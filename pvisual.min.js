/**
 * 
 * Various changes
 * 
 */


/*
 * 2013-12-21(v0.0.1-alpha)
 * 完成代码的第一次整合，集合的第一个版本 v0.1.0
 * 整合21种图形资源、建立API
 * @author Liyulin
 */

// ==========================================

/*
 * 2014-02-19(v0.0.2-alpha)
 * 改变的功能包括：
 * 1.对地图添加图例
 * 2.增加graph.dragHold(bool)选项，FALSE为graph的单节点动态拖拽，TRUE为节点集静态拖拽
 * 3.地图的初始大小从[600, 600]变化为[1000, 600]。并将地图的画板改为正方形，边长为初始大小的较小值
 * 4.pvisual.clone增加对function的复制功能，解决处理因为对array功能函数的复制导致的错误
 * @author Liyulin
 */

// ==========================================

/*
 * 2014-02-25(v0.0.3-alpha)
 * 解決严重bug：颜色库函数共享造成的颜色篡改，更改颜色函数;
 * 解决严重bug：浮动标签的位置偏移;
 */

// ==========================================

/*
 * 2014-03-08(v0.0.4-alpha)
 * 增加图片转换保存项(pvisual.save)
 * 引入依赖库（canvg.js filesaver.js jspdf.js jspdf.plugin.addimaage.js rgbcolor.js）开源MIT许可
 */

// ==========================================

/*
 * 2014-03-22(v0.0.5-alpha)
 * 新增图形样式combo
 */

// ==========================================

/*
 * 2014-05-18(v0.0.6-alpha)
 * 新增图形样式co_occurrence_matrix
 */
(function(_){'use strict';if(!_.d3)console.error('Pvisual needs the support of d3');var bt=_.d3;var bu='Pvisual';var bv=function(){return{color:bt.map({aliceblue:'#F0F8FF',antiquewhite:'#FAEBD7',aquamarine:'#7FFFD4',azure:'#F0FFFF',beige:'#F5F5DC',bisque:'#FFE4C4',black:'#000000',blanchedalmond:'#FFEBCD',blueviolet:'#8A2BE2',brown:'#A52A2A',burlywood:'#DEB887',cadetblue:'#5F9EA0',chartreuse:'#7FFF00',chocolate:'#D2691E',coral:'#FF7F50',cornflowerblue:'#6495ED',cornsilk:'#FFF8DC',crimson:'#DC143C',cyan:'#00FFFF',darkblue:'#00008B',darkcyan:'#008B8B',darkgoldenrod:'#B8860B',darkgray:'#A9A9A9',darkgreen:'#006400',darkgrey:'#A9A9A9',darkkhaki:'#BDB76B',darkmagenta:'#8B008B',darkolivegreen:'#556B2F',darkorange:'#FF8C00',darkorchid:'#9932CC',darkred:'#8B0000',darksalmon:'#E9967A',darkseagreen:'#8FBC8F',darkslateblue:'#483D8B',darkslategray:'#2F4F4F',darkslategrey:'#2F4F4F',darkturquoise:'#00CED1',darkviolet:'#9400D3',deeppink:'#FF1493',deepskyblue:'#00BFFF',dimgray:'#696969',dimgrey:'#696969',dodgerblue:'#1E90FF',firebrick:'#B22222',floralwhite:'#FFFAF0',forestgreen:'#228B22',gainsboro:'#DCDCDC',ghostwhite:'#F8F8FF',gold:'#FFD700',goldenrod:'#DAA520',grey:'#808080',greenyellow:'#ADFF2F',honeydew:'#F0FFF0',hotpink:'#FF69B4',indianred:'#CD5C5C',indigo:'#4B0082',ivory:'#FFFFF0',khaki:'#F0E68C',lavender:'#E6E6FA',lavenderblush:'#FFF0F5',lawngreen:'#7CFC00',lemonchiffon:'#FFFACD',lightblue:'#ADD8E6',lightcoral:'#F08080',lightcyan:'#E0FFFF',lightgoldenrodyellow:'#FAFAD2',lightgreen:'#90EE90',lightgrey:'#D3D3D3',lightpink:'#FFB6C1',lightsalmon:'#FFA07A',lightseagreen:'#20B2AA',lightskyblue:'#87CEFA',lightslategray:'#778899',lightslategrey:'#778899',lightsteelblue:'#B0C4DE',lightyellow:'#FFFFE0',limegreen:'#32CD32',linen:'#FAF0E6',magenta:'#FF00FF',mediumaquamarine:'#66CDAA',mediumblue:'#0000CD',mediumorchid:'#BA55D3',mediumpurple:'#9370DB',mediumseagreen:'#3CB371',mediumslateblue:'#7B68EE',mediumspringgreen:'#00FA9A',mediumturquoise:'#48D1CC',mediumvioletred:'#C71585',midnightblue:'#191970',mintcream:'#F5FFFA',mistyrose:'#FFE4E1',moccasin:'#FFE4B5',navajowhite:'#FFDEAD',oldlace:'#FDF5E6',olivedrab:'#6B8E23',orange:'#FFA500',orangered:'#FF4500',orchid:'#DA70D6',palegoldenrod:'#EEE8AA',palegreen:'#98FB98',paleturquoise:'#AFEEEE',palevioletred:'#DB7093',papayawhip:'#FFEFD5',peachpuff:'#FFDAB9',peru:'#CD853F',pink:'#FFC0CB',plum:'#DDA0DD',powderblue:'#B0E0E6',rosybrown:'#BC8F8F',royalblue:'#4169E1',saddlebrown:'#8B4513',salmon:'#FA8072',sandybrown:'#F4A460',seagreen:'#2E8B57',seashell:'#FFF5EE',sienna:'#A0522D',skyblue:'#87CEEB',slateblue:'#6A5ACD',slategray:'#708090',slategrey:'#708090',snow:'#FFFAFA',springgreen:'#00FF7F',steelblue:'#4682B4',tan:'#D2B48C',thistle:'#D8BFD8',tomato:'#FF6347',turquoise:'#40E0D0',violet:'#EE82EE',wheat:'#F5DEB3',whitesmoke:'#F5F5F5',yellowgreen:'#9ACD32'}),colorArray:['#579ce2','#87bdf4','#3bb4df','#7fd1ef','#a380ff','#baa0ff','#a164c5','#c28fe1','#d93a92','#ec74b6','#b82377','#d569a7','#bb3ca3','#d381c2','#da2d57','#ec6b8a','#4ca716','#4ca716','#5b63c2','#8e93d7','#15a9a3','#4ecac5','#a9ab48','#e8c670','#2aa5f5','#73c4fa','#f67e10','#feb648','#1faa77','#62c8a2','#eb4f20','#f58563','#ffc000','#ffd659','#f16ebc','#f6a1d3','#d23457','#e27b92']}};var bw=function(){};bw.version=function(){return'v0.0.5-alpha'};bw.windowSize=function(){var a={width:800,height:500};if(_.innerWidth&&_.innerHeight){a.width=_.innerWidth;a.height=_.innerHeight}if(document.body&&document.body.offsetWidth){a.width=document.body.offsetWidth;a.height=document.body.offsetHeight}if(document.documentElement&&document.documentElement.clientHeight&&document.documentElement.clientWidth){a.width=document.documentElement.clientWidth;a.height=document.documentElement.clientHeight}return a};bw.color=function(){var f=bv();var c=function(c){if(isFinite(c)){if(f.custom)return f.customArray[c%f.customArray.length];else return f.colorArray[c%f.colorArray.length]}else if(typeof c==='function'){if(f.custom)return(c(f.customArray));else return(c(f.colorArray))}else if(typeof c==='string'){if(!f.range){f.range=bt.set([]);f.rangeArray=[]}if(f.range.has(c)){var i;for(i=0;i<f.rangeArray.length;i++)if(f.rangeArray[i]===c)break;if(f.custom)return f.customArray[i%f.customArray.length];else return f.colorArray[i%f.colorArray.length]}else{f.range.add(c);f.rangeArray=f.range.values();if(f.custom)return f.customArray[(f.rangeArray.length-1)%f.customArray.length];else return f.colorArray[(f.rangeArray.length-1)%f.colorArray.length]}}};c.domain=function(a){if(typeof a==='object'&&a.constructor===Array){f.custom=bt.set(a);f.customArray=f.custom.values();return c}else if(arguments.length===0){return f.customArray}else{console.error('The color should be Array')}};c.range=function(a){if(typeof a==='object'&&a.constructor===Array){f.range=bt.set(a);f.rangeArray=f.range.values();return c}else if(arguments.length===0){return f.rangeArray}else{console.error('The range should be Array')}};c.getColorLib=function(){return f.color.entries()};c.gradientColor=function(a,b){if(!(typeof a==='object'&&a.constructor===Array)){console.error('The color should be Array')}var c=a[0];var d=a.length;var e=a[d-1];b=b||'default';if(b==='default'){return bt.interpolateRgb.apply(null,[c,e])}else return b.call(this,a)};return c};bw.keys=function(a){return bt.keys.call(this,a)};bw.values=function(a){if(typeof a==='object'&&a.constructor===Array)return a;return bw.keys.map(function(d){return a[d]})};bw.sum=function(a,b){var c=0;if(typeof obj==='object'&&obj.constructor===Array)b===undfined?c=bt.sum(a):c=bt.sum(a,b);else if(typeof obj==='object')b===undfined?c=bt.sum(bw.values(a)):c=bt.sum(bw.keys(a).map(b).map(function(d){return a[d]}));else{console.error('The list should be Array or Object with Numical attributes')}return c};bw.clone=function(a){if(typeof a!=='object'&&typeof a!=='function'){return a}if(typeof a==='function')return(new a()).constructor;var b={};if(a.constructor===Array){b=[];for(var i=0;i<a.length;i++)b.push(bw.clone(a[i]))}else{for(var i in a){b[i]=bw.clone(a[i])}}return b};bw.floatTag=function(d){var f=function(){};var g;var i;var j=function(e){var w=e.offsetWidth;var h=e.offsetHeight;var l=(function getX(a){return a.offsetLeft+(a.offsetParent?getX(a.offsetParent):a.x?a.x:0)}(e));var t=(function getY(a){return(a.offsetParent?a.offsetTop+getY(a.offsetParent):a.y?a.y:0)}(e));return{top:t,left:l,width:w,height:h,bottom:t+h,right:l+w}};var k=function(m){var x=m.x;var y=m.y;var a=j(i);var b=(g.node()).clientWidth;var c=(g.node()).clientHeight;if(x+b<=a.left+i.clientWidth){x=x-a.left}else{x=x-a.left-b}if(y+c<=a.top+i.clientHeight){y=y-a.top}else{y=y-a.top-c}g.style({'left':x+'px','top':y+'px'})};var n=function(){if(!bt.event){return false}f.call(this);k({'x':bt.event.pageX,'y':bt.event.pageY})};var o=function(a){i=a;g=bt.select(i).append('div').classed('floatTag',true).style({'border':'2px solid','border-color':'rgb(0, 0, 0)','background-color':'rgba(255, 255, 255, 0.85)','font-color':'rgb(0,0,0)','border-radius':'4px','padding':'12px 8px','font-size':'12px','box-shadow':' 1px 1px 1px 0px rgba(0,0,0,.5)','font-family':'"Lucida Grande", "Lucida Sans Unicode", Verdana, Arial, Helvetica, Arial','z-index':1000,'white-space':'nowrap','text-align':'center','opacity':'0','position':'absolute','transition':'opacity .15s','-moz-transition':'opacity .15s','-webkit-transition':'opacity .15s','-o-transition':'opacity .15s','top':60,'left':60});bt.select(i).on('mousemove',n);g.creator=o;return g};o.setContent=function(a){if(arguments.length===0){return f}f=a;return o};o.mouseToFloatTag=function(m){if(arguments.length===0){return mouseToFloatTag}mouseToFloatTag=m;return o};o.changeLoc=k;return o(d)};bw.extend=function(a,b){var c=function(){};a=a||bw;b=b||{};a.apply(c,arguments);c.prototype=new a();c.prototype.constructor=c;for(var d in a){if(c.hasOwnProperty(d))continue;c[d]=a[d]}for(var d in b){if(c.hasOwnProperty(d))continue;c[d]=b[d]}return c};bw.check=function(a,b){var c={};c.data=a;c.numMiss=0;c.flag=true;if(!c.data){console.error('Failed to load the data. Please check your file format');return}if(typeof c.data==='object'&&c.data.constructor===Array&&c.data.length>1){c.data.forEach(function(e){c.dimensions=bw.keys(e);c.dimensions.forEach(function(d){if(e[d]==='0')e[d]=0;e[d]=+e[d]||e[d]})});for(var i=1,item;i<c.data.length;i++){if(!c.flag)i--;item=c.data[i];if(i<c.data.length){if(!compareStructure.call(c,c.data[0],item,i)){console.error(((i===0)||(i===1))?'Wrong data structure: data 0 or data 1 is wrong':'Wrong data structure: data '+(i+1)+' is wrong');c.dataInFormat={meta:{isNested:true,isError:true},data:c.data};break}}else break}c.dataInFormat=dataConvert.call(c,c.data,b||'',c.numMiss)}else if(typeof c.data==='object'){c.dataInFormat=dataConvert(c.data,b||'',c.numMiss)}return c};bw.json=function(a,b){bt.json(a,function(_){_.type='json';b.call(this,_)})};bw.csv=function(a,b){bt.csv(a,function(_){_.type='csv';b.call(this,_)})};bw.tsv=function(a,b){bt.tsv(a,function(_){_.type='tsv';b.call(this,_)})};bw.xml=function(b,c){var d;bt.xml(b,function(_){var a=_.documentElement;d=xmlToArray(a,0,[]);d.type='xml';c(d)})};bw.xlsx=function(n,o){var q=[];q.name=n.name;q.type='xlsx';var r=new FileReader();r.onload=function(e){var k=e.target.result;var l=String.fromCharCode.apply(null,new Uint8Array(k));var m=XLSX.read(btoa(l),{type:'base64'});m.SheetNames.forEach(function(c){var e=XLSX.utils.sheet_to_csv(m.Sheets[c]);var f=e.split('\n');f.pop();var g=f.shift().split(',').map(function(d){d=d.replace(/"+/g,'');d=+d||d;return d});var h=[];f.forEach(function(p){var a={};var b=p.split(',').map(function(d){d=d.replace(/\"+/g,'');d=+d||d;return d});g.forEach(function(d,i){a[d]=b[i]||0});h.push(a)});var j={};j[c]=h;q.push(j)});o(q)};r.readAsArrayBuffer(n)};bw.xls=function(n,o){var q=[];q.name=n.name;q.type='xls';var r=new FileReader();r.onload=function(e){var k=e.target.result;var l=XLS.CFB.read(k,{type:'binary'});var m=XLS.parse_xlscfb(l);m.SheetNames.forEach(function(c){var e=XLS.utils.make_csv(m.Sheets[c]);var f=e.split('\n');f.pop();var g=f.shift().split(',').map(function(d){d=d.replace(/"+/g,'');d=+d||d;return d});var h=[];f.forEach(function(p){var a={};var b=p.split(',').map(function(d){d=d.replace(/\"+/g,'');d=+d||d;return d});g.forEach(function(d,i){a[d]=b[i]||0});h.push(a)});var j={};j[c]=h;q.push(j)});o(q)};r.readAsBinaryString(n)};bw.save=function(k,l){function internalCallback(){var a=null;var b;if(l==='svg'){for(var i=0;i<k.processing.buffer.length;i++){a=new XMLSerializer().serializeToString(k.processing.buffer[i][0]);b=generateBlob(a,'image/svg+xml');if(k.output==='save'){saveAs(b,'export.svg')}else if(k.output==='datastring'||k.output==='datauristring'||k.output==='dataurlstring'){b='data:image/svg+xml;base64,'+btoa(a)}else if(k.output==='dataurlnewwindow'){window.open('data:image/svg+xml;base64,'+btoa(a))}else if(k.output==='datauri'||k.output==='dataurl'){location.href='data:image/svg+xml;base64,'+btoa(a)}else if(k.output==='datastream'){location.href='data:image/octet-stream;base64,'+btoa(a)}}}else if(l==='application/pdf'||l==='pdf'){a=generatePDF(k).output('dataurlstring');b=generateBlob(a,'application/pdf');if(k.output==='save'){saveAs(b,'export.pdf')}else if(k.output==='datastring'||k.output==='datauristring'||k.output==='dataurlstring'){b=a}else if(k.output==='dataurlnewwindow'){window.open(a)}else if(k.output==='datauri'||k.output==='dataurl'){location.href=a}else if(k.output==='datastream'){location.href=a.replace('application/pdf','application/octet-stream')}}else if(l==='png'){a=k.canvas.toDataURL('image/png');b=generateBlob(a,'image/png');if(k.output==='save'){saveAs(b,'export.png')}else if(k.output==='datastring'||k.output==='datauristring'||k.output==='dataurlstring'){b=a}else if(k.output==='dataurlnewwindow'){window.open(a)}else if(k.output==='datauri'||k.output==='dataurl'){location.href=a}else if(k.output==='datastream'){location.href=a.replace('image/png','image/octet-stream')}}else if(l==='jpeg'||l==='jpg'){a=k.canvas.toDataURL('image/jpeg');b=generateBlob(a,'image/jpeg');if(k.output==='save'){saveAs(b,'export.jpg')}else if(k.output==='datastring'||k.output==='datauristring'||k.output==='dataurlstring'){b=a}else if(k.output==='dataurlnewwindow'){window.open(a)}else if(k.output==='datauri'||k.output==='dataurl'){location.href=a}else if(k.output==='datastream'){location.href=a.replace('image/jpeg','image/octet-stream')}}}function generateOutput(b){var c=document.getElementsByTagName('svg');var d=document.createElement('canvas');var e=d.getContext('2d');var f={y:0,x:0};k.svgs=c;k.processing.buffer=[];k.processing.drawn=0;k.canvas=d;for(var i=0;i<c.length;i++){var g=c[i].parentNode;var h=Number(g.style.left.slice(0,-2));var j=Number(g.style.top.slice(0,-2));f.x=h?h:f.x;f.y=j?j:f.y;k.processing.buffer.push([c[i],f])}d.id='canvas';d.width=k.svgs[0].clientWidth;d.height=k.svgs[0].clientHeight;if(k.backgroundColor||l==='jpeg'||l==='jpg'||l==='pdf'){e.fillStyle=k.backgroundColor||'#FFFFFF';e.fillRect(0,0,d.width,d.height)}function drawItWhenItsLoaded(){var a,buffer,f,source;if(k.processing.buffer.length===k.processing.drawn){return b()}else{buffer=k.processing.buffer[k.processing.drawn];source=new XMLSerializer().serializeToString(buffer[0]);f=buffer[1];canvg(d,source,{offsetX:f.x,offsetY:f.y,ignoreMouse:true,ignoreAnimation:true,ignoreDimensions:true,ignoreClear:true,renderCallback:function(){k.processing.drawn++;drawItWhenItsLoaded()}})}}return drawItWhenItsLoaded()}function generateBinaryArray(a){var b=a.length;var c=new Uint8Array(b/4*3|0);var i=0;var d=0;var e=[0,0];var f=0;var g=0;var h,code,undef,base64_ranks=new Uint8Array([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51]);while(b--){code=a.charCodeAt(i++);h=base64_ranks[code-43];if(h!==255&&h!==undef){e[1]=e[0];e[0]=code;g=(g<<6)|h;f++;if(f===4){c[d++]=g>>>16;if(e[1]!==61){c[d++]=g>>>8}if(e[0]!==61){c[d++]=g}f=0}}}return c}function generateBlob(a,b){var c=a.indexOf(',')+1;var d=a.substring(0,c);var e=a;var f=new Blob();if(d.indexOf('base64')!==-1){e=generateBinaryArray(a.substring(c))}if(false){f.data=e;f.size=e.length;f.type=b;f.encoding='base64'}else{f=new Blob([e],{type:b})}return f}function generatePDF(){var a={output:function(){return''}};var b=k.canvas.toDataURL('image/jpeg');var c=k.canvas.width/5;var d=k.canvas.height/5;if(window.jsPDF){a=new jsPDF();if(a.addImage){a.addImage(b,'JPEG',0,0,c,d)}else{console.error('Missing jsPDF plugin; Please add the "addImage" plugin.')}}else{console.error('Missing jsPDF lib; Do not forget to add the "addImage" plugin.')}return a}return generateOutput(internalCallback)};bw.save.generateButtons=function(h,j){if(!j)j={output:'save',processing:{},dpi:150,exportConfig:{menuTop:'auto',menuLeft:'auto',menuBottom:'auto',menuRight:'auto',menuItemStyle:{backgroundColor:'#EFEFEF',rollOverBackgroundColor:'#DDDDDD',color:'#000000',rollOverColor:'#CC0000',paddingTop:'6px',paddingRight:'6px',paddingBottom:'6px',paddingLeft:'6px',marginTop:'0px',marginRight:'0px',marginBottom:'0px',marginLeft:'0px',textAlign:'left',textDecoration:'none'},menuItems:[{textAlign:'center',icon:'export.png',onclick:function(){},items:[{title:'JPG',format:'jpg'},{title:'PNG',format:'png'},{title:'SVG',format:'svg'},{title:'PDF',format:'pdf'}]}]}};var k=document.createElement('div');var l=0;function createList(b){var c=document.createElement('ul');c.setAttribute('style','list-style: none; margin: 0; padding: 0;');for(var i=0;i<b.length;i++){var d=document.createElement('li');var e=document.createElement('img');var a=document.createElement('a');var f=b[i];var g=null;if(f['icon']){e.alt='保存';e.src=f['icon'];e.setAttribute('style','margin: 0 auto;border: none;outline: none');if(f['iconTitle']){e.title=f['iconTitle']}a.appendChild(e)}a.href='#';if(f['title']){e.setAttribute('style','margin-right: 5px;');a.innerHTML+=f.title}a.setAttribute('style','display: block; background-color: rgb(239, 239, 239); color: rgb(0, 0, 0); padding: 6px; margin: 0px; text-align: left; text-decoration: none; font-family: Verdana; font-size: 11px;');a.format=f.format;a.onclick=f.onclick||function(){bw.save(j,this.format)};d.appendChild(a);if(f.items){g=createList(f.items);d.appendChild(g);d.onmouseover=function(){g.style.display='block'};d.onmouseout=function(){g.style.display='none'};g.style.display='none'}c.appendChild(d);a.onmouseover=function(){this.style.backgroundColor=j.exportConfig.menuItemStyle.rollOverBackgroundColor;this.style.color=j.exportConfig.menuItemStyle.rollOverColor;this.style.borderColor=j.exportConfig.menuItemStyle.rollOverBorderColor};a.onmouseout=function(){this.style.backgroundColor=j.exportConfig.menuItemStyle.backgroundColor;this.style.color=j.exportConfig.menuItemStyle.color;this.style.borderColor=j.exportConfig.menuItemStyle.borderColor}}l++;return c}k.setAttribute('style','width:39px; position: absolute;top:'+j.exportConfig.menuTop+';right:'+j.exportConfig.menuRight+';bottom:'+j.exportConfig.menuBottom+';left:'+j.exportConfig.menuLeft+';box-shadow:0px 0px 1px 0px rgba(0,0,0,0);');k.appendChild(createList(j.exportConfig.menuItems));h.appendChild(k)};bw.model={};bw.model.area=function(){var j=bw.extend();var l=_.d3;var n='面积图';var o=900;var q=400;var r=o-200;var t=q-100;var u=50;var v=10;var w;var z='Arial';var A;var B;var C=1000;var D=l.format('s');var E=j.color();var F;var G;var H=null;var I=false;var J=false;var K='';var L='';var M=0;var N=0;var O=8;var P='#000000';var Q=8;var R=5;var S=5;var T=5;var U=8;var V='#929292';var W='#929292';var X=2;var Y='#000000';var Z='#000000';var bx=13;var by=0;var bz=0;var bA=10;var bB=100;j.getType=function(){return n};j.data=function(_){if(arguments.length){if(_.type==='xml'){_=_.root;_=_.map(function(d){var a={};d.row.row.forEach(function(p){var k=bw.keys(p)[0];a[k]=p[k]});return a})}else if(_.type==='xlsx'||_.type==='xls'){var s=[];for(var i=0;i<_.length;i++){var k=bw.keys(_[i])[0];s=s.concat(_[i][k])}_=s}w=_;G=bw.keys(_[0]).filter(function(d){return d!=='x'}).map(function(d){return{name:d,_flag:true}});var b=l.layout.stack().values(function(p){return p.value});F=b(G.map(function(p){return{name:p.name,value:_.map(function(d){return{x:d.x,y:+d[p.name]}})}}));G.x=F[0].value.map(function(d){return d.x});return this}else return w};j.getType=function(){return n};j.render=function(_){A=A||l.select(_).node();if(!A||A.tagName.toLowerCase()!=='div'){console.error('The argument(element) in area.rander(_) should be <div> element')}l.select(A).classed('chart',true);B=B||l.select(A).append('svg').classed('area',true).node();var c;var x;var y;var e;var f;if(H!==null)J=true;if(J){x=l.time.scale().domain(l.extent(G.x,function(d){return H.parse(d)})).range([0,r]);F.forEach(function(d){d.value.forEach(function(p){p.x=H.parse(p.x)})});F.forEach(function(d){d.value.sort(function(a,b){return a.x.getTime()-b.x.getTime()})});e=l.svg.axis().scale(x).orient('bottom').tickSize(S).ticks(Q)}else if(I){x=l.scale.linear().domain(l.extent(G.x,function(d){return+d})).range([0,r]);F.forEach(function(d){d.value.forEach(function(p){p.x=+p.x})});F.forEach(function(d){d.value.sort(function(a,b){return a.x-b.x})});e=l.svg.axis().scale(x).orient('bottom').ticks(Q).tickSize(S).tickFormat(D)}else{x=l.scale.ordinal().domain(G.x).rangePoints([0,r],0);e=l.svg.axis().scale(x).tickSize(S).orient('bottom')}F.forEach(function(d){var m=l.max(d.value,function(p){return p.y0+p.y});c=c>=m?c:m});y=l.scale.linear().domain([0,c]).range([t,0]);var a=l.svg.area().x(function(d){return x(d.x)}).y0(function(d){return y(d.y0)}).y1(function(d){return y(d.y0+d.y)});f=l.svg.axis().scale(y).orient('left').ticks(R).tickSize(T).tickFormat(D);var g=l.select(B).attr({'width':o,'height':q}).selectAll('g').data([1]).enter().append('svg:g').attr('transform','translate('+u+','+v+')');g.call(function(a){a.append('svg:g').classed('dimensions',true);a.append('svg:g').classed('x-axis axis',true);a.append('svg:g').classed('y-axis axis',true);a.append('svg:g').classed('legends',true)});g=l.select(B).select('g');var h=g.select('.dimensions').selectAll('.dimension').data(F);h.exit().transition().duration(C).style('opacity',0).remove();dimensionUpdate(h,a);dimensionDraw(h,a);var i=g.select('.legends').attr('transform','translate('+by+','+bz+')').selectAll('.legend').data(G);i.exit().transition().duration(C).style('opacity',0).remove();legendUpdate(i);legendDraw(i);axis(g,e,f)};function axis(g,b,c){g.select('.x-axis').each(function(){l.select(this).select('.label').transition().duration(C).attr({'x':r,'y':-6}).style({'text-anchor':'end','font-family':z,'font-size':O,'fill':P}).text(L);l.select(this).selectAll('.label').data([1]).enter().append('svg:text').classed('label',true).style({'text-anchor':'end','font-family':z,'font-size':O,'fill':P}).attr({'x':r,'y':-6}).text(L);l.select(this).transition().duration(C).attr('transform','translate(0,'+t+')').call(b)});g.select('.y-axis').each(function(){l.select(this).select('.label').style({'text-anchor':'end','font-family':z,'font-size':O,'fill':P}).text(K);l.select(this).selectAll('.label').data([1]).enter().append('svg:text').classed('label',true).style({'text-anchor':'end','font-family':z,'font-size':O,'fill':P}).attr({'transform':'rotate(-90)','y':8,'dy':'.71em'}).text(K);l.select(this).transition().duration(C).call(c)});g.selectAll('.axis').call(function(a){a.selectAll('path').style({'fill':'none','stroke':Y,'stroke-width':X,'shape-rendering':'crispEdges'});a.selectAll('line').style({'fill':'none','stroke':W,'shape-rendering':'crispEdges'})});g.select('.x-axis').selectAll('.tick').select('text').style({'text-anchor':'middle','font-family':z,'font-size':U,'fill':V}).attr('transform',function(){return'translate('+this.getComputedTextLength()*Math.abs(Math.sin(M)*.5)+','+(this.getComputedTextLength()*(.3*Math.abs(Math.sin(M))))+')rotate('+M+')'});g.select('.y-axis').selectAll('.tick').select('text').style({'text-anchor':'start','font-family':z,'font-size':U,'fill':V}).attr('transform',function(){return'translate('+ -this.getComputedTextLength()+', 0)rotate('+N+')'})}function dimensionUpdate(b,a){b.transition().duration(C).attr('d',function(d){return a(d.value)}).style('fill',function(d){return E(d.name)})}function dimensionDraw(b,a){b.enter().append('svg:path').classed('dimension',true).attr('d',function(d){return a(d.value)}).style('fill',function(d){return E(d.name)}).style('opacity',0).transition().duration(C).style('opacity',1)}function legendDraw(b){b.enter().append('svg:g').classed('legend',true).style('cursor','pointer').on('click',function(d){if(!l.select(this).classed('none')){if(G.length>1){l.select(this).classed('none',true);d._flag=false;var a=l.layout.stack().values(function(p){return p.value});F=a(G.filter(function(p){return p._flag}).map(function(p){return{name:p.name,value:w.map(function(d){return{x:d.x,y:+d[p.name]}})}}));j.render()}}else{l.select(this).classed('none',false);d._flag=true;var a=l.layout.stack().values(function(p){return p.value});F=a(G.filter(function(p){return p._flag}).map(function(p){return{name:p.name,value:w.map(function(d){return{x:d.x,y:+d[p.name]}})}}));j.render()}}).each(function(d,i){l.select(this).append('svg:rect').attr({'x':(i-i%bA)/bA*bB+r+20,'y':i%bA*20}).attr({'width':10,'height':10}).style({'fill':E(i),'stroke':E(i)}).style('fill-opacity',d._flag?1:0).style('opacity',0).transition().duration(C/2).style('opacity',1);l.select(this).append('svg:text').attr({'x':(i-i%bA)/bA*bB+r+40,'y':i%bA*20+9}).style({'opacity':0,'font-size':bx,'fill':Z,'font-family':z}).transition().duration(C/2).style('opacity',1).text(d.name)})}function legendUpdate(a){a.each(function(d,i){l.select(this).selectAll('rect').transition().duration(C/2).style({'fill':E(i),'stroke':E(i)}).style('fill-opacity',d._flag?1:0).attr({'x':(i-i%bA)/bA*bB+r+20,'y':i%bA*20});l.select(this).selectAll('text').style({'font-size':bx,'font-family':z}).transition().duration(C/2).attr({'x':(i-i%bA)/bA*bB+r+40,'y':i%bA*20+9}).style('fill',Z).text(d.name)})}j.size=function(_){if(!arguments.length)return[o,q];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in area.size(width, height) should be number and number of svg');return this}else{o=arguments[0];q=arguments[1];return this}};j.sizeAvail=function(_){if(!arguments.length)return[r,t];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in area.sizeAvail(widthAvail, heightAvail) should be number and number of svg');return this}else{r=arguments[0];t=arguments[1];return this}};j.tran=function(_){if(!arguments.length)return[u,v];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in area.tran(tranX, tranY) should be number and number of svg');return this}else{u=arguments[0];v=arguments[1];return this}};j.fontFamily=function(_){if(!arguments.length)return z;else{if(typeof arguments[0]!=='string'){console.error('The arguments in area.fontFamily(fontFamily) should be string of text');return this}else{fontSize=arguments[0];return this}}};j.duration=function(_){if(!arguments.length)return C;else{if(!isFinite(arguments[0])){console.error('The arguments in area.duration(duration) should be number of transition');return this}else{C=Math.round(arguments[0]);return this}}};j.tickFormat=function(_){if(!arguments.length)return D;else{if(typeof arguments[0]!=='string'){console.error('The arguments in area.tickFormat(format) should be string of d3.format');return this}else{D=l.format(arguments[0]);return this}}};j.timeFormat=function(_){if(!arguments.length)return H;else{if(typeof arguments[0]!=='string'){console.error('The arguments in area.timeFormat(format) should be string of d3.format');return this}else{H=l.time.format(arguments[0]);return this}}};j.isLinear=function(_){if(!arguments.length)return I;else{if(I!==true&&I!==false){console.error('The arguments in area.isLinear(isLinear) should be bool');return this}else{I=arguments[0];return this}}};j.xLegend=function(_){if(!arguments.length)return L;else{if(typeof arguments[0]!=='string'){console.error('The arguments in area.xLegend(xLegend) should be string');return this}else{L=arguments[0];return this}}};j.yLegend=function(_){if(!arguments.length)return K;else{if(typeof arguments[0]!=='string'){console.error('The arguments in area.yLegend(yLegend) should be string');return this}else{K=arguments[0];return this}}};j.xtickRotate=function(_){if(!arguments.length)return M;else{if(!isFinite(arguments[0])){console.error('The arguments in area.xtickRotate(xtickRotate) should be number of tick');return this}else{M=Math.round(arguments[0]);return this}}};j.ytickRotate=function(_){if(!arguments.length)return N;else{if(!isFinite(arguments[0])){console.error('The arguments in area.ytickRotate(ytickRotate) should be number of tick');return this}else{N=Math.round(arguments[0]);return this}}};j.labelSize=function(_){if(!arguments.length)return O;else{if(!isFinite(arguments[0])){console.error('The arguments in area.labelSize(labelSize) should be string');return this}else{O=arguments[0];return this}}};j.labelColor=function(_){if(!arguments.length)return P;else{if(typeof arguments[0]!=='string'){console.error('The arguments in area.labelColor(labelColor) should be string');return this}else{P=arguments[0];return this}}};j.xtickNumber=function(_){if(!arguments.length)return Q;else{if(!isFinite(arguments[0])){console.error('The arguments in area.xtickNumber(xtickNumber) should be number of tick');return this}else{Q=Math.round(arguments[0]);return this}}};j.ytickNumber=function(_){if(!arguments.length)return R;else{if(!isFinite(arguments[0])){console.error('The arguments in area.ytickNumber(ytickNumber) should be number of tick');return this}else{R=Math.round(arguments[0]);return this}}};j.tickLineColor=function(_){if(!arguments.length)return W;else{if(typeof arguments[0]!=='string'){console.error('The arguments in area.tickLineColor(tickLineColor) should be string');return this}else{W=arguments[0];return this}}};j.tickTextSize=function(_){if(!arguments.length)return U;else{if(!isFinite(arguments[0])){console.error('The arguments in area.tickTextSize(tickTextSize) should be number');return this}else{U=arguments[0];return this}}};j.tickTextColor=function(_){if(!arguments.length)return V;else{if(typeof arguments[0]!=='string'){console.error('The arguments in area.tickTextColor(tickTextColor) should be string');return this}else{V=arguments[0];return this}}};j.axisPathWidth=function(_){if(!arguments.length)return X;else{if(!isFinite(arguments[0])){console.error('The arguments in area.axisPathWidth(axisPathWidth) should be string');return this}else{X=arguments[0];return this}}};j.axisPathColor=function(_){if(!arguments.length)return Y;else{if(typeof arguments[0]!=='string'){console.error('The arguments in area.axisPathColor(axisPathColor) should be string');return this}else{Y=arguments[0];return this}}};j.legendTran=function(_){if(!arguments.length)return[by,bz];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in area.legendTran(tranX, tranY) should be number and number of svg');return this}else{by=arguments[0];bz=arguments[1];return this}};j.legendSize=function(_){if(!arguments.length)return bx;else{if(!isFinite(arguments[0])){console.error('The arguments in area.legendSize(legendSize) should be number of text');return this}else{bx=arguments[0];return this}}};j.legendColor=function(_){if(!arguments.length)return Z;else{if(typeof arguments[0]!=='string'){console.error('The arguments in area.legendColor(legendColor) should be string of text');return this}else{Z=arguments[0];return this}}};j.legendColumnNo=function(_){if(!arguments.length)return bA;else{if(!isFinite(arguments[0])){console.error('The arguments in area.legendColumnNo(legendColumnNo) should be number of text');return this}else{bA=arguments[0];return this}}};j.legendRowGap=function(_){if(!arguments.length)return bB;else{if(!isFinite(arguments[0])){console.error('The arguments in area.legendRowGap(legendRowGap) should be number of text');return this}else{bB=arguments[0];return this}}};j.options=function(_){if(!arguments.length)return{'type':j.getType(),'width':o,'height':q,'widthAvail':r,'heightAvail':t,'tranX':u,'tranY':v,'format':D,'fontFamily':z,'color':E,'duration':C,'timeFormat':H,'isLinear':I,'xLegend':L,'yLegend':K,'xtickRotate':M,'ytickRotate':N,'labelSize':O,'labelColor':P,'xtickNumber':Q,'ytickNumber':R,'tickTextSize':U,'tickTextColor':V,'tickLineColor':W,'xtickLineLength':S,'ytickLineLength':T,'axisPathWidth':X,'axisPathColor':Y,'legendColor':Z,'legendSize':bx,'legendTranX':by,'legendTranY':bz,'legendColumnNo':bA,'legendRowGap':bB};else if(typeof _!=='object'){console.error('The arguments in map.options(options) should be object');return this}else{o=isFinite(_.width)?_.width:o;q=isFinite(_.height)?_.height:q;r=isFinite(_.widthAvail)?_.widthAvail:r;t=isFinite(_.heightAvail)?_.heightAvail:t;u=isFinite(_.tranX)?_.tranX:u;v=isFinite(_.tranY)?_.tranY:v;_.format&&j.tickFormat(_.format);_.fontFamily&&j.fontFamily(_.fontFamily);isFinite(_.duration)&&j.duration(_.duration);_.isLinear&&j.isLinear(_.isLinear);_.xLegend&&j.xLegend(_.xLegend);_.yLegend&&j.yLegend(_.yLegend);isFinite(_.xtickRotate)&&j.xtickRotate(_.xtickRotate);isFinite(_.ytickRotate)&&j.ytickRotate(_.ytickRotate);isFinite(_.labelSize)&&j.labelSize(_.labelSize);_.labelColor&&j.labelColor(_.labelColor);isFinite(_.xtickNumber)&&j.xtickNumber(_.xtickNumber);isFinite(_.ytickNumber)&&j.ytickNumber(_.ytickNumber);isFinite(_.tickTextSize)&&j.tickTextSize(_.tickTextSize);_.tickTextColor&&j.tickTextColor(_.tickTextColor);_.tickLineColor&&j.tickLineColor(_.tickLineColor);isFinite(_.xtickLineLength)&&j.xtickLineLength(_.xtickLineLength);isFinite(_.ytickLineLength)&&j.ytickLineLength(_.ytickLineLength);isFinite(_.axisPathWidth)&&j.axisPathWidth(_.axisPathWidth);_.axisPathColor&&j.axisPathColor(_.axisPathColor);_.legendColor&&j.legendColor(_.legendColor);isFinite(_.legendSize)&&j.legendSize(_.legendSize);by=isFinite(_.legendTranX)?_.legendTranX:by;bz=isFinite(_.legendTranY)?_.legendTranY:bz;isFinite(_.legendColumnNo)&&j.legendColumnNo(_.legendColumnNo);isFinite(_.legendRowGap)&&j.legendRowGap(_.legendRowGap);return this}};if(arguments.length===1)j.options(arguments[0]);return j};bw.model.boxplot=function(){var r=bw.extend();var t=_.d3;var u='箱式图';var v=800;var w=500;var z=v-100;var A=w-30;var B;var C=10;var D=10;var E=8;var F='Arial';var G='#000';var H;var I;var J;var K=1000;var L=t.format('s');var M=r.color();var N;var O;var P=.2;var Q=5;var R=2;var S='#000000';var T='#000000';var U=13;var V=0;var W=0;var X=10;var Y=100;r.data=function(_){if(arguments.length){if(_.type==='xml'){_=_.root;_=_.map(function(d){var a={};d.row.row.forEach(function(p){var k=bw.keys(p)[0];a[k]=p[k]});return a})}else if(_.type==='xlsx'||_.type==='xls'){var s=[];for(var i=0;i<_.length;i++){var k=bw.keys(_[i])[0];s=s.concat(_[i][k])}_=s}B=t.nest().key(function(d){return d.name}).sortValues(function(a,b){return+a.value- +b.value}).entries(_);return this}else return B};r.getType=function(){return u};r.render=function(_){I=I||t.select(_).node();if(!I||I.tagName.toLowerCase()!=='div'){console.error('The argument(element) in boxplot.rander(_) should be <div> element')}t.select(I).classed('chart',true);J=J||t.select(I).append('svg').classed('boxplot',true).node();N=B.filter(function(d){return d._flag!==false});O=N.map(function(d){return d.key});var b=z/O.length;H=t.select(I).select('.floatTag').node()?t.select(I).select('.floatTag'):r.floatTag(I);var c=Infinity;var e=-Infinity;N.forEach(function(d){c=c<+d.values[0].value?c:+d.values[0].value;e=e>+d.values[d.values.length-1].value?e:+d.values[d.values.length-1].value});var x=t.scale.ordinal();var y=t.scale.linear();x.rangeBands([0,z]).domain(O);y.domain([c,e]).range([A,0]);t.select(J).attr({'width':v,'height':w}).selectAll('g').data([1]).enter().append('svg:g').attr('transform','translate('+C+','+D+')');var g=t.select(J).select('g');g.call(function(a){a.append('svg:g').classed('nodes',true);a.append('svg:g').classed('legends',true)});g=t.select(J).select('g');var f=g.select('.nodes').selectAll('.node').data(N);f.exit().transition().duration(K).style('opacity',0).remove();nodeUpdate(f,b,x,y);nodeDraw(f,b,x,y);var h=g.select('.legends').attr('transform','translate('+V+','+W+')').selectAll('.legend').data(B);h.exit().transition().duration(K).style('opacity',0).remove();legendUpdate(h);legendDraw(h)};function legendDraw(a){a.enter().append('svg:g').classed('legend',true).style('cursor','pointer').on('click',function(d){if(!t.select(this).classed('none')){if(B.length>1){t.select(this).classed('none',true);for(var j=0,k;j<B.length;j++){k=B[j];if(k.key===d.key){k._flag=false;break}}r.render()}}else{t.select(this).classed('none',false);for(var j=0,k;j<B.length;j++){k=B[j];if(k.key===d.key){k._flag=true;break}}r.render()}}).each(function(d,i){t.select(this).append('svg:rect').attr({'x':(i-i%X)/X*Y+z-20,'y':i%X*20+10}).attr({'width':10,'height':10}).style({'fill':M(d.key),'stroke':M(d.key)}).style('fill-opacity',d._flag!==false?1:0).style('opacity',0).transition().duration(K/2).style('opacity',1);t.select(this).append('svg:text').attr({'x':(i-i%X)/X*Y+z,'y':i%X*20+19}).style({'opacity':0,'font-size':U,'fill':T,'font-family':F}).transition().duration(K/2).style('opacity',1).text(d.key)})}function legendUpdate(a){a.each(function(d,i){t.select(this).select('rect').transition().duration(K/2).attr({'x':(i-i%X)/X*Y+z-20,'y':i%X*20+10}).style({'fill':M(d.key),'stroke':M(d.key)}).style('fill-opacity',d._flag!==false?1:0);t.select(this).select('text').transition().duration(K/2).attr({'x':(i-i%X)/X*Y+z,'y':i%X*20+19}).style({'font-size':U,'fill':T,'font-family':F}).text(d.key)})}function nodeDraw(n,o,x,y){var q=o*P;n.enter().append('svg:g').classed('node',true).attr('transform',function(d){return'translate('+x(d.key)+',0)'}).on('mouseover',function(d){drawLegend(d,true)}).on('mouseout',function(d){drawLegend(d,false)}).each(function(d){var a=d.values.map(function(p){return+p.value});var b=boxQuartiles(a);var c=outplot(a,b,1);var e=c&&c.map(function(i){return a[i]});var f=c?t.range(0,c[0]).concat(t.range(c[1]+1,a.length)):t.range(a.length);var g=t.select(this).selectAll('.center').data(e?[e]:[]);g.enter().append('svg:line').classed('center',true).style({'opacity':0,'stroke':S,'stroke-width':R,'stroke-dasharray':'3,3'}).attr('x1',o/2).attr('x2',o/2).attr('y1',function(p){return y(p[1])}).attr('y2',function(p){return y(p[1])}).transition().duration(K).style('opacity',1).attr('y1',function(p){return y(p[0])});var h=t.select(this).selectAll('.box').data([b]);h.enter().append('svg:rect').classed('box',true).attr('x',q).attr('y',function(p){return y(p[2])}).attr('width',o-2*q).attr('height',function(p){return y(p[0])-y(p[2])}).style({'opacity':0,'fill':M(d.key),'stroke':S,'stroke-width':R}).transition().duration(K).style('opacity',1);var j=t.select(this).selectAll('.median').data([b[1]]);j.enter().append('svg:line').classed('median',true).style({'opacity':0,'stroke':S,'stroke-width':R}).attr('x1',q).attr('x2',o-q).attr('y1',y(b[2])).attr('y2',y(b[2])).transition().duration(K).style('opacity',1).attr('y2',function(p){return y(p)}).attr('y1',function(p){return y(p)});var k=t.select(this).selectAll('.whisker').data(e||[]);k.enter().append('svg:line').classed('whisker',true).style({'opacity':0,'stroke':S,'stroke-width':R}).attr('x1',o/2).attr('x2',o/2).attr('y1',function(p){return y(p)}).attr('y2',function(p){return y(p)}).transition().duration(K).style('opacity',1).attr('x1',q).attr('x2',o-q);var l=t.select(this).selectAll('.outlier').data(f);l.enter().append('svg:circle').classed('outlier',true).on('mouseover',function(p){t.select(this).transition().duration(K/2).style('fill-opacity',0);drawLegendOutlier(a[p],true);t.event.stopPropagation()}).on('mouseout',function(p){t.select(this).transition().duration(K/2).style('fill-opacity',1);drawLegendOutlier(a[p],false);t.event.stopPropagation()}).style({'fill':M(d.key),'stroke':M(d.key),'opacity':0}).attr('r',Q).attr('cx',o/2).attr('cy',function(p){return y(a[p])}).transition().duration(K).style('opacity',1);var m=t.select(this).selectAll('.tick').data(b);m.enter().append('svg:text').classed('tick',true).style({'opacity':0,'fill':G,'font-size':E,'font-family':F}).attr('dy','.3em').attr('dx',function(p,i){return i&1?6:-6}).attr('x',function(p,i){return i&1?(o-q):q}).attr('y',function(p){return y(p)}).attr('text-anchor',function(p,i){return i&1?'start':'end'}).transition().duration(K).style('opacity',1).text(function(p){return L(p)})})}function nodeUpdate(h,j,x,y){var k=j*P;h.transition().duration(K).attr('transform',function(d){return'translate('+x(d.key)+',0)'});h.each(function(d){var a=d.values.map(function(p){return+p.value});var b=boxQuartiles(a);var c=outplot(a,b,1);var e=c&&c.map(function(i){return a[i]});var f=c?t.range(0,c[0]).concat(t.range(c[1]+1,a.length)):t.range(a.length);t.select(this).select('.center').data(e?[e]:[]).transition().duration(K).style({'stroke':S,'stroke-width':R}).attr('x1',j/2).attr('y1',function(p){return y(p[0])}).attr('x2',j/2).attr('y2',function(p){return y(p[1])});t.select(this).select('.box').data([b]).transition().duration(K).style({'stroke':S,'stroke-width':R,'fill':M(d.key)}).attr('x',k).attr('y',function(p){return y(p[2])}).attr('width',j-2*k).attr('height',function(p){return y(p[0])-y(p[2])});t.select(this).selectAll('.median').data([b[1]]).transition().duration(K).style({'stroke':S,'stroke-width':R}).attr('x1',k).attr('y1',function(p){return y(p)}).attr('x2',j-k).attr('y2',function(p){return y(p)});t.select(this).selectAll('.whisker').data(e||[]).transition().duration(K).style({'stroke':S,'stroke-width':R}).attr('x1',k).attr('y1',function(p){return y(p)}).attr('x2',j-k).attr('y2',function(p){return y(p)});var g=t.select(this).selectAll('.outlier').data(f);g.exit().transition().duration(K).attr('r',Q).style('opacity',0).remove();g.transition().duration(K).style({'fill':M(d.key),'stroke':M(d.key)}).attr('cx',j/2).attr('cy',function(i){return y(a[i])});g.enter().append('svg:circle').classed('outlier',true).on('mouseover',function(p){t.select(this).transition().duration(K/2).style('fill-opacity',0);drawLegendOutlier(a[p],true)}).on('mouseout',function(p){t.select(this).transition().duration(K/2).style('fill-opacity',1);drawLegendOutlier(a[p],false)}).style({'fill':M(d.key),'stroke':M(d.key),'opacity':0}).attr('r',Q).attr('cx',j/2).attr('cy',function(p){return y(a[p])}).transition().duration(K).style('opacity',1);t.select(this).selectAll('.tick').data(b).transition().duration(K).style({'fill':G,'font-size':E,'font-family':F}).attr('dx',function(p,i){return i&1?6:-6}).attr('x',function(p,i){return i&1?(j-k):k}).attr('y',function(p){return y(p)}).attr('text-anchor',function(p,i){return i&1?'start':'end'}).text(function(p){return L(p)})})}function boxQuartiles(d){return[t.quantile(d,.25),t.quantile(d,.5),t.quantile(d,.75)]}function outplot(d,a,k){var b=a[0],q3=a[2],iqr=(q3-b)*k,i=-1,j=d.length;while(d[++i]<b-iqr);while(d[--j]>q3+iqr);return[i,j]}function drawLegendOutlier(d,a){if(a){H.html('abnormal point value: '+d).style({'textAlign':'center','margin':'auto','color':'#ffffff'});H.style({'visibility':'visible'})}else H.style({'visibility':'hidden'})}function drawLegend(d,a){if(a){var b=d.values.map(function(p){return+p.value});var c=boxQuartiles(b);H.html('<div style="font-family:Helvetica;font-size:10px;"><p style="font-style:italic;margin-bottom:5px">name: '+d.key+'</p><p style="color:#2f7ed8;font-weight:bold;margin:5px">Observations</p>Minimum: '+b[0]+'<br/>Lower quartile: '+c[0]+'<br/>Median: '+c[1]+'<br/>Higher quartile: '+c[2]+'<br/>Maximum: '+b[b.length-1]+'<br/></div>').style({'border-color':M(d.key),'opacity':1,'textAlign':'center','margin':'auto'})}else H.style('opacity',0)}r.size=function(_){if(!arguments.length)return[v,w];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in boxplot.size(width, height) should be number and number of svg');return this}else{v=arguments[0];w=arguments[1];return this}};r.sizeAvail=function(_){if(!arguments.length)return[z,A];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in boxplot.sizeAvail(widthAvail, heightAvail) should be number and number of svg');return this}else{z=arguments[0];A=arguments[1];return this}};r.tran=function(_){if(!arguments.length)return[C,D];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in boxplot.tran(tranX, tranY) should be number and number of svg');return this}else{C=arguments[0];D=arguments[1];return this}};r.fontSize=function(_){if(!arguments.length)return E;else{if(!isFinite(arguments[0])){console.error('The arguments in boxplot.fontSize(fontSize) should be number of text');return this}else{E=arguments[0];return this}}};r.fontFamily=function(_){if(!arguments.length)return F;else{if(typeof arguments[0]!=='string'){console.error('The arguments in boxplot.fontFamily(fontFamily) should be string of text');return this}else{E=arguments[0];return this}}};r.fontColor=function(_){if(!arguments.length)return G;else{if(typeof arguments[0]!=='string'){console.error('The arguments in boxplot.fontColor(fontColor) should be string of text');return this}else{G=arguments[0];return this}}};r.duration=function(_){if(!arguments.length)return K;else{if(!isFinite(arguments[0])){console.error('The arguments in boxplot.duration(duration) should be number of transition');return this}else{K=Math.round(arguments[0]);return this}}};r.color=function(_){if(!arguments.length)return M;else{if(typeof arguments[0]!=='function'){console.error('The arguments in boxplot.color(color) should be function of pvisual.color');return this}else{M=arguments[0];return this}}};r.tickFormat=function(_){if(!arguments.length)return L;else{if(typeof arguments[0]!=='string'){console.error('The arguments in boxplot.tickFormat(format) should be string of d3.format');return this}else{L=t.format(arguments[0]);return this}}};r.legendTran=function(_){if(!arguments.length)return[V,W];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in boxplot.legendTran(tranX, tranY) should be number and number of svg');return this}else{V=arguments[0];W=arguments[1];return this}};r.legendSize=function(_){if(!arguments.length)return U;else{if(!isFinite(arguments[0])){console.error('The arguments in boxplot.legendSize(legendSize) should be number of text');return this}else{U=arguments[0];return this}}};r.legendColor=function(_){if(!arguments.length)return T;else{if(typeof arguments[0]!=='string'){console.error('The arguments in boxplot.legendColor(legendColor) should be string of text');return this}else{T=arguments[0];return this}}};r.legendColumnNo=function(_){if(!arguments.length)return X;else{if(!isFinite(arguments[0])){console.error('The arguments in boxplot.legendColumnNo(legendColumnNo) should be number of text');return this}else{X=arguments[0];return this}}};r.legendRowGap=function(_){if(!arguments.length)return Y;else{if(!isFinite(arguments[0])){console.error('The arguments in boxplot.legendRowGap(legendRowGap) should be number of text');return this}else{Y=arguments[0];return this}}};r.padding=function(_){if(!arguments.length)return P;else{if(!isFinite(arguments[0])){console.error('The arguments in boxplot.padding(padding) should be number');return this}else{P=arguments[0];return this}}};r.lineWidth=function(_){if(!arguments.length)return R;else{if(!isFinite(arguments[0])){console.error('The arguments in boxplot.lineWidth(lineWidth) should be number');return this}else{R=arguments[0];return this}}};r.lineColor=function(_){if(!arguments.length)return S;else{if(typeof arguments[0]!=='string'){console.error('The arguments in boxplot.lineColor(lineColor) should be string');return this}else{S=arguments[0];return this}}};r.outclicleSize=function(_){if(!arguments.length)return Q;else{if(!isFinite(arguments[0])){console.error('The arguments in boxplot.outclicleSize(outclicleSize) should be number');return this}else{Q=arguments[0];return this}}};r.options=function(_){if(!arguments.length)return{'type':r.getType(),'width':v,'height':w,'widthAvail':z,'heightAvail':A,'tranX':C,'tranY':D,'format':L,'fontSize':E,'fontColor':G,'fontFamily':F,'color':M,'duration':K,'padding':P,'outclicleSize':Q,'lineWidth':R,'lineColor':S,'legendColor':T,'legendSize':U,'legendTranX':V,'legendTranY':W,'legendColumnNo':X,'legendRowGap':Y};else if(typeof _!=='object'){console.error('The arguments in map.options(options) should be object');return this}else{v=isFinite(_.width)?_.width:v;w=isFinite(_.height)?_.height:w;z=isFinite(_.widthAvail)?_.widthAvail:z;A=isFinite(_.heightAvail)?_.heightAvail:A;C=isFinite(_.tranX)?_.tranX:C;D=isFinite(_.tranY)?_.tranY:D;_.format&&r.tickFormat(_.format);_.fontFamily&&r.fontFamily(_.fontFamily);_.fontColor&&r.fontColor(_.fontColor);isFinite(_.fontSize)&&r.fontSize(_.fontSize);isFinite(_.duration)&&r.duration(_.duration);isFinite(_.padding)&&r.padding(_.padding);isFinite(_.outclicleSize)&&r.outclicleSize(_.outclicleSize);isFinite(_.lineWidth)&&r.lineWidth(_.lineWidth);_.lineColor&&r.lineColor(_.lineColor);_.legendColor&&r.legendColor(_.legendColor);isFinite(_.legendSize)&&r.legendSize(_.legendSize);V=isFinite(_.legendTranX)?_.legendTranX:V;W=isFinite(_.legendTranY)?_.legendTranY:W;isFinite(_.legendColumnNo)&&r.legendColumnNo(_.legendColumnNo);isFinite(_.legendRowGap)&&r.legendRowGap(_.legendRowGap);return this}};if(arguments.length===1)r.options(arguments[0]);return r};bw.model.chernoff=function(){var e=bw.extend();var f=_.d3;var h='切尔诺夫脸谱图';var j=600;var l=600;var m=j;var n=l;var o=0;var q=0;var r;var t=10;var u='Arial';var v;var w;var x;var y=1000;var z=f.format('s');var A=e.color();var B=2;var C=function(d){return'#000'};e.data=function(_){if(arguments.length){if(_.type==='xml'){_=_.root;_=_.map(function(d){var a={};d.row.row.forEach(function(p){var k=bw.keys(p)[0];a[k]=p[k]});return a})}else if(_.type==='xlsx'||_.type==='xls'){var s=[];for(var i=0;i<_.length;i++){var k=bw.keys(_[i])[0];s=s.concat(_[i][k])}_=s}r=_;return this}else return r};e.getType=function(){return h};e.render=function(_){w=w||f.select(_).node();if(!w||w.tagName.toLowerCase()!=='div'){console.error('The argument(element) in chernoff.rander(_) should be <div> element')}f.select(w).classed('chart',true);x=x||f.select(w).append('svg').classed('chernoff',true).node();var b=f.chernoff().face(function(d){return d.f}).hair(function(d){return d.h}).mouth(function(d){return d.m}).nosew(function(d){return d.nw}).noseh(function(d){return d.nh}).eyew(function(d){return d.ew}).eyeh(function(d){return d.eh}).brow(function(d){return d.b});v=f.select(w).select('.floatTag').node()?f.select(w).select('.floatTag'):e.floatTag(w);var g=f.select(x).attr({'width':j,'height':l}).selectAll('g').data([1]).enter().append('svg:g').attr('transform','translate('+o+','+q+')');g.call(function(a){a.append('svg:g').classed('dimensions',true)});g=f.select(x).select('g');var c=g.select('.dimensions').selectAll('.dimension').data(r);c.exit().transition().duration(y).style('opacity',0).remove();c.call(b).transition().duration(y).attr('transform',function(d,i){return'translate('+(i%parseInt(m/150)*150)+','+(parseInt(i/(m/150))*150)+')'}).select('text').style('stroke',C).style({'font-family':u,'font-size':t}).text(function(d){return d.name});c.enter().append('svg:g').classed('dimension',true).on('mouseover',function(d){drawLegend(d,true)}).on('mouseout',function(d){drawLegend(d,false)}).style('stroke',C).style({'fill':'none','stroke-width':B,'opacity':0}).call(b).call(function(a){a.append('svg:text').style('stroke',C).style({'text-anchor':'middle','font-family':u,'stroke-width':1,'font-size':t}).attr('transform',function(d,i){return'translate(70, 175)'}).text(function(d){return d.name})}).attr('transform',function(d,i){return'translate('+(i%parseInt(m/150)*150)+','+(parseInt(i/(m/150))*150)+')'}).transition().duration(y).style('opacity',1)};function drawLegend(d,a){if(a){v.style({'opacity':1,'textAlign':'center','margin':'auto'}).html('<span style="color:#2f7ed8;font-size:15px;font-weight:bold;margin:5px">name: '+d.name+'</span><hr style="margin:5px"/>face: '+z(d.f)+'<br/>hair: '+z(d.h)+'<br/>nose-w: '+z(d.nw)+'<br/>nose-h: '+z(d.nh)+'<br/>eye-w: '+z(d.ew)+'<br/>eye-h: '+z(d.eh)+'<br/>mouse: '+z(d.m)+'<br/>brow: '+z(d.b))}else{v.style('opacity',0)}}e.size=function(_){if(!arguments.length)return[j,l];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in chernoff.size(width, height) should be number and number of svg');return this}else{j=arguments[0];l=arguments[1];return this}};e.sizeAvail=function(_){if(!arguments.length)return[m,n];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in chernoff.sizeAvail(widthAvail, heightAvail) should be number and number of svg');return this}else{m=arguments[0];n=arguments[1];return this}};e.tran=function(_){if(!arguments.length)return[o,q];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in chernoff.tran(tranX, tranY) should be number and number of svg');return this}else{o=arguments[0];q=arguments[1];return this}};e.fontSize=function(_){if(!arguments.length)return t;else{if(!isFinite(arguments[0])){console.error('The arguments in chernoff.fontSize(fontSize) should be number of text');return this}else{t=arguments[0];return this}}};e.fontFamily=function(_){if(!arguments.length)return u;else{if(typeof arguments[0]!=='string'){console.error('The arguments in chernoff.fontFamily(fontFamily) should be string of text');return this}else{t=arguments[0];return this}}};e.duration=function(_){if(!arguments.length)return y;else{if(!isFinite(arguments[0])){console.error('The arguments in chernoff.duration(duration) should be number of transition');return this}else{y=Math.round(arguments[0]);return this}}};e.color=function(_){if(!arguments.length)return A;else{if(typeof arguments[0]!=='function'){console.error('The arguments in chernoff.color(color) should be function of pvisual.color');return this}else{A=arguments[0];return this}}};e.tickFormat=function(_){if(!arguments.length)return z;else{if(typeof arguments[0]!=='string'){console.error('The arguments in chernoff.tickFormat(format) should be string of d3.format');return this}else{z=f.format(arguments[0]);return this}}};e.lineWidth=function(_){if(!arguments.length)return B;else{if(!isFinite(arguments[0])){console.error('The arguments in chernoff.lineWidth(lineWidth) should be number');return this}else{B=arguments[0];return this}}};e.lineColor=function(_){if(!arguments.length)return C;else{if(typeof arguments[0]!=='string'&&typeof arguments[0]!=='function'){console.error('The arguments in chernoff.lineColor(lineColor) should be string or function');return this}else{C=arguments[0];return this}}};e.options=function(_){if(!arguments.length)return{'type':e.getType(),'width':j,'height':l,'widthAvail':m,'heightAvail':n,'tranX':o,'tranY':q,'format':z,'fontSize':t,'fontColor':fontColor,'fontFamily':u,'color':A,'duration':y,'lineWidth':B,'lineColor':C};else if(typeof _!=='object'){console.error('The arguments in map.options(options) should be object');return this}else{j=isFinite(_.width)?_.width:j;l=isFinite(_.height)?_.height:l;m=isFinite(_.widthAvail)?_.widthAvail:m;n=isFinite(_.heightAvail)?_.heightAvail:n;o=isFinite(_.tranX)?_.tranX:o;q=isFinite(_.tranY)?_.tranY:q;_.format&&e.tickFormat(_.format);_.fontFamily&&e.fontFamily(_.fontFamily);_.fontColor&&e.fontColor(_.fontColor);isFinite(_.fontSize)&&e.fontSize(_.fontSize);isFinite(_.duration)&&e.duration(_.duration);isFinite(_.lineWidth)&&e.lineWidth(_.lineWidth);_.lineColor&&e.lineColor(_.lineColor);return this}};if(arguments.length===1)e.options(arguments[0]);return e};bw.model.combo=function(){var u=bw.extend();var v=_.d3;var w='combo';var x=800;var z=1000;var A=x-200;var B=300;var C=50;var D=10;var E;var F=8;var G='Arial';var H;var I;var J;var K=500;var L=v.format('s');var M=u.color();var N='liner';var O=.7;var P;var Q=.1;var R;var S=0;var T=0;var U=1;var V=0;var W='';var X='';var Y='';var Z=8;var bx='#000000';var by=5;var bz=5;var bA=-A;var bB=8;var bC='#929292';var bD='rgba(0,0,0,.1)';var bE=2;var bF='#000000';var bG=0;var bH=100;var bI=50;var bJ=100;var bK='#000000';var bL=13;var bM=10;var bN=0;var bO=10;var bP=100;u.data=function(_){if(arguments.length){if(_.type==='xml'){_=_.root;_=_.map(function(d){var a={};d.row.row.forEach(function(p){var k=bw.keys(p)[0];a[k]=p[k]});return a});_=XMLdata(_);var b={x:v.set()};P=_.map(function(d){b[d.name]=v.map();return{name:d.name,_flag:true}});_.forEach(function(d){d.points.forEach(function(p){p.y=+p.y;b[d.name].set(p.x,{x:p.x,y:p.y});b.x.add(p.x)})});E=bw.keys(b).filter(function(d){return d!=='x'}).map(function(d){return{name:d,points:b[d].values()}});P.x=b.x.values()}else if(_.type==='xlsx'||_.type==='xls'){var s=[];for(var i=0;i<_.length;i++){var k=bw.keys(_[i])[0];s=s.concat(_[i][k])}_=s;var b={x:v.set()};P=bw.keys(_[0]).filter(function(d){return d!=='x'}).map(function(d){b[d]=v.map();return{name:d,_flag:true}});_.forEach(function(d){P.forEach(function(p){d.x=''+d.x;b[p.name].set(d.x,{x:d.x,y:+d[p.name]});b.x.add(d.x)})});E=bw.keys(b).filter(function(d){return d!=='x'}).map(function(d){return{name:d,points:b[d].values()}});P.x=b.x.values()}else if(_.type==='tsv'||_.type==='csv'){var b={x:v.set()};P=bw.keys(_[0]).filter(function(d){return d!=='x'}).map(function(d){b[d]=v.map();return{name:d,_flag:true}});_.forEach(function(d){P.forEach(function(p){b[p.name].set(d.x,{x:d.x,y:+d[p.name]});b.x.add(d.x)})});E=bw.keys(b).filter(function(d){return d!=='x'}).map(function(d){return{name:d,points:b[d].values()}});P.x=b.x.values()}else if(_.type==='json'){var b={x:v.set()};P=_.map(function(d){b[d.name]=v.map();return{name:d.name,_flag:true}});_.forEach(function(d){d.points.forEach(function(p){p.y=+p.y;b[d.name].set(p.x,{x:p.x,y:p.y});b.x.add(p.x)})});E=bw.keys(b).filter(function(d){return d!=='x'}).map(function(d){return{name:d,points:b[d].values()}});P.x=b.x.values()}return this}else return E};u.getType=function(){return w};u.render=function(_){I=I||v.select(_).node();if(!I||I.tagName.toLowerCase()!=='div'){console.error('The argument(element) in multiline.rander(_) should be <div> element')}v.select(I).classed('chart',true);J=J||v.select(I).append('svg').classed('combo',true).node();var b=u.clone(E).filter(function(d){var a=true;P.forEach(function(p){if(p.name===d.name)a=p._flag});return a});var c;var e;var f;var h;var i;var j;var k;c=v.scale.ordinal().domain(P.x,function(d){return''+d}).rangeRoundBands([0,A],Q);i=v.svg.axis().scale(c).orient('bottom').tickSize(bz);f=v.scale.linear().domain([bI||(bI===0?0:v.min(b,function(d){return v.min(d.points,function(p){return p.y})})),bJ||v.max(b,function(d){return v.max(d.points,function(p){return p.y})})]).range([B,0]);h=v.scale.linear().domain([bG||(bG===0?0:v.min(b,function(d){return v.min(d.points,function(p){return p.y})})),bH||v.max(b,function(d){return v.max(d.points,function(p){return p.y})})]).range([B,0]);e=v.scale.ordinal();e.domain(P.filter(function(d){return d._flag}).map(function(d){return d.name})).rangeRoundBands([0,c.rangeBand()]);j=v.svg.axis().scale(f).orient('left').ticks(by).tickSize(bA).tickFormat(L);k=v.svg.axis().scale(h).orient('right').ticks(by).tickSize(bA).tickFormat(L);var l=v.svg.line().interpolate(N).tension(O).x(function(d){return c(d.x)}).y(function(d){return h(d.y)});H=v.select(I).select('.floatTag').node()?v.select(I).select('.floatTag'):u.floatTag(I);var g=v.select(J).attr({'width':x,'height':z}).selectAll('g').data([1]).enter().append('svg:g').attr('transform','translate('+C+','+D+')');g.call(function(a){a.append('svg:g').classed('x-axis axis',true);a.append('svg:g').classed('y-axis y-axis-bar axis',true);a.append('svg:g').classed('y-axis y-axis-line axis',true);a.append('svg:g').classed('bars',true);a.append('svg:g').classed('lines',true);a.append('svg:g').classed('points',true);a.append('svg:g').classed('pies',true);a.append('svg:g').classed('legends',true)});g=v.select(J).select('g');var m=g.selectAll('.bars').selectAll('.bar').data(P.x);m.exit().transition().duration(K).style('opacity',0).remove();barUpdate(m,c,e,f,b);barDraw(m,c,e,f,b);var n=g.selectAll('.lines').selectAll('.line').data(b);n.exit().transition().duration(K).style('opacity',0).remove();lineUpdate(n,l,c,h,b);lineDraw(n,l,c,h,b);var o=g.selectAll('.points').selectAll('.point').data(b);o.exit().transition().duration(K).style('opacity',0).remove();pointUpdate(o,c,h,b);pointDraw(o,c,h,b);T=T||P.x.length>4?A/8:A/P.x;S=S||T*.3;var q=g.selectAll('.pies').selectAll('.pie').data(P.x);q.exit().transition().duration(K).style('opacity',0).remove();pieUpdate(q,b);pieDraw(q,b);axis(g,i,j,k);var r=g.select('.legends').attr('transform','translate('+bM+','+bN+')').selectAll('.legend').data(P);r.exit().transition().duration(K).style('opacity',0).remove();legendUpdate(r);legendDraw(r)};function lineDraw(a,b,c,y,e){a.enter().append('svg:path').classed('line',true).attr('transform','translate('+c.rangeBand()/2+','+z+')').attr('d',function(d){return b(d.points)}).style({'fill':'none','width':2}).style('stroke',function(d){return M(d.name)}).transition().duration(K).attr('transform','translate('+c.rangeBand()/2+',0)')}function lineUpdate(a,b,c,y,e){a.transition().duration(K).attr('transform','translate('+c.rangeBand()/2+',0)').attr('d',function(d){return b(d.points)}).style('stroke',function(d){return M(d.name)})}function barDraw(a,b,c,y,e){a.enter().append('svg:g').classed('bar',true).attr('transform',function(d){return'translate('+b(d)+',0)'}).each(function(d,i){v.select(this).selectAll('rect').data(function(){return e.map(function(p){return{name:p.name,y:p.points[i].y}})}).enter().append('svg:rect').on('mouseover',function(p){drawLegend(p,true)}).on('mouseout',function(p){drawLegend(p,false)}).attr('height',function(p){return B-1-y(p.y)}).attr('x',function(p){return c(p.name)}).attr({'y':y(0),'zIndex':2,'width':c.rangeBand()}).attr('y',function(p){return y(p.y)}).style('fill',function(p){return M(p.name)}).style('opacity',0).transition().duration(K).style('opacity',U)})}function barUpdate(b,c,e,y,f){b.attr('transform',function(d){return'translate('+c(d)+',0)'}).each(function(d,i){var a=v.select(this).selectAll('rect').data(function(){return f.map(function(p){return{name:p.name,y:p.points[i].y}})});a.exit().transition().duration(K).style('opacity',0).remove();a.transition().duration(K).attr('width',e.rangeBand()).style('fill',function(p){return M(p.name)}).style('opacity',U).attr('x',function(p){return e(p.name)}).attr('y',function(p){return y(p.y)}).attr('height',function(p){return B-1-y(p.y)});a.enter().append('svg:rect').on('mouseover',function(p){drawLegend(p,true)}).on('mouseout',function(p){drawLegend(p,false)}).attr('x',function(p){return e(p.name)}).attr('y',function(p){return y(p.y)}).attr('width',e.rangeBand()).style('fill',function(p){return M(p.name)}).style('opacity',0).transition().duration(K).attr('height',function(p){return B-1-y(p.y)}).style('opacity',1)})}function pointDraw(a,b,y,c){var e=b.rangeBand()/2;a.enter().append('svg:g').classed('point',true).each(function(d,i){v.select(this).selectAll('circle').data(function(){return d.points}).enter().append('svg:circle').on('mouseover',function(p){return drawLegend({name:d.name,y:p.y},true)}).on('mouseout',function(p){return drawLegend({name:d.name,y:p.y},false)}).style('stroke',M(d.name)).attr({'r':4,'cx':0}).style({'fill':'#FFFFFF','stroke-width':2,'opacity':0}).transition().ease('bounce').duration(K).attr('cx',function(p){return b(p.x)+e}).attr('cy',function(p){return y(p.y)}).style('opacity',1)})}function pointUpdate(b,c,y,e){var f=c.rangeBand()/2;b.each(function(d,i){var a=v.select(this).selectAll('circle').data(function(){return d.points});a.transition().ease('bounce').duration(K).attr('cx',function(p){return c(p.x)+f}).attr('cy',function(p){return y(p.y)}).style('stroke',M(d.name))})}function pieUpdate(c,e){var f=v.format('.2%');var g=v.layout.pie().value(function(d){return d.y});var h=v.svg.arc().innerRadius(S).outerRadius(function(d){return(d.value-d.extent[0])/(d.extent[1]-d.extent[0])*(T-S)*.4+(T-S)*.6+S});c.each(function(d,i){var b=v.select(this).datum(function(){var a=v.extent(e.map(function(p){return p.points[i].y}));return e.map(function(p){return{name:p.name,y:p.points[i].y,extent:a}})}).selectAll('path').data(g);b.exit().attr('opacity',1).transition().duration(K).attr('opacity',0).remove();b.transition().duration(K).attr('fill',function(p){return M(p.data.name)}).attrTween('d',function(k){var q=v.interpolate(+v.select(this).attr('data-startAngle'),k.startAngle);var p=v.interpolate(+v.select(this).attr('data-endAngle'),k.endAngle);return function(t){return h({startAngle:p(t),endAngle:q(t),extent:k.data.extent,value:k.value})}}).attr('data-startAngle',function(p){return p.startAngle}).attr('data-endAngle',function(p){return p.endAngle});b.enter().append('svg:path').attr('data-startAngle',function(p){return p.startAngle}).attr('data-endAngle',function(p){return p.endAngle}).attr('fill',function(p){return M(p.data.name)}).attr('opacity',0).on('mouseover',function(p){drawLegend({name:p.data.name,y:f(Math.abs(p.endAngle-p.startAngle)/(2*Math.PI))},true)}).on('mouseout',function(p){drawLegend({name:p.data.name,y:f(Math.abs(p.endAngle-p.startAngle)/(2*Math.PI))},false)}).transition().duration(K).attrTween('d',function(p){var q=v.interpolate(p.startAngle,p.endAngle);return function(t){return h({startAngle:p.startAngle,endAngle:q(t),extent:p.data.extent,value:p.value})}}).attr('opacity',1);v.select(this).select('text tspan').transition().duration(K).style({'text-anchor':'end','font-family':G,'font-size':F}).text(d);v.select(this).transition().duration(K).attr('transform','translate('+((i%4+.5)*(T*2+20)-30)+','+((Math.round(i/4-.5)+.5)*(T*2+20)+B+20)+')')})}function pieDraw(c,e){var f=v.format('.2%');var g=v.layout.pie().value(function(d){return d.y});var h=v.svg.arc().innerRadius(S).outerRadius(function(d){return(d.value-d.extent[0])/(d.extent[1]-d.extent[0])*(T-S)*.4+(T-S)*.6+S});c.enter().append('svg:g').classed('pie',true).each(function(d,i){var b=v.select(this).datum(function(){var a=v.extent(e.map(function(p){return p.points[i].y}));return e.map(function(p){return{name:p.name,y:p.points[i].y,extent:a}})}).selectAll('path').data(g);b.exit().attr('opacity',1).transition().duration(K).attr('opacity',0).remove();b.enter().append('svg:path').attr('fill',function(p){return M(p.data.name)}).attr('opacity',0).on('mouseover',function(p){drawLegend({name:p.data.name,y:f(Math.abs(p.endAngle-p.startAngle)/(2*Math.PI))},true)}).on('mouseout',function(p){drawLegend({name:p.data.name,y:f(Math.abs(p.endAngle-p.startAngle)/(2*Math.PI))},false)}).transition().duration(K).attrTween('d',function(p){var q=v.interpolate(p.startAngle,p.endAngle);return function(t){return h({startAngle:p.startAngle,endAngle:q(t),extent:p.data.extent,value:p.value})}}).attr('opacity',1).attr('data-startAngle',function(p){return p.startAngle}).attr('data-endAngle',function(p){return p.endAngle});v.select(this).append('svg:text').append('svg:tspan').transition().duration(K).attr({x:10,y:5}).style({'text-anchor':'end','font-family':G,'font-size':F}).text(d);v.select(this).transition().duration(K).attr('transform','translate('+((i%4+.5)*(T*2+20)-30)+','+((Math.round(i/4-.5)+.5)*(T*2+20)+B+20)+')')})}function legendDraw(b){b.enter().append('svg:g').classed('legend',true).style('cursor','pointer').on('click',function(d){if(!v.select(this).classed('none')){if(P.length>1){v.select(this).classed('none',true);d._flag=false;R=E.map(function(d){var a=P.filter(function(p){return p._flag}).map(function(p){return{name:p.name,y:+d[p.name]}});return{x:d.x,value:a}});u.render()}}else{v.select(this).classed('none',false);d._flag=true;R=E.map(function(d){var a=P.filter(function(p){return p._flag}).map(function(p){return{name:p.name,y:+d[p.name]}});return{x:d.x,value:a}});u.render()}}).each(function(d,i){v.select(this).append('svg:rect').attr({'x':(i-i%bO)/bO*bP+A+20,'y':i%bO*20}).attr({'width':10,'height':10}).style({'fill':M(i),'stroke':M(i)}).style('fill-opacity',d._flag?1:0).style('opacity',0).transition().duration(K/2).style('opacity',1);v.select(this).append('svg:text').attr({'x':(i-i%bO)/bO*bP+A+40,'y':i%bO*20+9}).style({'opacity':0,'fill':bK,'font-size':bL,'font-family':G}).transition().duration(K/2).style('opacity',1).text(d.name)})}function legendUpdate(a){a.each(function(d,i){v.select(this).selectAll('rect').transition().duration(K/2).style({'fill':M(i),'stroke':M(i)}).style('fill-opacity',d._flag?1:0).attr({'x':(i-i%bO)/bO*bP+A+20,'y':i%bO*20});v.select(this).selectAll('text').transition().duration(K/2).attr({'x':(i-i%bO)/bO*bP+A+40,'y':i%bO*20+9}).style({'font-size':bL,'fill':bK,'font-family':G}).text(d.name)})}function axis(g,b,c,d){g.select('.x-axis').each(function(){v.select(this).select('.label').transition().duration(K).attr({'x':A,'y':-6}).style({'text-anchor':'end','font-family':G,'font-size':Z,'fill':bx}).text(Y);v.select(this).selectAll('.label').data([1]).enter().append('svg:text').classed('label',true).style({'text-anchor':'end','font-family':G,'font-size':Z,'fill':bx}).attr({'x':A,'y':-6}).text(Y);v.select(this).transition().duration(K).attr('transform','translate(0,'+B+')').call(b)});g.select('.y-axis-bar').each(function(){v.select(this).select('.label').style({'text-anchor':'end','font-family':G,'font-size':Z,'fill':bx}).text(W);v.select(this).selectAll('.label').data([1]).enter().append('svg:text').classed('label',true).style({'text-anchor':'end','font-family':G,'font-size':Z,'fill':bx}).attr({'transform':'rotate(-90)','y':8,'dy':'.71em'}).text(W);v.select(this).transition().duration(K).call(c).selectAll('.tick text').style({'text-anchor':'end','font-family':G,'font-size':bB,'fill':bC})});g.select('.y-axis-line').attr({'transform':'translate('+A+',0)'}).each(function(){v.select(this).select('.label').style({'text-anchor':'end','font-family':G,'font-size':Z,'fill':bx}).text(X);v.select(this).selectAll('.label').data([1]).enter().append('svg:text').classed('label',true).style({'text-anchor':'end','font-family':G,'font-size':Z,'fill':bx}).attr({'transform':'rotate(-90)','y':8,'dy':'.71em'}).text(X);v.select(this).transition().duration(K).call(d).selectAll('.tick text').style({'text-anchor':'start','font-family':G,'font-size':bB,'fill':bC})});g.select('.x-axis').selectAll('.tick').select('text').style({'text-anchor':'middle','font-family':G,'font-size':bB,'fill':bC}).attr('transform',function(){return'translate('+this.getComputedTextLength()*Math.abs(Math.sin(V)*.5)+','+(this.getComputedTextLength()*(.3*Math.abs(Math.sin(V))))+')rotate('+V+')'});g.selectAll('.axis').call(function(a){a.selectAll('path').style({'fill':'none','stroke':bF,'stroke-width':bE,'shape-rendering':'crispEdges'});a.selectAll('line').style({'fill':'none','stroke-dasharray':'3,1','stroke':bD,'shape-rendering':'crispEdges'})})}function drawLegend(d,a){if(a){H.style({'border-color':M(d.name),'opacity':1,'textAlign':'center','margin':'auto'}).html('name: <b>'+d.name+'</b><br/>value: <b>'+d.y+'</b>')}else{H.style('opacity',0)}}u.size=function(_){if(!arguments.length)return[x,z];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in pie.size(width, height) should be number and number of svg');return this}else{x=arguments[0];z=arguments[1];return this}};u.sizeAvail=function(_){if(!arguments.length)return[A,B];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in pie.sizeAvail(widthAvail, heightAvail) should be number and number of svg');return this}else{A=arguments[0];B=arguments[1];return this}};u.tran=function(_){if(!arguments.length)return[C,D];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in pie.tran(tranX, tranY) should be number and number of svg');return this}else{C=arguments[0];D=arguments[1];return this}};u.fontFamily=function(_){if(!arguments.length)return G;else{if(typeof arguments[0]!=='string'){console.error('The arguments in pie.fontFamily(fontFamily) should be string of text');return this}else{G=arguments[0];return this}}};u.duration=function(_){if(!arguments.length)return K;else{if(!isFinite(arguments[0])){console.error('The arguments in pie.duration(duration) should be number of transition');return this}else{K=Math.round(arguments[0]);return this}}};u.color=function(_){if(!arguments.length)return M;else{if(typeof arguments[0]!=='function'){console.error('The arguments in pie.color(color) should be function of pvisual.color');return this}else{M=arguments[0];return this}}};u.tickFormat=function(_){if(!arguments.length)return L;else{if(typeof arguments[0]!=='string'){console.error('The arguments in pie.tickFormat(format) should be string of d3.format');return this}else{L=v.format(arguments[0]);return this}}};u.legendTran=function(_){if(!arguments.length)return[bM,bN];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in pie.legendTran(tranX, tranY) should be number and number of svg');return this}else{bM=arguments[0];bN=arguments[1];return this}};u.legendSize=function(_){if(!arguments.length)return bL;else{if(!isFinite(arguments[0])){console.error('The arguments in pie.legendSize(legendSize) should be number of text');return this}else{bL=arguments[0];return this}}};u.legendColor=function(_){if(!arguments.length)return bK;else{if(typeof arguments[0]!=='string'){console.error('The arguments in pie.legendColor(legendColor) should be string of text');return this}else{bK=arguments[0];return this}}};u.legendColumnNo=function(_){if(!arguments.length)return bO;else{if(!isFinite(arguments[0])){console.error('The arguments in pie.legendColumnNo(legendColumnNo) should be number of text');return this}else{bO=arguments[0];return this}}};u.outerRadius=function(_){if(!arguments.length)return T;else{if(!isFinite(arguments[0])){console.error('The arguments in pie.outerRadius(outerRadius) should be number of');return this}else{T=Math.round(arguments[0]);return this}}};u.innerRadius=function(_){if(!arguments.length)return S;else{if(!isFinite(arguments[0])){console.error('The arguments in pie.innerRadius(innerRadius) should be number');return this}else{S=Math.round(arguments[0]);return this}}};u.xLegend=function(_){if(!arguments.length)return Y;else{if(typeof arguments[0]!=='string'){console.error('The arguments in combo.xLegend(xLegend) should be string');return this}else{Y=arguments[0];return this}}};u.yLegendBar=function(_){if(!arguments.length)return W;else{if(typeof arguments[0]!=='string'){console.error('The arguments in combo.yLegend(yLegend) should be string');return this}else{W=arguments[0];return this}}};u.yLegendLine=function(_){if(!arguments.length)return X;else{if(typeof arguments[0]!=='string'){console.error('The arguments in combo.yLegend(yLegend) should be string');return this}else{X=arguments[0];return this}}};u.xtickRotate=function(_){if(!arguments.length)return V;else{if(!isFinite(arguments[0])){console.error('The arguments in combo.xtickRotate(xtickRotate) should be number of tick');return this}else{V=Math.round(arguments[0]);return this}}};u.labelSize=function(_){if(!arguments.length)return Z;else{if(!isFinite(arguments[0])){console.error('The arguments in combo.labelSize(labelSize) should be string');return this}else{Z=arguments[0];return this}}};u.labelColor=function(_){if(!arguments.length)return bx;else{if(typeof arguments[0]!=='string'){console.error('The arguments in combo.labelColor(labelColor) should be string');return this}else{bx=arguments[0];return this}}};u.ytickNumber=function(_){if(!arguments.length)return by;else{if(!isFinite(arguments[0])){console.error('The arguments in combo.ytickNumber(ytickNumber) should be number of tick');return this}else{by=Math.round(arguments[0]);return this}}};u.tickLineColor=function(_){if(!arguments.length)return bD;else{if(typeof arguments[0]!=='string'){console.error('The arguments in combo.tickLineColor(tickLineColor) should be string');return this}else{bD=arguments[0];return this}}};u.tickTextSize=function(_){if(!arguments.length)return bB;else{if(!isFinite(arguments[0])){console.error('The arguments in combo.tickTextSize(tickTextSize) should be number');return this}else{bB=arguments[0];return this}}};u.tickTextColor=function(_){if(!arguments.length)return bC;else{if(typeof arguments[0]!=='string'){console.error('The arguments in combo.tickTextColor(tickTextColor) should be string');return this}else{bC=arguments[0];return this}}};u.axisPathWidth=function(_){if(!arguments.length)return bE;else{if(!isFinite(arguments[0])){console.error('The arguments in combo.axisPathWidth(axisPathWidth) should be string');return this}else{bE=arguments[0];return this}}};u.axisPathColor=function(_){if(!arguments.length)return bF;else{if(typeof arguments[0]!=='string'){console.error('The arguments in combo.axisPathColor(axisPathColor) should be string');return this}else{bF=arguments[0];return this}}};u.legendTran=function(_){if(!arguments.length)return[bM,bN];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in combo.legendTran(tranX, tranY) should be number and number of svg');return this}else{bM=arguments[0];bN=arguments[1];return this}};u.legendSize=function(_){if(!arguments.length)return bL;else{if(!isFinite(arguments[0])){console.error('The arguments in combo.legendSize(legendSize) should be number of text');return this}else{bL=arguments[0];return this}}};u.legendColor=function(_){if(!arguments.length)return bK;else{if(typeof arguments[0]!=='string'){console.error('The arguments in combo.legendColor(legendColor) should be string of text');return this}else{bK=arguments[0];return this}}};u.legendColumnNo=function(_){if(!arguments.length)return bO;else{if(!isFinite(arguments[0])){console.error('The arguments in combo.legendColumnNo(legendColumnNo) should be number of text');return this}else{bO=arguments[0];return this}}};u.legendRowGap=function(_){if(!arguments.length)return bP;else{if(!isFinite(arguments[0])){console.error('The arguments in combo.legendRowGap(legendRowGap) should be number of text');return this}else{bP=arguments[0];return this}}return u};u.minTickLine=function(_){if(!arguments.length)return bG;else{if(!isFinite(arguments[0])){console.error('The arguments in combo.minTickLine(minTickLine) should be number of text');return this}else{bG=arguments[0];return this}}return u};u.maxTickLine=function(_){if(!arguments.length)return bH;else{if(!isFinite(arguments[0])){console.error('The arguments in combo.maxTickLine(maxTickLine) should be number of text');return this}else{bH=arguments[0];return this}}return u};u.minTickBar=function(_){if(!arguments.length)return bI;else{if(!isFinite(arguments[0])){console.error('The arguments in combo.minTickBar(minTickBar) should be number of text');return this}else{bI=arguments[0];return this}}return u};u.maxTickBar=function(_){if(!arguments.length)return bJ;else{if(!isFinite(arguments[0])){console.error('The arguments in combo.maxTickBar(maxTickBar) should be number of text');return this}else{bJ=arguments[0];return this}}return u};u.pieFontSize=function(_){if(!arguments.length)return F;else{if(!isFinite(arguments[0])){console.error('The arguments in combo.pieFontSize(pieFontSize) should be number of text');return this}else{F=arguments[0];return this}}};u.interpolate=function(_){if(!arguments.length)return N;else{if(!isFinite(arguments[0])){console.error('The arguments in combo.interpolate(interpolate) should be text');return this}else{N=arguments[0];return this}}};u.tension=function(_){if(!arguments.length)return O;else{if(!isFinite(arguments[0])){console.error('The arguments in combo.tension(tension) should be number of 0 ~ `');return this}else{O=arguments[0];return this}}};u.padding=function(_){if(!arguments.length)return Q;else{if(!isFinite(arguments[0])){console.error('The arguments in combo.padding(padding) should be number of 0 ~ `');return this}else{Q=arguments[0];return this}}};u.barOpacity=function(_){if(!arguments.length)return U;else{if(!isFinite(arguments[0])){console.error('The arguments in combo.barOpacity(barOpacity) should be number of 0 ~ `');return this}else{U=arguments[0];return this}}};u.options=function(_){if(!arguments.length)return{'type':u.getType(),'width':x,'height':z,'widthAvail':A,'heightAvail':B,'tranX':C,'tranY':D,'maxTickBar':bJ,'minTickBar':bI,'maxTickLine':bH,'minTickLine':bG,'format':L,'pieFontSize':F,'ytickNumber':by,'fontFamily':G,'barOpacity':U,'xtickRotate':V,'yLegendBar':W,'yLegendLine':X,'color':M,'interpolate':N,'tension':O,'duration':K,'legendColor':bK,'legendSize':bL,'legendTranX':bM,'legendTranY':bN,'legendColumnNo':bO,'legendRowGap':bP};else if(typeof _!=='object'){console.error('The arguments in map.options(options) should be object');return this}else{x=isFinite(_.width)?_.width:x;z=isFinite(_.height)?_.height:z;A=isFinite(_.widthAvail)?_.widthAvail:A;B=isFinite(_.heightAvail)?_.heightAvail:B;C=isFinite(_.tranX)?_.tranX:C;D=isFinite(_.tranY)?_.tranY:D;_.format&&u.tickFormat(_.format);_.fontFamily&&u.fontFamily(_.fontFamily);isFinite(_.pieFontSize)&&u.pieFontSize(_.pieFontSize);isFinite(_.ytickNumber)&&u.ytickNumber(_.ytickNumber);isFinite(_.barOpacity)&&u.barOpacity(_.barOpacity);isFinite(_.xtickRotate)&&u.xtickRotate(_.xtickRotate);_.yLegendBar&&u.yLegendBar(_.yLegendBar);_.yLegendLine&&u.yLegendLine(_.yLegendLine);_.xLegend&&u.xLegend(_.xLegend);isFinite(_.tension)&&u.tension(_.tension);_.interpolate&&u.interpolate(_.interpolate);isFinite(_.fontSize)&&u.fontSize(_.fontSize);isFinite(_.duration)&&u.duration(_.duration);_.legendColor&&u.legendColor(_.legendColor);isFinite(_.legendSize)&&u.legendSize(_.legendSize);bM=isFinite(_.legendTranX)?_.legendTranX:bM;bN=isFinite(_.legendTranY)?_.legendTranY:bN;isFinite(_.legendColumnNo)&&u.legendColumnNo(_.legendColumnNo);isFinite(_.legendRowGap)&&u.legendRowGap(_.legendRowGap);return this}};if(arguments.length===1)u.options(arguments[0]);return u};bw.model.chord=function(){var l=bw.extend();var m=_.d3;var n='弦图';var o=900;var q=900;var r=o;var t=q;var u=0;var v=0;var w;var x=8;var y='Arial';var z='#000000';var A;var B;var C;var D=500;var E=m.format('s');var F=l.color();var G;var A;var H=.01;var I=true;var J;var K;var L;var M;var N='#000000';var O=13;var P=0;var Q=0;var R=10;var S=100;l.data=function(_){if(arguments.length){if(_.type==='xml'){_=_.map(function(d){var a={};d.row.forEach(function(p){var k=bw.keys(p)[0];a[k]=p[k]});return a})}else if(_.type==='xlsx'||_.type==='xls'){var s=[];for(var i=0;i<_.length;i++){var k=bw.keys(_[i])[0];s=s.concat(_[i][k])}_=s}var b=0;var c={};var e;var f;K=0;w=[];G=_;G.forEach(function(d){e=d.from;f=d.to;if(typeof c[e]==='undefined'){c[b]=e;c[e]=b++}if(typeof c[f]==='undefined'){c[b]=f;c[f]=b++}K+=+d.value});for(var i=0;i<b;i++){w[i]=[];w[i]._index=i;for(var j=0;j<b;j++){w[i][j]=0}}if(!I)G.forEach(function(d){w[c[d.from]][c[d.to]]+=+d.value});else G.forEach(function(d){w[c[d.from]][c[d.to]]+=+d.value;w[c[d.to]][c[d.from]]+=+d.value});J=c;return this}else return w};l.getType=function(){return n};l.render=function(_){B=B||m.select(_).node();if(!B||B.tagName.toLowerCase()!=='div'){console.error('The argument(element) in chord.rander(_) should be <div> element')}m.select(B).classed('chart',true);C=C||m.select(B).append('svg').classed('chord',true).node();A=m.select(B).select('.floatTag').node()?m.select(B).select('.floatTag'):l.floatTag(B);if(!L)L=Math.min(r,t)*.38;if(!M)M=L*1.1;var b=m.layout.chord().padding(H).sortSubgroups(m.descending).matrix(w);var g=m.select(C).attr({'width':o,'height':q}).selectAll('g').data([1]).enter().append('svg:g').attr('transform','translate('+(u+Math.min(r,t)/2)+','+(v+Math.min(r,t)/2)+')');g.call(function(a){a.append('svg:g').classed('arcs',true);a.append('svg:g').classed('labels',true);a.append('svg:g').classed('ticks',true);a.append('svg:g').classed('chords',true);a.append('svg:g').classed('legends',true)});g=m.select(C).select('g');var c=g.select('.chords').selectAll('path').data(b.chords);c.exit().transition().duration(D).style('opacity',0).remove();chordUpdate(c);chordDraw(c);var e=g.select('.arcs').selectAll('path').data(b.groups);e.exit().transition().duration(D).style('opacity',0).remove();arcUpdate(e,c);arcDraw(e,c);var f=g.select('.labels').selectAll('.label').data(b.groups);f.exit().transition().duration(D).style('opacity',0).remove();labelUpdate(f);labelDraw(f);var h=g.select('.ticks').selectAll('.tick').data(b.groups);h.exit().transition().duration(D).style('opacity',0).remove();tickUpdate(h);tickDraw(h);var i=g.select('.legends').attr('transform','translate('+P+','+Q+')').selectAll('.legend').data(function(){var p=m.set([]);G.forEach(function(d){p.add(d.from);p.add(d.to)});return p.values()}());i.exit().transition().duration(D).style('opacity',0).remove();legendUpdate(i);legendDraw(i)};function chordUpdate(a){a.transition().duration(D).style('fill',function(d){return F(w[d.target.index]._index)}).attr('d',m.svg.chord().radius(L))}function chordDraw(a){a.enter().append('svg:path').style('fill',function(d){return F(w[d.target.index]._index)}).attr('d',m.svg.chord().radius(L)).style({'opacity':0,'fill-opacity':.67,'stroke':'none','stroke-width':'.5px'}).on('mouseover',fadeone(.03,true,a)).on('mouseout',fadeone(1,false,a)).transition().duration(D).style('opacity',1)}function arcUpdate(a){a.transition().duration(D).style('fill',function(d){return F(w[d.index]._index)}).attr('d',m.svg.arc().innerRadius(L).outerRadius(M))}function arcDraw(a,b){a.enter().append('svg:path').style('fill',function(d){return F(J[w[d.index]._index])}).on('mouseover',fade(.03,true,b)).on('mouseout',fade(1,false,b)).transition().duration(D).attr('d',m.svg.arc().innerRadius(L).outerRadius(M))}function labelUpdate(a){a.transition().duration(D).attr('transform',function(d){return'rotate('+((d.endAngle+d.startAngle)*90/Math.PI-87)+')'+'translate('+M+',0)'}).select('text').style('text-anchor',function(d){return(d.endAngle+d.startAngle)/2>Math.PI?'end':null}).attr('transform',function(d){return(d.endAngle+d.startAngle)/2>Math.PI?'rotate(180)translate(-16)':null}).style({'font-family':y,'font-weight':'normal','font-size':x}).text(function(d){return d.endAngle-d.startAngle>.03?J[w[d.index]._index]:'...'})}function labelDraw(a){a.enter().append('svg:g').classed('label',true).attr('transform',function(d){return'rotate('+((d.endAngle+d.startAngle)*90/Math.PI-87)+')'+'translate('+M+',0)'}).append('svg:text').attr({'x':8,'dy':20}).style('opacity',0).style('text-anchor',function(d){return(d.endAngle+d.startAngle)/2>Math.PI?'end':null}).attr('transform',function(d){return(d.endAngle+d.startAngle)/2>Math.PI?'rotate(180)translate(-16)':null}).transition().duration(D).style({'font-family':y,'font-size':x,'font-weight':'normal','opacity':1}).text(function(d){return d.endAngle-d.startAngle>.03?J[w[d.index]._index]:'...'})}function tickUpdate(a){a.transition().duration(D).attr('transform',function(d){return'rotate('+((d.endAngle+d.startAngle)*90/Math.PI-89)+')'+'translate('+(M-50)+',0)'}).select('text').attr('transform',function(d){if((d.endAngle+d.startAngle)<Math.PI)return'rotate(90)translate(-9)';else if(Math.PI<(d.endAngle+d.startAngle)&&(d.endAngle+d.startAngle)<Math.PI*3)return'rotate(-90)translate(-9)';else return'rotate(90)translate(-9)'}).style({'font-family':y,'font-weight':'normal','font-size':x}).text(function(d){return E(Math.round(d.value))})}function tickDraw(a){a.enter().append('svg:g').classed('tick',true).attr('transform',function(d){return'rotate('+((d.endAngle+d.startAngle)*90/Math.PI-89)+')'+'translate('+(M-50)+',0)'}).append('svg:text').attr('transform',function(d){if((d.endAngle+d.startAngle)<Math.PI)return'rotate(90)translate(-9)';else if(Math.PI<(d.endAngle+d.startAngle)&&(d.endAngle+d.startAngle)<Math.PI*3)return'rotate(-90)translate(-9)';else return'rotate(90)translate(-9)'}).transition().duration(D).style({'font-family':y,'font-weight':'normal','font-size':x}).text(function(d){return E(Math.round(d.value))})}function legendUpdate(c){c.each(function(d){var b=J[d];m.select(this).select('rect').transition().duration(D).style('fill-opacity',function(){var a=1;for(var i=0,k;i<G.length;i++){k=G[i];if(k.from===d||k.to===d)a=k._flag===false?0:1}return a}).attr({'x':(b-b%R)/R*S+M,'y':b%R*20-M*1.15}).style({'fill':F(b),'stroke':F(b)});m.select(this).select('text').transition().duration(D).attr({'x':(b-b%R)/R*S+M+20,'y':b%R*20+9-M*1.15}).style({'font-size':O,'fill':N,'font-family':y}).text(d)})}function legendDraw(b){b.enter().append('svg:g').classed('legend',true).style('cursor','pointer').on('click',function(d){if(!m.select(this).classed('none')){m.select(this).classed('none',true);for(var j=0,k;j<G.length;j++){k=G[j];if(d===k.from||d===k.to){k._flag=false}else{k._flag=true}}dataUpdate();l.render()}else{m.select(this).classed('none',false);for(var j=0,k;j<G.length;j++){k=G[j];if(d===k.from||d===k.to){k._flag=true}}dataUpdate();l.render()}}).each(function(d){var a=J[d];m.select(this).append('svg:rect').attr({'x':(a-a%R)/R*S+M,'y':a%R*20-M*1.15}).attr({'width':10,'height':10}).style({'fill':F(a),'stroke':F(a)}).style('fill-opacity',1).style('opacity',0).transition().duration(D).style('fill-opacity',function(){for(var i=0,k;i<G.length;i++){k=G[i];if(k.from===d||k.to===d)return k.flag===false?0:1}return 1}).style('opacity',1);m.select(this).append('svg:text').attr({'x':(a-a%R)/R*S+M+20,'y':a%R*20+9-M*1.15}).style({'opacity':0,'font-size':O,'fill':N,'font-family':y}).transition().duration(D).style('opacity',1).text(d)})}function dataUpdate(){var a=0;var b={};var c;var e;K=0;w=[];G.forEach(function(d){if(d._flag!==false){c=d.from;e=d.to;if(typeof b[c]==='undefined'){b[a]=J[c];b[c]=a++}if(typeof b[e]==='undefined'){b[a]=J[e];b[e]=a++}K+=+d.value}});for(var i=0;i<a;i++){w[i]=[];for(var j=0;j<a;j++){w[i][j]=0}}if(!I)G.forEach(function(d){if(d._flag!==false){w[b[d.from]][b[d.to]]+=+d.value;w[b[d.from]]._index=b[b[d.from]]}});else G.forEach(function(d){if(d._flag!==false){w[b[d.from]][b[d.to]]+=+d.value;w[b[d.to]][b[d.from]]+=+d.value;w[b[d.from]]._index=b[b[d.from]];w[b[d.to]]._index=b[b[d.to]]}})}function fade(a,b,c){return function(g,i){drawLegendArc(b,g);c.filter(function(d){return d.source.index!==i&&d.target.index!==i}).transition().duration(D/2).style('opacity',a)}}function fadeone(b,c,e){return function(d){var a=this;drawLegend(c,d);e.filter(function(){return this!==a}).transition().duration(D/2).style('opacity',b)}}function drawLegend(a,d){if(a){A.style({'border-color':F(w[d.source.index]._index+w[d.target.index]._index),'opacity':1,'textAlign':'center','margin':'auto'}).html(J[w[d.source.index]._index]+' to '+J[w[d.target.index]._index]+' : '+E(d.source.value)+'<br>'+J[w[d.target.index]._index]+' to '+J[w[d.source.index]._index]+' : '+E(d.target.value))}else{A.style('opacity',0)}}function drawLegendArc(a,d){if(a){var b=m.sum(w[d.index]);A.style({'border-color':F(J[w[d.index]._index]),'opacity':1,'textAlign':'center','margin':'auto'}).html(J[w[d.index]._index]+' : '+b+'<br/>比例: '+E((b/K*100).toFixed(2))+'%')}else{A.style('opacity',0)}}l.size=function(_){if(!arguments.length)return[o,q];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in chord.size(width, height) should be number and number of svg');return this}else{o=arguments[0];q=arguments[1];return this}};l.sizeAvail=function(_){if(!arguments.length)return[r,t];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in chord.sizeAvail(widthAvail, heightAvail) should be number and number of svg');return this}else{r=arguments[0];t=arguments[1];return this}};l.tran=function(_){if(!arguments.length)return[u,v];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in chord.tran(tranX, tranY) should be number and number of svg');return this}else{u=arguments[0];v=arguments[1];return this}};l.fontSize=function(_){if(!arguments.length)return x;else{if(!isFinite(arguments[0])){console.error('The arguments in chord.fontSize(fontSize) should be number of text');return this}else{x=arguments[0];return this}}};l.fontFamily=function(_){if(!arguments.length)return y;else{if(typeof arguments[0]!=='string'){console.error('The arguments in chord.fontFamily(fontFamily) should be string of text');return this}else{x=arguments[0];return this}}};l.duration=function(_){if(!arguments.length)return D;else{if(!isFinite(arguments[0])){console.error('The arguments in chord.duration(duration) should be number of transition');return this}else{D=Math.round(arguments[0]);return this}}};l.color=function(_){if(!arguments.length)return F;else{if(typeof arguments[0]!=='function'){console.error('The arguments in chord.color(color) should be function of pvisual.color');return this}else{F=arguments[0];return this}}};l.tickFormat=function(_){if(!arguments.length)return E;else{if(typeof arguments[0]!=='string'){console.error('The arguments in chord.tickFormat(format) should be string of d3.format');return this}else{E=m.format(arguments[0]);return this}}};l.symmetry=function(_){if(!arguments.length)return I;else{if(arguments[0]!==true&&arguments[0]!==false){console.error('The arguments in chord.symmetry(symmetry) should be bool');return this}else{I=arguments[0];return this}}};l.padding=function(_){if(!arguments.length)return H;else{if(!isFinite(arguments[0])){console.error('The arguments in chord.padding(padding) should be number');return this}else{H=arguments[0];return this}}};l.innerRadius=function(_){if(!arguments.length)return L;else{if(!isFinite(arguments[0])){console.error('The arguments in chord.innerRadius(innerRadius) should be number');return this}else{L=arguments[0];return this}}};l.outerRadius=function(_){if(!arguments.length)return M;else{if(!isFinite(arguments[0])){console.error('The arguments in chord.outerRadius(outerRadius) should be number');return this}else{M=arguments[0];return this}}};l.legendTran=function(_){if(!arguments.length)return[P,Q];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in chord.legendTran(tranX, tranY) should be number and number of svg');return this}else{P=arguments[0];Q=arguments[1];return this}};l.legendSize=function(_){if(!arguments.length)return O;else{if(!isFinite(arguments[0])){console.error('The arguments in chord.legendSize(legendSize) should be number of text');return this}else{O=arguments[0];return this}}};l.legendColor=function(_){if(!arguments.length)return N;else{if(typeof arguments[0]!=='string'){console.error('The arguments in chord.legendColor(legendColor) should be string of text');return this}else{N=arguments[0];return this}}};l.legendColumnNo=function(_){if(!arguments.length)return R;else{if(!isFinite(arguments[0])){console.error('The arguments in chord.legendColumnNo(legendColumnNo) should be number of text');return this}else{R=arguments[0];return this}}};l.legendRowGap=function(_){if(!arguments.length)return S;else{if(!isFinite(arguments[0])){console.error('The arguments in chord.legendRowGap(legendRowGap) should be number of text');return this}else{S=arguments[0];return this}}};l.options=function(_){if(!arguments.length)return{'type':l.getType(),'width':o,'height':q,'widthAvail':r,'heightAvail':t,'tranX':u,'tranY':v,'format':E,'fontSize':x,'fontColor':z,'fontFamily':y,'color':F,'duration':D,'padding':H,'symmetry':I,'innerRadius':L,'outerRadius':M,'legendColor':N,'legendSize':O,'legendTranX':P,'legendTranY':Q,'legendColumnNo':R,'legendRowGap':S};else if(typeof _!=='object'){console.error('The arguments in map.options(options) should be object');return this}else{o=isFinite(_.width)?_.width:o;q=isFinite(_.height)?_.height:q;r=isFinite(_.widthAvail)?_.widthAvail:r;t=isFinite(_.heightAvail)?_.heightAvail:t;u=isFinite(_.tranX)?_.tranX:u;v=isFinite(_.tranY)?_.tranY:v;_.format&&l.tickFormat(_.format);_.fontFamily&&l.fontFamily(_.fontFamily);_.fontColor&&l.fontColor(_.fontColor);isFinite(_.fontSize)&&l.fontSize(_.fontSize);isFinite(_.duration)&&l.duration(_.duration);isFinite(_.padding)&&l.padding(_.padding);isFinite(_.outerRadius)&&l.outerRadius(_.outerRadius);isFinite(_.innerRadius)&&l.innerRadius(_.innerRadius);_.symmetry&&l.symmetry(_.symmetry);_.legendColor&&l.legendColor(_.legendColor);isFinite(_.legendSize)&&l.legendSize(_.legendSize);P=isFinite(_.legendTranX)?_.legendTranX:P;Q=isFinite(_.legendTranY)?_.legendTranY:Q;isFinite(_.legendColumnNo)&&l.legendColumnNo(_.legendColumnNo);isFinite(_.legendRowGap)&&l.legendRowGap(_.legendRowGap);return this}};if(arguments.length===1)l.options(arguments[0]);return l};bw.model.circlepacking=function(){var e=bw.extend();var f=_.d3;var h='Circle Packing';var j=600;var l=600;var m=j-100;var n=l-100;var o=50;var q=50;var r;var s=3;var t='Arial';var v;var w;var x;var y=1000;var z=f.format('s');var A=e.color();var B;var C=1;var D=function(d,i){return'#DD71DD'};var E=function(d,i){return'#F8F8FF'};var F=function(d,i){return'#FF7F0E'};var G=.7;var H;e.data=function(_){if(arguments.length){if(_.type==='xml'){_=_.root;_=XMLdata(_)}r=_;H=r;return this}else return r};e.getType=function(){return h};e.render=function(_){w=w||f.select(_).node();if(!w||w.tagName.toLowerCase()!=='div'){console.error('The argument(element) in circlepacking.rander(_) should be <div> element')}f.select(w).classed('chart',true);x=x||f.select(w).append('svg').classed('circlepacking',true).node();B=Math.min(m,n)-5;var a=f.layout.pack().size([B,B]).value(function(d){return+d.value});v=f.select(w).select('.floatTag').node()?f.select(w).select('.floatTag'):e.floatTag(w);var g=f.select(x).attr({'width':j,'height':l}).selectAll('g').data([1]).enter().append('svg:g').attr('transform','translate('+o+','+q+')');g=f.select(x).select('g');var b=g.datum(H).selectAll('g').data(a.nodes);var c=b.exit().transition().duration(y).remove();c.select('circle').attr('r',0);c.select('text').attr('fill-opacity',0);nodeUpdate(b);nodeDraw(b);g.selectAll('.leaf').on('mouseover',function(d){drawLegend(d,true)}).on('mouseout',function(d){drawLegend(d,false)});g.selectAll('g').on('click',function(d){if(f.event){f.event.stopPropagation();f.event.preventDefault()}H=d;e.render()});f.select('body').on('click',function(){if(f.event){f.event.stopPropagation();f.event.preventDefault()}H=H.parent||H;e.render()})};function nodeUpdate(b){b.each(function(d){f.select(this).attr('class',function(d){return d.children?'node':'leaf'}).call(function(a){a.transition().duration(y).attr('transform',function(d){return'translate('+d.x+','+d.y+')'});a.select('circle').transition().duration(y).style('fill',function(d){return d.children?E(d):F(d)}).style('stroke',function(d){return d.children?D(d):'none'}).style('opacity',function(d){return d.children?G:1}).style('stroke-width',C).attr('r',function(d){return(d.r>1?d.r:0)});a.select('text').transition().duration(y).style({'text-anchor':'middle','font-size':s,'fill':fontColor,'font-family':t,'opacity':1}).text(function(){return!d.children?(d.r>8?d.name.substring(0,d.r/4):''):''})})})}function nodeDraw(b){b.enter().append('svg:g').attr('class',function(d){return d.children?'node':'leaf'}).attr('transform',function(d){return'translate('+d.x+','+d.y+')'}).call(function(a){a.append('svg:circle').style('cursor','pointer').attr('r',0).style('fill',function(d){return d.children?E(d):F(d)}).style('stroke',function(d){return d.children?D(d):'none'}).style('opacity',function(d){return d.children?G:1}).style('stroke-width',C).transition().duration(y).attr('r',function(d){return(d.r>1?d.r:0)});a.append('svg:text').style('opacity',0).transition().duration(y).attr({'dy':'6px','color':'#FFFFFF'}).style({'text-anchor':'middle','font-size':s,'fill':fontColor,'font-family':t,'opacity':1}).text(function(d){return!d.children?(d.r>8?d.name.substring(0,d.r/4):''):''})})}function drawLegend(d,a){if(a){v.style({'border-color':F(d),'opacity':1,'textAlign':'center','margin':'auto'}).html('name: '+d.name+'<br/>'+'value: '+z(d.value))}else{v.style('opacity',0)}}function XMLdata(d){if(typeof d==='object'&&d.constructor===Array){var a=0;var b;var c;var u;d.forEach(function(p,i){if(p.name!==undefined){b=i;a++}if(p.value!==undefined){c=i;a++}});if(a===1){var k=d.filter(function(p,i){return i!==b});for(var i=0;i<k.length;i++){k[i].children.children=XMLdata(k[i].children.children)}u={name:d[b].name,children:d.filter(function(p,i){return i!==b}).map(function(p){return p.children.children})}}if(a===2){u={name:d[b].name,value:+d[c].value}}}return u}e.size=function(_){if(!arguments.length)return[j,l];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in circlepacking.size(width, height) should be number and number of svg');return this}else{j=arguments[0];l=arguments[1];return this}};e.sizeAvail=function(_){if(!arguments.length)return[m,n];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in circlepacking.sizeAvail(widthAvail, heightAvail) should be number and number of svg');return this}else{m=arguments[0];n=arguments[1];return this}};e.tran=function(_){if(!arguments.length)return[o,q];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in circlepacking.tran(tranX, tranY) should be number and number of svg');return this}else{o=arguments[0];q=arguments[1];return this}};e.fontSize=function(_){if(!arguments.length)return s;else{if(!isFinite(arguments[0])){console.error('The arguments in circlepacking.fontSize(fontSize) should be number of text');return this}else{s=arguments[0];return this}}};e.fontFamily=function(_){if(!arguments.length)return t;else{if(typeof arguments[0]!=='string'){console.error('The arguments in circlepacking.fontFamily(fontFamily) should be string of text');return this}else{s=arguments[0];return this}}};e.duration=function(_){if(!arguments.length)return y;else{if(!isFinite(arguments[0])){console.error('The arguments in circlepacking.duration(duration) should be number of transition');return this}else{y=Math.round(arguments[0]);return this}}};e.color=function(_){if(!arguments.length)return A;else{if(typeof arguments[0]!=='function'){console.error('The arguments in circlepacking.color(color) should be function of pvisual.color');return this}else{A=arguments[0];return this}}};e.tickFormat=function(_){if(!arguments.length)return z;else{if(typeof arguments[0]!=='string'){console.error('The arguments in circlepacking.tickFormat(format) should be string of d3.format');return this}else{z=f.format(arguments[0]);return this}}};e.circleLineWidth=function(_){if(!arguments.length)return C;else{if(!isFinite(arguments[0])){console.error('The arguments in circlepacking.circleLineWidth(circleLineWidth) should be number');return this}else{C=arguments[0];return this}}};e.opacity=function(_){if(!arguments.length)return G;else{if(!isFinite(arguments[0])){console.error('The arguments in circlepacking.opacity(opacity) should be number');return this}else{G=arguments[0];return this}}};e.circleLineColor=function(_){if(!arguments.length)return D;else{if(typeof arguments[0]!=='function'&&typeof arguments[0]!=='string'){console.error('The arguments in circlepacking.circleLineColor(circleLineColor) should be function or string');return this}else{D=f.functor(arguments[0]);return this}}};e.circleFillColor=function(_){if(!arguments.length)return E;else{if(typeof arguments[0]!=='function'&&typeof arguments[0]!=='string'){console.error('The arguments in circlepacking.circleFillColor(circleFillColor) should be function or string');return this}else{E=f.functor(arguments[0]);return this}}};e.nodeColor=function(_){if(!arguments.length)return F;else{if(typeof arguments[0]!=='function'&&typeof arguments[0]!=='string'){console.error('The arguments in circlepacking.nodeColor(nodeColor) should be function or string');return this}else{F=f.functor(arguments[0]);return this}}};e.options=function(_){if(!arguments.length)return{'type':e.getType(),'width':j,'height':l,'widthAvail':m,'heightAvail':n,'tranX':o,'tranY':q,'format':z,'fontSize':s,'fontFamily':t,'color':A,'duration':y,'circleLineWidth':C,'opacity':G,'circleLineColor':D,'circleFillColor':E,'nodeColor':F};else if(typeof _!=='object'){console.error('The arguments in map.options(options) should be object');return this}else{j=isFinite(_.width)?_.width:j;l=isFinite(_.height)?_.height:l;m=isFinite(_.widthAvail)?_.widthAvail:m;n=isFinite(_.heightAvail)?_.heightAvail:n;o=isFinite(_.tranX)?_.tranX:o;q=isFinite(_.tranY)?_.tranY:q;_.format&&e.tickFormat(_.format);_.fontFamily&&e.fontFamily(_.fontFamily);isFinite(_.fontSize)&&e.fontSize(_.fontSize);isFinite(_.duration)&&e.duration(_.duration);isFinite(_.circleLineWidth)&&e.circleLineWidth(_.circleLineWidth);isFinite(_.opacity)&&e.opacity(_.opacity);_.circleLineColor&&e.circleLineColor(_.circleLineColor);_.circleFillColor&&e.circleFillColor(_.circleFillColor);_.nodeColor&&e.nodeColor(_.nodeColor);return this}};if(arguments.length===1)e.options(arguments[0]);return e};bw.model.co_occurrence_matrix=function(){var l=bw.extend();var m=_.d3;var n='贡献矩阵';var o=800;var r=800;var s=o-100;var u=r-100;var v=99;var w=99;var y;var z;var A=8;var B='#000000';var C='sans-serif';var D;var E;var F=2000;var G=m.format('s');var H=l.color();var I=['#00FF00','#ff0000'];var J;var K;var L;l.data=function(_){if(arguments.length){if(_.type==='xml'){_=_.root;_=XMLdata(_)}var c=m.map();_.nodes.forEach(function(d,i){d.index=i;d.links=m.range(_.nodes.length).map(function(j){return{index:j,value:null}});d.links[i].value=-1;c.set(d.name,d)});J=-Infinity;K=Infinity;_.links.forEach(function(d){var a=c.get(d.source);var b=c.get(d.target);if(a&&b){J=Math.max(J,d.value);K=Math.min(K,d.value);a.links[b.index].value=d.value;b.links[a.index].value=d.value}});y=_.nodes;y.index=c;window.data=_;return this}else return y};l.getType=function(){return n};l.render=function(_){l.div=D=D||m.select(_).node();if(!D||D.tagName.toLowerCase()!=='div'){alert('The argument(element) in graph.rander(_) should be <div> element')}m.select(D).classed('chart',true);E=E||m.select(D).append('svg').classed('co_occurrence_matrix',true).node();z=m.select(D).select('.floatTag').node()?m.select(D).select('.floatTag'):l.floatTag(D);var g=m.select(E).attr({'width':o,'height':r}).selectAll('g').data([1]).enter().append('svg:g').attr('transform','translate('+v+','+w+')');g.call(function(a){a.append('rect').classed('background',true);a.append('svg:g').classed('rows',true);a.append('svg:g').classed('columns',true)});g=m.select(E).select('g');g.select('.background').attr({'width':s,'height':u,'fill':'#eee'});var x=m.scale.ordinal().rangeBands([0,s]);var h=m.scale.linear().domain([K,J]).range(I);L={name:m.range(y.length).sort(function(a,b){return m.ascending(y[a].name,y[b].name)}),value:m.range(y.length).sort(function(a,b){return y[b].value-y[a].value}),group:m.range(y.length).sort(function(a,b){return y[b].group-y[a].group})};this.orders=m.keys(L);x.domain(L.name);var c=g.select('.rows').selectAll('.row').data(y);c.exit().transition().duration(F).style('opacity',0).remove();rowsUpdate(c,x,h);rowsDraw(c,x,h);var e=g.select('.columns').selectAll('.column').data(y);e.exit().transition().duration(500).style('opacity',0).remove();columnsUpdate(e,x);columnsDraw(e,x);this.makeOrder=function(a){x.domain(L[a]);var t=g.transition().duration(F);t.selectAll('.row').delay(function(d,i){return x(i)*4}).attr('transform',function(d){return'translate(0,'+x(d.index)+')'}).selectAll('.cell').delay(function(d,i){return x(i)*4}).attr('x',function(d){return x(d.index)});t.selectAll('.column').delay(function(d,i){return x(i)*4}).attr('transform',function(d){return'translate('+x(d.index)+')rotate(-90)'})};return l};function rowsUpdate(b,x,h){b.each(function(d){m.select(this).select('line').transition().duration(500).attr('x2',s);m.select(this).select('text').attr('y',x.rangeBand()/2).transition().duration(500).style({'font-size':A,'font-family':C}).text(function(d){return d.name});var a=m.select(this).selectAll('.cell').data(d.links.filter(function(p){return p.value}));a.exit().transition().duration(500).style('opacity',0).remove();a.transition().duration(500).attr('width',x.rangeBand()).attr('height',x.rangeBand()).attr('fill',function(p){return p.value===-1?H(p.value):h(p.value)}).attr('x',function(p){return x(p.index)});a.enter().append('svg:rect').classed('cell',true).attr('width',x.rangeBand()).attr('height',x.rangeBand()).attr('fill',function(p){return p.value===-1?H(p.value):h(p.value)}).attr('x',function(p){return x(p.index)}).on('mouseover',function(p){m.selectAll('.row text').attr('fill',function(k,i){return i===d.index?'#ff0000':null});m.selectAll('.column text').attr('fill',function(k,i){return i===p.index?'#ff0000':null});drawLegend({value:p.value,color:h(p.value)},true)}).on('mouseout',function(){m.selectAll('text').attr('fill','null');drawLegend(null,false)})}).transition().duration(F/2).delay(function(d,i){return x(i)*4}).attr('transform',function(d){return'translate(0,'+x(d.index)+')'})}function rowsDraw(a,x,h){a.enter().append('svg:g').classed('row',true).attr('fill-opacity',0).each(function(d){m.select(this).append('svg:line').attr({'x2':s,'stroke':'#fff'});m.select(this).append('svg:text').attr('x',-6).attr('y',x.rangeBand()/2).attr('dy','.32em').attr('text-anchor','end').style({'font-size':A,'font-family':C}).text(function(d){return d.name});m.select(this).selectAll('.cell').data(d.links.filter(function(p){return p.value})).enter().append('svg:rect').classed('cell',true).attr('width',x.rangeBand()).attr('height',x.rangeBand()).attr('fill',function(p){return p.value===-1?H(p.value):h(p.value)}).attr('x',function(p){return x(p.index)}).on('mouseover',function(p){m.selectAll('.row text').attr('fill',function(k,i){return i===d.index?'#ff0000':null});m.selectAll('.column text').attr('fill',function(k,i){return i===p.index?'#ff0000':null});drawLegend({value:p.value,color:h(p.value)},true)}).on('mouseout',function(){m.selectAll('text').attr('fill','null');drawLegend(null,false)})}).transition().duration(F/2).delay(function(d,i){return x(i)*4}).attr('fill-opacity',1).attr('transform',function(d){return'translate(0,'+x(d.index)+')'})}function columnsUpdate(b,x){b.transition().duration(500).attr('transform',function(d){return'translate('+x(d.index)+')rotate(-90)'}).call(function(a){a.select('line').transition().duration(500).attr({'x1':-o,'stroke':'#fff'});a.select('text').transition().duration(500).attr('y',x.rangeBand()/2).style({'font-size':A,'font-family':C}).text(function(d){return d.name})})}function columnsDraw(b,x){b.enter().append('svg:g').classed('column',true).attr('transform',function(d){return'translate('+x(d.index)+')rotate(-90)'}).call(function(a){a.append('svg:line').attr({'x1':-o,'stroke':'#fff'});a.append('svg:text').attr('x',6).attr('y',x.rangeBand()/2).attr('dy','.32em').attr('text-anchor','start').style({'font-size':A,'font-family':C}).text(function(d){return d.name})})}function drawLegend(d,a){if(a){z.style({'border-color':d.color,'opacity':1,'textAlign':'center','margin':'auto'}).html('<span style="color:#3f7ed8; font-weight:bold; font-size:11px;margin-bottom:5px;">value: '+G(d.value)+'</span>')}else{z.style('opacity',0)}}function XMLdata(d){if(typeof d==='object'&&d.constructor===Array){var f;var g;var h;d.forEach(function(p){if(p.nodes!==undefined){var a;var b;f=p.nodes.nodes.map(function(k){k.node.node.forEach(function(q){if(q.name!==undefined)a=q.name;if(q.value!==undefined)e=q.value;if(q.group!==undefined)b=q.group});return{name:a,value:e,group:b}})}else if(p.links!==undefined){var c;var d;var e;g=p.links.links.map(function(k){k.link.link.forEach(function(q){if(q.target!==undefined)c=q.target;if(q.source!==undefined)d=q.source;if(q.value!==undefined)e=q.value});return{source:d,target:c,value:e}})}});return{nodes:f,links:g}}}l.size=function(_){if(!arguments.length)return[o,r];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in co_occurrence_matrix.size(width, height) should be number and number of svg');return this}else{o=arguments[0];r=arguments[1];return this}};l.sizeAvail=function(_){if(!arguments.length)return[s,u];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in co_occurrence_matrix.sizeAvail(widthAvail, heightAvail) should be number and number of svg');return this}else{s=arguments[0];u=arguments[1];return this}};l.tran=function(_){if(!arguments.length)return[v,w];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in co_occurrence_matrix.tran(tranX, tranY) should be number and number of svg');return this}else{v=arguments[0];w=arguments[1];return this}};l.fontSize=function(_){if(!arguments.length)return A;else{if(!isFinite(arguments[0])){console.error('The arguments in co_occurrence_matrix.fontSize(fontSize) should be number of text');return this}else{A=arguments[0];return this}}};l.fontFamily=function(_){if(!arguments.length)return C;else{if(typeof arguments[0]!=='string'){console.error('The arguments in co_occurrence_matrix.fontFamily(fontFamily) should be string of text');return this}else{A=arguments[0];return this}}};l.duration=function(_){if(!arguments.length)return F;else{if(!isFinite(arguments[0])){console.error('The arguments in co_occurrence_matrix.duration(duration) should be number of transition');return this}else{F=Math.round(arguments[0]);return this}}};l.color=function(_){if(!arguments.length)return H;else{if(typeof arguments[0]!=='function'){console.error('The arguments in co_occurrence_matrix.color(color) should be function of pvisual.color');return this}else{H=arguments[0];return this}}};l.tickFormat=function(_){if(!arguments.length)return G;else{if(typeof arguments[0]!=='string'){console.error('The arguments in co_occurrence_matrix.tickFormat(format) should be string of d3.format');return this}else{G=m.format(arguments[0]);return this}}};l.gradientColor=function(_){if(!arguments.length)return I;else if(arguments.length!==2||typeof arguments[0]!=='string'||typeof arguments[1]!=='string'){console.error('The argument(element) in co_occurrence_matrix.gradientColor(start, end) should be string and string of color');return this}else{I[0]=arguments[0];I[1]=arguments[1];return this}};l.options=function(_){if(!arguments.length)return{'type':l.getType(),'width':o,'height':r,'widthAvail':s,'heightAvail':u,'tranX':v,'tranY':w,'format':G,'fontSize':A,'fontColor':B,'fontFamily':C,'color':H,'duration':F,'gradientColor':I};else if(typeof _!=='object'){console.error('The arguments in co_occurrence_matrix.options(options) should be object');return this}else{o=isFinite(_.width)?_.width:o;r=isFinite(_.height)?_.height:r;s=isFinite(_.widthAvail)?_.widthAvail:s;u=isFinite(_.heightAvail)?_.heightAvail:u;v=isFinite(_.tranX)?_.tranX:v;w=isFinite(_.tranY)?_.tranY:w;_.format&&l.tickFormat(_.format);_.fontFamily&&l.fontFamily(_.fontFamily);isFinite(_.fontSize)&&l.fontSize(_.fontSize);isFinite(_.duration)&&l.duration(_.duration);typeof _.gradientColor==='object'&&_.gradientColor.constructor===Array&&_.gradientColor.length===2&&l.gradientColor(_.gradientColor[0],_.gradientColor[1]);return this}};if(arguments.length===1)l.options(arguments[0]);return l};bw.model.graph=function(){var s=bw.extend();var t=_.d3;var u='网络图';var w=800;var z=800;var A=w;var B=z;var C=0;var D=0;var E;var F;var G=500;var H=t.format('s');var I=s.color();var J=true;var K=.1;var L=.8;var M=.9;var N=-250;var O=20;var P=function(d,i){return 5};var Q=function(d,i){return I(d.group)};var R=function(d,i){return 10+d.value*5};var S=function(d,i){return 1};var T=function(d,i){return'#AAAAAA'};var U=function(d,i){return 1};var V=function(d,i){return 1};var W=function(d,i){return'#FF6666'};var X=function(d,i){return'#6666FF'};var Y=function(d,i){return'#d62799'};var Z=function(d,i){return 6};s.data=function(_){if(arguments.length){if(_.type==='xml'){_=_.root;_=XMLdata(_)}var a=t.map();_.nodes.forEach(function(d){a.set(d.name,d)});_.links.forEach(function(d){d.source=a.get(d.source);d.target=a.get(d.target)});_.links=_.links.filter(function(d){return d.source!==undefined&&d.target!==undefined});E=_;return this}else return E};s.getType=function(){return u};s.render=function(_){div=div||t.select(_).node();if(!div||div.tagName.toLowerCase()!=='div'){alert('The argument(element) in graph.rander(_) should be <div> element')}t.select(div).classed('chart',true);svg=svg||t.select(div).append('svg').classed('graph',true).node();t.select(svg).select('g').remove();var c,force=t.layout.force().alpha(1).charge(N).gravity(K).theta(L).friction(M).linkDistance(R).size([A-5,B-5]);force.nodes(E.nodes).links(E.links).start();F=t.select(div).select('.floatTag').node()?t.select(div).select('.floatTag'):s.floatTag(div);var g=t.select(svg).attr({'width':w,'height':z}).selectAll('g').data([1]).enter().append('svg:g').attr('transform','translate('+C+','+D+')');var e=g.append('svg:g').datum(function(){return{selected:false,previouslySelected:false}}).classed('brush',true);g.call(function(a){a.append('svg:g').classed('links',true);a.append('svg:g').classed('nodes',true)});g=t.select(svg).select('g');var f=g.select('.links').selectAll('.link').data(E.links);f.exit().transition().duration(G).style('opacity',0).remove();f.enter().append('svg:line').classed('link',true).style('stroke-width',S).style('stroke',T);var h=g.select('.nodes').selectAll('.node').data(E.nodes);h.exit().transition().duration(G).style('opacity',0).remove();h.enter().append('svg:circle').classed('node',true).on('mouseover',function(d){t.select(this).attr('r',Z).style('fill-opacity',.8).style('fill',Y);g.select('.links').selectAll('.link').each(function(p){if(p.source===d){t.select(this).style('stroke-width',U).style('stroke',W)}else if(p.target===d){t.select(this).style('stroke-width',V).style('stroke',X)}});drawLegend(d,true,g)}).on('mouseout',function(d){t.select(this).attr('r',P).style('fill-opacity',1).style('fill',I(d.group));g.select('.links').selectAll('.link').filter(function(p){return p.source===d||p.target===d}).style('stroke-width',S).style('stroke',T);drawLegend(d,false,g)});h=g.selectAll('.node').attr('r',P).style('stroke','none').style('fill',Q);h.on('mousedown',function(d){if(!d.selected){if(!c)h.classed('selected',function(p){return p.selected=d===p});else t.select(this).classed('selected',d.selected=true)}}).on('mouseup',function(d){if(d.selected&&c)t.select(this).classed('selected',d.selected=false)});if(J){e.call(t.svg.brush().x(t.scale.identity().domain([0,A-5])).y(t.scale.identity().domain([0,B-5])).on('brushstart',function(){h.each(function(d){d.previouslySelected=c&&d.selected})}).on('brush',function(){var a=t.event.target.extent();h.classed('selected',function(d){d.selected=d.previouslySelected^(a[0][0]<=d.x&&d.x<a[1][0]&&a[0][1]<=d.y&&d.y<a[1][1]);t.select(this).style('stroke',d.selected===1?'#000000':'none');return d.selected})}).on('brushend',function(){t.event.target.clear();t.select(this).call(t.event.target)}));h.call(t.behavior.drag().on('drag',function(){nudge(t.event.dx,t.event.dy)}));e.select('.extent').style({'fill-opacity':.1,'stroke':'#FFFFFF','shape-rendering':'crispEdges'})}else{t.select(svg).select('.brush').remove();h.call(force.drag)}force.on('tick',function(){f.attr('x1',function(d){return d.source.x}).attr('y1',function(d){return d.source.y}).attr('x2',function(d){return d.target.x}).attr('y2',function(d){return d.target.y});h.attr('cx',function(d){return d.x}).attr('cy',function(d){return d.y})});function nudge(a,b){h.filter(function(d){return d.selected}).attr("cx",function(d){return d.x+=a}).attr("cy",function(d){return d.y+=b});f.filter(function(d){return d.source.selected}).attr("x1",function(d){return d.source.x}).attr("y1",function(d){return d.source.y});f.filter(function(d){return d.target.selected}).attr("x2",function(d){return d.target.x}).attr("y2",function(d){return d.target.y})}};s.map=function(){function distance(a,b){return Math.sqrt(Math.pow(b[0]-a.x,2)+Math.pow(b[1]-a.y,2))}var r=20;var c=[Number.MAX_VALUE,Number.MAX_VALUE];var e=[Number.MIN_VALUE,Number.MIN_VALUE];E.nodes.forEach(function(d){c[0]=c[0]>d.x?d.x:c[0];c[1]=c[1]>d.y?d.y:c[1];e[0]=e[0]<d.x?d.x:e[0];e[1]=e[1]<d.y?d.y:e[1]});c[0]-=10,c[1]-=10,e[0]+=10,e[1]+=10;var f=t.range(Math.round(A*B/1000)).map(function(){return[Math.random()*(e[0]-c[0])+c[0],Math.random()*(e[1]-c[1])+c[1],-1]});for(var i=0;i<f.length;i++){var g=f[i];var h=Number.MAX_VALUE;for(var j=0;j<E.nodes.length;j++){var k=E.nodes[j];var d=distance(k,g);if(d<h){g[2]=k.group;h=d}}if(h>r)g[2]=-1}var n=E.nodes.map(function(d){return[d.x,d.y,d.group]});n=t.merge([f,n]);var l=t.geom.voronoi().clipExtent([c,e]);var m=t.select('.graph g').append('svg:g').classed('map',true).selectAll('path');m=m.data(l(n),polygon);m.exit().remove();m.enter().append('path').style('fill-opacity',.3).style('stroke-opacity',.1).style('fill',function(d){return d.point[2]===-1?'none':I(d.point[2])}).style('stroke','none').attr('d',polygon);m.order();function polygon(d){return'M'+d.join('L')+'Z'}};s.circle=function(_){function distance(a,b){return Math.sqrt(Math.pow(b[0]-a.x,2)+Math.pow(b[1]-a.y,2))}var j=t.nest().key(function(d){return d.group}).entries(E.nodes);div=div||t.select(_).node();if(!div||div.tagName.toLowerCase()!=='div'){alert('The argument(element) in graph.rander(_) should be <div> element')}t.select(div).classed('chart',true);svg=svg||t.select(div).append('svg').classed('graph',true).node();t.select(svg).select('g').remove();var k=t.layout.force().nodes(E.nodes).links(E.links).alpha(1).charge(N).gravity(K).theta(L).linkDistance(80).friction(M).size([A-5,B-5]).on('tick',tick).start();var g=t.select(svg).attr({'width':w,'height':z}).selectAll('g').data([1]).enter().append('svg:g').attr('transform','translate('+C+','+D+')');g.call(function(a){a.append('svg:g').classed('links',true);a.append('svg:g').classed('nodes',true);a.append('svg:g').classed('clusters',true)});g=t.select(svg).select('g');var m=g.select('.links').selectAll('.link').data(E.links);m.exit().transition().duration(G).style('opacity',0).remove();m.enter().append('svg:line').classed('link',true).style('stroke-width',S).style('stroke',T);var n=g.select('.nodes').selectAll('.node').data(E.nodes);n.exit().transition().duration(G).style('opacity',0).remove();n.enter().append('svg:circle').classed('node',true);n=g.selectAll('.node').attr('r',P).style('stroke','none').style('fill',Q).call(k.drag);var o=g.select('.clusters').selectAll('.cluster').data(j);o.exit().transition().duration(G).style('opacity',0).remove();o.enter().append('svg:circle').classed('cluster',true).style('fill','none');function tick(e){function collide(g){var h=t.geom.quadtree().extent([[0,0],[A,B]])(i);return function(d){var r=d.radius*2+O,nx1=d.x-r,nx2=d.x+r,ny1=d.y-r,ny2=d.y+r;h.visit(function(a,b,c,e,f){if(a.point&&(a.point!==d)){var x=d.x-a.point.x,y=d.y-a.point.y,l=Math.sqrt(x*x+y*y),r=d.radius+a.point.radius+O;if(l<r){l=(l-r)/l*g;d.x-=x*=l;d.y-=y*=l;a.point.x+=x;a.point.y+=y}}return b>nx2||e<nx1||c>ny2||f<ny1})}}function cluster(b){return function(d){var a=i[d.group];var x=d.x-a.x,y=d.y-a.y,l=Math.sqrt(x*x+y*y);l*=b;d.x-=x*=l;d.y-=y*=l}}var i=[];j.forEach(function(d){var v=d.values;var x=0;var y=0;v.forEach(function(p){x+=p.x;y+=p.y});x/=v.length;y/=v.length;var a=Number.MIN_VALUE;var b;v.forEach(function(p){b=distance(p,[x,y]);if(a<b)a=b});i[d.key]={group:d.key,x:x,y:y,radius:a+5}});i.forEach(collide(3*e.alpha));n.each(cluster(e.alpha*.01)).attr('cx',function(d){return d.x}).attr('cy',function(d){return d.y});m.attr('x1',function(d){return d.source.x}).attr('y1',function(d){return d.source.y}).attr('x2',function(d){return d.target.x}).attr('y2',function(d){return d.target.y});o.data(i).attr('cx',function(d){return d.x}).attr('cy',function(d){return d.y}).style('stroke',function(d){return I(d.group)}).attr('r',function(d){return d.radius})}};function drawLegend(d,a){if(a){F.style({'border-color':I(d.group),'opacity':1,'textAlign':'center','margin':'auto'}).html('name: '+d.name)}else{F.style('opacity',0)}}function XMLdata(d){if(typeof d==='object'&&d.constructor===Array){var f;var g;var h;d.forEach(function(p){if(p.nodes!==undefined){var a;var b;f=p.nodes.nodes.map(function(k){k.node.node.forEach(function(q){if(q.name!==undefined)a=q.name;if(q.value!==undefined)e=q.value;if(q.group!==undefined)b=q.group});return{name:a,value:e,group:b}})}else if(p.links!==undefined){var c;var d;var e;g=p.links.links.map(function(k){k.link.link.forEach(function(q){if(q.target!==undefined)c=q.target;if(q.source!==undefined)d=q.source;if(q.value!==undefined)e=q.value});return{source:d,target:c,value:e}})}});return{nodes:f,links:g}}}s.size=function(_){if(!arguments.length)return[w,z];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){alert('The argument(element) in graph.size(width, height) should be number and number of svg');return this}else{w=arguments[0];z=arguments[1];return this}};s.sizeAvail=function(_){if(!arguments.length)return[A,B];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){alert('The argument(element) in graph.sizeAvail(widthAvail, heightAvail) should be number and number of svg');return this}else{A=arguments[0];B=arguments[1];return this}};s.tran=function(_){if(!arguments.length)return[C,D];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){alert('The argument(element) in graph.tran(tranX, tranY) should be number and number of svg');return this}else{C=arguments[0];D=arguments[1];return this}};s.duration=function(_){if(!arguments.length)return G;else{if(!isFinite(arguments[0])){alert('The arguments in graph.duration(duration) should be number of transition');return this}else{G=Math.round(arguments[0]);return this}}};s.color=function(_){if(!arguments.length)return I;else{if(typeof arguments[0]!=='function'){alert('The arguments in graph.color(color) should be function of pvisual.color');return this}else{I=arguments[0];return this}}};s.tickFormat=function(_){if(!arguments.length)return H;else{if(typeof arguments[0]!=='string'){alert('The arguments in graph.tickFormat(format) should be string of d3.format');return this}else{H=t.format(arguments[0]);return this}}};s.dragHold=function(_){if(!arguments.length)return J;else if(_===true||_===false)J=_;return this};s.gravity=function(_){if(!arguments.length)return K;else{if(!isFinite(arguments[0])){alert('The arguments in graph.gravity(gravity) should be number');return this}else{K=arguments[0];return this}}};s.theta=function(_){if(!arguments.length)return L;else{if(!isFinite(arguments[0])){alert('The arguments in graph.theta(theta) should be number');return this}else{L=arguments[0];return this}}};s.friction=function(_){if(!arguments.length)return M;else{if(!isFinite(arguments[0])){alert('The arguments in graph.friction(friction) should be number');return this}else{M=arguments[0];return this}}};s.charge=function(_){if(!arguments.length)return N;else{if(!isFinite(arguments[0])){alert('The arguments in graph.charge(charge) should be number');return this}else{N=arguments[0];return this}}};s.nodeSize=function(_){if(!arguments.length)return P;else{if(typeof arguments[0]!=='function'&&!isFinite(arguments[0])){alert('The arguments in graph.nodeSize(nodeSize) should be function or number');return this}else{P=t.functor(arguments[0]);return this}}};s.nodeColor=function(_){if(!arguments.length)return Q;else{if(typeof arguments[0]!=='function'&&!isFinite(arguments[0])){alert('The arguments in graph.nodeColor(nodeColor) should be function or string');return this}else{Q=t.functor(arguments[0]);return this}}};s.linkDistance=function(_){if(!arguments.length)return R;else{if(typeof arguments[0]!=='function'&&!isFinite(arguments[0])){alert('The arguments in graph.linkDistance(linkDistance) should be function or number');return this}else{R=t.functor(arguments[0]);return this}}};s.linkWidth=function(_){if(!arguments.length)return S;else{if(typeof arguments[0]!=='function'&&!isFinite(arguments[0])){alert('The arguments in graph.linkWidth(linkWidth) should be function or number');return this}else{S=t.functor(arguments[0]);return this}}};s.linkColor=function(_){if(!arguments.length)return T;else{if(typeof arguments[0]!=='function'&&typeof arguments[0]!=='string'){alert('The arguments in graph.linkColor(linkColor) should be function or string');return this}else{T=t.functor(arguments[0]);return this}}};s.nodeLightColor=function(_){if(!arguments.length)return Y;else{if(typeof arguments[0]!=='function'&&typeof arguments[0]!=='string'){alert('The arguments in graph.nodeLightColor(nodeLightColor) should be function or string');return this}else{Y=t.functor(arguments[0]);return this}}};s.nodeLightSize=function(_){if(!arguments.length)return Z;else{if(typeof arguments[0]!=='function'&&!isFinite(arguments[0])){alert('The arguments in graph.nodeLightSize(nodeLightSize) should be function or number');return this}else{Z=t.functor(arguments[0]);return this}}};s.linkLightWidthSource=function(_){if(!arguments.length)return U;else{if(typeof arguments[0]!=='function'&&!isFinite(arguments[0])){alert('The arguments in graph.linkLightWidthSource(linkLightWidthSource) should be function or number');return this}else{U=t.functor(arguments[0]);return this}}};s.linkLightWidthTarget=function(_){if(!arguments.length)return V;else{if(typeof arguments[0]!=='function'&&!isFinite(arguments[0])){alert('The arguments in graph.linkLightWidthTarget(linkLightWidthTarget) should be function or number');return this}else{V=t.functor(arguments[0]);return this}}};s.linkLightColorSource=function(_){if(!arguments.length)return W;else{if(typeof arguments[0]!=='function'&&typeof arguments[0]!=='string'){alert('The arguments in graph.linkLightColorSource(linkLightColorSource) should be function or string');return this}else{W=t.functor(arguments[0]);return this}}};s.linkLightColorTarget=function(_){if(!arguments.length)return X;else{if(typeof arguments[0]!=='function'&&typeof arguments[0]!=='string'){alert('The arguments in graph.linkLightColorTarget(linkLightColorTarget) should be function or string');return this}else{X=t.functor(arguments[0]);return this}}};s.options=function(_){if(!arguments.length)return{'type':s.getType(),'width':w,'height':z,'widthAvail':A,'heightAvail':B,'tranX':C,'tranY':D,'format':H,'color':I,'duration':G,'c':J,'gravity':K,'theta':L,'friction':M,'charge':N,'nodeSize':P,'nodeColor':Q,'linkDistance':R,'linkWidth':S,'linkColor':T,'nodeLightColor':Y,'nodeLightSize':Z,'linkLightWidthSource':U,'linkLightWidthTarget':V,'linkLightColorSource':W,'linkLightColorTarget':X};else if(typeof _!=='object'){alert('The arguments in map.options(options) should be object');return this}else{w=isFinite(_.width)?_.width:w;z=isFinite(_.height)?_.height:z;A=isFinite(_.widthAvail)?_.widthAvail:A;B=isFinite(_.heightAvail)?_.heightAvail:B;C=isFinite(_.tranX)?_.tranX:C;D=isFinite(_.tranY)?_.tranY:D;_.format&&s.tickFormat(_.format);isFinite(_.duration)&&s.duration(_.duration);_.dragHold&&s.dragHold(_.dragHold);isFinite(_.gravity)&&s.gravity(_.gravity);isFinite(_.theta)&&s.theta(_.theta);isFinite(_.friction)&&s.friction(_.friction);isFinite(_.charge)&&s.charge(_.charge);_.nodeSize&&s.nodeSize(_.nodeSize);_.linkDistance&&s.linkDistance(_.linkDistance);_.linkWidth&&s.linkWidth(_.linkWidth);_.linkColor&&s.linkColor(_.linkColor);_.nodeLightColor&&s.nodeLightColor(_.nodeLightColor);_.nodeLightSize&&s.nodeLightSize(_.nodeLightSize);_.linkLightWidthSource&&s.linkLightWidthSource(_.linkLightWidthSource);_.linkLightWidthTarget&&s.linkLightWidthTarget(_.linkLightWidthTarget);_.linkLightColorSource&&s.linkLightColorSource(_.linkLightColorSource);_.linkLightColorTarget&&s.linkLightColorTarget(_.linkLightColorTarget);return this}};if(arguments.length===1)s.options(arguments[0]);return s};bw.model.groupbar=function(){var j=bw.extend();var l=_.d3;var m='柱状图';var n=800;var o=400;var q=n-200;var r=o-100;var t=50;var u;var v='Arial';var w;var x;var z;var A=1000;var B=l.format('s');var C=j.color();var D=.1;var E;var F;var G='';var H='';var I=0;var J=0;var K=8;var L='#000000';var M=5;var N=5;var O=5;var P=8;var Q='#929292';var R='#929292';var S=2;var T='#000000';var U='#000000';var V=13;var W=0;var X=0;var Y=10;var Z=100;j.data=function(_){if(arguments.length){if(_.type==='xml'){_=_.root;_=_.map(function(d){var a={};d.row.row.forEach(function(p){var k=bw.keys(p)[0];a[k]=p[k]});return a})}else if(_.type==='xlsx'||_.type==='xls'){var s=[];for(var i=0;i<_.length;i++){var k=bw.keys(_[i])[0];s=s.concat(_[i][k])}_=s}E=bw.keys(_[0]).filter(function(d){return d!=='x'}).map(function(d){return{name:d,_flag:true}});F=_.map(function(d){var a=E.map(function(p){return{name:p.name,y:+d[p.name]}});return{x:d.x,value:a}});E.x=_.map(function(p){return p.x});u=_;return this}else return u};j.getType=function(){return m};j.render=function(_){x=x||l.select(_).node();if(!x||x.tagName.toLowerCase()!=='div'){console.error('The argument(element) in groupbar.rander(_) should be <div> element')}l.select(x).classed('chart',true);z=z||l.select(x).append('svg').classed('groupbar',true).node();var b=l.scale.ordinal().rangeRoundBands([0,q],D);var c=l.scale.ordinal();var y=l.scale.linear().range([r,0]);b.domain(E.x);c.domain(E.filter(function(d){return d._flag}).map(function(d){return d.name})).rangeRoundBands([0,b.rangeBand()]);y.domain([0,l.max(F,function(d){return l.max(d.value,function(p){return p.y})})]);var e=l.svg.axis().scale(b).orient('bottom').tickSize(N);var f=l.svg.axis().scale(y).orient('left').ticks(M).tickSize(O).tickFormat(B);w=l.select(x).select('.floatTag').node()?l.select(x).select('.floatTag'):j.floatTag(x);var g=l.select(z).attr({'width':n,'height':o}).selectAll('g').data([1]).enter().append('svg:g').attr('transform','translate('+t+','+tranY+')');g.call(function(a){a.append('svg:g').classed('dimensions',true);a.append('svg:g').classed('x-axis axis',true);a.append('svg:g').classed('y-axis axis',true);a.append('svg:g').classed('legends',true)});g=l.select(z).select('g');var h=g.selectAll('.dimensions').selectAll('.dimension').data(F);h.exit().transition().duration(A).style('opacity',0).remove();dimensionUpdate(h,b,c,y);dimensionDraw(h,b,c,y);var i=g.select('.legends').attr('transform','translate('+W+','+X+')').selectAll('.legend').data(E);i.exit().transition().duration(A).style('opacity',0).remove();legendUpdate(i);legendDraw(i);axis(g,e,f)};function dimensionUpdate(b,c,e,y){b.each(function(d){var a=l.select(this).selectAll('rect').data(function(p){return p.value});a.exit().transition().duration(A).style('opacity',0).remove();a.transition().duration(A).attr('x',function(p){return e(p.name)}).style('fill',function(p){return C(p.name)}).attr('y',function(p){return y(p.y)}).attr('width',e.rangeBand()).attr('height',function(p){return r-y(p.y)});a.enter().append('svg:rect').attr('x',function(p){return e(p.name)}).attr({'height':0,'y':y(0),'width':e.rangeBand()}).style('fill',function(p){return C(p.name)}).on('mouseover',function(p){drawLegend(p,true)}).on('mouseout',function(p){drawLegend(p,false)}).transition().duration(A).attr('y',function(p){return y(p.y)}).attr('height',function(p){return r-y(p.y)});l.select(this).transition().duration(A).attr('transform',function(){return'translate('+c(d.x)+',0)'})})}function dimensionDraw(a,b,c,y){a.enter().append('svg:g').classed('dimension',true).each(function(d){l.select(this).selectAll('rect').data(function(p){return p.value}).enter().append('svg:rect').attr('x',function(p){return c(p.name)}).attr({'height':0,'y':y(0),'width':c.rangeBand()}).style('fill',function(p){return C(p.name)}).on('mouseover',function(p){drawLegend(p,true)}).on('mouseout',function(p){drawLegend(p,false)}).transition().duration(A).attr('y',function(p){return y(p.y)}).attr('height',function(p){return r-y(p.y)});l.select(this).transition().duration(A).attr('transform',function(){return'translate('+b(d.x)+',0)'})})}function legendDraw(b){b.enter().append('svg:g').classed('legend',true).style('cursor','pointer').on('click',function(d){if(!l.select(this).classed('none')){if(E.length>1){l.select(this).classed('none',true);d._flag=false;F=u.map(function(d){var a=E.filter(function(p){return p._flag}).map(function(p){return{name:p.name,y:+d[p.name]}});return{x:d.x,value:a}});j.render()}}else{l.select(this).classed('none',false);d._flag=true;F=u.map(function(d){var a=E.filter(function(p){return p._flag}).map(function(p){return{name:p.name,y:+d[p.name]}});return{x:d.x,value:a}});j.render()}}).each(function(d,i){l.select(this).append('svg:rect').attr({'x':(i-i%Y)/Y*Z+q+20,'y':i%Y*20}).attr({'width':10,'height':10}).style({'fill':C(i),'stroke':C(i)}).style('fill-opacity',d._flag?1:0).style('opacity',0).transition().duration(A/2).style('opacity',1);l.select(this).append('svg:text').attr({'x':(i-i%Y)/Y*Z+q+40,'y':i%Y*20+9}).style({'opacity':0,'fill':U,'font-size':V,'font-family':v}).transition().duration(A/2).style('opacity',1).text(d.name)})}function legendUpdate(a){a.each(function(d,i){l.select(this).selectAll('rect').transition().duration(A/2).style({'fill':C(i),'stroke':C(i)}).style('fill-opacity',d._flag?1:0).attr({'x':(i-i%Y)/Y*Z+q+20,'y':i%Y*20});l.select(this).selectAll('text').transition().duration(A/2).attr({'x':(i-i%Y)/Y*Z+q+40,'y':i%Y*20+9}).style({'font-size':V,'fill':U,'font-family':v}).text(d.name)})}function axis(g,b,c){g.select('.x-axis').each(function(){l.select(this).select('.label').transition().duration(A).attr({'x':q,'y':-6}).style({'text-anchor':'end','font-family':v,'font-size':K,'fill':L}).text(H);l.select(this).selectAll('.label').data([1]).enter().append('svg:text').classed('label',true).style({'text-anchor':'end','font-family':v,'font-size':K,'fill':L}).attr({'x':q,'y':-6}).text(H);l.select(this).transition().duration(A).attr('transform','translate(0,'+r+')').call(b)});g.select('.y-axis').each(function(){l.select(this).select('.label').style({'text-anchor':'end','font-family':v,'font-size':K,'fill':L}).text(G);l.select(this).selectAll('.label').data([1]).enter().append('svg:text').classed('label',true).style({'text-anchor':'end','font-family':v,'font-size':K,'fill':L}).attr({'transform':'rotate(-90)','y':8,'dy':'.71em'}).text(G);l.select(this).transition().duration(A).call(c)});g.selectAll('.axis').call(function(a){a.selectAll('path').style({'fill':'none','stroke':T,'stroke-width':S,'shape-rendering':'crispEdges'});a.selectAll('line').style({'fill':'none','stroke':R,'shape-rendering':'crispEdges'})});g.select('.x-axis').selectAll('.tick').select('text').style({'text-anchor':'middle','font-family':v,'font-size':P,'fill':Q}).attr('transform',function(){return'translate('+this.getComputedTextLength()*Math.abs(Math.sin(I)*.5)+','+(this.getComputedTextLength()*(.5*Math.abs(Math.sin(I)))+5)+')rotate('+I+')'});g.select('.y-axis').selectAll('.tick').select('text').style({'text-anchor':'start','font-family':v,'font-size':P,'fill':Q}).attr('transform',function(){return'translate('+ -this.getComputedTextLength()+', 0)rotate('+J+')'})}function drawLegend(d,a){if(a){w.style({'border-color':C(d.name),'opacity':1,'textAlign':'center','margin':'auto'}).html('name: '+d.name+'<br/>value: '+B(d.y))}else{w.style('opacity',0)}}j.size=function(_){if(!arguments.length)return[n,o];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in groupbar.size(width, height) should be number and number of svg');return this}else{n=arguments[0];o=arguments[1];return this}};j.sizeAvail=function(_){if(!arguments.length)return[q,r];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in groupbar.sizeAvail(widthAvail, heightAvail) should be number and number of svg');return this}else{q=arguments[0];r=arguments[1];return this}};j.tran=function(_){if(!arguments.length)return[t,tranY];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in groupbar.tran(tranX, tranY) should be number and number of svg');return this}else{t=arguments[0];tranY=arguments[1];return this}};j.fontFamily=function(_){if(!arguments.length)return v;else{if(typeof arguments[0]!=='string'){console.error('The arguments in groupbar.fontFamily(fontFamily) should be string of text');return this}else{fontSize=arguments[0];return this}}};j.duration=function(_){if(!arguments.length)return A;else{if(!isFinite(arguments[0])){console.error('The arguments in groupbar.duration(duration) should be number of transition');return this}else{A=Math.round(arguments[0]);return this}}};j.color=function(_){if(!arguments.length)return C;else{if(typeof arguments[0]!=='function'){console.error('The arguments in groupbar.color(color) should be function of pvisual.color');return this}else{C=arguments[0];return this}}};j.tickFormat=function(_){if(!arguments.length)return B;else{if(typeof arguments[0]!=='string'){console.error('The arguments in groupbar.tickFormat(format) should be string of d3.format');return this}else{B=l.format(arguments[0]);return this}}};j.padding=function(_){if(!arguments.length)return D;else{if(!isFinite(arguments[0])){console.error('The arguments in groupbar.padding(padding) should be number');return this}else{D=arguments[0];return this}}};j.xLegend=function(_){if(!arguments.length)return H;else{if(typeof arguments[0]!=='string'){console.error('The arguments in groupbar.xLegend(xLegend) should be string');return this}else{H=arguments[0];return this}}};j.yLegend=function(_){if(!arguments.length)return G;else{if(typeof arguments[0]!=='string'){console.error('The arguments in groupbar.yLegend(yLegend) should be string');return this}else{G=arguments[0];return this}}};j.xtickRotate=function(_){if(!arguments.length)return I;else{if(!isFinite(arguments[0])){console.error('The arguments in groupbar.xtickRotate(xtickRotate) should be number of tick');return this}else{I=Math.round(arguments[0]);return this}}};j.ytickRotate=function(_){if(!arguments.length)return J;else{if(!isFinite(arguments[0])){console.error('The arguments in groupbar.ytickRotate(ytickRotate) should be number of tick');return this}else{J=Math.round(arguments[0]);return this}}};j.labelSize=function(_){if(!arguments.length)return K;else{if(!isFinite(arguments[0])){console.error('The arguments in groupbar.labelSize(labelSize) should be string');return this}else{K=arguments[0];return this}}};j.labelColor=function(_){if(!arguments.length)return L;else{if(typeof arguments[0]!=='string'){console.error('The arguments in groupbar.labelColor(labelColor) should be string');return this}else{L=arguments[0];return this}}};j.ytickNumber=function(_){if(!arguments.length)return M;else{if(!isFinite(arguments[0])){console.error('The arguments in groupbar.ytickNumber(ytickNumber) should be number of tick');return this}else{M=Math.round(arguments[0]);return this}}};j.tickLineColor=function(_){if(!arguments.length)return R;else{if(typeof arguments[0]!=='string'){console.error('The arguments in groupbar.tickLineColor(tickLineColor) should be string');return this}else{R=arguments[0];return this}}};j.tickTextSize=function(_){if(!arguments.length)return P;else{if(!isFinite(arguments[0])){console.error('The arguments in groupbar.tickTextSize(tickTextSize) should be number');return this}else{P=arguments[0];return this}}};j.tickTextColor=function(_){if(!arguments.length)return Q;else{if(typeof arguments[0]!=='string'){console.error('The arguments in groupbar.tickTextColor(tickTextColor) should be string');return this}else{Q=arguments[0];return this}}};j.axisPathWidth=function(_){if(!arguments.length)return S;else{if(!isFinite(arguments[0])){console.error('The arguments in groupbar.axisPathWidth(axisPathWidth) should be string');return this}else{S=arguments[0];return this}}};j.axisPathColor=function(_){if(!arguments.length)return T;else{if(typeof arguments[0]!=='string'){console.error('The arguments in groupbar.axisPathColor(axisPathColor) should be string');return this}else{T=arguments[0];return this}}};j.legendTran=function(_){if(!arguments.length)return[W,X];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in groupbar.legendTran(tranX, tranY) should be number and number of svg');return this}else{W=arguments[0];X=arguments[1];return this}};j.legendSize=function(_){if(!arguments.length)return V;else{if(!isFinite(arguments[0])){console.error('The arguments in groupbar.legendSize(legendSize) should be number of text');return this}else{V=arguments[0];return this}}};j.legendColor=function(_){if(!arguments.length)return U;else{if(typeof arguments[0]!=='string'){console.error('The arguments in groupbar.legendColor(legendColor) should be string of text');return this}else{U=arguments[0];return this}}};j.legendColumnNo=function(_){if(!arguments.length)return Y;else{if(!isFinite(arguments[0])){console.error('The arguments in groupbar.legendColumnNo(legendColumnNo) should be number of text');return this}else{Y=arguments[0];return this}}};j.legendRowGap=function(_){if(!arguments.length)return Z;else{if(!isFinite(arguments[0])){console.error('The arguments in groupbar.legendRowGap(legendRowGap) should be number of text');return this}else{Z=arguments[0];return this}}};j.options=function(_){if(!arguments.length)return{'type':j.getType(),'width':n,'height':o,'widthAvail':q,'heightAvail':r,'tranX':t,'tranY':tranY,'format':B,'fontFamily':v,'color':C,'duration':A,'padding':D,'xLegend':H,'yLegend':G,'xtickRotate':I,'ytickRotate':J,'labelSize':K,'labelColor':L,'ytickNumber':M,'tickTextSize':P,'tickTextColor':Q,'tickLineColor':R,'xtickLineLength':N,'ytickLineLength':O,'axisPathWidth':S,'axisPathColor':T,'legendColor':U,'legendSize':V,'legendTranX':W,'legendTranY':X,'legendColumnNo':Y,'legendRowGap':Z};else if(typeof _!=='object'){console.error('The arguments in map.options(options) should be object');return this}else{n=isFinite(_.width)?_.width:n;o=isFinite(_.height)?_.height:o;q=isFinite(_.widthAvail)?_.widthAvail:q;r=isFinite(_.heightAvail)?_.heightAvail:r;t=isFinite(_.tranX)?_.tranX:t;tranY=isFinite(_.tranY)?_.tranY:tranY;_.format&&j.tickFormat(_.format);_.fontFamily&&j.fontFamily(_.fontFamily);isFinite(_.duration)&&j.duration(_.duration);_.xLegend&&j.xLegend(_.xLegend);_.yLegend&&j.yLegend(_.yLegend);isFinite(_.xtickRotate)&&j.xtickRotate(_.xtickRotate);isFinite(_.ytickRotate)&&j.ytickRotate(_.ytickRotate);isFinite(_.labelSize)&&j.labelSize(_.labelSize);_.labelColor&&j.labelColor(_.labelColor);isFinite(_.padding)&&j.padding(_.padding);isFinite(_.ytickNumber)&&j.ytickNumber(_.ytickNumber);isFinite(_.tickTextSize)&&j.tickTextSize(_.tickTextSize);_.tickTextColor&&j.tickTextColor(_.tickTextColor);_.tickLineColor&&j.tickLineColor(_.tickLineColor);isFinite(_.xtickLineLength)&&j.xtickLineLength(_.xtickLineLength);isFinite(_.ytickLineLength)&&j.ytickLineLength(_.ytickLineLength);isFinite(_.axisPathWidth)&&j.axisPathWidth(_.axisPathWidth);_.axisPathColor&&j.axisPathColor(_.axisPathColor);_.legendColor&&j.legendColor(_.legendColor);isFinite(_.legendSize)&&j.legendSize(_.legendSize);W=isFinite(_.legendTranX)?_.legendTranX:W;X=isFinite(_.legendTranY)?_.legendTranY:X;isFinite(_.legendColumnNo)&&j.legendColumnNo(_.legendColumnNo);isFinite(_.legendRowGap)&&j.legendRowGap(_.legendRowGap);return this}};if(arguments.length===1)j.options(arguments[0]);return j};bw.model.heat=function(){var l=bw.extend();var m=_.d3;var n='热点图';var o=400;var q=width-150;var r=o-100;var t=40;var u=10;var v;var w='Arial';var z;var A;var B=1000;var C=m.format('s');var D=l.color();var E=0;var F;var G=['white','steelblue'];var H='';var I='';var J=0;var K=0;var L=8;var M='#000000';var N=5;var O=5;var P=5;var Q=8;var R='#929292';var S='#929292';var T=2;var U='#000000';var V='#000000';var W=13;var X=0;var Y=0;var Z=10;var bx=100;l.data=function(_){if(arguments.length){if(_.type==='xml'){_=_.root;_=_.map(function(d){var a={};d.row.row.forEach(function(p){var k=bw.keys(p)[0];a[k]=p[k]});return a})}else if(_.type==='xlsx'||_.type==='xls'){var s=[];for(var i=0;i<_.length;i++){var k=bw.keys(_[i])[0];s=s.concat(_[i][k])}_=s}F={};F.x=m.set([]);F.y=m.set([]);_.forEach(function(d){d.h=+d.h;d._flag=true;F.x.add(d.x);F.y.add(d.y)});F.x=F.x.values();F.y=F.y.values();v=_;return this}else return v};l.getType=function(){return n};l.render=function(_){div=div||m.select(_).node();if(!div||div.tagName.toLowerCase()!=='div'){console.error('The argument(element) in heat.rander(_) should be <div> element')}m.select(div).classed('chart',true);A=A||m.select(div).append('svg').classed('heat',true).node();var x=m.scale.ordinal().rangeRoundBands([0,q],E);var y=m.scale.ordinal().rangeRoundBands([r,0],E);var h=m.scale.linear().range([G[0],G[1]]);x.domain(F.x);y.domain(F.y);h.domain([0,m.max(v,function(d){return d.h})]);var e=m.svg.axis().scale(x).orient('bottom').tickSize(O);var f=m.svg.axis().scale(y).orient('left').ticks(N).tickSize(P).tickFormat(C);z=m.select(div).select('.floatTag').node()?m.select(div).select('.floatTag'):l.floatTag(div);var g=m.select(A).attr({'width':width,'height':o}).selectAll('g').data([1]).enter().append('svg:g').attr('transform','translate('+t+','+u+')');g.call(function(a){a.append('svg:g').classed('dimensions',true);a.append('svg:g').classed('x-axis axis',true);a.append('svg:g').classed('y-axis axis',true);a.append('svg:g').classed('legends',true)});g=m.select(A).select('g');var i=g.selectAll('.dimensions').selectAll('.dimension').data(v.filter(function(d){return d._flag}));i.exit().transition().duration(B).style('opacity',0).remove();i.transition().duration(B).call(function(a){var b=x.rangeBand();var c=y.rangeBand();a.attr('x',function(d){return x(d.x)}).attr('y',function(d){return y(d.y)}).style('fill',function(d){return h(d.h)}).attr('width',b).attr('height',c)});i.enter().append('svg:rect').classed('dimension',true).on('mouseover',function(d){return drawLegend(d,true,h)}).on('mouseout',function(d){return drawLegend(d,false,h)}).call(function(a){var b=x.rangeBand();var c=y.rangeBand();a.attr('x',function(d){return x(d.x)}).attr('y',function(d){return y(d.y)}).style('fill',function(d){return h(d.h)}).transition().duration(B).attr('width',b).attr('height',c)});var j=g.select('.legends').attr('transform','translate('+X+','+Y+')').selectAll('.legend').data(h.ticks(6).slice(1).reverse());j.exit().transition().duration(B).style('opacity',0).remove();legendUpdate(j,h);legendDraw(j,h);axis(g,e,f)};function legendDraw(a,h){a.enter().append('svg:g').classed('legend',true).style('cursor','pointer').on('click',function(d,i){if(!m.select(this).classed('none')){m.select(this).classed('none',true).select('rect').transition().duration(B).style('fill-opacity',0);var s=h.ticks(6).slice(1).reverse();m.select(A).select('.dimensions').selectAll('.dimension').each(function(p){if((i===s.length-1&&p.h<=d)||(i===0&&p.h>s[1])||(p.h<=d&&p.h>s[i+1]))m.select(this).transition().duration(B).style('fill-opacity',.2)})}else{m.select(this).classed('none',false).select('rect').transition().duration(B).style('fill-opacity',1);var s=h.ticks(6).slice(1).reverse();m.select(A).select('.dimensions').selectAll('.dimension').each(function(p){if((i===s.length-1&&p.h<=d)||(i===0&&p.h>s[1])||(p.h<=d&&p.h>s[i+1]))m.select(this).transition().duration(B).style('fill-opacity',1)})}}).each(function(d,i){m.select(this).append('svg:rect').attr({'x':(i-i%Z)/Z*bx+q+20,'y':i%Z*20}).attr({'width':10,'height':10}).style('fill',h).style('stroke',h).style('fill-opacity',function(){return m.select(this).classed('none')?0:1}).style('opacity',0).transition().duration(B).style('opacity',1);m.select(this).append('svg:text').attr({'x':(i-i%Z)/Z*bx+q+40,'y':i%Z*20+9}).style({'opacity':0,'fill':V,'font-size':W,'font-family':w}).transition().duration(B).style('opacity',1).text(String)})}function legendUpdate(a,h){a.each(function(d,i){m.select(this).selectAll('rect').transition().duration(B/2).style('fill',h).style('stroke',h).style('fill-opacity',function(){return m.select(this).classed('none')?0:1}).attr({'x':(i-i%Z)/Z*bx+q+20,'y':i%Z*20});m.select(this).selectAll('text').transition().duration(B/2).attr({'x':(i-i%Z)/Z*bx+q+40,'y':i%Z*20+9}).style({'font-size':W,'fill':V,'font-family':w}).text(String)})}function axis(g,b,c){g.select('.x-axis').each(function(){m.select(this).select('.label').transition().duration(B).attr({'x':q,'y':-2}).style({'text-anchor':'end','font-family':w,'font-size':Q}).text(I);m.select(this).selectAll('.label').data([1]).enter().append('svg:text').classed('label',true).attr({'x':q,'y':-2}).style({'text-anchor':'end','font-family':w,'font-size':L,'fill':M}).text(I);m.select(this).transition().duration(B).attr('transform','translate(0,'+r+')').call(b)});g.select('.y-axis').each(function(){m.select(this).select('.label').style({'text-anchor':'end','font-family':w,'font-size':L,'fill':M}).text(H);m.select(this).selectAll('.label').data([1]).enter().append('svg:text').classed('label',true).style({'text-anchor':'end','font-family':w,'font-size':L,'fill':M}).attr({'transform':'rotate(-90)','y':8,'dy':'.71em'}).text(H);m.select(this).transition().duration(B).call(c)});g.selectAll('.axis').call(function(a){a.selectAll('path').style({'fill':'none','stroke':U,'stroke-width':T,'shape-rendering':'crispEdges'});a.selectAll('line').style({'fill':'none','stroke':S,'shape-rendering':'crispEdges'})});g.select('.x-axis').selectAll('.tick').select('text').style({'text-anchor':'middle','font-family':w,'font-size':Q,'fill':R}).attr('transform',function(){return'translate('+this.getComputedTextLength()*Math.abs(Math.sin(J)*.5)+','+(this.getComputedTextLength()*(.5*Math.abs(Math.sin(J)))+5)+')rotate('+J+')'});g.select('.y-axis').selectAll('.tick').select('text').style({'text-anchor':'start','font-family':w,'font-size':Q,'fill':R}).attr('transform',function(){return'translate('+ -this.getComputedTextLength()+', 0)rotate('+K+')'})}function drawLegend(d,a,h){if(a){z.style({'border-color':h(d.h),'opacity':1,'textAlign':'center','margin':'auto'}).html('x: '+d.x+'<br/>'+'y: '+d.y+'<br/>'+'value: '+d.h)}else{z.style('opacity',0)}}l.size=function(_){if(!arguments.length)return[width,o];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in heat.size(width, height) should be number and number of svg');return this}else{width=arguments[0];o=arguments[1];return this}};l.sizeAvail=function(_){if(!arguments.length)return[q,r];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in heat.sizeAvail(widthAvail, heightAvail) should be number and number of svg');return this}else{q=arguments[0];r=arguments[1];return this}};l.tran=function(_){if(!arguments.length)return[t,u];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in heat.tran(tranX, tranY) should be number and number of svg');return this}else{t=arguments[0];u=arguments[1];return this}};l.fontFamily=function(_){if(!arguments.length)return w;else{if(typeof arguments[0]!=='string'){console.error('The arguments in heat.fontFamily(fontFamily) should be string of text');return this}else{w=arguments[0];return this}}};l.duration=function(_){if(!arguments.length)return B;else{if(!isFinite(arguments[0])){console.error('The arguments in heat.duration(duration) should be number of transition');return this}else{B=Math.round(arguments[0]);return this}}};l.color=function(_){if(!arguments.length)return D;else{if(typeof arguments[0]!=='function'){console.error('The arguments in heat.color(color) should be function of pvisual.color');return this}else{D=arguments[0];return this}}};l.tickFormat=function(_){if(!arguments.length)return C;else{if(typeof arguments[0]!=='string'){console.error('The arguments in heat.tickFormat(format) should be string of d3.format');return this}else{C=m.format(arguments[0]);return this}}};l.padding=function(_){if(!arguments.length)return E;else{if(!isFinite(arguments[0])){console.error('The arguments in heat.padding(padding) should be number');return this}else{E=arguments[0];return this}}};l.xLegend=function(_){if(!arguments.length)return I;else{if(typeof arguments[0]!=='string'){console.error('The arguments in heat.xLegend(xLegend) should be string');return this}else{I=arguments[0];return this}}};l.yLegend=function(_){if(!arguments.length)return H;else{if(typeof arguments[0]!=='string'){console.error('The arguments in heat.yLegend(yLegend) should be string');return this}else{H=arguments[0];return this}}};l.xtickRotate=function(_){if(!arguments.length)return J;else{if(!isFinite(arguments[0])){console.error('The arguments in heat.xtickRotate(xtickRotate) should be number of tick');return this}else{J=Math.round(arguments[0]);return this}}};l.ytickRotate=function(_){if(!arguments.length)return K;else{if(!isFinite(arguments[0])){console.error('The arguments in heat.ytickRotate(ytickRotate) should be number of tick');return this}else{K=Math.round(arguments[0]);return this}}};l.labelSize=function(_){if(!arguments.length)return L;else{if(!isFinite(arguments[0])){console.error('The arguments in heat.labelSize(labelSize) should be string');return this}else{L=arguments[0];return this}}};l.labelColor=function(_){if(!arguments.length)return M;else{if(typeof arguments[0]!=='string'){console.error('The arguments in heat.labelColor(labelColor) should be string');return this}else{M=arguments[0];return this}}};l.ytickNumber=function(_){if(!arguments.length)return N;else{if(!isFinite(arguments[0])){console.error('The arguments in heat.ytickNumber(ytickNumber) should be number of tick');return this}else{N=Math.round(arguments[0]);return this}}};l.tickLineColor=function(_){if(!arguments.length)return S;else{if(typeof arguments[0]!=='string'){console.error('The arguments in heat.tickLineColor(tickLineColor) should be string');return this}else{S=arguments[0];return this}}};l.tickTextSize=function(_){if(!arguments.length)return Q;else{if(!isFinite(arguments[0])){console.error('The arguments in heat.tickTextSize(tickTextSize) should be number');return this}else{Q=arguments[0];return this}}};l.tickTextColor=function(_){if(!arguments.length)return R;else{if(typeof arguments[0]!=='string'){console.error('The arguments in heat.tickTextColor(tickTextColor) should be string');return this}else{R=arguments[0];return this}}};l.axisPathWidth=function(_){if(!arguments.length)return T;else{if(!isFinite(arguments[0])){console.error('The arguments in heat.axisPathWidth(axisPathWidth) should be string');return this}else{T=arguments[0];return this}}};l.axisPathColor=function(_){if(!arguments.length)return U;else{if(typeof arguments[0]!=='string'){console.error('The arguments in heat.axisPathColor(axisPathColor) should be string');return this}else{U=arguments[0];return this}}};l.legendTran=function(_){if(!arguments.length)return[X,Y];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in heat.legendTran(tranX, tranY) should be number and number of svg');return this}else{X=arguments[0];Y=arguments[1];return this}};l.legendSize=function(_){if(!arguments.length)return W;else{if(!isFinite(arguments[0])){console.error('The arguments in heat.legendSize(legendSize) should be number of text');return this}else{W=arguments[0];return this}}};l.legendColor=function(_){if(!arguments.length)return V;else{if(typeof arguments[0]!=='string'){console.error('The arguments in heat.legendColor(legendColor) should be string of text');return this}else{V=arguments[0];return this}}};l.legendColumnNo=function(_){if(!arguments.length)return Z;else{if(!isFinite(arguments[0])){console.error('The arguments in heat.legendColumnNo(legendColumnNo) should be number of text');return this}else{Z=arguments[0];return this}}};l.legendRowGap=function(_){if(!arguments.length)return bx;else{if(!isFinite(arguments[0])){console.error('The arguments in heat.legendRowGap(legendRowGap) should be number of text');return this}else{bx=arguments[0];return this}}};l.gradientColor=function(_){if(!arguments.length)return G;else if(arguments.length!==2||typeof arguments[0]!=='string'||typeof arguments[1]!=='string'){console.error('The argument(element) in map.gradientColor(start, end) should be string and string of color');return this}else{G[0]=arguments[0];G[1]=arguments[1];return this}};l.options=function(_){if(!arguments.length)return{'type':l.getType(),'width':width,'height':o,'widthAvail':q,'heightAvail':r,'tranX':t,'tranY':u,'format':C,'fontFamily':w,'color':D,'duration':B,'padding':E,'gradientColor':G,'xLegend':I,'yLegend':H,'xtickRotate':J,'ytickRotate':K,'labelSize':L,'labelColor':M,'ytickNumber':N,'tickTextSize':Q,'tickTextColor':R,'tickLineColor':S,'xtickLineLength':O,'ytickLineLength':P,'axisPathWidth':T,'axisPathColor':U,'legendColor':V,'legendSize':W,'legendTranX':X,'legendTranY':Y,'legendColumnNo':Z,'legendRowGap':bx};else if(typeof _!=='object'){console.error('The arguments in map.options(options) should be object');return this}else{width=isFinite(_.width)?_.width:width;o=isFinite(_.height)?_.height:o;q=isFinite(_.widthAvail)?_.widthAvail:q;r=isFinite(_.heightAvail)?_.heightAvail:r;t=isFinite(_.tranX)?_.tranX:t;u=isFinite(_.tranY)?_.tranY:u;_.format&&l.tickFormat(_.format);_.fontFamily&&l.fontFamily(_.fontFamily);isFinite(_.duration)&&l.duration(_.duration);typeof _.gradientColor==='object'&&_.gradientColor.constructor===Array&&_.gradientColor.length===2&&l.gradientColor(_.gradientColor[0],_.gradientColor[1]);_.xLegend&&l.xLegend(_.xLegend);_.yLegend&&l.yLegend(_.yLegend);isFinite(_.xtickRotate)&&l.xtickRotate(_.xtickRotate);isFinite(_.ytickRotate)&&l.ytickRotate(_.ytickRotate);isFinite(_.labelSize)&&l.labelSize(_.labelSize);_.labelColor&&l.labelColor(_.labelColor);isFinite(_.padding)&&l.padding(_.padding);isFinite(_.ytickNumber)&&l.ytickNumber(_.ytickNumber);isFinite(_.tickTextSize)&&l.tickTextSize(_.tickTextSize);_.tickTextColor&&l.tickTextColor(_.tickTextColor);_.tickLineColor&&l.tickLineColor(_.tickLineColor);isFinite(_.xtickLineLength)&&l.xtickLineLength(_.xtickLineLength);isFinite(_.ytickLineLength)&&l.ytickLineLength(_.ytickLineLength);isFinite(_.axisPathWidth)&&l.axisPathWidth(_.axisPathWidth);_.axisPathColor&&l.axisPathColor(_.axisPathColor);_.legendColor&&l.legendColor(_.legendColor);isFinite(_.legendSize)&&l.legendSize(_.legendSize);X=isFinite(_.legendTranX)?_.legendTranX:X;Y=isFinite(_.legendTranY)?_.legendTranY:Y;isFinite(_.legendColumnNo)&&l.legendColumnNo(_.legendColumnNo);isFinite(_.legendRowGap)&&l.legendRowGap(_.legendRowGap);return this}};if(arguments.length===1)l.options(arguments[0]);return l};bw.model.map=function(){var f=bw.extend();var j=_.d3;var l='Map';var m=1000;var n=600;var o=n;var q=0;var r;var t=3;var u='Arial';var v='#000';var w;var x;var y;var z=500;var A=f.color();var B=550;var C=[0,100];var D=['white','green'];var E=j.map([]);var F=function(d,i){return'orange'};var G=function(d,i){return'#DDDDDD'};var H=function(d,i){return'#FFFFFF'};var I={'type':'FeatureCollection','features':[{'type':'Feature','id':'65','properties':{'name':'新疆','cp':[84.9023,41.748],'childNum':18},'geometry':{'type':'Polygon','coordinates':[[[96.416,42.7588],[96.416,42.7148],[95.9766,42.4951],[96.0645,42.3193],[96.2402,42.2314],[95.9766,41.9238],[95.2734,41.6162],[95.1855,41.792],[94.5703,41.4844],[94.043,41.0889],[93.8672,40.6934],[93.0762,40.6494],[92.6367,39.6387],[92.373,39.3311],[92.373,39.1113],[92.373,39.0234],[90.1758,38.4961],[90.3516,38.2324],[90.6152,38.3203],[90.5273,37.8369],[91.0547,37.4414],[91.3184,37.0898],[90.7031,36.7822],[90.791,36.6064],[91.0547,36.5186],[91.0547,36.0791],[90.8789,36.0352],[90,36.2549],[89.9121,36.0791],[89.7363,36.0791],[89.209,36.2988],[88.7695,36.3428],[88.5938,36.4746],[87.3633,36.4307],[86.2207,36.167],[86.1328,35.8594],[85.6055,35.6836],[85.0781,35.7275],[84.1992,35.376],[83.1445,35.4199],[82.8809,35.6836],[82.4414,35.7275],[82.002,35.332],[81.6504,35.2441],[80.4199,35.4199],[80.2441,35.2881],[80.332,35.1563],[80.2441,35.2002],[79.8926,34.8047],[79.8047,34.4971],[79.1016,34.4531],[79.0137,34.3213],[78.2227,34.7168],[78.0469,35.2441],[78.0469,35.5078],[77.4316,35.4639],[76.8164,35.6396],[76.5527,35.8594],[76.2012,35.8154],[75.9375,36.0352],[76.0254,36.4746],[75.8496,36.6943],[75.498,36.7383],[75.4102,36.958],[75.0586,37.002],[74.8828,36.9141],[74.7949,37.0459],[74.5313,37.0898],[74.5313,37.2217],[74.8828,37.2217],[75.1465,37.4414],[74.8828,37.5732],[74.9707,37.749],[74.8828,38.4521],[74.3555,38.6719],[74.1797,38.6719],[74.0918,38.54],[73.8281,38.584],[73.7402,38.8477],[73.8281,38.9795],[73.4766,39.375],[73.916,39.5068],[73.916,39.6826],[73.8281,39.7705],[74.0039,40.0342],[74.8828,40.3418],[74.7949,40.5176],[75.2344,40.4297],[75.5859,40.6494],[75.7617,40.2979],[76.377,40.3857],[76.9043,41.001],[77.6074,41.001],[78.1348,41.2207],[78.1348,41.3965],[80.1563,42.0557],[80.2441,42.2754],[80.1563,42.627],[80.2441,42.8467],[80.5078,42.8906],[80.4199,43.0664],[80.7715,43.1982],[80.4199,44.165],[80.4199,44.6045],[79.9805,44.8242],[79.9805,44.9561],[81.7383,45.3955],[82.0898,45.2197],[82.5293,45.2197],[82.2656,45.6592],[83.0566,47.2412],[83.6719,47.0215],[84.7266,47.0215],[84.9023,46.8896],[85.5176,47.0654],[85.6934,47.2852],[85.5176,48.1201],[85.7813,48.4277],[86.5723,48.5596],[86.8359,48.8232],[86.748,48.9551],[86.8359,49.1309],[87.8027,49.1748],[87.8906,48.999],[87.7148,48.9111],[88.0664,48.7354],[87.9785,48.6035],[88.5059,48.3838],[88.6816,48.1641],[89.1211,47.9883],[89.5605,48.0322],[89.7363,47.8564],[90.0879,47.8564],[90.3516,47.6807],[90.5273,47.2412],[90.8789,46.9775],[91.0547,46.582],[90.8789,46.3184],[91.0547,46.0107],[90.7031,45.7471],[90.7031,45.5273],[90.8789,45.2197],[91.582,45.0879],[93.5156,44.9561],[94.7461,44.3408],[95.3613,44.2969],[95.3613,44.0332],[95.5371,43.9014],[95.8887,43.2422],[96.3281,42.9346],[96.416,42.7588]]]}},{'type':'Feature','id':'54','properties':{'name':'西藏','cp':[88.7695,31.6846],'childNum':7},'geometry':{'type':'Polygon','coordinates':[[[79.0137,34.3213],[79.1016,34.4531],[79.8047,34.4971],[79.8926,34.8047],[80.2441,35.2002],[80.332,35.1563],[80.2441,35.2881],[80.4199,35.4199],[81.6504,35.2441],[82.002,35.332],[82.4414,35.7275],[82.8809,35.6836],[83.1445,35.4199],[84.1992,35.376],[85.0781,35.7275],[85.6055,35.6836],[86.1328,35.8594],[86.2207,36.167],[87.3633,36.4307],[88.5938,36.4746],[88.7695,36.3428],[89.209,36.2988],[89.7363,36.0791],[89.3848,36.0352],[89.4727,35.9033],[89.7363,35.7715],[89.7363,35.4199],[89.4727,35.376],[89.4727,35.2441],[89.5605,34.8926],[89.8242,34.8486],[89.7363,34.6729],[89.8242,34.3652],[89.6484,34.0137],[90.0879,33.4863],[90.7031,33.1348],[91.4063,33.1348],[91.9336,32.8271],[92.1973,32.8271],[92.2852,32.7393],[92.9883,32.7393],[93.5156,32.4756],[93.7793,32.5635],[94.1309,32.4316],[94.6582,32.6074],[95.1855,32.4316],[95.0098,32.2998],[95.1855,32.3438],[95.2734,32.2119],[95.3613,32.168],[95.3613,31.9922],[95.4492,31.8164],[95.8008,31.6846],[95.9766,31.8164],[96.1523,31.5967],[96.2402,31.9482],[96.5039,31.7285],[96.8555,31.6846],[96.7676,31.9922],[97.2949,32.0801],[97.3828,32.5635],[97.7344,32.5195],[98.1738,32.3438],[98.4375,31.8604],[98.877,31.4209],[98.6133,31.2012],[98.9648,30.7617],[99.1406,29.2676],[98.9648,29.1357],[98.9648,28.8281],[98.7891,28.8721],[98.7891,29.0039],[98.7012,28.916],[98.6133,28.5205],[98.7891,28.3447],[98.7012,28.2129],[98.3496,28.125],[98.2617,28.3887],[98.1738,28.125],[97.5586,28.5205],[97.2949,28.0811],[97.3828,27.9053],[97.0313,27.7295],[96.5039,28.125],[95.7129,28.2568],[95.3613,28.125],[95.2734,27.9492],[94.2188,27.5537],[93.8672,27.0264],[93.6035,26.9385],[92.1094,26.8506],[92.0215,27.4658],[91.582,27.5537],[91.582,27.9053],[91.4063,28.0371],[91.0547,27.8613],[90.7031,28.0811],[89.8242,28.2129],[89.6484,28.1689],[89.1211,27.5977],[89.1211,27.334],[89.0332,27.2021],[88.7695,27.4219],[88.8574,27.9932],[88.6816,28.125],[88.1543,27.9053],[87.8906,27.9492],[87.7148,27.8174],[87.0996,27.8174],[86.748,28.125],[86.5723,28.125],[86.4844,27.9053],[86.1328,28.125],[86.0449,27.9053],[85.6934,28.3447],[85.6055,28.2568],[85.166,28.3447],[85.166,28.6523],[84.9023,28.5645],[84.4629,28.7402],[84.2871,28.8721],[84.1992,29.2236],[84.1113,29.2676],[83.584,29.1797],[83.2324,29.5752],[82.1777,30.0586],[82.0898,30.3223],[81.3867,30.3662],[81.2109,30.0146],[81.0352,30.2344],[80.0684,30.5859],[79.7168,30.9375],[79.0137,31.0693],[78.75,31.333],[78.8379,31.5967],[78.6621,31.8164],[78.75,31.9043],[78.4863,32.124],[78.3984,32.5195],[78.75,32.6953],[78.9258,32.3438],[79.2773,32.5635],[79.1016,33.1787],[78.6621,33.6621],[78.6621,34.1016],[78.9258,34.1455],[79.0137,34.3213]]]}},{'type':'Feature','id':'15','properties':{'name':'内蒙古','cp':[117.5977,44.3408],'childNum':12},'geometry':{'type':'Polygon','coordinates':[[[97.207,42.8027],[99.4922,42.583],[100.8105,42.6709],[101.7773,42.4951],[102.041,42.2314],[102.7441,42.1436],[103.3594,41.8799],[103.8867,41.792],[104.502,41.8799],[104.502,41.6602],[105.0293,41.5723],[105.7324,41.9238],[107.4023,42.4512],[109.4238,42.4512],[110.3906,42.7588],[111.0059,43.3301],[111.9727,43.6816],[111.9727,43.8135],[111.4453,44.3848],[111.7969,45],[111.9727,45.0879],[113.6426,44.7363],[114.1699,44.9561],[114.5215,45.3955],[115.6641,45.4395],[116.1914,45.7031],[116.2793,45.9668],[116.543,46.2744],[117.334,46.3623],[117.4219,46.582],[117.7734,46.5381],[118.3008,46.7578],[118.7402,46.7139],[118.916,46.7578],[119.0918,46.6699],[119.707,46.626],[119.9707,46.7139],[119.707,47.1973],[118.4766,47.9883],[117.8613,48.0322],[117.334,47.6807],[116.8066,47.9004],[116.1914,47.8564],[115.9277,47.6807],[115.5762,47.9004],[115.4883,48.1641],[115.8398,48.252],[115.8398,48.5596],[116.7188,49.834],[117.7734,49.5264],[118.5645,49.9219],[119.2676,50.0977],[119.3555,50.3174],[119.1797,50.3613],[119.5313,50.7568],[119.5313,50.8887],[119.707,51.0645],[120.1465,51.6797],[120.6738,51.9434],[120.7617,52.1191],[120.7617,52.251],[120.5859,52.3389],[120.6738,52.5146],[120.4102,52.6465],[120.0586,52.6025],[120.0586,52.7344],[120.8496,53.2617],[121.4648,53.3496],[121.8164,53.042],[121.2012,52.5586],[121.6406,52.4268],[121.7285,52.2949],[121.9922,52.2949],[122.168,52.5146],[122.6953,52.251],[122.6074,52.0752],[122.959,51.3281],[123.3105,51.2402],[123.6621,51.3721],[124.3652,51.2842],[124.541,51.3721],[124.8926,51.3721],[125.0684,51.6357],[125.332,51.6357],[126.0352,51.0205],[125.7715,50.7568],[125.7715,50.5371],[125.332,50.1416],[125.1563,49.834],[125.2441,49.1748],[124.8047,49.1309],[124.4531,48.1201],[124.2773,48.5156],[122.4316,47.373],[123.0469,46.7139],[123.3984,46.8896],[123.3984,46.9775],[123.4863,46.9775],[123.5742,46.8457],[123.5742,46.8896],[123.5742,46.6699],[123.0469,46.582],[123.2227,46.2305],[122.7832,46.0107],[122.6953,45.7031],[122.4316,45.8789],[122.2559,45.791],[121.8164,46.0107],[121.7285,45.7471],[121.9043,45.7031],[122.2559,45.2637],[122.0801,44.8682],[122.3438,44.2529],[123.1348,44.4727],[123.4863,43.7256],[123.3105,43.5059],[123.6621,43.374],[123.5742,43.0225],[123.3105,42.9785],[123.1348,42.8027],[122.7832,42.7148],[122.3438,42.8467],[122.3438,42.6709],[121.9922,42.7148],[121.7285,42.4512],[121.4648,42.4951],[120.498,42.0996],[120.1465,41.7041],[119.8828,42.1875],[119.5313,42.3633],[119.3555,42.2754],[119.2676,41.7041],[119.4434,41.6162],[119.2676,41.3086],[118.3887,41.3086],[118.125,41.748],[118.3008,41.792],[118.3008,42.0996],[118.125,42.0557],[117.9492,42.2314],[118.0371,42.4072],[117.7734,42.627],[117.5098,42.583],[117.334,42.4512],[116.8945,42.4072],[116.8066,42.0117],[116.2793,42.0117],[116.0156,41.792],[115.9277,41.9238],[115.2246,41.5723],[114.9609,41.6162],[114.873,42.0996],[114.5215,42.1436],[114.1699,41.792],[114.2578,41.5723],[113.9063,41.4404],[113.9941,41.2207],[113.9063,41.1328],[114.082,40.7373],[114.082,40.5176],[113.8184,40.5176],[113.5547,40.3418],[113.2031,40.3857],[112.7637,40.166],[112.3242,40.2539],[111.9727,39.5947],[111.4453,39.6387],[111.3574,39.4189],[111.0938,39.375],[111.0938,39.5947],[110.6543,39.2871],[110.127,39.4629],[110.2148,39.2871],[109.8633,39.2432],[109.9512,39.1553],[108.9844,38.3203],[109.0723,38.0127],[108.8965,37.9688],[108.8086,38.0127],[108.7207,37.7051],[108.1934,37.6172],[107.666,37.8809],[107.3145,38.1006],[106.7871,38.1885],[106.5234,38.3203],[106.9629,38.9795],[106.7871,39.375],[106.3477,39.2871],[105.9082,38.7158],[105.8203,37.793],[104.3262,37.4414],[103.4473,37.8369],[103.3594,38.0127],[103.5352,38.1445],[103.4473,38.3643],[104.2383,38.9795],[104.0625,39.4189],[103.3594,39.3311],[103.0078,39.1113],[102.4805,39.2432],[101.8652,39.1113],[102.041,38.8916],[101.7773,38.6719],[101.3379,38.7598],[101.25,39.0234],[100.9863,38.9355],[100.8105,39.4189],[100.5469,39.4189],[100.0195,39.7705],[99.4922,39.8584],[100.1074,40.2539],[100.1953,40.6494],[99.9316,41.001],[99.2285,40.8691],[99.0527,40.6934],[98.9648,40.7813],[98.7891,40.6055],[98.5254,40.7373],[98.6133,40.6494],[98.3496,40.5615],[98.3496,40.9131],[97.4707,41.4844],[97.8223,41.6162],[97.8223,41.748],[97.207,42.8027]]]}},{'type':'Feature','id':'63','properties':{'name':'青海','cp':[96.2402,35.4199],'childNum':8},'geometry':{'type':'Polygon','coordinates':[[[89.7363,36.0791],[89.9121,36.0791],[90,36.2549],[90.8789,36.0352],[91.0547,36.0791],[91.0547,36.5186],[90.791,36.6064],[90.7031,36.7822],[91.3184,37.0898],[91.0547,37.4414],[90.5273,37.8369],[90.6152,38.3203],[90.3516,38.2324],[90.1758,38.4961],[92.373,39.0234],[92.373,39.1113],[93.1641,39.1992],[93.1641,38.9795],[93.6914,38.9355],[93.8672,38.7158],[94.3066,38.7598],[94.5703,38.3643],[95.0098,38.4082],[95.4492,38.2764],[95.7129,38.3643],[96.2402,38.1006],[96.416,38.2324],[96.6797,38.1885],[96.6797,38.4521],[97.1191,38.584],[97.0313,39.1992],[98.1738,38.8037],[98.3496,39.0234],[98.6133,38.9355],[98.7891,39.0674],[99.1406,38.9355],[99.8438,38.3643],[100.1953,38.2764],[100.0195,38.4521],[100.1074,38.4961],[100.459,38.2764],[100.7227,38.2324],[101.1621,37.8369],[101.5137,37.8809],[101.7773,37.6172],[101.9531,37.7051],[102.1289,37.4414],[102.5684,37.1777],[102.4805,36.958],[102.6563,36.8262],[102.5684,36.7383],[102.832,36.3428],[103.0078,36.2549],[102.9199,36.0791],[102.9199,35.9033],[102.6563,35.7715],[102.832,35.5957],[102.4805,35.5957],[102.3047,35.4199],[102.3926,35.2002],[101.9531,34.8486],[101.9531,34.6289],[102.2168,34.4092],[102.1289,34.2773],[101.6895,34.1016],[100.9863,34.3652],[100.8105,34.2773],[101.25,33.6621],[101.5137,33.7061],[101.6016,33.5303],[101.7773,33.5303],[101.6895,33.3105],[101.7773,33.2227],[101.6016,33.1348],[101.1621,33.2227],[101.25,32.6953],[100.7227,32.6514],[100.7227,32.5195],[100.3711,32.7393],[100.1074,32.6514],[100.1074,32.8711],[99.8438,33.0029],[99.7559,32.7393],[99.2285,32.915],[99.2285,33.0469],[98.877,33.1787],[98.4375,34.0576],[97.8223,34.1895],[97.6465,34.1016],[97.7344,33.9258],[97.3828,33.8818],[97.4707,33.5742],[97.7344,33.3984],[97.3828,32.8711],[97.4707,32.6953],[97.7344,32.5195],[97.3828,32.5635],[97.2949,32.0801],[96.7676,31.9922],[96.8555,31.6846],[96.5039,31.7285],[96.2402,31.9482],[96.1523,31.5967],[95.9766,31.8164],[95.8008,31.6846],[95.4492,31.8164],[95.3613,31.9922],[95.3613,32.168],[95.2734,32.2119],[95.1855,32.3438],[95.0098,32.2998],[95.1855,32.4316],[94.6582,32.6074],[94.1309,32.4316],[93.7793,32.5635],[93.5156,32.4756],[92.9883,32.7393],[92.2852,32.7393],[92.1973,32.8271],[91.9336,32.8271],[91.4063,33.1348],[90.7031,33.1348],[90.0879,33.4863],[89.6484,34.0137],[89.8242,34.3652],[89.7363,34.6729],[89.8242,34.8486],[89.5605,34.8926],[89.4727,35.2441],[89.4727,35.376],[89.7363,35.4199],[89.7363,35.7715],[89.4727,35.9033],[89.3848,36.0352],[89.7363,36.0791]]]}},{'type':'Feature','id':'51','properties':{'name':'四川','cp':[102.9199,30.1904],'childNum':21},'geometry':{'type':'Polygon','coordinates':[[[101.7773,33.5303],[101.8652,33.5742],[101.9531,33.4424],[101.8652,33.0908],[102.4805,33.4424],[102.2168,33.9258],[102.9199,34.3213],[103.0957,34.1895],[103.1836,33.7939],[104.1504,33.6182],[104.2383,33.3984],[104.4141,33.3105],[104.3262,33.2227],[104.4141,33.0469],[104.3262,32.8711],[104.4141,32.7393],[105.2051,32.6074],[105.3809,32.7393],[105.3809,32.8711],[105.4688,32.915],[105.5566,32.7393],[106.084,32.8711],[106.084,32.7393],[106.3477,32.6514],[107.0508,32.6953],[107.1387,32.4756],[107.2266,32.4316],[107.4023,32.5195],[108.0176,32.168],[108.2813,32.2559],[108.5449,32.2119],[108.3691,32.168],[108.2813,31.9043],[108.5449,31.6846],[108.1934,31.5088],[107.9297,30.8496],[107.4902,30.8496],[107.4023,30.7617],[107.4902,30.6299],[107.0508,30.0146],[106.7871,30.0146],[106.6113,30.3223],[106.2598,30.1904],[105.8203,30.4541],[105.6445,30.2783],[105.5566,30.1025],[105.7324,29.8828],[105.293,29.5313],[105.4688,29.3115],[105.7324,29.2676],[105.8203,28.96],[106.2598,28.8721],[106.3477,28.5205],[105.9961,28.7402],[105.6445,28.4326],[105.9082,28.125],[106.1719,28.125],[106.3477,27.8174],[105.6445,27.6416],[105.5566,27.7734],[105.293,27.7295],[105.2051,27.9932],[105.0293,28.0811],[104.8535,27.9053],[104.4141,27.9492],[104.3262,28.0371],[104.4141,28.125],[104.4141,28.2568],[104.2383,28.4326],[104.4141,28.6084],[103.8867,28.6523],[103.7988,28.3008],[103.4473,28.125],[103.4473,27.7734],[102.9199,27.29],[103.0078,26.3672],[102.6563,26.1914],[102.5684,26.3672],[102.1289,26.1035],[101.8652,26.0596],[101.6016,26.2354],[101.6895,26.3672],[101.4258,26.5869],[101.4258,26.8066],[101.4258,26.7188],[101.1621,27.0264],[101.1621,27.1582],[100.7227,27.8613],[100.3711,27.8174],[100.2832,27.7295],[100.0195,28.125],[100.1953,28.3447],[99.668,28.8281],[99.4043,28.5205],[99.4043,28.1689],[99.2285,28.3008],[99.1406,29.2676],[98.9648,30.7617],[98.6133,31.2012],[98.877,31.4209],[98.4375,31.8604],[98.1738,32.3438],[97.7344,32.5195],[97.4707,32.6953],[97.3828,32.8711],[97.7344,33.3984],[97.4707,33.5742],[97.3828,33.8818],[97.7344,33.9258],[97.6465,34.1016],[97.8223,34.1895],[98.4375,34.0576],[98.877,33.1787],[99.2285,33.0469],[99.2285,32.915],[99.7559,32.7393],[99.8438,33.0029],[100.1074,32.8711],[100.1074,32.6514],[100.3711,32.7393],[100.7227,32.5195],[100.7227,32.6514],[101.25,32.6953],[101.1621,33.2227],[101.6016,33.1348],[101.7773,33.2227],[101.6895,33.3105],[101.7773,33.5303]]]}},{'type':'Feature','id':'23','properties':{'name':'黑龙江','cp':[128.1445,48.5156],'childNum':13},'geometry':{'type':'Polygon','coordinates':[[[121.4648,53.3496],[123.6621,53.5693],[124.8926,53.0859],[125.0684,53.2178],[125.5957,53.0859],[125.6836,52.9102],[126.123,52.7783],[126.0352,52.6025],[126.2109,52.5146],[126.3867,52.2949],[126.3867,52.207],[126.5625,52.1631],[126.4746,51.9434],[126.9141,51.3721],[126.8262,51.2842],[127.002,51.3281],[126.9141,51.1084],[127.2656,50.7568],[127.3535,50.2734],[127.6172,50.2295],[127.5293,49.8779],[127.793,49.6143],[128.7598,49.5703],[129.1113,49.3506],[129.4629,49.4385],[130.2539,48.8672],[130.6934,48.8672],[130.5176,48.6475],[130.8691,48.2959],[130.6934,48.1201],[131.0449,47.6807],[132.5391,47.7246],[132.627,47.9443],[133.0664,48.1201],[133.5059,48.1201],[134.209,48.3838],[135.0879,48.4277],[134.7363,48.252],[134.5605,47.9883],[134.7363,47.6807],[134.5605,47.4609],[134.3848,47.4609],[134.209,47.2852],[134.209,47.1533],[133.8574,46.5381],[133.9453,46.2744],[133.5059,45.835],[133.418,45.5713],[133.2422,45.5273],[133.0664,45.1318],[132.8906,45.0439],[131.9238,45.3516],[131.5723,45.0439],[131.0449,44.8682],[131.3086,44.0771],[131.2207,43.7256],[131.3086,43.4619],[130.8691,43.418],[130.5176,43.6377],[130.3418,43.9893],[129.9902,43.8574],[129.9023,44.0332],[129.8145,43.9014],[129.2871,43.8135],[129.1992,43.5938],[128.8477,43.5498],[128.4961,44.165],[128.4082,44.4727],[128.0566,44.3408],[128.0566,44.1211],[127.7051,44.1211],[127.5293,44.6045],[127.0898,44.6045],[127.002,44.7803],[127.0898,45],[126.9141,45.1318],[126.5625,45.2637],[126.0352,45.1758],[125.7715,45.3076],[125.6836,45.5273],[125.0684,45.3955],[124.8926,45.5273],[124.3652,45.4395],[124.0137,45.7471],[123.9258,46.2305],[123.2227,46.2305],[123.0469,46.582],[123.5742,46.6699],[123.5742,46.8896],[123.5742,46.8457],[123.4863,46.9775],[123.3984,46.9775],[123.3984,46.8896],[123.0469,46.7139],[122.4316,47.373],[124.2773,48.5156],[124.4531,48.1201],[124.8047,49.1309],[125.2441,49.1748],[125.1563,49.834],[125.332,50.1416],[125.7715,50.5371],[125.7715,50.7568],[126.0352,51.0205],[125.332,51.6357],[125.0684,51.6357],[124.8926,51.3721],[124.541,51.3721],[124.3652,51.2842],[123.6621,51.3721],[123.3105,51.2402],[122.959,51.3281],[122.6074,52.0752],[122.6953,52.251],[122.168,52.5146],[121.9922,52.2949],[121.7285,52.2949],[121.6406,52.4268],[121.2012,52.5586],[121.8164,53.042],[121.4648,53.3496]]]}},{'type':'Feature','id':'62','properties':{'name':'甘肃','cp':[95.7129,40.166],'childNum':14},'geometry':{'type':'Polygon','coordinates':[[[96.416,42.7148],[97.207,42.8027],[97.8223,41.748],[97.8223,41.6162],[97.4707,41.4844],[98.3496,40.9131],[98.3496,40.5615],[98.6133,40.6494],[98.5254,40.7373],[98.7891,40.6055],[98.9648,40.7813],[99.0527,40.6934],[99.2285,40.8691],[99.9316,41.001],[100.1953,40.6494],[100.1074,40.2539],[99.4922,39.8584],[100.0195,39.7705],[100.5469,39.4189],[100.8105,39.4189],[100.9863,38.9355],[101.25,39.0234],[101.3379,38.7598],[101.7773,38.6719],[102.041,38.8916],[101.8652,39.1113],[102.4805,39.2432],[103.0078,39.1113],[103.3594,39.3311],[104.0625,39.4189],[104.2383,38.9795],[103.4473,38.3643],[103.5352,38.1445],[103.3594,38.0127],[103.4473,37.8369],[104.3262,37.4414],[104.5898,37.4414],[104.5898,37.2217],[104.8535,37.2217],[105.293,36.8262],[105.2051,36.6943],[105.4688,36.123],[105.293,35.9912],[105.3809,35.7715],[105.7324,35.7275],[105.8203,35.5518],[105.9961,35.4639],[105.9082,35.4199],[105.9961,35.4199],[106.084,35.376],[106.2598,35.4199],[106.3477,35.2441],[106.5234,35.332],[106.4355,35.6836],[106.6992,35.6836],[106.9629,35.8154],[106.875,36.123],[106.5234,36.2549],[106.5234,36.4746],[106.4355,36.5625],[106.6113,36.7822],[106.6113,37.0898],[107.3145,37.0898],[107.3145,36.9141],[108.7207,36.3428],[108.6328,35.9912],[108.5449,35.8594],[108.6328,35.5518],[108.5449,35.2881],[107.7539,35.2881],[107.7539,35.1123],[107.8418,35.0244],[107.666,34.9365],[107.2266,34.8926],[106.9629,35.0684],[106.6113,35.0684],[106.5234,34.7607],[106.3477,34.585],[106.6992,34.3213],[106.5234,34.2773],[106.6113,34.1455],[106.4355,33.9258],[106.5234,33.5303],[105.9961,33.6182],[105.7324,33.3984],[105.9961,33.1787],[105.9082,33.0029],[105.4688,32.915],[105.3809,32.8711],[105.3809,32.7393],[105.2051,32.6074],[104.4141,32.7393],[104.3262,32.8711],[104.4141,33.0469],[104.3262,33.2227],[104.4141,33.3105],[104.2383,33.3984],[104.1504,33.6182],[103.1836,33.7939],[103.0957,34.1895],[102.9199,34.3213],[102.2168,33.9258],[102.4805,33.4424],[101.8652,33.0908],[101.9531,33.4424],[101.8652,33.5742],[101.7773,33.5303],[101.6016,33.5303],[101.5137,33.7061],[101.25,33.6621],[100.8105,34.2773],[100.9863,34.3652],[101.6895,34.1016],[102.1289,34.2773],[102.2168,34.4092],[101.9531,34.6289],[101.9531,34.8486],[102.3926,35.2002],[102.3047,35.4199],[102.4805,35.5957],[102.832,35.5957],[102.6563,35.7715],[102.9199,35.9033],[102.9199,36.0791],[103.0078,36.2549],[102.832,36.3428],[102.5684,36.7383],[102.6563,36.8262],[102.4805,36.958],[102.5684,37.1777],[102.1289,37.4414],[101.9531,37.7051],[101.7773,37.6172],[101.5137,37.8809],[101.1621,37.8369],[100.7227,38.2324],[100.459,38.2764],[100.1074,38.4961],[100.0195,38.4521],[100.1953,38.2764],[99.8438,38.3643],[99.1406,38.9355],[98.7891,39.0674],[98.6133,38.9355],[98.3496,39.0234],[98.1738,38.8037],[97.0313,39.1992],[97.1191,38.584],[96.6797,38.4521],[96.6797,38.1885],[96.416,38.2324],[96.2402,38.1006],[95.7129,38.3643],[95.4492,38.2764],[95.0098,38.4082],[94.5703,38.3643],[94.3066,38.7598],[93.8672,38.7158],[93.6914,38.9355],[93.1641,38.9795],[93.1641,39.1992],[92.373,39.1113],[92.373,39.3311],[92.6367,39.6387],[93.0762,40.6494],[93.8672,40.6934],[94.043,41.0889],[94.5703,41.4844],[95.1855,41.792],[95.2734,41.6162],[95.9766,41.9238],[96.2402,42.2314],[96.0645,42.3193],[95.9766,42.4951],[96.416,42.7148]]]}},{'type':'Feature','id':'53','properties':{'name':'云南','cp':[101.8652,25.1807],'childNum':16},'geometry':{'type':'Polygon','coordinates':[[[98.1738,28.125],[98.2617,28.3887],[98.3496,28.125],[98.7012,28.2129],[98.7891,28.3447],[98.6133,28.5205],[98.7012,28.916],[98.7891,29.0039],[98.7891,28.8721],[98.9648,28.8281],[98.9648,29.1357],[99.1406,29.2676],[99.2285,28.3008],[99.4043,28.1689],[99.4043,28.5205],[99.668,28.8281],[100.1953,28.3447],[100.0195,28.125],[100.2832,27.7295],[100.3711,27.8174],[100.7227,27.8613],[101.1621,27.1582],[101.1621,27.0264],[101.4258,26.7188],[101.4258,26.8066],[101.4258,26.5869],[101.6895,26.3672],[101.6016,26.2354],[101.8652,26.0596],[102.1289,26.1035],[102.5684,26.3672],[102.6563,26.1914],[103.0078,26.3672],[102.9199,27.29],[103.4473,27.7734],[103.4473,28.125],[103.7988,28.3008],[103.8867,28.6523],[104.4141,28.6084],[104.2383,28.4326],[104.4141,28.2568],[104.4141,28.125],[104.3262,28.0371],[104.4141,27.9492],[104.8535,27.9053],[105.0293,28.0811],[105.2051,27.9932],[105.293,27.7295],[105.2051,27.3779],[104.5898,27.334],[104.4141,27.4658],[104.1504,27.2461],[103.8867,27.4219],[103.623,27.0264],[103.7109,26.9824],[103.7109,26.7627],[103.8867,26.543],[104.4141,26.6748],[104.6777,26.4111],[104.3262,25.708],[104.8535,25.2246],[104.5898,25.0488],[104.6777,24.9609],[104.502,24.7412],[104.6777,24.3457],[104.7656,24.4775],[105.0293,24.4336],[105.2051,24.082],[105.4688,24.0381],[105.5566,24.126],[105.9961,24.126],[106.1719,23.8184],[106.1719,23.5547],[105.6445,23.4229],[105.5566,23.2031],[105.293,23.3789],[104.8535,23.1592],[104.7656,22.8516],[104.3262,22.6758],[104.1504,22.8076],[103.9746,22.5439],[103.623,22.7637],[103.5352,22.5879],[103.3594,22.8076],[103.0957,22.4561],[102.4805,22.7637],[102.3047,22.4121],[101.8652,22.3682],[101.7773,22.5],[101.6016,22.1924],[101.8652,21.6211],[101.7773,21.1377],[101.6016,21.2256],[101.25,21.1816],[101.1621,21.7529],[100.6348,21.4453],[100.1074,21.4893],[99.9316,22.0605],[99.2285,22.1484],[99.4043,22.5879],[99.3164,22.7197],[99.4922,23.0713],[98.877,23.2031],[98.7012,23.9502],[98.877,24.126],[98.1738,24.082],[97.7344,23.8623],[97.5586,23.9063],[97.7344,24.126],[97.6465,24.4336],[97.5586,24.4336],[97.5586,24.7412],[97.7344,24.8291],[97.8223,25.2686],[98.1738,25.4004],[98.1738,25.6201],[98.3496,25.5762],[98.5254,25.8398],[98.7012,25.8838],[98.6133,26.0596],[98.7012,26.1475],[98.7891,26.5869],[98.7012,27.5098],[98.5254,27.6416],[98.3496,27.5098],[98.1738,28.125]]]}},{'type':'Feature','id':'45','properties':{'name':'广西','cp':[108.2813,23.6426],'childNum':14},'geometry':{'type':'Polygon','coordinates':[[[104.502,24.7412],[104.6777,24.6094],[105.2051,24.9609],[105.9961,24.6533],[106.1719,24.7852],[106.1719,24.9609],[106.875,25.1807],[107.0508,25.2686],[106.9629,25.4883],[107.2266,25.6201],[107.4902,25.2246],[107.7539,25.2246],[107.8418,25.1367],[108.1055,25.2246],[108.1934,25.4443],[108.3691,25.5322],[108.6328,25.3125],[108.6328,25.5762],[109.0723,25.5322],[108.9844,25.752],[109.3359,25.708],[109.5117,26.0156],[109.7754,25.8838],[109.9512,26.1914],[110.2148,25.9717],[110.5664,26.3232],[111.1816,26.3232],[111.2695,26.2354],[111.2695,25.8838],[111.4453,25.8398],[111.0059,25.0049],[111.0938,24.9609],[111.3574,25.1367],[111.5332,24.6533],[111.709,24.7852],[112.0605,24.7412],[111.8848,24.6533],[112.0605,24.3457],[111.8848,24.2139],[111.8848,23.9941],[111.7969,23.8184],[111.6211,23.8184],[111.6211,23.6865],[111.3574,23.4668],[111.4453,23.0273],[111.2695,22.8076],[110.7422,22.5439],[110.7422,22.2803],[110.6543,22.1484],[110.3027,22.1484],[110.3027,21.8848],[109.9512,21.8408],[109.8633,21.665],[109.7754,21.6211],[109.7754,21.4014],[109.5996,21.4453],[109.1602,21.3574],[109.248,20.874],[109.0723,20.9619],[109.0723,21.5332],[108.7207,21.5332],[108.6328,21.665],[108.2813,21.4893],[107.8418,21.6211],[107.4023,21.6211],[107.0508,21.7969],[107.0508,21.9287],[106.6992,22.0166],[106.6113,22.4121],[106.7871,22.7637],[106.6992,22.8955],[105.9082,22.9395],[105.5566,23.0713],[105.5566,23.2031],[105.6445,23.4229],[106.1719,23.5547],[106.1719,23.8184],[105.9961,24.126],[105.5566,24.126],[105.4688,24.0381],[105.2051,24.082],[105.0293,24.4336],[104.7656,24.4775],[104.6777,24.3457],[104.502,24.7412]]]}},{'type':'Feature','id':'43','properties':{'name':'湖南','cp':[111.5332,27.3779],'childNum':14},'geometry':{'type':'Polygon','coordinates':[[[109.248,28.4766],[109.248,29.1357],[109.5117,29.6191],[109.6875,29.6191],[109.7754,29.751],[110.4785,29.6631],[110.6543,29.751],[110.4785,30.0146],[110.8301,30.1465],[111.7969,29.9268],[112.2363,29.5313],[112.5,29.6191],[112.6758,29.5752],[112.9395,29.7949],[113.0273,29.751],[112.9395,29.4873],[113.0273,29.4434],[113.5547,29.8389],[113.5547,29.707],[113.7305,29.5752],[113.6426,29.3115],[113.7305,29.0918],[113.9063,29.0479],[114.1699,28.8281],[114.082,28.5645],[114.2578,28.3447],[113.7305,27.9492],[113.6426,27.5977],[113.6426,27.3779],[113.8184,27.29],[113.7305,27.1143],[113.9063,26.9385],[113.9063,26.6309],[114.082,26.5869],[113.9941,26.1914],[114.2578,26.1475],[113.9941,26.0596],[113.9063,25.4443],[113.6426,25.3125],[113.2031,25.5322],[112.8516,25.3564],[113.0273,25.2246],[113.0273,24.9609],[112.8516,24.917],[112.5879,25.1367],[112.2363,25.1807],[112.1484,24.873],[112.0605,24.7412],[111.709,24.7852],[111.5332,24.6533],[111.3574,25.1367],[111.0938,24.9609],[111.0059,25.0049],[111.4453,25.8398],[111.2695,25.8838],[111.2695,26.2354],[111.1816,26.3232],[110.5664,26.3232],[110.2148,25.9717],[109.9512,26.1914],[109.7754,25.8838],[109.5117,26.0156],[109.4238,26.2793],[109.248,26.3232],[109.4238,26.5869],[109.3359,26.7188],[109.5117,26.8066],[109.5117,27.0264],[109.3359,27.1582],[108.8965,27.0264],[108.8086,27.1143],[109.4238,27.5977],[109.3359,27.9053],[109.3359,28.2568],[109.248,28.4766]]]}},{'type':'Feature','id':'61','properties':{'name':'陕西','cp':[109.5996,35.6396],'childNum':10},'geometry':{'type':'Polygon','coordinates':[[[105.4688,32.915],[105.9082,33.0029],[105.9961,33.1787],[105.7324,33.3984],[105.9961,33.6182],[106.5234,33.5303],[106.4355,33.9258],[106.6113,34.1455],[106.5234,34.2773],[106.6992,34.3213],[106.3477,34.585],[106.5234,34.7607],[106.6113,35.0684],[106.9629,35.0684],[107.2266,34.8926],[107.666,34.9365],[107.8418,35.0244],[107.7539,35.1123],[107.7539,35.2881],[108.5449,35.2881],[108.6328,35.5518],[108.5449,35.8594],[108.6328,35.9912],[108.7207,36.3428],[107.3145,36.9141],[107.3145,37.0898],[107.3145,37.6172],[107.666,37.8809],[108.1934,37.6172],[108.7207,37.7051],[108.8086,38.0127],[108.8965,37.9688],[109.0723,38.0127],[108.9844,38.3203],[109.9512,39.1553],[109.8633,39.2432],[110.2148,39.2871],[110.127,39.4629],[110.6543,39.2871],[111.0938,39.5947],[111.0938,39.375],[111.1816,39.2432],[110.918,38.7158],[110.8301,38.4961],[110.4785,38.1885],[110.4785,37.9688],[110.8301,37.6611],[110.3906,37.002],[110.4785,36.123],[110.5664,35.6396],[110.2148,34.8926],[110.2148,34.6729],[110.3906,34.585],[110.4785,34.2334],[110.6543,34.1455],[110.6543,33.8379],[111.0059,33.5303],[111.0059,33.2666],[110.7422,33.1348],[110.5664,33.2666],[110.3027,33.1787],[109.5996,33.2666],[109.4238,33.1348],[109.7754,33.0469],[109.7754,32.915],[110.127,32.7393],[110.127,32.6074],[109.6875,32.6074],[109.5117,32.4316],[109.5996,31.7285],[109.248,31.7285],[109.0723,31.9482],[108.5449,32.2119],[108.2813,32.2559],[108.0176,32.168],[107.4023,32.5195],[107.2266,32.4316],[107.1387,32.4756],[107.0508,32.6953],[106.3477,32.6514],[106.084,32.7393],[106.084,32.8711],[105.5566,32.7393],[105.4688,32.915]]]}},{'type':'Feature','id':'44','properties':{'name':'广东','cp':[113.4668,22.8076],'childNum':21},'geometry':{'type':'Polygon','coordinates':[[[109.7754,21.4014],[109.7754,21.6211],[109.8633,21.665],[109.9512,21.8408],[110.3027,21.8848],[110.3027,22.1484],[110.6543,22.1484],[110.7422,22.2803],[110.7422,22.5439],[111.2695,22.8076],[111.4453,23.0273],[111.3574,23.4668],[111.6211,23.6865],[111.6211,23.8184],[111.7969,23.8184],[111.8848,23.9941],[111.8848,24.2139],[112.0605,24.3457],[111.8848,24.6533],[112.0605,24.7412],[112.1484,24.873],[112.2363,25.1807],[112.5879,25.1367],[112.8516,24.917],[113.0273,24.9609],[113.0273,25.2246],[112.8516,25.3564],[113.2031,25.5322],[113.6426,25.3125],[113.9063,25.4443],[113.9941,25.2686],[114.6094,25.4004],[114.7852,25.2686],[114.6973,25.1367],[114.4336,24.9609],[114.1699,24.6973],[114.4336,24.5215],[115.4004,24.7852],[115.8398,24.5654],[115.752,24.7852],[115.9277,24.917],[116.2793,24.7852],[116.3672,24.873],[116.543,24.6094],[116.7188,24.6533],[116.9824,24.1699],[116.9824,23.9063],[117.1582,23.5547],[117.334,23.2471],[116.8945,23.3789],[116.6309,23.1152],[116.543,22.8516],[115.9277,22.7197],[115.6641,22.7637],[115.5762,22.6318],[115.0488,22.6758],[114.6094,22.3682],[114.3457,22.5439],[113.9941,22.5],[113.8184,22.1924],[114.3457,22.1484],[114.4336,22.0166],[114.082,21.9287],[113.9941,21.7969],[113.5547,22.0166],[113.1152,21.8408],[112.9395,21.5771],[112.4121,21.4453],[112.2363,21.5332],[111.5332,21.4893],[111.2695,21.3574],[110.7422,21.3574],[110.6543,21.2256],[110.7422,20.918],[110.4785,20.874],[110.6543,20.2588],[110.5664,20.2588],[110.3906,20.127],[110.0391,20.127],[109.8633,20.127],[109.8633,20.3027],[109.5996,20.918],[109.7754,21.4014],[109.7754,21.4014]],[[113.5986,22.1649],[113.6096,22.1265],[113.5547,22.11],[113.5437,22.2034],[113.5767,22.2034],[113.5986,22.1649]]]}},{'type':'Feature','id':'22','properties':{'name':'吉林','cp':[126.4746,43.5938],'childNum':9},'geometry':{'type':'Polygon','coordinates':[[[123.2227,46.2305],[123.9258,46.2305],[124.0137,45.7471],[124.3652,45.4395],[124.8926,45.5273],[125.0684,45.3955],[125.6836,45.5273],[125.7715,45.3076],[126.0352,45.1758],[126.5625,45.2637],[126.9141,45.1318],[127.0898,45],[127.002,44.7803],[127.0898,44.6045],[127.5293,44.6045],[127.7051,44.1211],[128.0566,44.1211],[128.0566,44.3408],[128.4082,44.4727],[128.4961,44.165],[128.8477,43.5498],[129.1992,43.5938],[129.2871,43.8135],[129.8145,43.9014],[129.9023,44.0332],[129.9902,43.8574],[130.3418,43.9893],[130.5176,43.6377],[130.8691,43.418],[131.3086,43.4619],[131.3086,43.3301],[131.1328,42.9346],[130.4297,42.7148],[130.6055,42.6709],[130.6055,42.4512],[130.2539,42.7588],[130.2539,42.8906],[130.166,42.9785],[129.9023,43.0225],[129.7266,42.4951],[129.375,42.4512],[128.9355,42.0117],[128.0566,42.0117],[128.3203,41.5723],[128.1445,41.3525],[127.0898,41.5283],[127.1777,41.5723],[126.9141,41.792],[126.6504,41.6602],[126.4746,41.3965],[126.123,40.957],[125.6836,40.8691],[125.5957,40.9131],[125.7715,41.2207],[125.332,41.6602],[125.332,41.9678],[125.4199,42.0996],[125.332,42.1436],[124.8926,42.8027],[124.8926,43.0664],[124.7168,43.0664],[124.4531,42.8467],[124.2773,43.2422],[123.8379,43.4619],[123.6621,43.374],[123.3105,43.5059],[123.4863,43.7256],[123.1348,44.4727],[122.3438,44.2529],[122.0801,44.8682],[122.2559,45.2637],[121.9043,45.7031],[121.7285,45.7471],[121.8164,46.0107],[122.2559,45.791],[122.4316,45.8789],[122.6953,45.7031],[122.7832,46.0107],[123.2227,46.2305]]]}},{'type':'Feature','id':'13','properties':{'name':'河北','cp':[115.4004,37.9688],'childNum':11},'geometry':{'type':'MultiPolygon','coordinates':[[[[114.5215,39.5068],[114.3457,39.8584],[113.9941,39.9902],[114.5215,40.3418],[114.3457,40.3857],[114.2578,40.6055],[114.082,40.7373],[113.9063,41.1328],[113.9941,41.2207],[113.9063,41.4404],[114.2578,41.5723],[114.1699,41.792],[114.5215,42.1436],[114.873,42.0996],[114.9609,41.6162],[115.2246,41.5723],[115.9277,41.9238],[116.0156,41.792],[116.2793,42.0117],[116.8066,42.0117],[116.8945,42.4072],[117.334,42.4512],[117.5098,42.583],[117.7734,42.627],[118.0371,42.4072],[117.9492,42.2314],[118.125,42.0557],[118.3008,42.0996],[118.3008,41.792],[118.125,41.748],[118.3887,41.3086],[119.2676,41.3086],[118.8281,40.8252],[119.2676,40.5176],[119.5313,40.5615],[119.707,40.1221],[119.8828,39.9463],[119.5313,39.6826],[119.4434,39.4189],[118.916,39.0674],[118.4766,38.9355],[118.125,39.0234],[118.0371,39.1992],[118.0371,39.2432],[117.8613,39.4189],[117.9492,39.5947],[117.6855,39.5947],[117.5098,39.7705],[117.5098,39.9902],[117.6855,39.9902],[117.6855,40.0781],[117.4219,40.21],[117.2461,40.5176],[117.4219,40.6494],[116.9824,40.6934],[116.6309,41.0449],[116.3672,40.9131],[116.4551,40.7813],[116.1914,40.7813],[116.1035,40.6055],[115.752,40.5615],[115.9277,40.2539],[115.4004,39.9463],[115.4883,39.6387],[115.752,39.5068],[116.1914,39.5947],[116.3672,39.4629],[116.543,39.5947],[116.8066,39.5947],[116.8945,39.1113],[116.7188,38.9355],[116.7188,38.8037],[117.2461,38.54],[117.5977,38.6279],[117.9492,38.3203],[117.4219,37.8369],[116.8066,37.8369],[116.4551,37.4854],[116.2793,37.5732],[116.2793,37.3535],[116.0156,37.3535],[115.752,36.9141],[115.3125,36.5186],[115.4883,36.167],[115.3125,36.0791],[115.1367,36.2109],[114.9609,36.0791],[114.873,36.123],[113.7305,36.3428],[113.4668,36.6504],[113.7305,36.8701],[113.7305,37.1338],[114.1699,37.6611],[113.9941,37.7051],[113.8184,38.1445],[113.5547,38.2764],[113.5547,38.54],[113.8184,38.8037],[113.8184,38.9355],[113.9063,39.0234],[114.3457,39.0674],[114.5215,39.5068]]],[[[117.2461,40.0781],[117.1582,39.8145],[117.1582,39.6387],[116.8945,39.6826],[116.8945,39.8145],[116.8066,39.9902],[117.2461,40.0781]]]]}},{'type':'Feature','id':'42','properties':{'name':'湖北','cp':[112.2363,31.1572],'childNum':17},'geometry':{'type':'Polygon','coordinates':[[[110.2148,31.1572],[110.127,31.377],[109.6875,31.5527],[109.7754,31.6846],[109.5996,31.7285],[109.5117,32.4316],[109.6875,32.6074],[110.127,32.6074],[110.127,32.7393],[109.7754,32.915],[109.7754,33.0469],[109.4238,33.1348],[109.5996,33.2666],[110.3027,33.1787],[110.5664,33.2666],[110.7422,33.1348],[111.0059,33.2666],[111.5332,32.6074],[112.3242,32.3438],[113.2031,32.4316],[113.4668,32.2998],[113.7305,32.4316],[113.8184,31.8604],[113.9941,31.7725],[114.1699,31.8604],[114.5215,31.7725],[114.6094,31.5527],[114.7852,31.4648],[115.1367,31.5967],[115.2246,31.4209],[115.4004,31.4209],[115.5762,31.2012],[116.0156,31.0254],[115.752,30.6738],[116.1035,30.1904],[116.1035,29.8389],[115.9277,29.707],[115.4883,29.7949],[114.873,29.3994],[114.2578,29.3555],[113.9063,29.0479],[113.7305,29.0918],[113.6426,29.3115],[113.7305,29.5752],[113.5547,29.707],[113.5547,29.8389],[113.0273,29.4434],[112.9395,29.4873],[113.0273,29.751],[112.9395,29.7949],[112.6758,29.5752],[112.5,29.6191],[112.2363,29.5313],[111.7969,29.9268],[110.8301,30.1465],[110.4785,30.0146],[110.6543,29.751],[110.4785,29.6631],[109.7754,29.751],[109.6875,29.6191],[109.5117,29.6191],[109.248,29.1357],[109.0723,29.3555],[108.9844,29.3115],[108.6328,29.8389],[108.457,29.7949],[108.5449,30.2344],[108.457,30.4102],[108.6328,30.5859],[108.8086,30.498],[109.0723,30.6299],[109.1602,30.542],[109.248,30.6299],[109.4238,30.542],[109.8633,30.8936],[110.0391,30.8057],[110.2148,31.1572]]]}},{'type':'Feature','id':'52','properties':{'name':'贵州','cp':[106.6113,26.9385],'childNum':9},'geometry':{'type':'Polygon','coordinates':[[[104.1504,27.2461],[104.4141,27.4658],[104.5898,27.334],[105.2051,27.3779],[105.293,27.7295],[105.5566,27.7734],[105.6445,27.6416],[106.3477,27.8174],[106.1719,28.125],[105.9082,28.125],[105.6445,28.4326],[105.9961,28.7402],[106.3477,28.5205],[106.5234,28.5645],[106.4355,28.7842],[106.5234,28.7842],[106.6113,28.6523],[106.6113,28.5205],[106.6992,28.4766],[106.875,28.7842],[107.4023,28.8721],[107.4023,29.1797],[107.5781,29.2236],[107.8418,29.1357],[107.8418,29.0039],[108.2813,29.0918],[108.3691,28.6523],[108.5449,28.6523],[108.5449,28.3887],[108.7207,28.4766],[108.7207,28.2129],[109.0723,28.2129],[109.248,28.4766],[109.3359,28.2568],[109.3359,27.9053],[109.4238,27.5977],[108.8086,27.1143],[108.8965,27.0264],[109.3359,27.1582],[109.5117,27.0264],[109.5117,26.8066],[109.3359,26.7188],[109.4238,26.5869],[109.248,26.3232],[109.4238,26.2793],[109.5117,26.0156],[109.3359,25.708],[108.9844,25.752],[109.0723,25.5322],[108.6328,25.5762],[108.6328,25.3125],[108.3691,25.5322],[108.1934,25.4443],[108.1055,25.2246],[107.8418,25.1367],[107.7539,25.2246],[107.4902,25.2246],[107.2266,25.6201],[106.9629,25.4883],[107.0508,25.2686],[106.875,25.1807],[106.1719,24.9609],[106.1719,24.7852],[105.9961,24.6533],[105.2051,24.9609],[104.6777,24.6094],[104.502,24.7412],[104.6777,24.9609],[104.5898,25.0488],[104.8535,25.2246],[104.3262,25.708],[104.6777,26.4111],[104.4141,26.6748],[103.8867,26.543],[103.7109,26.7627],[103.7109,26.9824],[103.623,27.0264],[103.8867,27.4219],[104.1504,27.2461]]]}},{'type':'Feature','id':'37','properties':{'name':'山东','cp':[118.7402,36.4307],'childNum':17},'geometry':{'type':'Polygon','coordinates':[[[115.4883,36.167],[115.3125,36.5186],[115.752,36.9141],[116.0156,37.3535],[116.2793,37.3535],[116.2793,37.5732],[116.4551,37.4854],[116.8066,37.8369],[117.4219,37.8369],[117.9492,38.3203],[118.125,38.1445],[118.916,38.1445],[119.3555,37.6611],[119.0039,37.5293],[119.0039,37.3535],[119.3555,37.1338],[119.707,37.1338],[119.8828,37.3975],[120.498,37.8369],[120.5859,38.1445],[120.9375,38.4521],[121.0254,37.8369],[121.2012,37.6611],[121.9043,37.4854],[122.168,37.6172],[122.2559,37.4854],[122.6074,37.4854],[122.6953,37.3535],[122.6074,36.9141],[122.4316,36.7822],[121.8164,36.8701],[121.7285,36.6943],[121.1133,36.6064],[121.1133,36.4307],[121.377,36.2549],[120.7617,36.167],[120.9375,35.8594],[120.6738,36.0352],[119.707,35.4639],[119.9707,34.9805],[119.3555,35.0244],[119.2676,35.1123],[118.916,35.0244],[118.7402,34.7168],[118.4766,34.6729],[118.3887,34.4092],[118.2129,34.4092],[118.125,34.6289],[117.9492,34.6729],[117.5977,34.4531],[117.334,34.585],[117.2461,34.4531],[116.8066,34.9365],[116.4551,34.8926],[116.3672,34.6289],[116.1914,34.585],[115.5762,34.585],[115.4004,34.8486],[114.7852,35.0684],[115.0488,35.376],[115.2246,35.4199],[115.4883,35.7275],[116.1035,36.0791],[115.3125,35.8154],[115.4883,36.167]]]}},{'type':'Feature','id':'36','properties':{'name':'江西','cp':[116.0156,27.29],'childNum':11},'geometry':{'type':'Polygon','coordinates':[[[114.2578,28.3447],[114.082,28.5645],[114.1699,28.8281],[113.9063,29.0479],[114.2578,29.3555],[114.873,29.3994],[115.4883,29.7949],[115.9277,29.707],[116.1035,29.8389],[116.2793,29.7949],[116.7188,30.0586],[116.8945,29.9268],[116.7188,29.751],[116.7188,29.6191],[117.1582,29.707],[117.0703,29.8389],[117.1582,29.9268],[117.5098,29.6191],[118.0371,29.5752],[118.2129,29.3994],[118.0371,29.1797],[118.0371,29.0479],[118.3887,28.7842],[118.4766,28.3447],[118.4766,28.3008],[118.3008,28.0811],[117.7734,27.8174],[117.5098,27.9932],[116.9824,27.6416],[117.1582,27.29],[117.0703,27.1143],[116.543,26.8066],[116.6309,26.4551],[116.3672,26.2354],[116.4551,26.1035],[116.1914,25.8838],[116.0156,25.2686],[115.8398,25.2246],[115.9277,24.917],[115.752,24.7852],[115.8398,24.5654],[115.4004,24.7852],[114.4336,24.5215],[114.1699,24.6973],[114.4336,24.9609],[114.6973,25.1367],[114.7852,25.2686],[114.6094,25.4004],[113.9941,25.2686],[113.9063,25.4443],[113.9941,26.0596],[114.2578,26.1475],[113.9941,26.1914],[114.082,26.5869],[113.9063,26.6309],[113.9063,26.9385],[113.7305,27.1143],[113.8184,27.29],[113.6426,27.3779],[113.6426,27.5977],[113.7305,27.9492],[114.2578,28.3447]]]}},{'type':'Feature','id':'41','properties':{'name':'河南','cp':[113.4668,33.8818],'childNum':17},'geometry':{'type':'Polygon','coordinates':[[[110.3906,34.585],[110.8301,34.6289],[111.1816,34.8047],[111.5332,34.8486],[111.7969,35.0684],[112.0605,35.0684],[112.0605,35.2881],[112.7637,35.2002],[113.1152,35.332],[113.6426,35.6836],[113.7305,36.3428],[114.873,36.123],[114.9609,36.0791],[115.1367,36.2109],[115.3125,36.0791],[115.4883,36.167],[115.3125,35.8154],[116.1035,36.0791],[115.4883,35.7275],[115.2246,35.4199],[115.0488,35.376],[114.7852,35.0684],[115.4004,34.8486],[115.5762,34.585],[116.1914,34.585],[116.1914,34.4092],[116.543,34.2773],[116.6309,33.9258],[116.1914,33.7061],[116.0156,33.9697],[115.6641,34.0576],[115.5762,33.9258],[115.5762,33.6621],[115.4004,33.5303],[115.3125,33.1787],[114.873,33.1348],[114.873,33.0029],[115.1367,32.8711],[115.2246,32.6074],[115.5762,32.4316],[115.8398,32.5195],[115.9277,31.7725],[115.4883,31.6846],[115.4004,31.4209],[115.2246,31.4209],[115.1367,31.5967],[114.7852,31.4648],[114.6094,31.5527],[114.5215,31.7725],[114.1699,31.8604],[113.9941,31.7725],[113.8184,31.8604],[113.7305,32.4316],[113.4668,32.2998],[113.2031,32.4316],[112.3242,32.3438],[111.5332,32.6074],[111.0059,33.2666],[111.0059,33.5303],[110.6543,33.8379],[110.6543,34.1455],[110.4785,34.2334],[110.3906,34.585]]]}},{'type':'Feature','id':'21','properties':{'name':'辽宁','cp':[122.3438,41.0889],'childNum':14},'geometry':{'type':'Polygon','coordinates':[[[119.2676,41.3086],[119.4434,41.6162],[119.2676,41.7041],[119.3555,42.2754],[119.5313,42.3633],[119.8828,42.1875],[120.1465,41.7041],[120.498,42.0996],[121.4648,42.4951],[121.7285,42.4512],[121.9922,42.7148],[122.3438,42.6709],[122.3438,42.8467],[122.7832,42.7148],[123.1348,42.8027],[123.3105,42.9785],[123.5742,43.0225],[123.6621,43.374],[123.8379,43.4619],[124.2773,43.2422],[124.4531,42.8467],[124.7168,43.0664],[124.8926,43.0664],[124.8926,42.8027],[125.332,42.1436],[125.4199,42.0996],[125.332,41.9678],[125.332,41.6602],[125.7715,41.2207],[125.5957,40.9131],[125.6836,40.8691],[124.541,40.21],[124.1016,39.6826],[123.3984,39.6826],[123.1348,39.4189],[123.1348,39.0234],[122.0801,39.0234],[121.5527,38.7158],[121.1133,38.6719],[120.9375,38.9795],[121.377,39.1992],[121.2012,39.5508],[122.0801,40.3857],[121.9922,40.6934],[121.7285,40.8252],[121.2012,40.8252],[120.5859,40.21],[119.8828,39.9463],[119.707,40.1221],[119.5313,40.5615],[119.2676,40.5176],[118.8281,40.8252],[119.2676,41.3086]]]}},{'type':'Feature','id':'14','properties':{'name':'山西','cp':[112.4121,37.6611],'childNum':11},'geometry':{'type':'Polygon','coordinates':[[[110.918,38.7158],[111.1816,39.2432],[111.0938,39.375],[111.3574,39.4189],[111.4453,39.6387],[111.9727,39.5947],[112.3242,40.2539],[112.7637,40.166],[113.2031,40.3857],[113.5547,40.3418],[113.8184,40.5176],[114.082,40.5176],[114.082,40.7373],[114.2578,40.6055],[114.3457,40.3857],[114.5215,40.3418],[113.9941,39.9902],[114.3457,39.8584],[114.5215,39.5068],[114.3457,39.0674],[113.9063,39.0234],[113.8184,38.9355],[113.8184,38.8037],[113.5547,38.54],[113.5547,38.2764],[113.8184,38.1445],[113.9941,37.7051],[114.1699,37.6611],[113.7305,37.1338],[113.7305,36.8701],[113.4668,36.6504],[113.7305,36.3428],[113.6426,35.6836],[113.1152,35.332],[112.7637,35.2002],[112.0605,35.2881],[112.0605,35.0684],[111.7969,35.0684],[111.5332,34.8486],[111.1816,34.8047],[110.8301,34.6289],[110.3906,34.585],[110.2148,34.6729],[110.2148,34.8926],[110.5664,35.6396],[110.4785,36.123],[110.3906,37.002],[110.8301,37.6611],[110.4785,37.9688],[110.4785,38.1885],[110.8301,38.4961],[110.918,38.7158]]]}},{'type':'Feature','id':'34','properties':{'name':'安徽','cp':[117.2461,32.0361],'childNum':17},'geometry':{'type':'Polygon','coordinates':[[[116.6309,33.9258],[116.543,34.2773],[116.1914,34.4092],[116.1914,34.585],[116.3672,34.6289],[116.8945,34.4092],[117.1582,34.0576],[117.5977,34.0137],[117.7734,33.7061],[118.125,33.75],[117.9492,33.2227],[118.0371,33.1348],[118.2129,33.2227],[118.3008,32.7832],[118.7402,32.7393],[118.916,32.959],[119.1797,32.8271],[119.1797,32.4756],[118.5645,32.5635],[118.6523,32.2119],[118.4766,32.168],[118.3887,31.9482],[118.916,31.5527],[118.7402,31.377],[118.8281,31.2451],[119.3555,31.2891],[119.4434,31.1572],[119.6191,31.1133],[119.6191,31.0693],[119.4434,30.6738],[119.2676,30.6299],[119.3555,30.4102],[118.916,30.3223],[118.916,29.9707],[118.7402,29.707],[118.2129,29.3994],[118.0371,29.5752],[117.5098,29.6191],[117.1582,29.9268],[117.0703,29.8389],[117.1582,29.707],[116.7188,29.6191],[116.7188,29.751],[116.8945,29.9268],[116.7188,30.0586],[116.2793,29.7949],[116.1035,29.8389],[116.1035,30.1904],[115.752,30.6738],[116.0156,31.0254],[115.5762,31.2012],[115.4004,31.4209],[115.4883,31.6846],[115.9277,31.7725],[115.8398,32.5195],[115.5762,32.4316],[115.2246,32.6074],[115.1367,32.8711],[114.873,33.0029],[114.873,33.1348],[115.3125,33.1787],[115.4004,33.5303],[115.5762,33.6621],[115.5762,33.9258],[115.6641,34.0576],[116.0156,33.9697],[116.1914,33.7061],[116.6309,33.9258]]]}},{'type':'Feature','id':'35','properties':{'name':'福建','cp':[118.3008,25.9277],'childNum':9},'geometry':{'type':'Polygon','coordinates':[[[118.4766,28.3008],[118.8281,28.2568],[118.7402,28.0371],[118.916,27.4658],[119.2676,27.4219],[119.6191,27.6855],[119.7949,27.29],[120.2344,27.4219],[120.4102,27.1582],[120.7617,27.0264],[120.6738,26.8945],[120.2344,26.8506],[120.2344,26.7188],[120.4102,26.6748],[120.498,26.3672],[120.2344,26.2793],[120.4102,26.1475],[120.0586,26.1914],[119.9707,25.9277],[119.7949,25.9277],[119.9707,25.4004],[119.7949,25.2686],[119.5313,25.1367],[119.4434,25.0049],[119.2676,25.0928],[118.916,24.8291],[118.6523,24.5215],[118.4766,24.5215],[118.4766,24.4336],[118.2129,24.3457],[118.2129,24.1699],[117.8613,23.9941],[117.7734,23.7744],[117.5098,23.5986],[117.1582,23.5547],[116.9824,23.9063],[116.9824,24.1699],[116.7188,24.6533],[116.543,24.6094],[116.3672,24.873],[116.2793,24.7852],[115.9277,24.917],[115.8398,25.2246],[116.0156,25.2686],[116.1914,25.8838],[116.4551,26.1035],[116.3672,26.2354],[116.6309,26.4551],[116.543,26.8066],[117.0703,27.1143],[117.1582,27.29],[116.9824,27.6416],[117.5098,27.9932],[117.7734,27.8174],[118.3008,28.0811],[118.4766,28.3008]]]}},{'type':'Feature','id':'33','properties':{'name':'浙江','cp':[120.498,29.0918],'childNum':11},'geometry':{'type':'Polygon','coordinates':[[[118.2129,29.3994],[118.7402,29.707],[118.916,29.9707],[118.916,30.3223],[119.3555,30.4102],[119.2676,30.6299],[119.4434,30.6738],[119.6191,31.0693],[119.6191,31.1133],[119.9707,31.1572],[120.498,30.8057],[120.9375,31.0254],[121.2891,30.6738],[121.9922,30.8057],[122.6953,30.8936],[122.8711,30.7178],[122.959,30.1465],[122.6074,30.1025],[122.6074,29.9268],[122.168,29.5313],[122.3438,28.8721],[121.9922,28.8721],[121.9922,28.4326],[121.7285,28.3447],[121.7285,28.2129],[121.4648,28.2129],[121.5527,28.0371],[121.2891,27.9492],[121.1133,27.4219],[120.6738,27.334],[120.6738,27.1582],[120.9375,27.0264],[120.7617,27.0264],[120.4102,27.1582],[120.2344,27.4219],[119.7949,27.29],[119.6191,27.6855],[119.2676,27.4219],[118.916,27.4658],[118.7402,28.0371],[118.8281,28.2568],[118.4766,28.3008],[118.4766,28.3447],[118.3887,28.7842],[118.0371,29.0479],[118.0371,29.1797],[118.2129,29.3994]]]}},{'type':'Feature','id':'32','properties':{'name':'江苏','cp':[120.0586,32.915],'childNum':13},'geometry':{'type':'Polygon','coordinates':[[[116.3672,34.6289],[116.4551,34.8926],[116.8066,34.9365],[117.2461,34.4531],[117.334,34.585],[117.5977,34.4531],[117.9492,34.6729],[118.125,34.6289],[118.2129,34.4092],[118.3887,34.4092],[118.4766,34.6729],[118.7402,34.7168],[118.916,35.0244],[119.2676,35.1123],[119.3555,35.0244],[119.3555,34.8486],[119.707,34.585],[120.3223,34.3652],[120.9375,33.0469],[121.0254,32.6514],[121.377,32.4756],[121.4648,32.168],[121.9043,31.9922],[121.9922,31.6846],[121.9922,31.5967],[121.2012,31.8604],[121.1133,31.7285],[121.377,31.5088],[121.2012,31.4648],[120.9375,31.0254],[120.498,30.8057],[119.9707,31.1572],[119.6191,31.1133],[119.4434,31.1572],[119.3555,31.2891],[118.8281,31.2451],[118.7402,31.377],[118.916,31.5527],[118.3887,31.9482],[118.4766,32.168],[118.6523,32.2119],[118.5645,32.5635],[119.1797,32.4756],[119.1797,32.8271],[118.916,32.959],[118.7402,32.7393],[118.3008,32.7832],[118.2129,33.2227],[118.0371,33.1348],[117.9492,33.2227],[118.125,33.75],[117.7734,33.7061],[117.5977,34.0137],[117.1582,34.0576],[116.8945,34.4092],[116.3672,34.6289]]]}},{'type':'Feature','id':'50','properties':{'name':'重庆','cp':[107.7539,30.1904],'childNum':40},'geometry':{'type':'Polygon','coordinates':[[[108.5449,31.6846],[108.2813,31.9043],[108.3691,32.168],[108.5449,32.2119],[109.0723,31.9482],[109.248,31.7285],[109.5996,31.7285],[109.7754,31.6846],[109.6875,31.5527],[110.127,31.377],[110.2148,31.1572],[110.0391,30.8057],[109.8633,30.8936],[109.4238,30.542],[109.248,30.6299],[109.1602,30.542],[109.0723,30.6299],[108.8086,30.498],[108.6328,30.5859],[108.457,30.4102],[108.5449,30.2344],[108.457,29.7949],[108.6328,29.8389],[108.9844,29.3115],[109.0723,29.3555],[109.248,29.1357],[109.248,28.4766],[109.0723,28.2129],[108.7207,28.2129],[108.7207,28.4766],[108.5449,28.3887],[108.5449,28.6523],[108.3691,28.6523],[108.2813,29.0918],[107.8418,29.0039],[107.8418,29.1357],[107.5781,29.2236],[107.4023,29.1797],[107.4023,28.8721],[106.875,28.7842],[106.6992,28.4766],[106.6113,28.5205],[106.6113,28.6523],[106.5234,28.7842],[106.4355,28.7842],[106.5234,28.5645],[106.3477,28.5205],[106.2598,28.8721],[105.8203,28.96],[105.7324,29.2676],[105.4688,29.3115],[105.293,29.5313],[105.7324,29.8828],[105.5566,30.1025],[105.6445,30.2783],[105.8203,30.4541],[106.2598,30.1904],[106.6113,30.3223],[106.7871,30.0146],[107.0508,30.0146],[107.4902,30.6299],[107.4023,30.7617],[107.4902,30.8496],[107.9297,30.8496],[108.1934,31.5088],[108.5449,31.6846]]]}},{'type':'Feature','id':'64','properties':{'name':'宁夏','cp':[105.9961,37.3096],'childNum':5},'geometry':{'type':'Polygon','coordinates':[[[104.3262,37.4414],[105.8203,37.793],[105.9082,38.7158],[106.3477,39.2871],[106.7871,39.375],[106.9629,38.9795],[106.5234,38.3203],[106.7871,38.1885],[107.3145,38.1006],[107.666,37.8809],[107.3145,37.6172],[107.3145,37.0898],[106.6113,37.0898],[106.6113,36.7822],[106.4355,36.5625],[106.5234,36.4746],[106.5234,36.2549],[106.875,36.123],[106.9629,35.8154],[106.6992,35.6836],[106.4355,35.6836],[106.5234,35.332],[106.3477,35.2441],[106.2598,35.4199],[106.084,35.376],[105.9961,35.4199],[106.084,35.4639],[105.9961,35.4639],[105.8203,35.5518],[105.7324,35.7275],[105.3809,35.7715],[105.293,35.9912],[105.4688,36.123],[105.2051,36.6943],[105.293,36.8262],[104.8535,37.2217],[104.5898,37.2217],[104.5898,37.4414],[104.3262,37.4414]]]}},{'type':'Feature','id':'46','properties':{'name':'海南','cp':[109.9512,19.2041],'childNum':18},'geometry':{'type':'Polygon','coordinates':[[[108.6328,19.3799],[109.0723,19.6436],[109.248,19.9512],[109.5996,20.0391],[110.0391,20.127],[110.3906,20.127],[110.5664,20.2588],[110.6543,20.2588],[111.0938,19.9512],[111.2695,19.9951],[110.6543,19.1602],[110.5664,18.6768],[110.2148,18.5889],[110.0391,18.3691],[109.8633,18.3691],[109.6875,18.1055],[108.9844,18.2813],[108.6328,18.457],[108.6328,19.3799]]]}},{'type':'Feature','id':'71','properties':{'name':'台湾','cp':[121.0254,23.5986],'childNum':1},'geometry':{'type':'Polygon','coordinates':[[[121.9043,25.0488],[121.9922,25.0049],[121.8164,24.7412],[121.9043,24.5654],[121.6406,24.0381],[121.377,23.1152],[121.0254,22.6758],[120.8496,22.0605],[120.7617,21.9287],[120.6738,22.3242],[120.2344,22.5879],[120.0586,23.0713],[120.1465,23.6865],[121.0254,25.0488],[121.5527,25.3125],[121.9043,25.0488]]]}},{'type':'Feature','id':'11','properties':{'name':'北京','cp':[116.4551,40.2539],'childNum':19},'geometry':{'type':'Polygon','coordinates':[[[117.4219,40.21],[117.334,40.1221],[117.2461,40.0781],[116.8066,39.9902],[116.8945,39.8145],[116.8945,39.6826],[116.8066,39.5947],[116.543,39.5947],[116.3672,39.4629],[116.1914,39.5947],[115.752,39.5068],[115.4883,39.6387],[115.4004,39.9463],[115.9277,40.2539],[115.752,40.5615],[116.1035,40.6055],[116.1914,40.7813],[116.4551,40.7813],[116.3672,40.9131],[116.6309,41.0449],[116.9824,40.6934],[117.4219,40.6494],[117.2461,40.5176],[117.4219,40.21]]]}},{'type':'Feature','id':'12','properties':{'name':'天津','cp':[117.4219,39.4189],'childNum':18},'geometry':{'type':'Polygon','coordinates':[[[116.8066,39.5947],[116.8945,39.6826],[117.1582,39.6387],[117.1582,39.8145],[117.2461,40.0781],[117.334,40.1221],[117.4219,40.21],[117.6855,40.0781],[117.6855,39.9902],[117.5098,39.9902],[117.5098,39.7705],[117.6855,39.5947],[117.9492,39.5947],[117.8613,39.4189],[118.0371,39.2432],[118.0371,39.1992],[117.8613,39.1113],[117.5977,38.6279],[117.2461,38.54],[116.7188,38.8037],[116.7188,38.9355],[116.8945,39.1113],[116.8066,39.5947]]]}},{'type':'Feature','id':'31','properties':{'name':'上海','cp':[121.4648,31.2891],'childNum':19},'geometry':{'type':'Polygon','coordinates':[[[120.9375,31.0254],[121.2012,31.4648],[121.377,31.5088],[121.1133,31.7285],[121.2012,31.8604],[121.9922,31.5967],[121.9043,31.1572],[121.9922,30.8057],[121.2891,30.6738],[120.9375,31.0254]]]}},{'type':'Feature','id':'81','properties':{'name':'香港','cp':[114.2578,22.3242],'childNum':1},'geometry':{'type':'Polygon','coordinates':[[[114.6094,22.4121],[114.5215,22.1484],[114.3457,22.1484],[113.9063,22.1484],[113.8184,22.1924],[113.9063,22.4121],[114.1699,22.5439],[114.3457,22.5439],[114.4336,22.5439],[114.4336,22.4121],[114.6094,22.4121]]]}},{'type':'Feature','id':'82','properties':{'name':'澳门','cp':[113.5547,22.1484],'childNum':1},'geometry':{'type':'Polygon','coordinates':[[[113.5986,22.1649],[113.6096,22.1265],[113.5547,22.11],[113.5437,22.2034],[113.5767,22.2034],[113.5986,22.1649]]]}}]};var J='#000000';var K=13;var L=0;var M=20;var N=10;var O=100;f.data=function(_){if(arguments.length){if(_.type==='xml'){_=_.root;_=_.map(function(d){var a={};d.row.row.forEach(function(p){var k=bw.keys(p)[0];a[k]=p[k]});return a})}else if(_.type==='xlsx'||_.type==='xls'){var s=[];for(var i=0;i<_.length;i++){var k=bw.keys(_[i])[0];s=s.concat(_[i][k])}_=s}r=_;r.forEach(function(d,i){if(!isFinite(parseFloat(d.value))){alert('Attribute "value" in line '+i+' should be a number')}});return this}else return r};f.getType=function(){return l};f.render=function(_){x=x||j.select(_).node();if(!x||x.tagName.toLowerCase()!=='div'){alert('The argument(element) in map.rander(_) should be <div> element')}j.select(x).classed('chart',true);y=y||j.select(x).append('svg').classed('map',true).node();widthAvail=j.min([m,n]);o=j.min([m,n]);var h=j.scale.linear().range([D[0],D[1]]);h.domain(C);w=j.select(x).select('.floatTag').node()?j.select(x).select('.floatTag'):f.floatTag(x);var g=j.select(y).attr({'width':m,'height':n}).selectAll('g').data([1]).enter().append('svg:g').attr('transform','translate('+q+','+tranY+')');g.call(function(a){a.append('svg:g').classed('map',true);a.append('svg:g').classed('legends',true)});g=j.select(y).select('g');chinamapUpdate(g);chinamapDraw(g);var b=g.select('.map').selectAll('.state');r.forEach(function(d){if(E.has(d.name)){j.select(E.get(d.name)).data([d]).select('path').attr('data-color',h(d.value)).style('fill',h(d.value))}});b.on('mouseover',function(d){drawLegend(d,true,h);j.select(this).select('path').transition().duration(z).style('fill',F)}).on('mouseout',function(d){drawLegend(d,false,h);j.select(this).select('path').transition().duration(z).style('fill',function(){return j.select(this).attr('data-color')})});var c=g.select('.legends').attr('transform','translate('+L+','+M+')').selectAll('.legend').data(h.ticks(6).slice(1).reverse());c.exit().transition().duration(z).style('opacity',0).remove();legendUpdate(c,h);legendDraw(c,h)};function chinamapUpdate(g){var b=j.geo.mercator().center([122,40]).scale(B);var c=j.geo.path().projection(b);g.select('.map').selectAll('.state').append('svg:g').call(function(a){a.select('path').transition().duration(z).attr('d',c).attr('data-color',G).style('fill',G).style('stroke',H);a.select('text').transition().duration(z).attr('x',function(d){return b(d.properties.cp)[0]}).attr('y',function(d){return b(d.properties.cp)[1]}).style({'font-family':u,'font-size':t,'fill':v})})}function chinamapDraw(g){var b=j.geo.mercator().center([122,40]).scale(B);var c=j.geo.path().projection(b);var e=g.select('.map').selectAll('.state').data(I.features).enter();e.append('svg:g').classed('state',true).attr('id',function(d){return d.properties.name}).call(function(a){a.each(function(d){E.set(d.properties.name,this)});a.append('svg:path').attr('d',c).attr('data-color',G).style('fill',G).style('stroke',H);a.append('svg:text').attr('x',function(d){return b(d.properties.cp)[0]}).attr('y',function(d){return b(d.properties.cp)[1]}).style('text-anchor',function(d){if(d.properties.name==="澳门"){return'end'}else if(d.properties.name==="香港"){return'start'}else return'middle'}).style({'font-family':u,'font-size':t,'fill':v}).text(function(d){return d.properties.name})})}function legendDraw(a,h){a.enter().append('svg:g').classed('legend',true).each(function(d,i){j.select(this).append('svg:rect').attr({'x':(i-i%N)/N*O+widthAvail+20,'y':i%N*20}).attr({'width':10,'height':10}).style('fill',h).style('stroke',h).style('fill-opacity',1).style('opacity',0).transition().duration(z).style('opacity',1);j.select(this).append('svg:text').attr({'x':(i-i%N)/N*O+widthAvail+40,'y':i%N*20+9}).style({'opacity':0,'fill':J,'font-size':K,'font-family':u}).transition().duration(z).style('opacity',1).text(String)})}function legendUpdate(a,h){a.each(function(d,i){j.select(this).selectAll('rect').transition().duration(z/2).style('fill',h).style('stroke',h).style('fill-opacity',1).attr({'x':(i-i%N)/N*O+widthAvail+20,'y':i%N*20});j.select(this).selectAll('text').transition().duration(z/2).attr({'x':(i-i%N)/N*O+widthAvail+40,'y':i%N*20+9}).style({'font-size':K,'fill':J,'font-family':u}).text(String)})}function drawLegend(d,a,h){if(a){w.style({'border-color':h(d.value),'opacity':1,'textAlign':'center','margin':'auto'}).html('name: '+d.name+'<br/>'+'value: '+d.value)}else{w.style('opacity',0)}}f.size=function(_){if(!arguments.length)return[m,n];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in map.size(width, height) should be number and number of svg');return this}else{m=arguments[0];n=arguments[1];return this}};f.sizeAvail=function(_){if(!arguments.length)return[widthAvail,o];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in map.sizeAvail(widthAvail, heightAvail) should be number and number of svg');return this}else{widthAvail=arguments[0];o=arguments[1];return this}};f.tran=function(_){if(!arguments.length)return[q,tranY];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in map.tran(tranX, tranY) should be number and number of svg');return this}else{q=arguments[0];tranY=arguments[1];return this}};f.fontSize=function(_){if(!arguments.length)return t;else{if(!isFinite(arguments[0])){console.error('The arguments in map.fontSize(fontSize) should be number of text');return this}else{t=arguments[0];return this}}};f.fontFamily=function(_){if(!arguments.length)return u;else{if(typeof arguments[0]!=='string'){console.error('The arguments in map.fontFamily(fontFamily) should be string of text');return this}else{t=arguments[0];return this}}};f.fontColor=function(_){if(!arguments.length)return v;else{if(typeof arguments[0]!=='string'){console.error('The arguments in map.fontColor(fontColor) should be string of text');return this}else{v=arguments[0];return this}}};f.duration=function(_){if(!arguments.length)return z;else{if(!isFinite(arguments[0])){console.error('The arguments in map.duration(duration) should be number of transition');return this}else{z=Math.round(arguments[0]);return this}}};f.color=function(_){if(!arguments.length)return A;else{if(typeof arguments[0]!=='function'){console.error('The arguments in map.color(color) should be function of pvisual.color');return this}else{A=arguments[0];return this}}};f.tickFormat=function(_){if(!arguments.length)return format;else{if(typeof arguments[0]!=='string'){console.error('The arguments in map.tickFormat(format) should be string of d3.format');return this}else{format=j.format(arguments[0]);return this}}};f.mapScale=function(_){if(!arguments.length)return B;else{if(!isFinite(arguments[0])){console.error('The arguments in map.mapScale(mapScale) should be number of map');return this}else{B=arguments[0];return this}}};f.extentValue=function(_){if(!arguments.length)return C;else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in map.extentValue(start, end) should be number and number of color');return this}else{C[0]=arguments[0];C[1]=arguments[1];return this}};f.gradientColor=function(_){if(!arguments.length)return D;else if(arguments.length!==2||typeof arguments[0]!=='string'||typeof arguments[1]!=='string'){console.error('The argument(element) in map.gradientColor(start, end) should be string and string of color');return this}else{D[0]=arguments[0];D[1]=arguments[1];return this}};f.stateFillColor=function(_){if(!arguments.length)return G;else{if(typeof arguments[0]!=='string'&&typeof arguments[0]!=='function'){console.error('The arguments in map.stateFillColor(stateFillColor) should be string or function of map');return this}else{G=j.functor(arguments[0]);return this}}};f.stateStrokeColor=function(_){if(!arguments.length)return H;else{if(typeof arguments[0]!=='string'&&typeof arguments[0]!=='function'){console.error('The arguments in map.stateStrokeColor(stateStrokeColor) should be string or function of map');return this}else{H=j.functor(arguments[0]);return this}}};f.activeStateColor=function(_){if(!arguments.length)return F;else{if(typeof arguments[0]!=='string'&&typeof arguments[0]!=='function'){console.error('The arguments in map.activeStateColor(activeStateColor) should be string or function of map');return this}else{F=j.functor(arguments[0]);return this}}};f.options=function(_){if(!arguments.length)return{'type':f.getType(),'width':m,'height':n,'widthAvail':widthAvail,'heightAvail':o,'tranX':q,'tranY':tranY,'format':format,'fontSize':t,'fontColor':v,'fontFamily':u,'color':A,'duration':z,'mapScale':B,'extentValue':C,'stateFillColor':G,'stateStrokeColor':H,'activeStateColor':F,'gradientColor':D};else if(typeof _!=='object'){console.error('The arguments in map.options(options) should be object');return this}else{m=isFinite(_.width)?_.width:m;n=isFinite(_.height)?_.height:n;widthAvail=isFinite(_.widthAvail)?_.widthAvail:widthAvail;o=isFinite(_.heightAvail)?_.heightAvail:o;q=isFinite(_.tranX)?_.tranX:q;tranY=isFinite(_.tranY)?_.tranY:tranY;_.format&&f.tickFormat(_.format);_.fontFamily&&f.fontFamily(_.fontFamily);_.fontColor&&f.fontColor(_.fontColor);isFinite(_.fontSize)&&f.fontSize(_.fontSize);isFinite(_.duration)&&f.duration(_.duration);isFinite(_.mapScale)&&f.mapScale(_.mapScale);typeof _.extentValue==='object'&&_.extentValue.constructor===Array&&_.extentValue.length===2&&f.extentValue(_.extentValue[0],_.extentValue[1]);typeof _.gradientColor==='object'&&_.gradientColor.constructor===Array&&_.gradientColor.length===2&&f.gradientColor(_.gradientColor[0],_.gradientColor[1]);_.stateFillColor&&f.stateFillColor(_.stateFillColor);_.stateStrokeColor&&f.stateStrokeColor(_.stateStrokeColor);_.activeStateColor&&f.activeStateColor(_.activeStateColor);return this}};if(arguments.length===1)f.options(arguments[0]);return f};bw.model.multiline=function(){var l=bw.extend();var m=_.d3;var n='多线图';var o=800;var r=400;var t=o-200;var v=r-100;var w=50;var z=0;var A;var B='Arial';var C;var D;var E;var F=1000;var G=m.format('s');var H=l.color();var I=true;var J=false;var K=null;var L='liner';var M=.7;var N;var O='';var P='';var Q=0;var R=0;var S=8;var T='#000000';var U=8;var V=5;var W=5;var X=-t;var Y=8;var Z='#929292';var bx='#929292';var by=2;var bz='#000000';var bA='#000000';var bB=13;var bC=0;var bD=0;var bE=10;var bF=100;l.data=function(_){if(arguments.length){if(_.type==='xml'){_=_.root;_=_.map(function(d){var a={};d.row.row.forEach(function(p){var k=bw.keys(p)[0];a[k]=p[k]});return a});_=XMLdata(_);var b={x:m.set()};N=_.map(function(d){b[d.name]=m.map();return{name:d.name,_flag:true}});_.forEach(function(d){d.points.forEach(function(p){p.y=+p.y;b[d.name].set(p.x,{x:p.x,y:p.y});b.x.add(p.x)})});A=bw.keys(b).filter(function(d){return d!=='x'}).map(function(d){return{name:d,points:b[d].values()}});N.x=b.x.values()}else if(_.type==='xlsx'||_.type==='xls'){var s=[];for(var i=0;i<_.length;i++){var k=bw.keys(_[i])[0];s=s.concat(_[i][k])}_=s;var b={x:m.set()};N=bw.keys(_[0]).filter(function(d){return d!=='x'}).map(function(d){b[d]=m.map();return{name:d,_flag:true}});_.forEach(function(d){N.forEach(function(p){d.x=''+d.x;b[p.name].set(d.x,{x:d.x,y:+d[p.name]});b.x.add(d.x)})});A=bw.keys(b).filter(function(d){return d!=='x'}).map(function(d){return{name:d,points:b[d].values()}});N.x=b.x.values()}else if(_.type==='tsv'||_.type==='csv'){var b={x:m.set()};N=bw.keys(_[0]).filter(function(d){return d!=='x'}).map(function(d){b[d]=m.map();return{name:d,_flag:true}});_.forEach(function(d){N.forEach(function(p){b[p.name].set(d.x,{x:d.x,y:+d[p.name]});b.x.add(d.x)})});A=bw.keys(b).filter(function(d){return d!=='x'}).map(function(d){return{name:d,points:b[d].values()}});N.x=b.x.values()}else if(_.type==='json'){var b={x:m.set()};N=_.map(function(d){b[d.name]=m.map();return{name:d.name,_flag:true}});_.forEach(function(d){d.points.forEach(function(p){p.y=+p.y;b[d.name].set(p.x,{x:p.x,y:p.y});b.x.add(p.x)})});A=bw.keys(b).filter(function(d){return d!=='x'}).map(function(d){return{name:d,points:b[d].values()}});N.x=b.x.values()}return this}else return A};l.getType=function(){return n};l.render=function(_){D=D||m.select(_).node();if(!D||D.tagName.toLowerCase()!=='div'){console.error('The argument(element) in multiline.rander(_) should be <div> element')}m.select(D).classed('chart',true);E=E||m.select(D).append('svg').classed('multiline',true).node();var c=l.clone(A).filter(function(d){var a=true;N.forEach(function(p){if(p.name===d.name)a=p._flag});return a});if(K!==null){J=true}var x;var y;var e;var f;if(J){x=m.time.scale().domain(m.extent(N.x,function(d){return K.parse(d)})).range([0,t]);c.forEach(function(d){d.points.forEach(function(p){p.x=K.parse(p.x)})});c.forEach(function(d){d.points.sort(function(a,b){return a.x.getTime()-b.x.getTime()})});e=m.svg.axis().scale(x).orient('bottom').tickSize(W).ticks(U)}else if(I){x=m.scale.linear().domain(m.extent(N.x,function(d){return+d})).range([0,t]);c.forEach(function(d){d.points.forEach(function(p){p.x=+p.x})});c.forEach(function(d){d.points.sort(function(a,b){return a.x-b.x})});e=m.svg.axis().scale(x).orient('bottom').ticks(U).tickSize(W).tickFormat(G)}else{x=m.scale.ordinal().domain(N.x,function(d){return''+d}).range([0,t]);e=m.svg.axis().scale(x).orient('bottom').tickSize(W)}y=m.scale.linear().domain([m.min(c,function(d){return m.min(d.points,function(p){return p.y})}),m.max(c,function(d){return m.max(d.points,function(p){return p.y})})]).range([v,0]);f=m.svg.axis().scale(y).orient('left').ticks(V).tickSize(X).tickFormat(G);var h=m.svg.line().interpolate(L).tension(M).x(function(d){return x(d.x)}).y(function(d){return y(d.y)});C=m.select(D).select('.floatTag').node()?m.select(D).select('.floatTag'):l.floatTag(D);var g=m.select(E).attr({'width':o,'height':r}).selectAll('g').data([1]).enter().append('svg:g').attr('transform','translate('+w+','+z+')');g.call(function(a){a.append('svg:g').classed('dimensions',true);a.append('svg:g').classed('x-axis axis',true);a.append('svg:g').classed('y-axis axis',true);a.append('svg:g').classed('legends',true)});g=m.select(E).select('g');var i=g.selectAll('.dimensions').selectAll('.dimension').data(c);i.exit().transition().duration(F).style('opacity',0).remove();dimensionUpdate(i,h,x,y);dimensionDraw(i,h,x,y,c);var j=g.select('.legends').attr('transform','translate('+bC+','+bD+')').selectAll('.legend').data(N);j.exit().transition().duration(F).style('opacity',0).remove();legendUpdate(j);legendDraw(j);axis(g,e,f)};function dimensionUpdate(b,c,x,y){b.call(function(a){a.select('.line').transition().duration(F).attr('d',function(d){return c(d.points)}).style('stroke',function(d){return H(d.name)})})}function dimensionDraw(b,c,x,y,e){b.enter().append('svg:g').classed('dimension',true).call(function(a){a.append('svg:path').classed('line',true).attr('d',function(d){return c(d.points)}).style('fill','none').style('stroke',function(d){return H(d.name)}).style('opacity',0).transition().duration(F).style('opacity',1)})}function legendDraw(a){a.enter().append('svg:g').classed('legend',true).style('cursor','pointer').on('click',function(d){if(!m.select(this).classed('none')){if(N.length>1){m.select(this).classed('none',true);d._flag=false;l.render()}}else{m.select(this).classed('none',false);d._flag=true;l.render()}}).each(function(d,i){m.select(this).append('svg:rect').attr({'x':(i-i%bE)/bE*bF+t+20,'y':i%bE*20+9}).attr({'width':10,'height':10}).style({'fill':H(i),'stroke':H(i)}).style('fill-opacity',d._flag?1:0).style('opacity',0).transition().duration(F).style('opacity',1);m.select(this).append('svg:text').attr({'x':(i-i%bE)/bE*bF+t+40,'y':i%bE*20+19}).style({'opacity':0,'font-size':bB,'fill':bA,'font-family':B}).transition().duration(F).style('opacity',1).text(d.name)})}function legendUpdate(a){a.each(function(d,i){m.select(this).selectAll('rect').transition().duration(F).style({'fill':H(i),'stroke':H(i)}).style('fill-opacity',d._flag?1:0).attr({'x':(i-i%bE)/bE*bF+t+20,'y':i%bE*20+9});m.select(this).selectAll('text').transition().duration(F).attr({'x':(i-i%bE)/bE*bF+t+40,'y':i%bE*20+19}).style({'font-size':bB,'fill':bA,'font-family':B}).text(d.name)})}function axis(g,b,c){g.select('.x-axis').each(function(){m.select(this).select('.label').transition().duration(F).attr({'x':t,'y':-6}).style({'text-anchor':'end','font-family':B,'font-size':S,'fill':T}).text(P);m.select(this).selectAll('.label').data([1]).enter().append('svg:text').classed('label',true).style({'text-anchor':'end','font-family':B,'font-size':S,'fill':T}).attr({'x':t,'y':-6}).text(P);m.select(this).transition().duration(F).attr('transform','translate(0,'+v+')').call(b)});g.select('.y-axis').each(function(){m.select(this).select('.label').style({'text-anchor':'end','font-family':B,'font-size':S,'fill':T}).text(O);m.select(this).selectAll('.label').data([1]).enter().append('svg:text').classed('label',true).style({'text-anchor':'end','font-family':B,'font-size':S,'fill':T}).attr({'transform':'rotate(-90)','y':8,'dy':'.71em'}).text(O);m.select(this).transition().duration(F).call(c)});g.selectAll('.axis').call(function(a){a.selectAll('path').style({'fill':'none','stroke':bz,'stroke-width':by,'shape-rendering':'crispEdges'});a.selectAll('line').style({'fill':'none','stroke-dasharray':'3,1','stroke':bx,'shape-rendering':'crispEdges'})});g.select('.x-axis').selectAll('.tick').select('text').style({'text-anchor':'middle','font-family':B,'font-size':Y,'fill':Z}).attr('transform',function(){return'translate('+this.getComputedTextLength()*Math.abs(Math.sin(Q)*.5)+','+(this.getComputedTextLength()*(.3*Math.abs(Math.sin(Q))))+')rotate('+Q+')'});g.select('.y-axis').selectAll('.tick').select('text').style({'text-anchor':'start','font-family':B,'font-size':Y,'fill':Z}).attr('transform',function(){return'translate('+ -this.getComputedTextLength()+', 0)rotate('+R+')'})}function XMLdata(d){var u;if(typeof d==='object'&&d.constructor===Array){u=d.map(function(p){var a=p.points.points.map(function(k){var x;var y;k.point.point.forEach(function(q){if(q.x!==undefined)x=q.x;if(q.y!==undefined)y=q.y});return{x:''+x,y:y}});return{name:p.name,points:a}})}return u}l.size=function(_){if(!arguments.length)return[o,r];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in multiline.size(width, height) should be number and number of svg');return this}else{o=arguments[0];r=arguments[1];return this}};l.sizeAvail=function(_){if(!arguments.length)return[t,v];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in multiline.sizeAvail(widthAvail, heightAvail) should be number and number of svg');return this}else{t=arguments[0];v=arguments[1];return this}};l.tran=function(_){if(!arguments.length)return[w,z];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in multiline.tran(tranX, tranY) should be number and number of svg');return this}else{w=arguments[0];z=arguments[1];return this}};l.fontSize=function(_){if(!arguments.length)return fontSize;else{if(!isFinite(arguments[0])){console.error('The arguments in multiline.fontSize(fontSize) should be number of text');return this}else{fontSize=arguments[0];return this}}};l.fontFamily=function(_){if(!arguments.length)return B;else{if(typeof arguments[0]!=='string'){console.error('The arguments in multiline.fontFamily(fontFamily) should be string of text');return this}else{fontSize=arguments[0];return this}}};l.duration=function(_){if(!arguments.length)return F;else{if(!isFinite(arguments[0])){console.error('The arguments in multiline.duration(duration) should be number of transition');return this}else{F=Math.round(arguments[0]);return this}}};l.color=function(_){if(!arguments.length)return H;else{if(typeof arguments[0]!=='function'){console.error('The arguments in multiline.color(color) should be function of pvisual.color');return this}else{H=arguments[0];return this}}};l.tickFormat=function(_){if(!arguments.length)return G;else{if(typeof arguments[0]!=='string'){console.error('The arguments in multiline.tickFormat(format) should be string of d3.format');return this}else{G=m.format(arguments[0]);return this}}};l.timeFormat=function(_){if(!arguments.length)return K;else{if(typeof arguments[0]!=='string'){console.error('The arguments in multiline.timeFormat(format) should be string of d3.format');return this}else{K=m.time.format(arguments[0]);return this}}};l.isLinear=function(_){if(!arguments.length)return I;else{if(I!==true&&I!==false){console.error('The arguments in multiline.isLinear(isLinear) should be bool');return this}else{I=arguments[0];return this}}};l.xLegend=function(_){if(!arguments.length)return P;else{if(typeof arguments[0]!=='string'){console.error('The arguments in multiline.xLegend(xLegend) should be string');return this}else{P=arguments[0];return this}}};l.yLegend=function(_){if(!arguments.length)return O;else{if(typeof arguments[0]!=='string'){console.error('The arguments in multiline.yLegend(yLegend) should be string');return this}else{O=arguments[0];return this}}};l.xtickRotate=function(_){if(!arguments.length)return Q;else{if(!isFinite(arguments[0])){console.error('The arguments in multiline.xtickRotate(xtickRotate) should be number of tick');return this}else{Q=Math.round(arguments[0]);return this}}};l.ytickRotate=function(_){if(!arguments.length)return R;else{if(!isFinite(arguments[0])){console.error('The arguments in multiline.ytickRotate(ytickRotate) should be number of tick');return this}else{R=Math.round(arguments[0]);return this}}};l.labelSize=function(_){if(!arguments.length)return S;else{if(!isFinite(arguments[0])){console.error('The arguments in multiline.labelSize(labelSize) should be string');return this}else{S=arguments[0];return this}}};l.labelColor=function(_){if(!arguments.length)return T;else{if(typeof arguments[0]!=='string'){console.error('The arguments in multiline.labelColor(labelColor) should be string');return this}else{T=arguments[0];return this}}};l.tickLineColor=function(_){if(!arguments.length)return bx;else{if(typeof arguments[0]!=='string'){console.error('The arguments in multiline.tickLineColor(tickLineColor) should be string');return this}else{bx=arguments[0];return this}}};l.tickTextSize=function(_){if(!arguments.length)return Y;else{if(!isFinite(arguments[0])){console.error('The arguments in multiline.tickTextSize(tickTextSize) should be number');return this}else{Y=arguments[0];return this}}};l.tickTextColor=function(_){if(!arguments.length)return Z;else{if(typeof arguments[0]!=='string'){console.error('The arguments in multiline.tickTextColor(tickTextColor) should be string');return this}else{Z=arguments[0];return this}}};l.xtickNumber=function(_){if(!arguments.length)return U;else{if(!isFinite(arguments[0])){console.error('The arguments in multiline.xtickNumber(xtickNumber) should be number of tick');return this}else{U=Math.round(arguments[0]);return this}}};l.ytickNumber=function(_){if(!arguments.length)return V;else{if(!isFinite(arguments[0])){console.error('The arguments in multiline.ytickNumber(ytickNumber) should be number of tick');return this}else{V=Math.round(arguments[0]);return this}}};l.axisPathWidth=function(_){if(!arguments.length)return by;else{if(!isFinite(arguments[0])){console.error('The arguments in multiline.axisPathWidth(axisPathWidth) should be string');return this}else{by=arguments[0];return this}}};l.axisPathColor=function(_){if(!arguments.length)return bz;else{if(typeof arguments[0]!=='string'){console.error('The arguments in multiline.axisPathColor(axisPathColor) should be string');return this}else{bz=arguments[0];return this}}};l.legendTran=function(_){if(!arguments.length)return[bC,bD];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in multiline.legendTran(tranX, tranY) should be number and number of svg');return this}else{bC=arguments[0];bD=arguments[1];return this}};l.legendSize=function(_){if(!arguments.length)return bB;else{if(!isFinite(arguments[0])){console.error('The arguments in multiline.legendSize(legendSize) should be number of text');return this}else{bB=arguments[0];return this}}};l.legendColor=function(_){if(!arguments.length)return bA;else{if(typeof arguments[0]!=='string'){console.error('The arguments in multiline.legendColor(legendColor) should be string of text');return this}else{bA=arguments[0];return this}}};l.legendColumnNo=function(_){if(!arguments.length)return bE;else{if(!isFinite(arguments[0])){console.error('The arguments in multiline.legendColumnNo(legendColumnNo) should be number of text');return this}else{bE=arguments[0];return this}}};l.legendRowGap=function(_){if(!arguments.length)return bF;else{if(!isFinite(arguments[0])){console.error('The arguments in multiline.legendRowGap(legendRowGap) should be number of text');return this}else{bF=arguments[0];return this}}};l.tension=function(_){if(!arguments.length)return M;else{if(!isFinite(arguments[0])){console.error('The arguments in multiline.tension(tension) should be number');return this}else{M=arguments[0];return this}}};l.interpolate=function(_){if(!arguments.length)return L;else{if(typeof arguments[0]!=='string'){console.error('The arguments in multiline.interpolate(interpolate) should be string');return this}else{L=arguments[0];return this}}};l.options=function(_){if(!arguments.length)return{'type':l.getType(),'width':o,'height':r,'widthAvail':t,'heightAvail':v,'tranX':w,'tranY':z,'format':G,'fontFamily':B,'color':H,'duration':F,'interpolate':L,'tension':M,'timeFormat':K,'isLinear':I,'xLegend':P,'yLegend':O,'xtickRotate':Q,'ytickRotate':R,'labelSize':S,'labelColor':T,'xtickNumber':U,'ytickNumber':V,'tickTextSize':Y,'tickTextColor':Z,'tickLineColor':bx,'xtickLineLength':W,'ytickLineLength':X,'axisPathWidth':by,'axisPathColor':bz,'legendColor':bA,'legendSize':bB,'legendTranX':bC,'legendTranY':bD,'legendColumnNo':bE,'legendRowGap':bF};else if(typeof _!=='object'){console.error('The arguments in map.options(options) should be object');return this}else{o=isFinite(_.width)?_.width:o;r=isFinite(_.height)?_.height:r;t=isFinite(_.widthAvail)?_.widthAvail:t;v=isFinite(_.heightAvail)?_.heightAvail:v;w=isFinite(_.tranX)?_.tranX:w;z=isFinite(_.tranY)?_.tranY:z;_.format&&l.tickFormat(_.format);_.fontFamily&&l.fontFamily(_.fontFamily);isFinite(_.duration)&&l.duration(_.duration);isFinite(_.tension)&&l.tension(_.tension);_.isLinear&&l.isLinear(_.isLinear);_.interpolate&&l.interpolate(_.interpolate);_.xLegend&&l.xLegend(_.xLegend);_.yLegend&&l.yLegend(_.yLegend);isFinite(_.xtickRotate)&&l.xtickRotate(_.xtickRotate);isFinite(_.ytickRotate)&&l.ytickRotate(_.ytickRotate);isFinite(_.labelSize)&&l.labelSize(_.labelSize);_.labelColor&&l.labelColor(_.labelColor);isFinite(_.xtickNumber)&&l.xtickNumber(_.xtickNumber);isFinite(_.ytickNumber)&&l.ytickNumber(_.ytickNumber);isFinite(_.tickTextSize)&&l.tickTextSize(_.tickTextSize);_.tickTextColor&&l.tickTextColor(_.tickTextColor);_.tickLineColor&&l.tickLineColor(_.tickLineColor);isFinite(_.xtickLineLength)&&l.xtickLineLength(_.xtickLineLength);isFinite(_.ytickLineLength)&&l.ytickLineLength(_.ytickLineLength);isFinite(_.axisPathWidth)&&l.axisPathWidth(_.axisPathWidth);_.axisPathColor&&l.axisPathColor(_.axisPathColor);_.legendColor&&l.legendColor(_.legendColor);isFinite(_.legendSize)&&l.legendSize(_.legendSize);bC=isFinite(_.legendTranX)?_.legendTranX:bC;bD=isFinite(_.legendTranY)?_.legendTranY:bD;isFinite(_.legendColumnNo)&&l.legendColumnNo(_.legendColumnNo);isFinite(_.legendRowGap)&&l.legendRowGap(_.legendRowGap);return this}};if(arguments.length===1)l.options(arguments[0]);return l};bw.model.parallel=function(){var l=bw.extend();var m=_.d3;var n='平行坐标系';var o=800;var q=o-10;var r=height-20;var t=10;var u=10;var v;var w=8;var z='Arial';var A='#000000';var B;var C;var D;var E=1000;var F=m.format('s');var G=l.color();var H;var I=function(d,i){return G(d.name)};var J=function(d,i){return 1};var K=function(d,i){return'#EEEEEE'};var L=0;var M=5;var N=5;var O=8;var P='#929292';var Q='#929292';var R=2;var S='#000000';l.data=function(_){if(arguments.length){if(_.type==='xml'){_=_.root;_=_.map(function(d){var a={};d.row.row.forEach(function(p){var k=bw.keys(p)[0];a[k]=p[k]});return a})}else if(_.type==='xlsx'||_.type==='xls'){var s=[];for(var i=0;i<_.length;i++){var k=bw.keys(_[i])[0];s=s.concat(_[i][k])}_=s}H=bw.keys(_[0]).filter(function(d){return d!=='name'});H.x=m.set(_.map(function(d){return d.name}));H.x=H.x.values();v=_;return this}else return v};l.getType=function(){return n};l.render=function(_){C=C||m.select(_).node();if(!C||C.tagName.toLowerCase()!=='div'){console.error('The argument(element) in parallel.rander(_) should be <div> element')}m.select(C).classed('chart',true);D=D||m.select(C).append('svg').classed('parallel',true).node();var x=m.scale.ordinal().rangePoints([0,q],1).domain(H);var y={};var h=m.svg.line();H.forEach(function(d){y[d]=m.scale.linear().domain(m.extent(v,function(p){return+p[d]})).range([r,0])});H.forEach(function(d){y[d].brush=m.svg.brush().y(y[d]).on('brush',brush);y[d].yAxis=m.svg.axis().orient('left').scale(y[d]).ticks(M).tickSize(N).tickFormat(F)});B=m.select(C).select('.floatTag').node()?m.select(C).select('.floatTag'):l.floatTag(C);var g=m.select(D).attr({'width':o,'height':height}).selectAll('g').data([1]).enter().append('svg:g').attr('transform','translate('+t+','+u+')');g.call(function(a){a.append('svg:g').classed('dimensions',true);a.append('svg:g').classed('y-axis axis',true)});g=m.select(D).select('g');var j=g.select('.dimensions').style({'fill':'none','stroke-opacity':'0.2','shape-rendering':'crispEdges'}).selectAll('path').data(v);j.exit().transition().duration(E).style('opacity',0).remove();j.transition().duration(E).style('stroke',I).style('stroke-width',J).attr('d',path);j.enter().append('svg:path').style('stroke',I).style('stroke-width',J).attr('d',path);axis(g,x,y);function path(d){return h(H.map(function(p){return[x(p),y[p](+d[p])]}))}function brush(){var b=H.filter(function(p){return!y[p].brush.empty()});var c=b.map(function(p){return y[p].brush.extent()});var e=[];b.forEach(function(d,i){e[i]={dimension:d,extent:c[i]}});var f=[];m.select(D).select('.dimensions').selectAll('path').style('stroke',function(d){var a=b.every(function(p,i){return c[i][0]<=d[p]&&d[p]<=c[i][1]});if(a)f.push(d);return a?I(d):K(d)})}};function b(g,x,y){var b=g.select('.y-axis').selectAll('.y').data(H);b.exit().transition().duration(E).style('opacity',0).remove();b.transition().duration(E).attr('transform',function(d){return'translate('+x(d)+',0)'}).each(function(d){m.select(this).call(y[d].yAxis).select('.brush').call(y[d].brush)});b.enter().append('svg:g').classed('y',true).attr('transform',function(d){return'translate('+x(d)+',0)'}).each(function(d){m.select(this).call(y[d].yAxis).append('svg:g').classed('brush',true).call(y[d].brush).selectAll('rect').attr('x',-8).attr('width',16).style({'fill-opacity':0.3,'stroke':'#FFFFFF','shape-rendering':'crispEdges'})});g.select('.y-axis').selectAll('.y').each(function(d){m.select(this).select('.label').style({'text-anchor':'end','font-family':z,'font-size':w,'fill':A}).text(d);m.select(this).selectAll('.label').data([1]).enter().append('svg:text').classed('label',true).style({'text-anchor':'end','font-family':z,'font-size':w,'fill':A}).attr({'transform':'rotate(-90)','y':8,'dy':'.71em'}).text(d)});g.selectAll('.axis').call(function(a){a.selectAll('path').style({'fill':'none','stroke':S,'stroke-width':R,'shape-rendering':'crispEdges'});a.selectAll('line').style({'fill':'none','stroke':Q,'shape-rendering':'crispEdges'})});g.select('.y-axis').selectAll('.tick').select('text').style({'text-anchor':'start','font-family':z,'font-size':O,'fill':P}).attr('transform',function(){return'translate('+ -this.getComputedTextLength()+', 0)rotate('+L+')'})}l.size=function(_){if(!arguments.length)return[o,height];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in parallel.size(width, height) should be number and number of svg');return this}else{o=arguments[0];height=arguments[1];return this}};l.sizeAvail=function(_){if(!arguments.length)return[q,r];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in parallel.sizeAvail(widthAvail, heightAvail) should be number and number of svg');return this}else{q=arguments[0];r=arguments[1];return this}};l.tran=function(_){if(!arguments.length)return[t,u];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in parallel.tran(tranX, tranY) should be number and number of svg');return this}else{t=arguments[0];u=arguments[1];return this}};l.fontSize=function(_){if(!arguments.length)return w;else{if(!isFinite(arguments[0])){console.error('The arguments in parallel.fontSize(fontSize) should be number of text');return this}else{w=arguments[0];return this}}};l.fontFamily=function(_){if(!arguments.length)return z;else{if(typeof arguments[0]!=='string'){console.error('The arguments in parallel.fontFamily(fontFamily) should be string of text');return this}else{w=arguments[0];return this}}};l.fontColor=function(_){if(!arguments.length)return A;else{if(typeof arguments[0]!=='string'){console.error('The arguments in parallel.fontColor(fontColor) should be string of text');return this}else{A=arguments[0];return this}}};l.duration=function(_){if(!arguments.length)return E;else{if(!isFinite(arguments[0])){console.error('The arguments in parallel.duration(duration) should be number of transition');return this}else{E=Math.round(arguments[0]);return this}}};l.color=function(_){if(!arguments.length)return G;else{if(typeof arguments[0]!=='function'){console.error('The arguments in parallel.color(color) should be function of pvisual.color');return this}else{G=arguments[0];return this}}};l.tickFormat=function(_){if(!arguments.length)return F;else{if(typeof arguments[0]!=='string'){console.error('The arguments in parallel.tickFormat(format) should be string of d3.format');return this}else{F=m.format(arguments[0]);return this}}};l.ytickRotate=function(_){if(!arguments.length)return L;else{if(!isFinite(arguments[0])){console.error('The arguments in parallel.ytickRotate(ytickRotate) should be number of tick');return this}else{L=Math.round(arguments[0]);return this}}};l.ytickNumber=function(_){if(!arguments.length)return M;else{if(!isFinite(arguments[0])){console.error('The arguments in parallel.ytickNumber(ytickNumber) should be number of tick');return this}else{M=Math.round(arguments[0]);return this}}};l.tickLineColor=function(_){if(!arguments.length)return Q;else{if(typeof arguments[0]!=='string'){console.error('The arguments in parallel.tickLineColor(tickLineColor) should be string');return this}else{Q=arguments[0];return this}}};l.tickTextSize=function(_){if(!arguments.length)return O;else{if(!isFinite(arguments[0])){console.error('The arguments in parallel.tickTextSize(tickTextSize) should be number');return this}else{O=arguments[0];return this}}};l.tickTextColor=function(_){if(!arguments.length)return P;else{if(typeof arguments[0]!=='string'){console.error('The arguments in parallel.tickTextColor(tickTextColor) should be string');return this}else{P=arguments[0];return this}}};l.axisPathWidth=function(_){if(!arguments.length)return R;else{if(!isFinite(arguments[0])){console.error('The arguments in parallel.axisPathWidth(axisPathWidth) should be string');return this}else{R=arguments[0];return this}}};l.axisPathColor=function(_){if(!arguments.length)return S;else{if(typeof arguments[0]!=='string'){console.error('The arguments in parallel.axisPathColor(axisPathColor) should be string');return this}else{S=arguments[0];return this}}};l.lineColor=function(_){if(!arguments.length)return I;else{if(typeof arguments[0]!=='function'&&typeof arguments[0]!=='string'){console.error('The arguments in parallel.lineColor(lineColor) should be function or string');return this}else{I=m.functor(arguments[0]);return this}}};l.backColor=function(_){if(!arguments.length)return K;else{if(typeof arguments[0]!=='function'&&typeof arguments[0]!=='string'){console.error('The arguments in parallel.backColor(backColor) should be function or string');return this}else{K=m.functor(arguments[0]);return this}}};l.lineWidth=function(_){if(!arguments.length)return J;else{if(typeof arguments[0]!=='function'&&!isFinite(arguments[0])){console.error('The arguments in parallel.lineWidth(lineWidth) should be function or number');return this}else{J=m.functor(arguments[0]);return this}}};l.options=function(_){if(!arguments.length)return{'type':l.getType(),'width':o,'height':height,'widthAvail':q,'heightAvail':r,'tranX':t,'tranY':u,'format':F,'fontSize':w,'fontColor':A,'fontFamily':z,'color':G,'duration':E,'lineColor':I,'lineWidth':J,'backColor':K,'ytickRotate':L,'ytickNumber':M,'tickTextSize':O,'tickTextColor':P,'tickLineColor':Q,'ytickLineLength':N,'axisPathWidth':R,'axisPathColor':S};else if(typeof _!=='object'){console.error('The arguments in map.options(options) should be object');return this}else{o=isFinite(_.width)?_.width:o;height=isFinite(_.height)?_.height:height;q=isFinite(_.widthAvail)?_.widthAvail:q;r=isFinite(_.heightAvail)?_.heightAvail:r;t=isFinite(_.tranX)?_.tranX:t;u=isFinite(_.tranY)?_.tranY:u;_.format&&l.tickFormat(_.format);_.fontFamily&&l.fontFamily(_.fontFamily);_.fontColor&&l.fontColor(_.fontColor);isFinite(_.fontSize)&&l.fontSize(_.fontSize);isFinite(_.duration)&&l.duration(_.duration);_.lineColor&&l.lineColor(_.lineColor);_.lineWidth&&l.lineWidth(_.lineWidth);_.backColor&&l.backColor(_.backColor);isFinite(_.tickTextSize)&&l.tickTextSize(_.tickTextSize);_.tickTextColor&&l.tickTextColor(_.tickTextColor);_.tickLineColor&&l.tickLineColor(_.tickLineColor);isFinite(_.ytickRotate)&&l.ytickRotate(_.ytickRotate);isFinite(_.ytickNumber)&&l.ytickNumber(_.ytickNumber);isFinite(_.ytickLineLength)&&l.ytickLineLength(_.ytickLineLength);isFinite(_.axisPathWidth)&&l.axisPathWidth(_.axisPathWidth);_.axisPathColor&&l.axisPathColor(_.axisPathColor);return this}};if(arguments.length===1)l.options(arguments[0]);return l};bw.model.pie=function(){var l=bw.extend();var m=_.d3;var n='饼图';var o=900;var r=700;var u=o;var v=r;var w=0;var x=0;var y;var z=10;var A='Arial';var B='#000';var C;var D;var E;var F=1000;var G=m.format('s');var H=l.color();var I='bounce';var J=0;var K=Math.min(u,v)*.42;var L='#000000';var M=13;var N=0;var O=0;var P=10;var Q=100;l.data=function(_){if(arguments.length){if(_.type==='xml'){_=_.root;_=_.map(function(d){var a={};d.row.row.forEach(function(p){var k=bw.keys(p)[0];a[k]=p[k]});return a})}else if(_.type==='xlsx'||_.type==='xls'){var s=[];for(var i=0;i<_.length;i++){var k=bw.keys(_[i])[0];s=s.concat(_[i][k])}_=s}y=_.map(function(a,b){return{index:b,value:+a.value,data:+a.value,name:a.name,_flag:true}});return this}else return y};l.getType=function(){return n};l.render=function(_){D=D||m.select(_).node();if(!D||D.tagName.toLowerCase()!=='div'){l.log({priority:'Error',position:'pie',info:'The argument(element) in pie.rander(_) should be <div> element'});console.error('The argument(element) in pie.rander(_) should be <div> element')}m.select(D).classed('chart',true);E=E||m.select(D).append('svg').classed('pie',true).node();C=m.select(D).select('.floatTag').node()?m.select(D).select('.floatTag'):l.floatTag(D);var c=m.layout.pie().value(function(d){return d.value}).sort(function(a,b){return b.value-a.value});var e=m.svg.arc().innerRadius(J).outerRadius(K);var g=m.select(E).attr({'width':o,'height':r}).selectAll('g').data([1]).enter().append('svg:g').attr('transform','translate('+(w+K*1.2)+','+(x+K*1.2)+')');g.call(function(a){a.append('svg:g').classed('arcs',true);a.append('svg:g').classed('labels',true);a.append('svg:g').classed('legends',true)});g=m.select(E).select('g');var f=g.select('.arcs').datum(y.filter(function(d){return d._flag})).selectAll('path').data(c);f.exit().attr('opacity',1).transition().duration(F).attr('opacity',0).remove();arcUpdate(f,e);arcDraw(f,g,e);var h=g.select('.labels').datum(y.filter(function(d){return d._flag})).selectAll('.label').data(c);h.exit().attr('opacity',1).transition().duration(F).attr('opacity',0).remove();labelUpdate(h);labelDraw(h);var i=g.select('.legends').attr('transform','translate('+N+','+O+')').selectAll('.legend').data(y);i.exit().transition().duration(F).style('opacity',0).remove();legendUpdate(i);legendDraw(i)};function arcUpdate(a,b){a.transition().duration(F).attrTween('d',function(d){var q=m.interpolate(+m.select(this).attr('data-startAngle'),d.startAngle);var p=m.interpolate(+m.select(this).attr('data-endAngle'),d.endAngle);return function(t){return b({startAngle:p(t),endAngle:q(t)})}}).attr('fill',function(d){return H(d.data.index)}).attr('data-startAngle',function(d){return d.startAngle}).attr('data-endAngle',function(d){return d.endAngle})}function arcDraw(i,g,j){i.enter().append('svg:path').attr('fill',function(d){return H(d.data.index)}).attr('opacity',0).on('mouseover',function(d){drawLegend(d.data,true)}).on('mouseout',function(d){drawLegend(d.data,false)}).on('click',function(d){var a=this;var b=g.select('.labels').selectAll('.label');var c=g.select('.arcs').selectAll('path');if(!m.select(this).classed('out')){m.select(this).classed('out',true);var e=0.5*((d.startAngle+d.endAngle)-Math.PI);var f={x:K*0.1*Math.cos(e),y:K*0.1*Math.sin(e)};b.each(function(p){if(p.data.index===d.data.index)m.select(this).transition().duration(F/2).ease(I).attr('transform','rotate('+((d.endAngle+d.startAngle)*90/Math.PI-87)+')'+'translate('+K*1.2+',0)')});m.select(this).transition().duration(F/2).ease(I).attr('opacity',1).attr('transform','translate('+(f.x)+', '+(f.y)+')');c.filter(function(){return this!==a}).transition().duration(F/2).attr('opacity',function(){return m.select(this).classed('out')?1:.3})}else{m.select(this).classed('out',false);b.each(function(p){if(p.data.index===d.data.index)m.select(this).transition().duration(F/2).ease(I).attr('transform','rotate('+((d.endAngle+d.startAngle)*90/Math.PI-87)+')'+'translate('+K+',0)')});var h=g.select('.arcs').selectAll('.out').node()?true:false;m.select(this).transition().duration(F/2).ease(I).attr('transform','').attr('opacity',h?.3:1);c.filter(function(){return this!==a}).transition().duration(F/2).attr('opacity',function(){return!h?1:m.select(this).classed('out')?1:.3})}}).transition().duration(F).attrTween('d',function(d){var q=m.interpolate(d.startAngle,d.endAngle);return function(t){return j({startAngle:d.startAngle,endAngle:q(t)})}}).attr('opacity',1).attr('data-startAngle',function(d){return d.startAngle}).attr('data-endAngle',function(d){return d.endAngle})}function labelUpdate(a){a.transition().duration(F).attrTween('transform',function(d){var q=m.interpolate(+m.select(this).attr('data-Angle'),d.endAngle+d.startAngle);return function(t){return'rotate('+(q(t)*90/Math.PI-87)+')'+'translate('+K+',0)'}}).attr('data-Angle',function(d){return d.endAngle+d.startAngle}).select('text').style('text-anchor',function(d){return(d.endAngle+d.startAngle)/2>Math.PI?'end':null}).attr('transform',function(d){return(d.endAngle+d.startAngle)/2>Math.PI?'rotate(180)translate(-16)':null}).style({'font-family':A,'fill':B,'font-size':z}).text(function(d){return d.endAngle-d.startAngle>.03?d.data.name:'...'})}function labelDraw(a){a.enter().append('svg:g').classed('label',true).style({'font-family':A,'fill':B,'font-size':z}).attr('transform',function(d){return'rotate('+((d.endAngle+d.startAngle)*90/Math.PI-87)+')'+'translate('+K+',0)'}).attr('data-Angle',function(d){return d.endAngle+d.startAngle}).append('svg:text').attr('opacity',0).style('text-anchor',function(d){return(d.endAngle+d.startAngle)/2>Math.PI?'end':null}).attr('transform',function(d){return(d.endAngle+d.startAngle)/2>Math.PI?'rotate(180)translate(-16)':null}).transition().duration(F).ease('exp').attr({'x':8,'dy':20}).style('opacity',1).text(function(d){return d.endAngle-d.startAngle>.03?d.data.name:'...'})}function legendUpdate(a){a.each(function(d){m.select(this).select('rect').transition().duration(F).style('fill-opacity',d._flag?1:0).attr({'x':(d.index-d.index%P)/P*Q+K,'y':d.index%P*20-K*1.1-9}).style({'fill':H(d.index),'stroke':H(d.index)});m.select(this).select('text').transition().duration(F).attr({'x':(d.index-d.index%P)/P*Q+K+20,'y':d.index%P*20-K*1.1}).style({'font-size':M,'fill':L,'font-family':A}).text(d.name)})}function legendDraw(a){a.enter().append('svg:g').classed('legend',true).style('cursor','pointer').on('click',function(d){if(!m.select(this).classed('none')){m.select(this).classed('none',true);d._flag=false}else{m.select(this).classed('none',false);d._flag=true}l.render(y)}).each(function(d){m.select(this).append('svg:rect').attr({'x':(d.index-d.index%P)/P*Q+K,'y':d.index%P*20-K*1.1-9}).attr({'width':10,'height':10}).style({'fill':H(d.index),'stroke':H(d.index)}).style('fill-opacity',1).style('opacity',0).transition().duration(F).style('fill-opacity',d._flag?1:0).style('opacity',1);m.select(this).append('svg:text').attr({'x':(d.index-d.index%P)/P*Q+K+20,'y':d.index%P*20-K*1.1}).style({'opacity':0,'font-size':M,'fill':L,'font-family':A}).transition().duration(F).style('opacity',1).text(d.name)})}function drawLegend(d,a){if(a){C.style({'border-color':H(d.name),'opacity':1,'textAlign':'center','margin':'auto'}).html('<p style="color:#3f7ed8; font-weight:bold; font-size:11px;margin-bottom:5px;">name: '+d.name+'</p>value: '+G(d.value))}else{C.style('opacity',0)}}l.size=function(_){if(!arguments.length)return[o,r];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in pie.size(width, height) should be number and number of svg');return this}else{o=arguments[0];r=arguments[1];return this}};l.sizeAvail=function(_){if(!arguments.length)return[u,v];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in pie.sizeAvail(widthAvail, heightAvail) should be number and number of svg');return this}else{u=arguments[0];v=arguments[1];return this}};l.tran=function(_){if(!arguments.length)return[w,x];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in pie.tran(tranX, tranY) should be number and number of svg');return this}else{w=arguments[0];x=arguments[1];return this}};l.fontSize=function(_){if(!arguments.length)return z;else{if(!isFinite(arguments[0])){console.error('The arguments in pie.fontSize(fontSize) should be number of text');return this}else{z=arguments[0];return this}}};l.fontFamily=function(_){if(!arguments.length)return A;else{if(typeof arguments[0]!=='string'){console.error('The arguments in pie.fontFamily(fontFamily) should be string of text');return this}else{z=arguments[0];return this}}};l.fontColor=function(_){if(!arguments.length)return B;else{if(typeof arguments[0]!=='string'){console.error('The arguments in pie.fontColor(fontColor) should be string of text');return this}else{B=arguments[0];return this}}};l.duration=function(_){if(!arguments.length)return F;else{if(!isFinite(arguments[0])){console.error('The arguments in pie.duration(duration) should be number of transition');return this}else{F=Math.round(arguments[0]);return this}}};l.color=function(_){if(!arguments.length)return H;else{if(typeof arguments[0]!=='function'){console.error('The arguments in pie.color(color) should be function of pvisual.color');return this}else{H=arguments[0];return this}}};l.tickFormat=function(_){if(!arguments.length)return G;else{if(typeof arguments[0]!=='string'){console.error('The arguments in pie.tickFormat(format) should be string of d3.format');return this}else{G=m.format(arguments[0]);return this}}};l.legendTran=function(_){if(!arguments.length)return[N,O];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in pie.legendTran(tranX, tranY) should be number and number of svg');return this}else{N=arguments[0];O=arguments[1];return this}};l.legendSize=function(_){if(!arguments.length)return M;else{if(!isFinite(arguments[0])){console.error('The arguments in pie.legendSize(legendSize) should be number of text');return this}else{M=arguments[0];return this}}};l.legendColor=function(_){if(!arguments.length)return L;else{if(typeof arguments[0]!=='string'){console.error('The arguments in pie.legendColor(legendColor) should be string of text');return this}else{L=arguments[0];return this}}};l.legendColumnNo=function(_){if(!arguments.length)return P;else{if(!isFinite(arguments[0])){console.error('The arguments in pie.legendColumnNo(legendColumnNo) should be number of text');return this}else{P=arguments[0];return this}}};l.ease=function(_){if(!arguments.length)return I;else{if(typeof arguments[0]!=='string'){console.error('The arguments in pie.ease(ease) should be string');return this}else{I=arguments[0];return this}}};l.outerRadius=function(_){if(!arguments.length)return K;else{if(!isFinite(arguments[0])){console.error('The arguments in pie.outerRadius(outerRadius) should be number of');return this}else{K=Math.round(arguments[0]);return this}}};l.innerRadius=function(_){if(!arguments.length)return J;else{if(!isFinite(arguments[0])){console.error('The arguments in pie.innerRadius(innerRadius) should be number');return this}else{J=Math.round(arguments[0]);return this}}};l.options=function(_){if(!arguments.length)return{'type':l.getType(),'width':o,'height':r,'widthAvail':u,'heightAvail':v,'tranX':w,'tranY':x,'format':G,'fontSize':z,'fontColor':B,'fontFamily':A,'color':H,'duration':F,'outerRadius':K,'innerRadius':J,'ease':I,'legendColor':L,'legendSize':M,'legendTranX':N,'legendTranY':O,'legendColumnNo':P,'legendRowGap':Q};else if(typeof _!=='object'){console.error('The arguments in map.options(options) should be object');return this}else{o=isFinite(_.width)?_.width:o;r=isFinite(_.height)?_.height:r;u=isFinite(_.widthAvail)?_.widthAvail:u;v=isFinite(_.heightAvail)?_.heightAvail:v;w=isFinite(_.tranX)?_.tranX:w;x=isFinite(_.tranY)?_.tranY:x;_.format&&l.tickFormat(_.format);_.fontFamily&&l.fontFamily(_.fontFamily);_.fontColor&&l.fontColor(_.fontColor);isFinite(_.fontSize)&&l.fontSize(_.fontSize);isFinite(_.duration)&&l.duration(_.duration);_.ease&&l.ease(_.ease);isFinite(_.innerRadius)&&l.innerRadius(_.innerRadius);isFinite(_.outerRadius)&&l.outerRadius(_.outerRadius);_.legendColor&&l.legendColor(_.legendColor);isFinite(_.legendSize)&&l.legendSize(_.legendSize);N=isFinite(_.legendTranX)?_.legendTranX:N;O=isFinite(_.legendTranY)?_.legendTranY:O;isFinite(_.legendColumnNo)&&l.legendColumnNo(_.legendColumnNo);isFinite(_.legendRowGap)&&l.legendRowGap(_.legendRowGap);return this}};if(arguments.length===1)l.options(arguments[0]);return l};bw.model.radar=function(){var l=bw.extend();var m='雷达图';var n=700;var r=700;var v=n;var w=r;var x=0;var y=0;var z;var A=10;var B='Arial';var C='#737373';var D=13;var E;var F;var G=1000;var H=bt.format('.2s');var I=l.color();var J;var K;var L;var M=6;var N='grey';var O=8;var P='#929292';var Q=1;var R='#CCCCCC';var S='#000000';var D=13;var T=0;var U=0;var V=10;var W=100;l.data=function(_){if(arguments.length){if(_.type==='csv'||_.type==='tsv'){_=_.map(function(d){var a=[];a=bw.keys(d).filter(function(p){return p!=='name'}).map(function(p){return{axis:p,value:+d[p]}});return{name:d.name,data:a}})}else if(_.type==='xml'){_=_.root;_=_.map(function(d){var a={};d.row.row.forEach(function(p){var k=bw.keys(p)[0];a[k]=p[k]});return a});_=XMLdata(_)}else if(_.type==='xlsx'||_.type==='xls'){var s=[];for(var i=0;i<_.length;i++){var k=bw.keys(_[i])[0];s=s.concat(_[i][k])}_=s;_=_.map(function(d){var a=[];a=bw.keys(d).filter(function(p){return p!=='name'}).map(function(p){return{axis:p,value:+d[p]}});return{name:d.name,data:a}})}_.forEach(function(d){d._flag=true});z=_;return this}else return z};l.getType=function(){return m};l.render=function(_){E=E||bt.select(_).node();if(!E||E.tagName.toLowerCase()!=='div'){console.error('The argument(element) in radar.rander(_) should be <div> element')}bt.select(E).classed('chart',true);F=F||bt.select(E).append('svg').classed('radar',true).node();J=Math.min(v,w)*.4;K=bt.max(z,function(d){if(d._flag)return bt.max(d.data.map(function(p){return p.value}));else return 0});L=bt.set();z.forEach(function(d){d.data.forEach(function(p){L.add(p.axis)})});L=L.values();z.forEach(function(d){d.data.forEach(function(p){p.index=L.indexOf(p.axis)})});z.forEach(function(d){d.data.forEach(function(p){p.position=[v/2-J*((parseFloat(Math.max(p.value,0))/K)*Math.sin(p.index*2*Math.PI/L.length)),w/2-J*((parseFloat(Math.max(p.value,0))/K)*Math.cos(p.index*2*Math.PI/L.length))]})});var g=bt.select(F).attr({'width':n,'height':r}).selectAll('g').data([1]).enter().append('svg:g').attr('transform','translate('+x+','+y+')');g.call(function(a){a.append('svg:g').classed('levels',true);a.append('svg:g').classed('ticks',true);a.append('svg:g').classed('items',true);a.append('svg:g').classed('axises',true);a.append('svg:g').classed('legends',true)});g=bt.select(F).select('g');var b=g.select('.items').selectAll('.item').data(z.filter(function(d){return d._flag}));b.exit().transition().duration(G/2).style('opacity',0).remove();var c=g.select('.items').selectAll('.mark').data([1]).enter().append('svg:text').classed('mark',true).style({'opacity':0,'font-family':B,'fill':C,'font-size':A});dataUpdate(b,c);dataDraw(b,c);var e=g.select('.levels').selectAll('.level').data(bt.range(M));e.exit().transition().duration(G/2).style('opacity',0).remove();loopsUpdate(e);loopsDraw(e);var f=g.select('.ticks').selectAll('.tick').data(bt.range(M));f.exit().transition().duration(G/2).style('opacity',0).remove();ticksUpdate(f);ticksDraw(f);var h=g.select('.axises').selectAll('.axis').data(L);h.exit().transition().duration(G/2).style('opacity',0).remove();axisesUpdate(h);axisesDraw(h);var i=g.select('.legends').attr('transform','translate('+T+','+U+')').selectAll('.legend').data(z);i.exit().transition().duration(G/2).style('opacity',0).remove();legendUpdate(i);legendDraw(i)};function dataDraw(c,e){var f=bt.svg.line().x(function(d){return d.position[0]}).y(function(d){return d.position[1]});c.enter().append('svg:g').classed('item',true).each(function(d,i){bt.select(this).append('svg:path').classed('radar',true).on('mouseover',function(){var a=this;c.selectAll('.radar').each(function(){if(this!==a)bt.select(this).transition(200).style('fill-opacity',0.1);else bt.select(a).transition(200).style('fill-opacity',.7)})}).on('mouseout',function(){c.selectAll('.radar').transition(200).style('fill-opacity',.5)}).style({'stroke-width':'2px','fill-opacity':0,'stroke-opacity':0,'stroke':I(i),'fill':I(i)}).transition().duration(G).style({'fill-opacity':.5,'stroke-opacity':1}).attr('d',function(){var p=l.clone(d.data);p.push(p[0]);return f(p)});var b=bt.select(this).append('svg:g').classed('nodes',true).selectAll('.node').data(d.data);b.exit().transition().duration(G/2).style('opacity',0).remove();b.enter().append('svg:circle').classed('node',true).style({'fill':I(i),'fill-opacity':0}).on('mouseover',function(d){var a=this;c.selectAll('.radar').each(function(){if(this!==a)bt.select(this).transition(200).style('fill-opacity',0.1);else bt.select(a).transition(200).style('fill-opacity',.7)});e.attr('x',parseFloat(bt.select(a).attr('cx'))-10).attr('y',parseFloat(bt.select(a).attr('cy'))-5).text(H(d.value)).transition(200).style('opacity',1)}).on('mouseout',function(){c.selectAll('.radar').transition(200).style('fill-opacity',.5);e.transition(200).style('opacity',0)}).transition().duration(G).style('fill-opacity',.9).attr('r',4).attr('cx',function(d){return d.position[0]}).attr('cy',function(d){return d.position[1]}).attr('data-id',function(d){return d.axis})})}function dataUpdate(c,e){var f=bt.svg.line().x(function(d){return d.position[0]}).y(function(d){return d.position[1]});c.each(function(d,i){bt.select(this).selectAll('.radar').transition().duration(G).style({'stroke':I(i),'fill':I(i)}).attr('d',function(){var p=l.clone(d.data);p.push(p[0]);return f(p)});var b=bt.select(this).selectAll('.nodes').selectAll('.node').data(d.data);b.exit().transition().duration(G/2).style('opacity',0).remove();b.transition().duration(G).style('fill',I(i)).attr('r',4).attr('cx',function(d){return d.position[0]}).attr('cy',function(d){return d.position[1]}).attr('data-id',function(d){return d.axis});b.enter().append('svg:circle').classed('node',true).style({'fill':I(i),'fill-opacity':0}).on('mouseover',function(d){var a=this;c.selectAll('.radar').each(function(){if(this!==a)bt.select(this).transition(200).style('fill-opacity',0.1);else bt.select(a).transition(200).style('fill-opacity',.7)});e.attr('x',parseFloat(bt.select(a).attr('cx'))-10).attr('y',parseFloat(bt.select(a).attr('cy'))-5).text(H(d.value)).transition(200).style('opacity',1)}).on('mouseout',function(){c.selectAll('.radar').transition(200).style('fill-opacity',.5);e.transition(200).style('opacity',0)}).transition().duration(G).style('fill-opacity',.9).attr('r',4).attr('cx',function(d){return d.position[0]}).attr('cy',function(d){return d.position[1]}).attr('data-id',function(d){return d.axis})})}function loopsDraw(c){c.enter().append('svg:g').classed('level',true).each(function(d){var a=J*(++d/M);var b=bt.select(this).selectAll('.line').data(L);b.exit().transition().duration(G/2).style('opacity',0).remove();b.enter().append('svg:line').classed('line',true).style({'stroke':N,'stroke-dasharray':'3,1','stroke-opacity':'0','stroke-width':1}).transition().duration(G).attr('x1',function(p,i){return v/2-a*Math.sin(i*2*Math.PI/L.length)}).attr('y1',function(p,i){return w/2-a*Math.cos(i*2*Math.PI/L.length)}).attr('x2',function(p,i){return v/2-a*Math.sin((i+1)*2*Math.PI/L.length)}).attr('y2',function(p,i){return w/2-a*Math.cos((i+1)*2*Math.PI/L.length)}).style('stroke-opacity',.75)})}function loopsUpdate(c){c.each(function(d){var a=J*(++d/M);var b=bt.select(this).selectAll('.line').data(L);b.exit().transition().duration(G/2).style('opacity',0).remove();b.transition().duration(G).attr('x1',function(p,i){return v/2-a*Math.sin(i*2*Math.PI/L.length)}).attr('y1',function(p,i){return w/2-a*Math.cos(i*2*Math.PI/L.length)}).attr('x2',function(p,i){return v/2-a*Math.sin((i+1)*2*Math.PI/L.length)}).attr('y2',function(p,i){return w/2-a*Math.cos((i+1)*2*Math.PI/L.length)});b.enter().append('svg:line').classed('line',true).style({'stroke':N,'stroke-dasharray':'3,1','stroke-opacity':'0','stroke-width':1}).transition().duration(G).attr('x1',function(p,i){return v/2-a*Math.sin(i*2*Math.PI/L.length)}).attr('y1',function(p,i){return w/2-a*Math.cos(i*2*Math.PI/L.length)}).attr('x2',function(p,i){return v/2-a*Math.sin((i+1)*2*Math.PI/L.length)}).attr('y2',function(p,i){return w/2-a*Math.cos((i+1)*2*Math.PI/L.length)}).style('stroke-opacity',.75)})}function ticksDraw(b){b.enter().append('svg:text').classed('tick',true).each(function(d){var a=J*(++d/M);bt.select(this).style({'font-family':B,'fill':C,'font-size':A}).transition().duration(G).attr('x',function(){return v/2-a*Math.sin(0)+2}).attr('y',function(){return w/2-a*Math.cos(0)}).text(H(d*K/M))})}function ticksUpdate(b){b.each(function(d){var a=J*(++d/M);bt.select(this).transition().duration(G).style({'font-family':B,'fill':C,'font-size':A}).attr('x',function(){return v/2-a*Math.sin(0)+2}).attr('y',function(){return w/2-a*Math.cos(0)}).text(H(d*K/M))})}function axisesDraw(e){e.enter().append('svg:g').classed('axis',true).each(function(d,i){var a=+(bt.select(this).attr('data-index')||0);var b=bt.select(this).selectAll('.line').data([d]);b.exit().transition().duration(G/2).style('opacity',0).remove();b.enter().append('svg:line').classed('line',true).style({'stroke':R,'stroke-width':Q}).attr({'x1':v/2,'y1':w/2}).transition().duration(G).attrTween('x2',function(){var q=bt.interpolate(a*2*Math.PI,i*2*Math.PI/L.length);return function(t){return v/2-J*Math.sin(q(t))}}).attrTween('y2',function(){var q=bt.interpolate(a*2*Math.PI,i*2*Math.PI/L.length);return function(t){return w/2-J*Math.cos(q(t))}});var c=bt.select(this).selectAll('.text').data([d]);c.exit().transition().duration(G/2).style('opacity',0).remove();c.enter().append('svg:text').classed('text',true).style({'font-family':P,'font-size':O,'opacity':0}).attr({'transform':'translate(0, -10)','text-anchor':'middle','dy':'1.5em'}).transition().duration(G).attrTween('x',function(){var q=bt.interpolate(a*2*Math.PI,i*2*Math.PI/L.length);return function(t){return v/2-J*.85*Math.sin(q(t))-60*Math.sin(q(t))}}).attrTween('y',function(){var q=bt.interpolate(a*2*Math.PI,i*2*Math.PI/L.length);return function(t){return w/2-J*Math.cos(q(t))-20*Math.cos(q(t))}}).style('opacity',1).text(d);bt.select(this).attr('data-index',i/L.length)})}function axisesUpdate(e){e.each(function(d,i){var a=+(bt.select(this).attr('data-index')||0);var b=bt.select(this).selectAll('.line');b.transition().duration(G).style({'stroke':R,'stroke-width':Q}).attrTween('x2',function(){var q=bt.interpolate(a*2*Math.PI,i*2*Math.PI/L.length);return function(t){return v/2-J*Math.sin(q(t))}}).attrTween('y2',function(){var q=bt.interpolate(a*2*Math.PI,i*2*Math.PI/L.length);return function(t){return w/2-J*Math.cos(q(t))}});var c=bt.select(this).selectAll('.text');c.style({'font-family':P,'font-size':O}).transition().duration(G).attrTween('x',function(){var q=bt.interpolate(a*2*Math.PI,i*2*Math.PI/L.length);return function(t){return v/2-J*.85*Math.sin(q(t))-60*Math.sin(q(t))}}).attrTween('y',function(){var q=bt.interpolate(a*2*Math.PI,i*2*Math.PI/L.length);return function(t){return w/2-J*Math.cos(q(t))-20*Math.cos(q(t))}}).text(d);bt.select(this).attr('data-index',i/L.length)})}function legendDraw(a){a.enter().append('svg:g').classed('legend',true).style('cursor','pointer').on('click',function(d){if(!bt.select(this).classed('none')){if(z.length>1){bt.select(this).classed('none',true);for(var j=0,k;j<z.length;j++){k=z[j];if(k.name===d.name){k._flag=false;break}}l.render()}}else{bt.select(this).classed('none',false);for(var j=0,k;j<z.length;j++){k=z[j];if(k.name===d.name){k._flag=true;break}}l.render()}}).each(function(d,i){bt.select(this).append('svg:rect').attr({'x':(i-i%V)/V*W+J*2,'y':i%V*20+10}).attr({'width':10,'height':10}).style({'fill':I(i),'stroke':I(i)}).style('fill-opacity',d._flag?1:0).style('opacity',0).transition().duration(G/2).style('opacity',1);bt.select(this).append('svg:text').attr({'x':(i-i%V)/V*W+J*2+20,'y':i%V*20+19}).style({'opacity':0,'font-size':D,'fill':S,'font-family':B}).transition().duration(G/2).style('opacity',1).text(d.name)})}function legendUpdate(a){a.each(function(d,i){bt.select(this).selectAll('rect').transition().duration(G/2).style({'fill':I(i),'stroke':I(i)}).style('fill-opacity',d._flag?1:0).attr({'x':(i-i%V)/V*W+J*2,'y':i%V*20+10});bt.select(this).selectAll('text').transition().duration(G/2).attr({'x':(i-i%V)/V*W+J*2+20,'y':i%V*20+19}).style({'font-size':D,'fill':S,'font-family':B}).text(d.name)})}function XMLdata(d){var u;if(typeof d==='object'&&d.constructor===Array){u=d.map(function(p){var a;var b;var c=p.data.data.map(function(k){k.row.row.forEach(function(o){if(o.axis!==undefined)a=o.axis;if(o.value!==undefined)b=o.value});return{axis:a,value:b}});return{name:p.name,data:c}})}return u}l.size=function(_){if(!arguments.length)return[n,r];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in radar.size(width, height) should be number and number of svg');return this}else{n=arguments[0];r=arguments[1];return this}};l.sizeAvail=function(_){if(!arguments.length)return[v,w];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in radar.sizeAvail(widthAvail, heightAvail) should be number and number of svg');return this}else{v=arguments[0];w=arguments[1];return this}};l.tran=function(_){if(!arguments.length)return[x,y];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in radar.tran(tranX, tranY) should be number and number of svg');return this}else{x=arguments[0];y=arguments[1];return this}};l.fontSize=function(_){if(!arguments.length)return A;else{if(!isFinite(arguments[0])){console.error('The arguments in radar.fontSize(fontSize) should be number of text');return this}else{A=arguments[0];return this}}};l.fontFamily=function(_){if(!arguments.length)return B;else{if(typeof arguments[0]!=='string'){console.error('The arguments in radar.fontFamily(fontFamily) should be string of text');return this}else{A=arguments[0];return this}}};l.fontColor=function(_){if(!arguments.length)return C;else{if(typeof arguments[0]!=='string'){console.error('The arguments in radar.fontColor(fontColor) should be string of text');return this}else{C=arguments[0];return this}}};l.duration=function(_){if(!arguments.length)return G;else{if(!isFinite(arguments[0])){console.error('The arguments in radar.duration(duration) should be number of transition');return this}else{G=Math.round(arguments[0]);return this}}};l.color=function(_){if(!arguments.length)return I;else{if(typeof arguments[0]!=='function'){console.error('The arguments in radar.color(color) should be function of pvisual.color');return this}else{I=arguments[0];return this}}};l.gridColor=function(_){if(!arguments.length)return N;else{if(typeof arguments[0]!=='string'){console.error('The arguments in radar.gridColor(gridColor) should be string');return this}else{N=arguments[0];return this}}};l.tickFormat=function(_){if(!arguments.length)return H;else{if(typeof arguments[0]!=='string'){console.error('The arguments in radar.tickFormat(format) should be string of d3.format');return this}else{H=bt.format(arguments[0]);return this}}};l.tickTextSize=function(_){if(!arguments.length)return O;else{if(!isFinite(arguments[0])){console.error('The arguments in radar.tickTextSize(tickTextSize) should be number');return this}else{O=arguments[0];return this}}};l.tickTextColor=function(_){if(!arguments.length)return P;else{if(typeof arguments[0]!=='string'){console.error('The arguments in radar.tickTextColor(tickTextColor) should be string');return this}else{P=arguments[0];return this}}};l.axisPathWidth=function(_){if(!arguments.length)return Q;else{if(!isFinite(arguments[0])){console.error('The arguments in radar.axisPathWidth(axisPathWidth) should be string');return this}else{Q=arguments[0];return this}}};l.axisPathColor=function(_){if(!arguments.length)return R;else{if(typeof arguments[0]!=='string'){console.error('The arguments in radar.axisPathColor(axisPathColor) should be string');return this}else{R=arguments[0];return this}}};l.legendTran=function(_){if(!arguments.length)return[T,U];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in radar.legendTran(tranX, tranY) should be number and number of svg');return this}else{T=arguments[0];U=arguments[1];return this}};l.legendSize=function(_){if(!arguments.length)return D;else{if(!isFinite(arguments[0])){console.error('The arguments in radar.legendSize(legendSize) should be number of text');return this}else{D=arguments[0];return this}}};l.legendColor=function(_){if(!arguments.length)return S;else{if(typeof arguments[0]!=='string'){console.error('The arguments in radar.legendColor(legendColor) should be string of text');return this}else{S=arguments[0];return this}}};l.legendColumnNo=function(_){if(!arguments.length)return V;else{if(!isFinite(arguments[0])){console.error('The arguments in radar.legendColumnNo(legendColumnNo) should be number of text');return this}else{V=arguments[0];return this}}};l.legendRowGap=function(_){if(!arguments.length)return W;else{if(!isFinite(arguments[0])){console.error('The arguments in radar.legendRowGap(legendRowGap) should be number of text');return this}else{W=arguments[0];return this}}};l.segNumber=function(_){if(!arguments.length)return M;else{if(!isFinite(arguments[0])){console.error('The arguments in radar.segNumber(number) should be number of svg');return this}else{M=arguments[0];return this}}};l.options=function(_){if(!arguments.length)return{'width':n,'height':r,'format':H,'segnumber':M,'fontSize':A,'fontFamily':B,'legendsize':D,'duration':G};else if(typeof _!=='object'){l.log({priority:'Warning',position:'radar',info:'The arguments in radar.options(options) should be object'});console.error('The arguments in radar.options(options) should be object');return this}else{n=isFinite(_.width)?_.width:n;r=isFinite(_.width)?_.height:r;H=(_.format&&typeof _.format==='function')?_.format:H;M=isFinite(_.segnumber)?_.segnumber:M;A=isFinite(_.fontSize)?_.fontSize:A;D=isFinite(_.legendsize)?_.legendsize:D;B=_.fontFamily||B;G=isFinite(_.duration)||G;return this}};l.options=function(_){if(!arguments.length)return{'type':l.getType(),'width':n,'height':r,'widthAvail':v,'heightAvail':w,'tranX':x,'tranY':y,'format':H,'fontSize':A,'fontColor':C,'fontFamily':B,'color':I,'duration':G,'segNumber':M,'gridColor':N,'tickTextSize':O,'tickTextColor':P,'axisPathWidth':Q,'axisPathColor':R,'legendColor':S,'legendSize':D,'legendTranX':T,'legendTranY':U,'legendColumnNo':V,'legendRowGap':W};else if(typeof _!=='object'){console.error('The arguments in map.options(options) should be object');return this}else{n=isFinite(_.width)?_.width:n;r=isFinite(_.height)?_.height:r;v=isFinite(_.widthAvail)?_.widthAvail:v;w=isFinite(_.heightAvail)?_.heightAvail:w;x=isFinite(_.tranX)?_.tranX:x;y=isFinite(_.tranY)?_.tranY:y;_.format&&l.tickFormat(_.format);_.fontFamily&&l.fontFamily(_.fontFamily);_.fontColor&&l.fontColor(_.fontColor);isFinite(_.fontSize)&&l.fontSize(_.fontSize);isFinite(_.duration)&&l.duration(_.duration);isFinite(_.segNumber)&&l.segNumber(_.segNumber);_.gridColor&&l.gridColor(_.gridColor);isFinite(_.tickTextSize)&&l.tickTextSize(_.tickTextSize);_.tickTextColor&&l.tickTextColor(_.tickTextColor);isFinite(_.axisPathWidth)&&l.axisPathWidth(_.axisPathWidth);_.axisPathColor&&l.axisPathColor(_.axisPathColor);_.legendColor&&l.legendColor(_.legendColor);isFinite(_.legendSize)&&l.legendSize(_.legendSize);T=isFinite(_.legendTranX)?_.legendTranX:T;U=isFinite(_.legendTranY)?_.legendTranY:U;isFinite(_.legendColumnNo)&&l.legendColumnNo(_.legendColumnNo);isFinite(_.legendRowGap)&&l.legendRowGap(_.legendRowGap);return this}};if(arguments.length===1)l.options(arguments[0]);return l};bw.model.sankey=function(){var h=bw.extend();var j=_.d3;var l='Sankey';var m=700;var n=400;var o=m;var r=n;var s=0;var t=0;var u;var v=8;var w='Arial';var x='#000000';var y;var z;var A;var B=1000;var C=j.format(',.0f');var D=h.color();var E=.2;var F=function(d,i){return'#000000'};h.data=function(_){if(arguments.length){if(_.type==='xml'){_=_.root;_=XMLdata(_)}var a=j.map();_.nodes.forEach(function(d){a.set(d.name,d)});_.links.forEach(function(d){d.source=a.get(d.source);d.target=a.get(d.target)});u=_;return this}else return u};h.getType=function(){return l};h.render=function(_){z=z||j.select(_).node();if(!z||z.tagName.toLowerCase()!=='div'){console.error('The argument(element) in sankey.rander(_) should be <div> element')}j.select(z).classed('chart',true);A=A||j.select(z).append('svg').classed('sankey',true).node();var b=j.sankey().nodeWidth(15).nodePadding(10).size([o-2,r-2]);b.nodes(u.nodes).links(u.links).layout(40);var c=b.link();y=j.select(z).select('.floatTag').node()?j.select(z).select('.floatTag'):h.floatTag(z);var g=j.select(A).attr({'width':m,'height':n}).selectAll('g').data([1]).enter().append('svg:g').attr('transform','translate('+s+','+t+')');g.call(function(a){a.append('svg:g').classed('links',true);a.append('svg:g').classed('nodes',true)});g=j.select(A).select('g');var d=g.select('.links').selectAll('.link').data(u.links);d.exit().transition().duration(B).style('opacity',0).remove();linkUpdate(d,c);linkDraw(d,c);var e=g.select('.nodes').selectAll('.node').data(u.nodes);e.exit().transition().duration(B).style('opacity',0).remove();nodeUpdate(e,b,c,d);nodeDraw(e,b,c,d)};function linkUpdate(c,e){c.transition().duration(B).attr('d',e).style('stroke-width',function(d){return Math.max(1,d.dy)}).style('stroke',F).sort(function(a,b){return b.dy-a.dy})}function linkDraw(a,b){a.enter().append('svg:path').classed('link',true).attr('d',b).style({'fill':'none','opacity':E}).style('stroke',F).style('stroke-width',function(d){return Math.max(1,d.dy)}).on('mouseover',function(d){drawLegend(d,true);j.select(this).transition().duration(B/3).style('stroke-opacity',.5)}).on('mouseout',function(d){drawLegend(d,false);j.select(this).transition().duration(B/3).style('stroke-opacity',1)})}function nodeUpdate(a,b,c,e){a.call(j.behavior.drag().origin(function(d){return d}).on('dragstart',function(){this.parentNode.appendChild(this)}).on('drag',dragmove)).each(function(d,i){j.select(this).attr('transform','translate('+d.x+','+d.y+')');j.select(this).select('rect').transition().duration(B).attr('height',d.dy).attr('width',b.nodeWidth()).style('fill',function(){return d.color=D(i)}).style('stroke',function(){return j.rgb(d.color).darker(2)});j.select(this).select('text').transition().duration(B).attr('y',d.dy/2).text(function(d){return d.name}).style({'font-family':w,'fill':x,'font-size':v}).filter(function(d){return d.x<b.width/2}).attr('x',6+b.nodeWidth()).attr('text-anchor','start')});function dragmove(d){j.select(this).attr('transform','translate('+d.x+','+(d.y=Math.max(0,Math.min(r-d.dy,j.event.y)))+')');b.relayout();e.attr('d',c)}}function nodeDraw(a,b,c,e){a.enter().append('svg:g').classed('node',true).attr('transform',function(d){return'translate('+d.x+','+d.y+')'}).call(j.behavior.drag().origin(function(d){return d}).on('dragstart',function(){this.parentNode.appendChild(this)}).on('drag',dragmove)).each(function(d,i){j.select(this).append('svg:rect').attr('height',d.dy).attr('width',b.nodeWidth()).style('fill',function(){return d.color=D(i)}).style({'cursor':'move','fill-opacity':.7,'stroke':j.rgb(d.color).darker(2),'shape-rendering':'crispEdges'});j.select(this).append('svg:text').attr({'x':-2,'y':d.dy/2,'dy':'.35em','text-anchor':'end'}).text(d.name).style({'pointer-events':'none','text-shadow':'0 1px 0 #fff','font-family':w,'fill':x,'font-size':v}).filter(function(){return d.x<b.width/2}).attr('x',6+b.nodeWidth()).attr('text-anchor','start')});function dragmove(d){j.select(this).attr('transform','translate('+d.x+','+(d.y=Math.max(0,Math.min(r-d.dy,j.event.y)))+')');b.relayout();e.attr('d',c)}}function drawLegend(d,a){if(a){y.style({'border-color':F(d),'opacity':1,'textAlign':'center','margin':'auto'}).html('source: '+d.source.name+'<br/>'+'target: '+d.target.name+'<br/>'+'value: '+C(d.value))}else{y.style('opacity',0)}}function XMLdata(d){if(typeof d==='object'&&d.constructor===Array){var a;var b;var c;var e;var f;d.forEach(function(p){if(p.nodes!==undefined){a=p.nodes.nodes.map(function(k){return{name:k.node.name}})}else if(p.links!==undefined){b=p.links.links.map(function(k){k.link.link.forEach(function(q){if(q.target!==undefined)e=q.target;if(q.source!==undefined)f=q.source;if(q.value!==undefined)c=q.value});return{source:f,target:e,value:c}})}});return{nodes:a,links:b}}}h.size=function(_){if(!arguments.length)return[m,n];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in sankey.size(width, height) should be number and number of svg');return this}else{m=arguments[0];n=arguments[1];return this}};h.sizeAvail=function(_){if(!arguments.length)return[o,r];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in sankey.sizeAvail(widthAvail, heightAvail) should be number and number of svg');return this}else{o=arguments[0];r=arguments[1];return this}};h.tran=function(_){if(!arguments.length)return[s,t];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in sankey.tran(tranX, tranY) should be number and number of svg');return this}else{s=arguments[0];t=arguments[1];return this}};h.fontSize=function(_){if(!arguments.length)return v;else{if(!isFinite(arguments[0])){console.error('The arguments in sankey.fontSize(fontSize) should be number of text');return this}else{v=arguments[0];return this}}};h.fontFamily=function(_){if(!arguments.length)return w;else{if(typeof arguments[0]!=='string'){console.error('The arguments in sankey.fontFamily(fontFamily) should be string of text');return this}else{v=arguments[0];return this}}};h.fontColor=function(_){if(!arguments.length)return x;else{if(typeof arguments[0]!=='string'){console.error('The arguments in sankey.fontColor(fontColor) should be string of text');return this}else{x=arguments[0];return this}}};h.duration=function(_){if(!arguments.length)return B;else{if(!isFinite(arguments[0])){console.error('The arguments in sankey.duration(duration) should be number of transition');return this}else{B=Math.round(arguments[0]);return this}}};h.color=function(_){if(!arguments.length)return D;else{if(typeof arguments[0]!=='function'){console.error('The arguments in sankey.color(color) should be function of pvisual.color');return this}else{D=arguments[0];return this}}};h.tickFormat=function(_){if(!arguments.length)return C;else{if(typeof arguments[0]!=='string'){console.error('The arguments in sankey.tickFormat(format) should be string of d3.format');return this}else{C=j.format(arguments[0]);return this}}};h.linkOpacity=function(_){if(!arguments.length)return E;else{if(!isFinite(arguments[0])){console.error('The arguments in sankey.linkOpacity(linkOpacity) should be number');return this}else{E=arguments[0];return this}}};h.linkColor=function(_){if(!arguments.length)return F;else{if(typeof arguments[0]!=='function'&&typeof typeof arguments[0]!=='string'){console.error('The arguments in graph.linkColor(linkColor) should be function or string');return this}else{F=j.functor(arguments[0]);return this}}};h.options=function(_){if(!arguments.length)return{'type':h.getType(),'width':m,'height':n,'widthAvail':o,'heightAvail':r,'tranX':s,'tranY':t,'format':C,'fontSize':v,'fontColor':x,'fontFamily':w,'color':D,'duration':B,'linkOpacity':E,'linkColor':F};else if(typeof _!=='object'){console.error('The arguments in map.options(options) should be object');return this}else{m=isFinite(_.width)?_.width:m;n=isFinite(_.height)?_.height:n;o=isFinite(_.widthAvail)?_.widthAvail:o;r=isFinite(_.heightAvail)?_.heightAvail:r;s=isFinite(_.tranX)?_.tranX:s;t=isFinite(_.tranY)?_.tranY:t;_.format&&h.tickFormat(_.format);_.fontFamily&&h.fontFamily(_.fontFamily);_.fontColor&&h.fontColor(_.fontColor);isFinite(_.fontSize)&&h.fontSize(_.fontSize);isFinite(_.duration)&&h.duration(_.duration);_.linkColor&&h.linkColor(_.linkColor);isFinite(_.linkOpacity)&&h.linkOpacity(_.linkOpacity);return this}};if(arguments.length===1)h.options(arguments[0]);return h};bw.model.scatterplot=function(){var l=bw.extend();var o=_.d3;var q='散点矩阵';var r=800;var t=800;var u=r-150;var v=t-100;var w=20;var z=20;var A;var B='Arial';var C;var D;var E=o.format('.3s');var F=l.color();var G;var H=2;var I;var J=.05;var K;var L=0;var M=0;var N=5;var O=8;var P='#929292';var Q='#929292';var R=8;var S='normal';var T='#000';var U=13;var V=0;var W=0;var X=10;var Y=100;l.data=function(_){if(arguments.length){if(_.type==='xml'){_=_.root;_=_.map(function(d){var a={};d.row.row.forEach(function(p){var k=bw.keys(p)[0];a[k]=p[k]});return a})}else if(_.type==='xlsx'||_.type==='xls'){var s=[];for(var i=0;i<_.length;i++){var k=bw.keys(_[i])[0];s=s.concat(_[i][k])}_=s}var b=bw.keys(_[0]).filter(function(p){return p!=='species'});b.forEach(function(d){_.forEach(function(p){p[d]=+p[d]})});I=b.map(function(d){return{name:d,_flag:true,extent:o.extent(_,function(p){return p[d]})}});I.species=o.set(_.map(function(d){return d.species})).values();A=_;return this}else return A};l.getType=function(){return q};l.render=function(_){C=C||o.select(_).node();if(!C||C.tagName.toLowerCase()!=='div'){l.log({priority:'Error',position:'scatterplot',info:'The argument(element) in scatterplot.rander(_) should be <div> element'});console.error('The argument(element) in scatterplot.rander(_) should be <div> element')}o.select(C).classed('chart',true);D=D||o.select(C).append('svg').classed('scatterplot',true).node();var c=I.filter(function(d){return d._flag});G=o.min([u,v])/c.length;K=J*G;var x={};var y={};c.forEach(function(d){x[d.name]=o.scale.linear().domain(d.extent).range([K/2,G-K/2]);y[d.name]=o.scale.linear().domain(d.extent).range([G-K/2,K/2])});var f=o.svg.axis().ticks(N).tickSize(G*c.length);var h=o.svg.brush().on('brushstart',brushstart).on('brush',h).on('brushend',brushend);var g=o.select(D).attr({'width':r,'height':t}).selectAll('g').data([1]).enter().append('svg:g').attr('transform','translate('+w+','+z+')');g.call(function(a){a.append('svg:g').classed('dimensions',true);a.append('svg:g').classed('x-axis axis',true);a.append('svg:g').classed('y-axis axis',true);a.append('svg:g').classed('legends',true);a.append('svg:g').classed('labels',true)});g=o.select(D).select('g');var i=g.select('.labels').selectAll('.label').data(c);i.exit().transition().duration(duration).style('opacity',0).remove();labelUpdate(i);labelDraw(i);var j=g.select('.dimensions').selectAll('.dimension').data(cross(c,c));j.exit().transition().duration(duration).style('opacity',0).remove();j.each(function(p){var a=o.select(this);a.transition().duration(duration).attr('transform',function(d){return'translate('+d.i*G+','+d.j*G+')'});a.select('.frame').attr({'x':K/2,'y':K/2,'width':G-K,'height':G-K});var b=a.selectAll('circle').data(A);b.exit().transition().duration(duration).style('opacity',0).remove();b.attr('class',function(d){return d.species}).transition().duration(duration).attr('fill',function(d){return F(d.species)}).attr('cx',function(d){return x[p.x.name](d[p.x.name])}).attr('cy',function(d){return y[p.y.name](d[p.y.name])});b.enter().append('svg:circle').attr('class',function(d){return d.species}).attr('fill',function(d){return F(d.species)}).attr('cx',function(d){return x[p.x.name](d[p.x.name])}).attr('cy',function(d){return y[p.y.name](d[p.y.name])}).attr('r',H);a.call(h.x(x[p.x.name]).y(y[p.y.name]))});j.enter().append('svg:g').classed('dimension',true).attr('transform',function(d){return'translate('+d.i*G+','+d.j*G+')'}).each(function(p){var a=o.select(this);a.append('svg:rect').classed('frame',true).attr({'x':K/2,'y':K/2,'width':G-K,'height':G-K,'fill':'none','stroke':'#444444','stroke-width':'1px'});a.selectAll('circle').data(A).enter().append('svg:circle').attr('class',function(d){return d.species}).attr('fill',function(d){return F(d.species)}).attr('cx',function(d){return x[p.x.name](d[p.x.name])}).attr('cy',function(d){return y[p.y.name](d[p.y.name])}).attr('r',H);a.call(h.x(x[p.x.name]).y(y[p.y.name]))});g.select('.dimensions').selectAll('.dimension').selectAll('.extent').style({'fill':'#000','fill-opacity':.1,'stroke':'#fff'});var k=g.select('.legends').attr('transform','translate('+V+','+W+')').selectAll('.legend').data(I);k.exit().transition().duration(duration).style('opacity',0).remove();legendUpdate(k);legendDraw(k,c);axisDraw(g,f,x,y,c);function brushstart(p){if(h.data!==p){j.call(h.clear());h.x(x[p.x.name]).y(y[p.y.name]).data=p}}function h(p){var e=h.extent();g.select('.dimensions').selectAll('.dimension').selectAll('circle').attr('class',function(d){return e[0][0]<=d[p.x.name]&&d[p.x.name]<=e[1][0]&&e[0][1]<=d[p.y.name]&&d[p.y.name]<=e[1][1]?d.species:'none'}).attr('fill',function(d){return o.select(this).classed('none')?'#AAAAAA':F(d.species)})}function brushend(){if(h.empty())g.select('.dimensions').selectAll('.dimension').selectAll('circle').attr('class',function(d){return d.species}).attr('fill',function(d){return F(d.species)})}};function labelUpdate(a){a.each(function(d,i){o.select(this).select('.x').text(d.name).transition().duration(duration).attr('transform','translate('+(i+.5)*G+',0)').style({'text-anchor':'middle','fill':S,'font-family':B,'font-size':R});o.select(this).select('.y').text(d.name).transition().duration(duration).attr('transform','translate(-5,'+(i+.5)*G+')rotate(-90)').style({'text-anchor':'middle','fill':S,'font-family':B,'font-size':R})})}function labelDraw(a){a.enter().append('svg:g').classed('label',true).each(function(d,i){o.select(this).append('svg:text').classed('x',true).text(d.name).attr('transform','translate('+(i+.5)*G+',0)').style({'text-anchor':'middle','font-family':B,'font-size':R,'fill':S});o.select(this).append('svg:text').classed('y',true).text(d.name).attr('transform','translate(-5,'+(i+.5)*G+')rotate(-90)').style({'text-anchor':'middle','font-family':B,'font-size':R,'fill':S})})}function legendDraw(a,b){a.enter().append('svg:g').classed('legend',true).style('cursor','pointer').on('click',function(d){if(!o.select(this).classed('none')){if(b.length>1){o.select(this).classed('none',true);d._flag=false;l.render()}}else{o.select(this).classed('none',false);d._flag=true;l.render()}}).each(function(d,i){o.select(this).append('svg:rect').attr({'x':(i-i%X)/X*Y+u+20,'y':i%X*20}).attr({'width':10,'height':10}).style({'fill':F(i),'stroke':F(i)}).style('fill-opacity',d._flag?1:0).style('opacity',0).transition().duration(duration/2).style('opacity',1);o.select(this).append('svg:text').attr({'x':(i-i%X)/X*Y+u+40,'y':i%X*20+9}).style({'opacity':0,'font-size':U,'fill':T,'font-family':B}).transition().duration(duration/2).style('opacity',1).text(d.name)})}function legendUpdate(a){a.each(function(d,i){o.select(this).selectAll('rect').transition().duration(duration/2).style({'fill':F(i),'stroke':F(i)}).style('fill-opacity',d._flag?1:0).attr({'x':(i-i%X)/X*Y+u+20,'y':i%X*20});o.select(this).selectAll('text').transition().duration(duration/2).attr({'x':(i-i%X)/X*Y+u+40,'y':i%X*20+9}).style({'font-size':U,'fill':T,'font-family':B}).text(d.name)})}function axisDraw(g,b,x,y,c){var e=g.select('.x-axis').selectAll('.x').data(c);e.exit().transition().duration(duration).style('opacity',0).remove();e.transition().duration(duration).attr('transform',function(d,i){return'translate('+i*G+',0)'}).each(function(d){o.select(this).transition().duration(duration).call(b.scale(x[d.name]).orient('bottom'))});e.enter().append('svg:g').classed('x',true).attr('transform',function(d,i){return'translate('+i*G+',0)'}).each(function(d){o.select(this).transition().duration(duration).call(b.scale(x[d.name]).orient('bottom'))});var f=g.select('.y-axis').selectAll('.y').data(c);f.exit().transition().duration(duration).style('opacity',0).remove();f.transition().duration(duration).attr('transform',function(d,i){return'translate(0,'+i*G+')'}).each(function(d){o.select(this).transition().duration(duration).call(b.scale(y[d.name]).orient('right'))});f.enter().append('svg:g').classed('y',true).attr('transform',function(d,i){return'translate(0,'+i*G+')'}).each(function(d){o.select(this).transition().duration(duration).call(b.scale(y[d.name]).orient('right'))});g.selectAll('.axis').call(function(a){a.style('shape-rendering','crispEdges').selectAll('path').style('display','none');a.selectAll('line').style({'fill':'none','stroke-dasharray':'3,1','stroke':Q,'shape-rendering':'crispEdges'})});g.select('.x-axis').selectAll('.tick').select('text').style({'text-anchor':'middle','font-family':B,'font-size':O,'fill':P}).attr('transform',function(){return'translate('+this.getComputedTextLength()*Math.abs(Math.sin(L)*.5)+','+(this.getComputedTextLength()*(.5*Math.abs(Math.sin(L)))+5)+')rotate('+L+')'});g.select('.y-axis').selectAll('.tick').select('text').style({'text-anchor':'start','font-family':B,'font-size':O,'fill':P}).attr('transform',function(){return'rotate('+M+')'})}function cross(a,b){var c=[],n=a.length,m=b.length,i,j;for(i=-1;++i<n;)for(j=-1;++j<m;)c.push({x:a[i],i:i,y:b[j],j:j});return c}l.size=function(_){if(!arguments.length)return[r,t];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in scatterplot.size(width, height) should be number and number of svg');return this}else{r=arguments[0];t=arguments[1];return this}};l.sizeAvail=function(_){if(!arguments.length)return[u,v];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in scatterplot.sizeAvail(widthAvail, heightAvail) should be number and number of svg');return this}else{u=arguments[0];v=arguments[1];return this}};l.tran=function(_){if(!arguments.length)return[w,z];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in scatterplot.tran(tranX, tranY) should be number and number of svg');return this}else{w=arguments[0];z=arguments[1];return this}};l.fontFamily=function(_){if(!arguments.length)return B;else{if(typeof arguments[0]!=='string'){console.error('The arguments in scatterplot.fontFamily(fontFamily) should be string of text');return this}else{fontSize=arguments[0];return this}}};l.duration=function(_){if(!arguments.length)return duration;else{if(!isFinite(arguments[0])){console.error('The arguments in scatterplot.duration(duration) should be number of transition');return this}else{duration=Math.round(arguments[0]);return this}}};l.color=function(_){if(!arguments.length)return F;else{if(typeof arguments[0]!=='function'){console.error('The arguments in scatterplot.color(color) should be function of pvisual.color');return this}else{F=arguments[0];return this}}};l.tickFormat=function(_){if(!arguments.length)return E;else{if(typeof arguments[0]!=='string'){console.error('The arguments in scatterplot.tickFormat(format) should be string of d3.format');return this}else{E=o.format(arguments[0]);return this}}};l.legendTran=function(_){if(!arguments.length)return[V,W];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in scatterplot.legendTran(tranX, tranY) should be number and number of svg');return this}else{V=arguments[0];W=arguments[1];return this}};l.legendSize=function(_){if(!arguments.length)return U;else{if(!isFinite(arguments[0])){console.error('The arguments in scatterplot.legendSize(legendSize) should be number of text');return this}else{U=arguments[0];return this}}};l.legendColor=function(_){if(!arguments.length)return T;else{if(typeof arguments[0]!=='string'){console.error('The arguments in scatterplot.legendColor(legendColor) should be string of text');return this}else{T=arguments[0];return this}}};l.legendColumnNo=function(_){if(!arguments.length)return X;else{if(!isFinite(arguments[0])){console.error('The arguments in scatterplot.legendColumnNo(legendColumnNo) should be number of text');return this}else{X=arguments[0];return this}}};l.legendRowGap=function(_){if(!arguments.length)return Y;else{if(!isFinite(arguments[0])){console.error('The arguments in scatterplot.legendRowGap(legendRowGap) should be number of text');return this}else{Y=arguments[0];return this}}};l.xtickRotate=function(_){if(!arguments.length)return L;else{if(!isFinite(arguments[0])){console.error('The arguments in scatterplot.xtickRotate(xtickRotate) should be number of tick');return this}else{L=Math.round(arguments[0]);return this}}};l.ytickRotate=function(_){if(!arguments.length)return M;else{if(!isFinite(arguments[0])){console.error('The arguments in scatterplot.ytickRotate(ytickRotate) should be number of tick');return this}else{M=Math.round(arguments[0]);return this}}};l.labelSize=function(_){if(!arguments.length)return R;else{if(!isFinite(arguments[0])){console.error('The arguments in scatterplot.labelSize(labelSize) should be string');return this}else{R=arguments[0];return this}}};l.labelColor=function(_){if(!arguments.length)return S;else{if(typeof arguments[0]!=='string'){console.error('The arguments in scatterplot.labelColor(labelColor) should be string');return this}else{S=arguments[0];return this}}};l.tickNumber=function(_){if(!arguments.length)return N;else{if(!isFinite(arguments[0])){console.error('The arguments in scatterplot.tickNumber(tickNumber) should be number of tick');return this}else{N=Math.round(arguments[0]);return this}}};l.tickLineColor=function(_){if(!arguments.length)return Q;else{if(typeof arguments[0]!=='string'){console.error('The arguments in scatterplot.tickLineColor(tickLineColor) should be string');return this}else{Q=arguments[0];return this}}};l.tickTextSize=function(_){if(!arguments.length)return O;else{if(!isFinite(arguments[0])){console.error('The arguments in scatterplot.tickTextSize(tickTextSize) should be number');return this}else{O=arguments[0];return this}}};l.tickTextColor=function(_){if(!arguments.length)return P;else{if(typeof arguments[0]!=='string'){console.error('The arguments in scatterplot.tickTextColor(tickTextColor) should be string');return this}else{P=arguments[0];return this}}};l.padding=function(_){if(!arguments.length)return J;else{if(!isFinite(arguments[0])){console.error('The arguments in scatterplot.padding(padding) should be number');return this}else{J=arguments[0];return this}}};l.radius=function(_){if(!arguments.length)return H;else{if(!isFinite(arguments[0])){console.error('The arguments in scatterplot.radius(radius) should be number');return this}else{H=arguments[0];return this}}};l.options=function(_){if(!arguments.length)return{'type':l.getType(),'width':r,'height':t,'widthAvail':u,'heightAvail':v,'tranX':w,'tranY':z,'format':E,'fontFamily':B,'color':F,'duration':duration,'radius':H,'padding':J,'xtickRotate':L,'ytickRotate':M,'labelSize':R,'labelColor':S,'tickNumber':N,'tickTextSize':O,'tickTextColor':P,'tickLineColor':Q,'legendColor':T,'legendSize':U,'legendTranX':V,'legendTranY':W,'legendColumnNo':X,'legendRowGap':Y};else if(typeof _!=='object'){console.error('The arguments in map.options(options) should be object');return this}else{r=isFinite(_.width)?_.width:r;t=isFinite(_.height)?_.height:t;u=isFinite(_.widthAvail)?_.widthAvail:u;v=isFinite(_.heightAvail)?_.heightAvail:v;w=isFinite(_.tranX)?_.tranX:w;z=isFinite(_.tranY)?_.tranY:z;_.format&&l.tickFormat(_.format);_.fontFamily&&l.fontFamily(_.fontFamily);isFinite(_.duration)&&l.duration(_.duration);isFinite(_.padding)&&l.padding(_.padding);isFinite(_.radius)&&l.radius(_.radius);isFinite(_.xtickRotate)&&l.xtickRotate(_.xtickRotate);isFinite(_.ytickRotate)&&l.ytickRotate(_.ytickRotate);isFinite(_.labelSize)&&l.labelSize(_.labelSize);_.labelColor&&l.labelColor(_.labelColor);isFinite(_.tickNumber)&&l.tickNumber(_.tickNumber);isFinite(_.tickTextSize)&&l.tickTextSize(_.tickTextSize);_.tickTextColor&&l.tickTextColor(_.tickTextColor);_.tickLineColor&&l.tickLineColor(_.tickLineColor);_.legendColor&&l.legendColor(_.legendColor);isFinite(_.legendSize)&&l.legendSize(_.legendSize);V=isFinite(_.legendTranX)?_.legendTranX:V;W=isFinite(_.legendTranY)?_.legendTranY:W;isFinite(_.legendColumnNo)&&l.legendColumnNo(_.legendColumnNo);isFinite(_.legendRowGap)&&l.legendRowGap(_.legendRowGap);return this}};if(arguments.length===1)l.options(arguments[0]);return l};bw.model.stackbar=function(){var h=bw.extend();var j=_.d3;var l='堆叠柱状图';var m=800;var n=400;var o=m-200;var q=n-100;var r=0;var t;var u='Arial';var v;var w;var z;var A=1000;var B=j.format('s');var C=h.color();var D=0.2;var E;var F;var G='';var H='';var I=0;var J=0;var K=8;var L='#000000';var M=5;var N=5;var O=5;var P=8;var Q='#929292';var R='#929292';var S=2;var T='#000000';var U='#000000';var V=13;var W=0;var X=0;var Y=10;var Z=100;h.data=function(_){if(arguments.length){if(_.type==='xml'){_=_.root;_=_.map(function(d){var a={};d.row.row.forEach(function(p){var k=bw.keys(p)[0];a[k]=p[k]});return a})}else if(_.type==='xlsx'||_.type==='xls'){var s=[];for(var i=0;i<_.length;i++){var k=bw.keys(_[i])[0];s=s.concat(_[i][k])}_=s}E=bw.keys(_[0]).filter(function(d){return d!=='x'}).map(function(d){return{name:d,_flag:true}});F=_.map(function(d){var a=0;var b=E.map(function(p){return{name:p.name,y0:a,y1:a+=+d[p.name]}});var c=b[b.length-1].y1;return{value:b,total:c,x:d.x}});E.x=_.map(function(p){return p.x});t=_;return this}else return t};h.getType=function(){return l};h.render=function(_){w=w||j.select(_).node();if(!w||w.tagName.toLowerCase()!=='div'){h.log({priority:'Error',position:'stackbar',info:'The argument(element) in stackbar.rander(_) should be <div> element'});console.error('The argument(element) in stackbar.rander(_) should be <div> element')}j.select(w).classed('chart',true);z=z||j.select(w).append('svg').classed('stackbar',true).node();var x=j.scale.ordinal().rangeRoundBands([0,o],D);var y=j.scale.linear().rangeRound([q,0]);x.domain(E.x);y.domain([0,j.max(F,function(d){return d.total})]);var b=j.svg.axis().scale(x).orient('bottom').tickSize(N);var c=j.svg.axis().scale(y).orient('left').ticks(M).tickSize(O).tickFormat(B);v=j.select(w).select('.floatTag').node()?j.select(w).select('.floatTag'):h.floatTag(w);var g=j.select(z).attr({'width':m,'height':n}).selectAll('g').data([1]).enter().append('svg:g').attr('transform','translate('+tranX+','+r+')');g.call(function(a){a.append('svg:g').classed('dimensions',true);a.append('svg:g').classed('x-axis axis',true);a.append('svg:g').classed('y-axis axis',true);a.append('svg:g').classed('legends',true)});g=j.select(z).select('g');var e=g.selectAll('.dimensions').selectAll('.dimension').data(F);e.exit().transition().duration(A).style('opacity',0).remove();dimensionUpdate(e,x,y);dimensionDraw(e,x,y);g=j.select(z).select('g');var f=g.select('.legends').attr('transform','translate('+W+','+X+')').selectAll('.legend').data(E);f.exit().transition().duration(A).style('opacity',0).remove();legendUpdate(f);legendDraw(f);axis(g,b,c)};function dimensionUpdate(b,x,y){b.each(function(){var a=j.select(this).selectAll('rect').data(function(d){return d.value});a.exit().transition().duration(A).style('opacity',0).remove();a.transition().duration(A).style('fill',function(d){return C(d.name)}).attr('y',function(d){return y(d.y1)}).attr('width',x.rangeBand()).attr('height',function(d){return y(d.y0)-y(d.y1)});a.enter().append('svg:rect').attr({'height':0,'y':y(0),'width':x.rangeBand()}).style('fill',function(d){return C(d.name)}).on('mouseover',function(d){drawLegend(d,true)}).on('mouseout',function(d){drawLegend(d,false)}).transition().duration(A).attr('y',function(d){return y(d.y1)}).attr('height',function(d){return y(d.y0)-y(d.y1)});j.select(this).transition().duration(A).attr('transform',function(d){return'translate('+x(d.x)+',0)'})})}function dimensionDraw(a,x,y){a.enter().append('svg:g').classed('dimension',true).each(function(){j.select(this).selectAll('rect').data(function(d){return d.value}).enter().append('svg:rect').attr({'height':0,'y':y(0),'width':x.rangeBand()}).style('fill',function(d){return C(d.name)}).on('mouseover',function(d){drawLegend(d,true)}).on('mouseout',function(d){drawLegend(d,false)}).transition().duration(A).attr('y',function(d){return y(d.y1)}).attr('height',function(d){return y(d.y0)-y(d.y1)});j.select(this).transition().duration(A).attr('transform',function(d){return'translate('+x(d.x)+',0)'})})}function legendDraw(e){e.enter().append('svg:g').classed('legend',true).style('cursor','pointer').on('click',function(d){if(!j.select(this).classed('none')){if(E.length>1){j.select(this).classed('none',true);d._flag=false;F=t.map(function(d){var a=0;var b=E.filter(function(p){return p._flag}).map(function(p){return{name:p.name,y0:a,y1:a+=+d[p.name]}});var c=b[b.length-1].y1;return{value:b,total:c,x:d.x}});h.render()}}else{j.select(this).classed('none',false);d._flag=true;F=t.map(function(d){var a=0;var b=E.filter(function(p){return p._flag}).map(function(p){return{name:p.name,y0:a,y1:a+=+d[p.name]}});var c=b[b.length-1].y1;return{value:b,total:c,x:d.x}});h.render()}}).each(function(d,i){j.select(this).append('svg:rect').attr({'x':(i-i%Y)/Y*Z+o+20,'y':i%Y*20}).attr({'width':10,'height':10}).style({'fill':C(i),'stroke':C(i)}).style('fill-opacity',d._flag?1:0).style('opacity',0).transition().duration(A/2).style('opacity',1);j.select(this).append('svg:text').attr({'x':(i-i%Y)/Y*Z+o+40,'y':i%Y*20+9}).style({'opacity':0,'fill':U,'font-size':V,'font-family':u}).transition().duration(A/2).style('opacity',1).text(d.name)})}function legendUpdate(a){a.each(function(d,i){j.select(this).selectAll('rect').transition().duration(A/2).style({'fill':C(i),'stroke':C(i)}).style('fill-opacity',d._flag?1:0).attr({'x':(i-i%Y)/Y*Z+o+20,'y':i%Y*20});j.select(this).selectAll('text').transition().duration(A/2).attr({'x':(i-i%Y)/Y*Z+o+40,'y':i%Y*20+9}).style({'font-size':V,'fill':U,'font-family':u}).text(d.name)})}function axis(g,b,c){g.select('.x-axis').each(function(){j.select(this).select('.label').transition().duration(A).style({'text-anchor':'end','font-family':u,'font-size':K,'fill':L}).attr({'x':o,'y':-6}).text(H);j.select(this).selectAll('.label').data([1]).enter().append('svg:text').classed('label',true).style({'text-anchor':'end','font-family':u,'font-size':K,'fill':L}).attr({'x':o,'y':-6}).text(H);j.select(this).transition().duration(A).attr('transform','translate(0,'+q+')').call(b)});g.select('.y-axis').each(function(){j.select(this).select('.label').style({'text-anchor':'end','font-family':u,'font-size':K,'fill':L}).text(G);j.select(this).selectAll('.label').data([1]).enter().append('svg:text').classed('label',true).style({'text-anchor':'end','font-family':u,'font-size':K,'fill':L}).attr({'transform':'rotate(-90)','y':8,'dy':'.71em'}).text(G);j.select(this).transition().duration(A).call(c)});g.selectAll('.axis').call(function(a){a.selectAll('path').style({'fill':'none','stroke':T,'stroke-width':S,'shape-rendering':'crispEdges'});a.selectAll('line').style({'fill':'none','stroke':R,'shape-rendering':'crispEdges'})});g.select('.x-axis').selectAll('.tick').select('text').style({'text-anchor':'middle','font-family':u,'font-size':P,'fill':Q}).attr('transform',function(){return'translate('+this.getComputedTextLength()*Math.abs(Math.sin(I)*.5)+','+(this.getComputedTextLength()*(.5*Math.abs(Math.sin(I)))+5)+')rotate('+I+')'});g.select('.y-axis').selectAll('.tick').select('text').style({'text-anchor':'start','font-family':u,'font-size':P,'fill':Q}).attr('transform',function(){return'translate('+ -this.getComputedTextLength()+', 0)rotate('+J+')'})}function drawLegend(d,a){if(a){v.style({'border-color':C(d.name),'opacity':1,'textAlign':'center','margin':'auto'}).html('name: '+d.name+'<br/>value: '+B(d.y1-d.y0))}else{v.style('opacity',0)}}h.size=function(_){if(!arguments.length)return[m,n];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in stackbar.size(width, height) should be number and number of svg');return this}else{m=arguments[0];n=arguments[1];return this}};h.sizeAvail=function(_){if(!arguments.length)return[o,q];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in stackbar.sizeAvail(widthAvail, heightAvail) should be number and number of svg');return this}else{o=arguments[0];q=arguments[1];return this}};h.tran=function(_){if(!arguments.length)return[tranX,r];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in stackbar.tran(tranX, tranY) should be number and number of svg');return this}else{tranX=arguments[0];r=arguments[1];return this}};h.fontSize=function(_){if(!arguments.length)return fontSize;else{if(!isFinite(arguments[0])){console.error('The arguments in stackbar.fontSize(fontSize) should be number of text');return this}else{fontSize=arguments[0];return this}}};h.fontFamily=function(_){if(!arguments.length)return u;else{if(typeof arguments[0]!=='string'){console.error('The arguments in stackbar.fontFamily(fontFamily) should be string of text');return this}else{fontSize=arguments[0];return this}}};h.duration=function(_){if(!arguments.length)return A;else{if(!isFinite(arguments[0])){console.error('The arguments in stackbar.duration(duration) should be number of transition');return this}else{A=Math.round(arguments[0]);return this}}};h.color=function(_){if(!arguments.length)return C;else{if(typeof arguments[0]!=='function'){console.error('The arguments in stackbar.color(color) should be function of pvisual.color');return this}else{C=arguments[0];return this}}};h.tickFormat=function(_){if(!arguments.length)return B;else{if(typeof arguments[0]!=='string'){console.error('The arguments in stackbar.tickFormat(format) should be string of d3.format');return this}else{B=j.format(arguments[0]);return this}}};h.padding=function(_){if(!arguments.length)return D;else{if(!isFinite(arguments[0])){console.error('The arguments in stackbar.padding(padding) should be number');return this}else{D=arguments[0];return this}}};h.xLegend=function(_){if(!arguments.length)return H;else{if(typeof arguments[0]!=='string'){console.error('The arguments in stackbar.xLegend(xLegend) should be string');return this}else{H=arguments[0];return this}}};h.yLegend=function(_){if(!arguments.length)return G;else{if(typeof arguments[0]!=='string'){console.error('The arguments in stackbar.yLegend(yLegend) should be string');return this}else{G=arguments[0];return this}}};h.xtickRotate=function(_){if(!arguments.length)return I;else{if(!isFinite(arguments[0])){console.error('The arguments in stackbar.xtickRotate(xtickRotate) should be number of tick');return this}else{I=Math.round(arguments[0]);return this}}};h.ytickRotate=function(_){if(!arguments.length)return J;else{if(!isFinite(arguments[0])){console.error('The arguments in stackbar.ytickRotate(ytickRotate) should be number of tick');return this}else{J=Math.round(arguments[0]);return this}}};h.labelSize=function(_){if(!arguments.length)return K;else{if(!isFinite(arguments[0])){console.error('The arguments in stackbar.labelSize(labelSize) should be string');return this}else{K=arguments[0];return this}}};h.labelColor=function(_){if(!arguments.length)return L;else{if(typeof arguments[0]!=='string'){console.error('The arguments in stackbar.labelColor(labelColor) should be string');return this}else{L=arguments[0];return this}}};h.ytickNumber=function(_){if(!arguments.length)return M;else{if(!isFinite(arguments[0])){console.error('The arguments in stackbar.ytickNumber(ytickNumber) should be number of tick');return this}else{M=Math.round(arguments[0]);return this}}};h.tickLineColor=function(_){if(!arguments.length)return R;else{if(typeof arguments[0]!=='string'){console.error('The arguments in stackbar.tickLineColor(tickLineColor) should be string');return this}else{R=arguments[0];return this}}};h.tickTextSize=function(_){if(!arguments.length)return P;else{if(!isFinite(arguments[0])){console.error('The arguments in stackbar.tickTextSize(tickTextSize) should be number');return this}else{P=arguments[0];return this}}};h.tickTextColor=function(_){if(!arguments.length)return Q;else{if(typeof arguments[0]!=='string'){console.error('The arguments in stackbar.tickTextColor(tickTextColor) should be string');return this}else{Q=arguments[0];return this}}};h.axisPathWidth=function(_){if(!arguments.length)return S;else{if(!isFinite(arguments[0])){console.error('The arguments in stackbar.axisPathWidth(axisPathWidth) should be string');return this}else{S=arguments[0];return this}}};h.axisPathColor=function(_){if(!arguments.length)return T;else{if(typeof arguments[0]!=='string'){console.error('The arguments in stackbar.axisPathColor(axisPathColor) should be string');return this}else{T=arguments[0];return this}}};h.legendTran=function(_){if(!arguments.length)return[W,X];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in stackbar.legendTran(tranX, tranY) should be number and number of svg');return this}else{W=arguments[0];X=arguments[1];return this}};h.legendSize=function(_){if(!arguments.length)return V;else{if(!isFinite(arguments[0])){console.error('The arguments in stackbar.legendSize(legendSize) should be number of text');return this}else{V=arguments[0];return this}}};h.legendColor=function(_){if(!arguments.length)return U;else{if(typeof arguments[0]!=='string'){console.error('The arguments in stackbar.legendColor(legendColor) should be string of text');return this}else{U=arguments[0];return this}}};h.legendColumnNo=function(_){if(!arguments.length)return Y;else{if(!isFinite(arguments[0])){console.error('The arguments in stackbar.legendColumnNo(legendColumnNo) should be number of text');return this}else{Y=arguments[0];return this}}};h.legendRowGap=function(_){if(!arguments.length)return Z;else{if(!isFinite(arguments[0])){console.error('The arguments in stackbar.legendRowGap(legendRowGap) should be number of text');return this}else{Z=arguments[0];return this}}};h.options=function(_){if(!arguments.length)return{'type':h.getType(),'width':m,'height':n,'widthAvail':o,'heightAvail':q,'tranX':tranX,'tranY':r,'format':B,'fontFamily':u,'color':C,'duration':A,'padding':D,'xLegend':H,'yLegend':G,'xtickRotate':I,'ytickRotate':J,'labelSize':K,'labelColor':L,'ytickNumber':M,'tickTextSize':P,'tickTextColor':Q,'tickLineColor':R,'xtickLineLength':N,'ytickLineLength':O,'axisPathWidth':S,'axisPathColor':T,'legendColor':U,'legendSize':V,'legendTranX':W,'legendTranY':X,'legendColumnNo':Y,'legendRowGap':Z};else if(typeof _!=='object'){console.error('The arguments in map.options(options) should be object');return this}else{m=isFinite(_.width)?_.width:m;n=isFinite(_.height)?_.height:n;o=isFinite(_.widthAvail)?_.widthAvail:o;q=isFinite(_.heightAvail)?_.heightAvail:q;tranX=isFinite(_.tranX)?_.tranX:tranX;r=isFinite(_.tranY)?_.tranY:r;_.format&&h.tickFormat(_.format);_.fontFamily&&h.fontFamily(_.fontFamily);isFinite(_.duration)&&h.duration(_.duration);_.xLegend&&h.xLegend(_.xLegend);_.yLegend&&h.yLegend(_.yLegend);isFinite(_.xtickRotate)&&h.xtickRotate(_.xtickRotate);isFinite(_.ytickRotate)&&h.ytickRotate(_.ytickRotate);isFinite(_.labelSize)&&h.labelSize(_.labelSize);_.labelColor&&h.labelColor(_.labelColor);isFinite(_.padding)&&h.padding(_.padding);isFinite(_.ytickNumber)&&h.ytickNumber(_.ytickNumber);isFinite(_.tickTextSize)&&h.tickTextSize(_.tickTextSize);_.tickTextColor&&h.tickTextColor(_.tickTextColor);_.tickLineColor&&h.tickLineColor(_.tickLineColor);isFinite(_.xtickLineLength)&&h.xtickLineLength(_.xtickLineLength);isFinite(_.ytickLineLength)&&h.ytickLineLength(_.ytickLineLength);isFinite(_.axisPathWidth)&&h.axisPathWidth(_.axisPathWidth);_.axisPathColor&&h.axisPathColor(_.axisPathColor);_.legendColor&&h.legendColor(_.legendColor);isFinite(_.legendSize)&&h.legendSize(_.legendSize);W=isFinite(_.legendTranX)?_.legendTranX:W;X=isFinite(_.legendTranY)?_.legendTranY:X;isFinite(_.legendColumnNo)&&h.legendColumnNo(_.legendColumnNo);isFinite(_.legendRowGap)&&h.legendRowGap(_.legendRowGap);return this}};if(arguments.length===1)h.options(arguments[0]);return h};bw.model.sunburst=function(){var j=bw.extend();var l=_.d3;var m='Sunburst';var n=800;var o=800;var q=n;var r=o;var s=0;var v=0;var w;var z=10;var A='#FFFFFF';var B='Arial';var C;var D;var E;var F=1000;var G=l.format('s');var H=j.color();var I=Math.min(q,r)*.45;j.data=function(_){if(arguments.length){if(_.type==='xml'){_=_.root;_=XMLdata(_)}w=_;return this}else return w};j.getType=function(){return m};j.render=function(_){D=D||l.select(_).node();if(!D||D.tagName.toLowerCase()!=='div'){console.error('The argument(element) in sunburst.rander(_) should be <div> element')}l.select(D).classed('chart',true);E=E||l.select(D).append('svg').classed('sunburst',true).node();var x=l.scale.linear().domain([0,1]).range([0,2*Math.PI]);var y=l.scale.pow().exponent(1.5).domain([0,1]).range([0,I]);var c=l.scale.sqrt().domain([0,1e6]).clamp(true).range([90,20]);var e=l.layout.partition().sort(function(a,b){return l.ascending(a.name,b.name)}).value(function(d){return d.value}).nodes(w).map(function(d){d.sum=d.value;d.fill=fill(d,c);return d});var f=l.svg.arc().startAngle(function(d){return Math.max(0,Math.min(2*Math.PI,x(d.x)))}).endAngle(function(d){return Math.max(0,Math.min(2*Math.PI,x(d.x+d.dx)))}).innerRadius(function(d){return Math.max(0,d.y?y(d.y):d.y)}).outerRadius(function(d){return Math.max(0,y(d.y+d.dy))});C=l.select(D).select('.floatTag').node()?l.select(D).select('.floatTag'):j.floatTag(D);var g=l.select(E).attr({'width':n,'height':o}).selectAll('g').data([1]).enter().append('svg:g').attr('transform','translate('+(s+I*1.1)+','+(v+I*1.1)+')');g.call(function(a){a.append('svg:g').classed('nodes',true)});g=l.select(E).select('g');var h=g.select('.nodes').selectAll('.node').data(e);h.exit().transition().duration(F/2).style('opacity',0).remove();h.each(function(d){l.select(this).select('path').transition().duration(F).attr('d',f).style('fill',function(d){return d.fill}).style('stroke',function(){return d.dx<.002?'none':gapColor});l.select(this).select('text').transition().duration(F).style({'font-family':B,'fill':A,'font-size':z}).attrTween('text-anchor',function(d){return function(){return x(d.x+d.dx/2)>Math.PI?'end':'start'}}).attrTween('transform',function(){return function(){var a=x(d.x+d.dx/2)*180/Math.PI-90;return'rotate('+a+')translate('+(y(d.y)+10)+')rotate('+(a>90?-180:0)+')'}}).style('fill-opacity',x(d.dx)<0.1||d.parent===undefined?0:1).text(d.name.substring(0,Math.round(y(d.dy)/9)));l.select(this).on('click',function(d){return click(d,x,y,h,f)})});h.enter().append('g').classed('node',true).attr('data-depth',function(d){return d.depth}).style('cursor','pointer').on('mouseover',function(d){l.select(this).style('opacity',.8);drawLegend(d,true)}).on('mouseout',function(d){drawLegend(d,false);l.select(this).style('opacity',1)}).each(function(d){l.select(this).append('path').style('fill',d.fill).style('opacity',0).style('stroke',function(){return d.dx<.002?'none':gapColor}).transition().duration(F).attr('d',f).style('opacity',1);l.select(this).append('text').attr('dy','5px').transition().duration(F).style({'font-family':B,'fill':A,'font-size':z}).style('fill-opacity',x(d.dx)<0.1||d.parent===undefined?0:1).attr('text-anchor',x(d.x+d.dx/2)>Math.PI?'end':'start').attr('transform',function(){var a=x(d.x+d.dx/2)*180/Math.PI-90;return'rotate('+a+')translate('+(y(d.y)+10)+')rotate('+(a>90?-180:0)+')'}).text(d.name.substring(0,Math.round(y(d.dy)/9)));l.select(this).on('click',function(d){return click(d,x,y,h,f)})})};function click(d,x,y,b,c){var e=b.selectAll('text');var f=b.selectAll('path');var g=l.scale.linear().domain([0,d.dx]).range([0,2*Math.PI]);f.transition().duration(F).attrTween('d',arcTween(d,x,y,c));e.transition().duration(F).attrTween('text-anchor',function(p){return function(){return x(p.x+p.dx/2)>Math.PI?'end':'start'}}).attrTween('transform',function(p){return function(){var a=x(p.x+p.dx/2)*180/Math.PI-90;return'rotate('+a+')translate('+(y(p.y)+10)+')rotate('+(a>90?-180:0)+')'}}).style('fill-opacity',function(p){return g(p.dx)>0.1&&p.parent!==undefined&&isParentOf(d,p)?1:0})}function isParentOf(p,c){if(p===c)return true;if(p.children){return p.children.some(function(d){return isParentOf(d,c)})}return false}function arcTween(d,x,y,a){var b=maxY(d),xd=l.interpolate(x.domain(),[d.x,d.x+d.dx]),yd=l.interpolate(y.domain(),[d.y,b]),yr=l.interpolate(y.range(),[d.y?20:0,I]);return function(p){return function(t){x.domain(xd(t));y.domain(yd(t)).range(yr(t));return a(p)}}}function maxY(d){return d.children?Math.max.apply(Math,d.children.map(maxY)):d.y+d.dy}function fill(d,a){var p=d;while(p.depth>1)p=p.parent;var c=l.lab(H(p.name));c.l=a(d.sum);return c}function drawLegend(d,a){if(a){C.style({'border-color':d.fill,'opacity':1,'textAlign':'center','margin':'auto'}).html('<p style="color:#3f7ed8;font-weight:bold;font-size:12px;margin-bottom:5px;">name: '+d.name+'</p>value: '+d.value)}else{C.style('opacity',0)}}function XMLdata(d){if(typeof d==='object'&&d.constructor===Array){var a=0;var b;var c;var u;d.forEach(function(p,i){if(p.name!==undefined){b=i;a++}if(p.value!==undefined){c=i;a++}});if(a===1){var k=d.filter(function(p,i){return i!==b});for(var i=0;i<k.length;i++){k[i].children.children=XMLdata(k[i].children.children)}u={name:d[b].name,children:d.filter(function(p,i){return i!==b}).map(function(p){return p.children.children})}}if(a===2){u={name:d[b].name,value:+d[c].value}}}return u}j.size=function(_){if(!arguments.length)return[n,o];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in sunburst.size(width, height) should be number and number of svg');return this}else{n=arguments[0];o=arguments[1];return this}};j.sizeAvail=function(_){if(!arguments.length)return[q,r];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in sunburst.sizeAvail(widthAvail, heightAvail) should be number and number of svg');return this}else{q=arguments[0];r=arguments[1];return this}};j.tran=function(_){if(!arguments.length)return[s,v];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in sunburst.tran(tranX, tranY) should be number and number of svg');return this}else{s=arguments[0];v=arguments[1];return this}};j.fontSize=function(_){if(!arguments.length)return z;else{if(!isFinite(arguments[0])){console.error('The arguments in sunburst.fontSize(fontSize) should be number of text');return this}else{z=arguments[0];return this}}};j.fontFamily=function(_){if(!arguments.length)return B;else{if(typeof arguments[0]!=='string'){console.error('The arguments in sunburst.fontFamily(fontFamily) should be string of text');return this}else{z=arguments[0];return this}}};j.fontColor=function(_){if(!arguments.length)return A;else{if(typeof arguments[0]!=='string'){console.error('The arguments in sunburst.fontColor(fontColor) should be string of text');return this}else{A=arguments[0];return this}}};j.duration=function(_){if(!arguments.length)return F;else{if(!isFinite(arguments[0])){console.error('The arguments in sunburst.duration(duration) should be number of transition');return this}else{F=Math.round(arguments[0]);return this}}};j.color=function(_){if(!arguments.length)return H;else{if(typeof arguments[0]!=='function'){console.error('The arguments in sunburst.color(color) should be function of pvisual.color');return this}else{H=arguments[0];return this}}};j.tickFormat=function(_){if(!arguments.length)return G;else{if(typeof arguments[0]!=='string'){console.error('The arguments in sunburst.tickFormat(format) should be string of d3.format');return this}else{G=l.format(arguments[0]);return this}}};j.gapColor=function(_){if(!arguments.length)return gapColor;else{if(typeof arguments[0]!=='string'){console.error('The arguments in sunburst.gapColor(gapColor) should be string');return this}else{gapColor=arguments[0];return this}}};j.radius=function(_){if(!arguments.length)return I;else{if(!isFinite(arguments[0])){console.error('The arguments in sunburst.radius(radius) should be number');return this}else{I=arguments[0];return this}}};j.options=function(_){if(!arguments.length)return{'type':j.getType(),'width':n,'height':o,'widthAvail':q,'heightAvail':r,'tranX':s,'tranY':v,'format':G,'fontSize':z,'fontColor':A,'fontFamily':B,'color':H,'duration':F,'radius':I,'gapColor':gapColor};else if(typeof _!=='object'){console.error('The arguments in map.options(options) should be object');return this}else{n=isFinite(_.width)?_.width:n;o=isFinite(_.height)?_.height:o;q=isFinite(_.widthAvail)?_.widthAvail:q;r=isFinite(_.heightAvail)?_.heightAvail:r;s=isFinite(_.tranX)?_.tranX:s;v=isFinite(_.tranY)?_.tranY:v;_.format&&j.tickFormat(_.format);_.fontFamily&&j.fontFamily(_.fontFamily);_.fontColor&&j.fontColor(_.fontColor);isFinite(_.fontSize)&&j.fontSize(_.fontSize);isFinite(_.duration)&&j.duration(_.duration);isFinite(_.radius)&&j.radius(_.radius);_.gapColor&&j.gapColor(_.gapColor);return this}};if(arguments.length===1)j.options(arguments[0]);return j};bw.model.surveyplot=function(){var l=bw.extend();var m=_.d3;var n='Surveyplot';var o=800;var q=400;var r=o-150;var t;var u=30;var v=20;var w='#000000';var x='Arial';var z;var A;var B;var C=1000;var D=m.format('s');var E=l.color();var F;var G=.1;var H='';var I='';var J=0;var K=0;var L=8;var M='#000000';var N=5;var O=5;var P=5;var Q=8;var R='#929292';var S='#929292';var T=2;var U='#000000';var V='#000000';var W=13;var X=0;var Y=0;var Z=10;var bx=100;l.data=function(_){if(arguments.length){if(_.type==='xml'){_=_.root;_=_.map(function(d){var a={};d.row.row.forEach(function(p){var k=bw.keys(p)[0];a[k]=p[k]});return a})}else if(_.type==='xlsx'||_.type==='xls'){var s=[];for(var i=0;i<_.length;i++){var k=bw.keys(_[i])[0];s=s.concat(_[i][k])}_=s}var b=bw.keys(_[0]).filter(function(p){return p!=='species'});b.forEach(function(d){_.forEach(function(p){p.dimensions={};p[d]=+p[d]})});F=b.map(function(d){return{name:d,_flag:true,extent:m.extent(_,function(p){return p[d]})}});F.species=m.set(_.map(function(d){return d.species})).values();t=_;return this}else return t};l.getType=function(){return n};l.render=function(_){A=A||m.select(_).node();if(!A||A.tagName.toLowerCase()!=='div'){console.error('The argument(element) in surveyplot.rander(_) should be <div> element')}m.select(A).classed('chart',true);B=B||m.select(A).append('svg').classed('surveyplot',true).node();var b=F.filter(function(d){return d._flag});var c=m.scale.ordinal();var e=m.scale.linear();var y=m.scale.linear();c.rangeRoundBands([0,r],G);y.rangeRound([heightAvail,0]);c.domain(b.map(function(d){return d.name}));y.domain([0,t.length-1]);var f=m.svg.axis().scale(c).orient('bottom').tickSize(O);var h=m.svg.axis().scale(y).orient('left').ticks(N).tickSize(P).tickFormat(D);z=m.select(A).select('.floatTag').node()?m.select(A).select('.floatTag'):l.floatTag(A);var g=m.select(B).attr({'width':o,'height':q}).selectAll('g').data([1]).enter().append('svg:g').attr('transform','translate('+u+','+v+')');g.call(function(a){a.append('svg:g').classed('dimensions',true);a.append('svg:g').classed('x-axis axis',true);a.append('svg:g').classed('y-axis axis',true);a.append('svg:g').classed('legends',true)});g=m.select(B).select('g');var i=g.select('.dimensions').selectAll('.dimension').data(b);i.exit().transition().duration(C/2).style('opacity',0).remove();dimensionUpdate(i,c,e,y,b);dimensionDraw(i,c,e,y,b);var j=g.select('.legends').attr('transform','translate('+X+','+Y+')').selectAll('.legend').data(F);j.exit().transition().duration(C).style('opacity',0).remove();legendUpdate(j);legendDraw(j,b);axis(g,f,h,c)};function dimensionUpdate(e,f,g,y,h){e.transition().duration(C).attr('transform',function(d){return'translate('+f(d.name)+', 0)'}).each(function(d){var a=f.rangeBand();var b=Math.round(heightAvail/t.length)+1;g.domain([0,d.extent[1]]).range([0,a]);var c=m.select(this).selectAll('.box').data(t);c.exit().transition().duration(C).style('opacity',0).remove();c.on('mouseover',function(p){h.forEach(function(k){m.select(p.dimensions[k.name]).style('fill',E(t.length))});drawLegend(p,true,h)}).on('mouseout',function(p){h.forEach(function(k){m.select(p.dimensions[k.name]).style('fill',function(){return E(p.species)})});drawLegend(p,false,h)}).transition().duration(C/2).style('fill',function(p){p.dimensions[d.name]=this;return E(p.species)}).attr('x',function(p){return(a-g(p[d.name]))/2}).attr('y',function(p,i){return y(i)}).attr('width',function(p){return g(p[d.name])}).attr('height',function(){return b});c.enter().append('svg:rect').classed('box',true).style('stroke','none').style('fill',function(p){p.dimensions[d.name]=this;return E(p.species)}).on('mouseover',function(p){h.forEach(function(k){m.select(p.dimensions[k.name]).style('fill',E(t.length))});drawLegend(p,true,h)}).on('mouseout',function(p){h.forEach(function(k){m.select(p.dimensions[k.name]).style('fill',function(){return E(p.species)})});drawLegend(p,false,h)}).transition().duration(C/2).attr('x',function(p){return(a-g(p[d.name]))/2}).attr('y',function(p,i){return y(i)}).attr('width',function(p){return g(p[d.name])}).attr('height',function(){return b})})}function dimensionDraw(c,e,f,y,g){c.enter().append('svg:g').classed('dimension',true).transition().duration(C).attr('transform',function(d){return'translate('+e(d.name)+', 0)'}).each(function(d){var a=e.rangeBand();var b=Math.round(heightAvail/t.length)+1;f.domain([0,d.extent[1]]).range([0,a]);m.select(this).selectAll('.box').data(t).enter().append('svg:rect').classed('box',true).style('stroke','none').style('fill',function(p){p.dimensions[d.name]=this;return E(p.species)}).on('mouseover',function(p){g.forEach(function(k){m.select(p.dimensions[k.name]).style('fill',E(t.length))});drawLegend(p,true,g)}).on('mouseout',function(p){g.forEach(function(k){m.select(p.dimensions[k.name]).style('fill',function(){return E(p.species)})});drawLegend(p,false,g)}).transition().duration(C/2).attr('x',function(p){return(a-f(p[d.name]))/2}).attr('y',function(p,i){return y(i)}).attr('width',function(p){return f(p[d.name])}).attr('height',function(){return b})})}function legendDraw(a,b){a.enter().append('svg:g').classed('legend',true).style('cursor','pointer').on('click',function(d){if(!m.select(this).classed('none')){if(b.length>1){m.select(this).classed('none',true);d._flag=false;l.render()}}else{m.select(this).classed('none',false);d._flag=true;l.render()}}).each(function(d,i){m.select(this).append('svg:rect').attr({'x':(i-i%Z)/Z*bx+r+20,'y':i%Z*20}).attr({'width':10,'height':10}).style({'fill':E(i),'stroke':E(i)}).style('fill-opacity',d._flag?1:0).style('opacity',0).transition().duration(C/2).style('opacity',1);m.select(this).append('svg:text').attr({'x':(i-i%Z)/Z*bx+r+40,'y':i%Z*20+9}).style({'opacity':0,'font-size':W,'fill':V,'font-family':x}).transition().duration(C/2).style('opacity',1).text(d.name)})}function legendUpdate(a){a.each(function(d,i){m.select(this).selectAll('rect').transition().duration(C/2).style({'fill':E(i),'stroke':E(i)}).style('fill-opacity',d._flag?1:0).attr({'x':(i-i%Z)/Z*bx+r+20,'y':i%Z*20});m.select(this).selectAll('text').transition().duration(C/2).attr({'x':(i-i%Z)/Z*bx+r+40,'y':i%Z*20+9}).style({'font-size':W,'fill':V,'font-family':x}).text(d.name)})}function axis(g,b,c){g.select('.x-axis').each(function(){m.select(this).select('.label').transition().duration(C).attr({'x':r,'y':-6}).style({'text-anchor':'end','font-family':x,'font-size':L,'fill':M}).text(I);m.select(this).selectAll('.label').data([1]).enter().append('svg:text').classed('label',true).style({'text-anchor':'end','font-family':x,'font-size':L,'fill':M}).attr({'x':r,'y':-6}).text(I);m.select(this).transition().duration(C).attr('transform','translate(0,'+(heightAvail+2)+')').call(b)});g.select('.y-axis').each(function(){m.select(this).select('.label').style({'text-anchor':'end','font-family':x,'font-size':L,'fill':M}).text(H);m.select(this).selectAll('.label').data([1]).enter().append('svg:text').classed('label',true).style({'text-anchor':'end','font-family':x,'font-size':L,'fill':M}).attr({'transform':'rotate(-90)','y':8,'dy':'.71em'}).text(H);m.select(this).transition().duration(C).call(c)});g.selectAll('.axis').call(function(a){a.selectAll('path').style({'fill':'none','stroke':U,'stroke-width':T,'shape-rendering':'crispEdges'});a.selectAll('line').style({'fill':'none','stroke':S,'shape-rendering':'crispEdges'})});g.select('.x-axis').selectAll('.tick').select('text').style({'text-anchor':'end','font-family':x,'font-size':Q,'fill':R}).attr('transform',function(){return'translate('+(this.getComputedTextLength()/2+this.getComputedTextLength()*Math.abs(Math.sin(J)*.5))+','+(this.getComputedTextLength()*(.5*Math.abs(Math.sin(J)))+5)+')rotate('+J+')'});g.select('.y-axis').selectAll('.tick').select('text').style({'text-anchor':'start','font-family':x,'font-size':Q,'fill':R}).attr('transform',function(){return'translate('+ -this.getComputedTextLength()+', 0)rotate('+K+')'})}function drawLegend(d,a,b){if(a){var c='';b.forEach(function(p){c+=p.name+'= '+d[p.name]+'<br/>'});z.style({'border-color':E(d.species),'opacity':1,'textAlign':'center','margin':'auto'}).html('Attributes:<br/> '+c+'<br/>'+'Class: '+d.species)}else{z.style('opacity',0)}}l.size=function(_){if(!arguments.length)return[o,q];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in surveyplot.size(width, height) should be number and number of svg');return this}else{o=arguments[0];q=arguments[1];return this}};l.sizeAvail=function(_){if(!arguments.length)return[r,heightAvail];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in surveyplot.sizeAvail(widthAvail, heightAvail) should be number and number of svg');return this}else{r=arguments[0];heightAvail=arguments[1];return this}};l.tran=function(_){if(!arguments.length)return[u,v];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in surveyplot.tran(tranX, tranY) should be number and number of svg');return this}else{u=arguments[0];v=arguments[1];return this}};l.fontSize=function(_){if(!arguments.length)return fontSize;else{if(!isFinite(arguments[0])){console.error('The arguments in surveyplot.fontSize(fontSize) should be number of text');return this}else{fontSize=arguments[0];return this}}};l.fontFamily=function(_){if(!arguments.length)return x;else{if(typeof arguments[0]!=='string'){console.error('The arguments in surveyplot.fontFamily(fontFamily) should be string of text');return this}else{fontSize=arguments[0];return this}}};l.duration=function(_){if(!arguments.length)return C;else{if(!isFinite(arguments[0])){console.error('The arguments in surveyplot.duration(duration) should be number of transition');return this}else{C=Math.round(arguments[0]);return this}}};l.color=function(_){if(!arguments.length)return E;else{if(typeof arguments[0]!=='function'){console.error('The arguments in surveyplot.color(color) should be function of pvisual.color');return this}else{E=arguments[0];return this}}};l.tickFormat=function(_){if(!arguments.length)return D;else{if(typeof arguments[0]!=='string'){console.error('The arguments in surveyplot.tickFormat(format) should be string of d3.format');return this}else{D=m.format(arguments[0]);return this}}};l.xLegend=function(_){if(!arguments.length)return I;else{if(typeof arguments[0]!=='string'){console.error('The arguments in surveyplot.xLegend(xLegend) should be string');return this}else{I=arguments[0];return this}}};l.yLegend=function(_){if(!arguments.length)return H;else{if(typeof arguments[0]!=='string'){console.error('The arguments in surveyplot.yLegend(yLegend) should be string');return this}else{H=arguments[0];return this}}};l.xtickRotate=function(_){if(!arguments.length)return J;else{if(!isFinite(arguments[0])){console.error('The arguments in surveyplot.xtickRotate(xtickRotate) should be number of tick');return this}else{J=Math.round(arguments[0]);return this}}};l.ytickRotate=function(_){if(!arguments.length)return K;else{if(!isFinite(arguments[0])){console.error('The arguments in surveyplot.ytickRotate(ytickRotate) should be number of tick');return this}else{K=Math.round(arguments[0]);return this}}};l.labelSize=function(_){if(!arguments.length)return L;else{if(!isFinite(arguments[0])){console.error('The arguments in surveyplot.labelSize(labelSize) should be string');return this}else{L=arguments[0];return this}}};l.labelColor=function(_){if(!arguments.length)return M;else{if(typeof arguments[0]!=='string'){console.error('The arguments in surveyplot.labelColor(labelColor) should be string');return this}else{M=arguments[0];return this}}};l.ytickNumber=function(_){if(!arguments.length)return N;else{if(!isFinite(arguments[0])){console.error('The arguments in surveyplot.ytickNumber(ytickNumber) should be number of tick');return this}else{N=Math.round(arguments[0]);return this}}};l.tickLineColor=function(_){if(!arguments.length)return S;else{if(typeof arguments[0]!=='string'){console.error('The arguments in surveyplot.tickLineColor(tickLineColor) should be string');return this}else{S=arguments[0];return this}}};l.tickTextSize=function(_){if(!arguments.length)return Q;else{if(!isFinite(arguments[0])){console.error('The arguments in surveyplot.tickTextSize(tickTextSize) should be number');return this}else{Q=arguments[0];return this}}};l.tickTextColor=function(_){if(!arguments.length)return R;else{if(typeof arguments[0]!=='string'){console.error('The arguments in surveyplot.tickTextColor(tickTextColor) should be string');return this}else{R=arguments[0];return this}}};l.axisPathWidth=function(_){if(!arguments.length)return T;else{if(!isFinite(arguments[0])){console.error('The arguments in surveyplot.axisPathWidth(axisPathWidth) should be string');return this}else{T=arguments[0];return this}}};l.axisPathColor=function(_){if(!arguments.length)return U;else{if(typeof arguments[0]!=='string'){console.error('The arguments in surveyplot.axisPathColor(axisPathColor) should be string');return this}else{U=arguments[0];return this}}};l.legendTran=function(_){if(!arguments.length)return[X,Y];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in surveyplot.legendTran(tranX, tranY) should be number and number of svg');return this}else{X=arguments[0];Y=arguments[1];return this}};l.legendSize=function(_){if(!arguments.length)return W;else{if(!isFinite(arguments[0])){console.error('The arguments in surveyplot.legendSize(legendSize) should be number of text');return this}else{W=arguments[0];return this}}};l.legendColor=function(_){if(!arguments.length)return V;else{if(typeof arguments[0]!=='string'){console.error('The arguments in surveyplot.legendColor(legendColor) should be string of text');return this}else{V=arguments[0];return this}}};l.legendColumnNo=function(_){if(!arguments.length)return Z;else{if(!isFinite(arguments[0])){console.error('The arguments in surveyplot.legendColumnNo(legendColumnNo) should be number of text');return this}else{Z=arguments[0];return this}}};l.legendRowGap=function(_){if(!arguments.length)return bx;else{if(!isFinite(arguments[0])){console.error('The arguments in surveyplot.legendRowGap(legendRowGap) should be number');return this}else{bx=arguments[0];return this}}};l.padding=function(_){if(!arguments.length)return G;else{if(!isFinite(arguments[0])){console.error('The arguments in surveyplot.padding(padding) should be number');return this}else{G=arguments[0];return this}}};l.options=function(_){if(!arguments.length)return{'type':l.getType(),'width':o,'height':q,'widthAvail':r,'heightAvail':heightAvail,'tranX':u,'tranY':v,'format':D,'fontFamily':x,'color':E,'duration':C,'padding':G,'xLegend':I,'yLegend':H,'xtickRotate':J,'ytickRotate':K,'labelSize':L,'labelColor':M,'ytickNumber':N,'tickTextSize':Q,'tickTextColor':R,'tickLineColor':S,'xtickLineLength':O,'ytickLineLength':P,'axisPathWidth':T,'axisPathColor':U,'legendColor':V,'legendSize':W,'legendTranX':X,'legendTranY':Y,'legendColumnNo':Z,'legendRowGap':bx};else if(typeof _!=='object'){console.error('The arguments in map.options(options) should be object');return this}else{o=isFinite(_.width)?_.width:o;q=isFinite(_.height)?_.height:q;r=isFinite(_.widthAvail)?_.widthAvail:r;heightAvail=isFinite(_.heightAvail)?_.heightAvail:heightAvail;u=isFinite(_.tranX)?_.tranX:u;v=isFinite(_.tranY)?_.tranY:v;_.format&&l.tickFormat(_.format);_.fontFamily&&l.fontFamily(_.fontFamily);isFinite(_.duration)&&l.duration(_.duration);isFinite(_.padding)&&l.padding(_.padding);_.xLegend&&l.xLegend(_.xLegend);_.yLegend&&l.yLegend(_.yLegend);isFinite(_.xtickRotate)&&l.xtickRotate(_.xtickRotate);isFinite(_.ytickRotate)&&l.ytickRotate(_.ytickRotate);isFinite(_.labelSize)&&l.labelSize(_.labelSize);_.labelColor&&l.labelColor(_.labelColor);isFinite(_.ytickNumber)&&l.ytickNumber(_.ytickNumber);isFinite(_.tickTextSize)&&l.tickTextSize(_.tickTextSize);_.tickTextColor&&l.tickTextColor(_.tickTextColor);_.tickLineColor&&l.tickLineColor(_.tickLineColor);isFinite(_.xtickLineLength)&&l.xtickLineLength(_.xtickLineLength);isFinite(_.ytickLineLength)&&l.ytickLineLength(_.ytickLineLength);isFinite(_.axisPathWidth)&&l.axisPathWidth(_.axisPathWidth);_.axisPathColor&&l.axisPathColor(_.axisPathColor);_.legendColor&&l.legendColor(_.legendColor);isFinite(_.legendSize)&&l.legendSize(_.legendSize);X=isFinite(_.legendTranX)?_.legendTranX:X;Y=isFinite(_.legendTranY)?_.legendTranY:Y;isFinite(_.legendColumnNo)&&l.legendColumnNo(_.legendColumnNo);isFinite(_.legendRowGap)&&l.legendRowGap(_.legendRowGap);return this}};if(arguments.length===1)l.options(arguments[0]);return l};bw.model.tree=function(){var l=bw.extend();var m=_.d3;var n='树图';var q=800;var r=500;var s=q-100;var t=r;var v;var w=50;var x=0;var y=10;var z='#000';var A='Arial';var B;var C;var D=1000;var E=m.format(',');var F=l.color();var G;var H=0;var I=function(d,i){return 1};var J=function(d,i){return'#CCCCCC'};var K=function(d,i){return F(d.depth)};var L=function(d,i){return 4};var M=function(d,i){return'#CCCCCC'};var N=function(d,i){return 6};l.data=function(_){if(arguments.length){if(_.type==='xml'){_=_.root;_=XMLdata(_)}v=_;return this}else return v};l.getType=function(){return n};l.render=function(_){B=B||m.select(_).node();if(!B||B.tagName.toLowerCase()!=='div'){console.error('The argument(element) in tree.rander(_) should be <div> element')}m.select(B).classed('chart',true);C=C||m.select(B).append('svg').classed('tree',true).node();G=m.layout.tree().size([t,s]);v.x0=t/2;v.y0=0;var g=m.select(C).attr({'width':q,'height':r}).selectAll('g').data([1]).enter().append('svg:g').attr('transform','translate('+w+','+x+')');g.call(function(a){a.append('svg:g').classed('links',true);a.append('svg:g').classed('nodes',true)});v.children.forEach(toggleAll);update(v)};function update(a){var b=G.nodes(v).reverse();var c=G.links(b);var e=m.select('.nodes').selectAll('.node').data(b,function(d){return d.id||(d.id=++H)});var f=e.exit().transition().duration(D).attr('transform',function(){return'translate('+a.y+','+a.x+')'}).remove();f.select('circle').attr('r',0);f.select('text').attr('fill-opacity',0);var g=e.enter().append('svg:g').classed('node',true).style('cursor','pointer').attr('transform',function(){return'translate('+a.y0+','+a.x0+')'}).on('click',function(d){toggle(d);update(d)});g.append('svg:circle').attr('r',0).style('stroke',function(d,i){return d._children?K(d,i):M(d,i)}).style('stroke-width',1).style('fill-opacity',function(d){return d._children?0.5:0});g.append('svg:text').attr({'font-size':y,'fill':z,'font-family':A,'fill-opacity':0,'dy':'.35em'}).attr('x',function(d){return d.children||d._children?-10:10}).attr('text-anchor',function(d){return d.children||d._children?'end':'start'}).text(function(d){return d.name});var h=e.transition().duration(D).attr('transform',function(d){return'translate('+d.y+','+d.x+')'});h.select('circle').attr('r',function(d,i){return d.children||d._children?L(d,i):N(d,i)}).style('fill',function(d,i){return d.children||d._children?K(d,i):M(d,i)}).style('fill-opacity',function(d){return d.children||d._children?.5:0});h.select('text').attr('fill-opacity',1);var j=m.select('.links').selectAll('.link').data(c,function(d){return d.target.id});var k=m.svg.diagonal().projection(function(d){return[d.y,d.x]});j.enter().insert('svg:path','g').classed('link',true).style('fill','none').style('stroke',J).style('stroke-width',I).attr('d',function(){var o={x:a.x0,y:a.y0};return k({source:o,target:o})}).transition().duration(D).attr('d',k);j.transition().duration(D).attr('d',k);j.exit().transition().duration(D).attr('d',function(d){var o={x:a.x,y:a.y};return k({source:o,target:o})}).remove();b.forEach(function(d){d.x0=d.x;d.y0=d.y})}function toggleAll(d){if(d.children){d.children.forEach(toggleAll);toggle(d)}}function toggle(d){if(d.children){d._children=d.children;d.children=null}else{d.children=d._children;d._children=null}}function XMLdata(d){if(typeof d==='object'&&d.constructor===Array){var a=0;var b;var c;var u;d.forEach(function(p,i){if(p.name!==undefined){b=i;a++}if(p.value!==undefined){c=i;a++}});if(a===1){var k=d.filter(function(p,i){return i!==b});for(var i=0;i<k.length;i++){k[i].children.children=XMLdata(k[i].children.children)}u={name:d[b].name,children:d.filter(function(p,i){return i!==b}).map(function(p){return p.children.children})}}if(a===2){u={name:d[b].name,value:+d[c].value}}}return u}l.size=function(_){if(!arguments.length)return[q,r];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in tree.size(width, height) should be number and number of svg');return this}else{q=arguments[0];r=arguments[1];return this}};l.sizeAvail=function(_){if(!arguments.length)return[s,t];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in tree.sizeAvail(widthAvail, heightAvail) should be number and number of svg');return this}else{s=arguments[0];t=arguments[1];return this}};l.tran=function(_){if(!arguments.length)return[w,x];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in tree.tran(tranX, tranY) should be number and number of svg');return this}else{w=arguments[0];x=arguments[1];return this}};l.fontSize=function(_){if(!arguments.length)return y;else{if(!isFinite(arguments[0])){console.error('The arguments in tree.fontSize(fontSize) should be number of text');return this}else{y=arguments[0];return this}}};l.fontFamily=function(_){if(!arguments.length)return A;else{if(typeof arguments[0]!=='string'){console.error('The arguments in tree.fontFamily(fontFamily) should be string of text');return this}else{y=arguments[0];return this}}};l.fontColor=function(_){if(!arguments.length)return z;else{if(typeof arguments[0]!=='string'){console.error('The arguments in tree.fontColor(fontColor) should be string of text');return this}else{z=arguments[0];return this}}};l.duration=function(_){if(!arguments.length)return D;else{if(!isFinite(arguments[0])){console.error('The arguments in tree.duration(duration) should be number of transition');return this}else{D=Math.round(arguments[0]);return this}}};l.color=function(_){if(!arguments.length)return F;else{if(typeof arguments[0]!=='function'){console.error('The arguments in tree.color(color) should be function of pvisual.color');return this}else{F=arguments[0];return this}}};l.tickFormat=function(_){if(!arguments.length)return E;else{if(typeof arguments[0]!=='string'){console.error('The arguments in tree.tickFormat(format) should be string of d3.format');return this}else{E=m.format(arguments[0]);return this}}};l.lineWidth=function(_){if(!arguments.length)return I;else{if(typeof arguments[0]!=='function'&&!isFinite(arguments[0])){console.error('The arguments in tree.lineWidth(lineWidth) should be function or number');return this}else{I=m.functor(arguments[0]);return this}}};l.lineColor=function(_){if(!arguments.length)return J;else{if(typeof arguments[0]!=='function'&&typeof arguments[0]!=='string'){console.error('The arguments in tree.lineColor(lineColor) should be function or string');return this}else{J=m.functor(arguments[0]);return this}}};l.leafSize=function(_){if(!arguments.length)return L;else{if(typeof arguments[0]!=='function'&&!isFinite(arguments[0])){console.error('The arguments in tree.leafSize(leafSize) should be function or number');return this}else{L=m.functor(arguments[0]);return this}}};l.leafColor=function(_){if(!arguments.length)return K;else{if(typeof arguments[0]!=='function'&&typeof arguments[0]!=='string'){console.error('The arguments in tree.leafColor(leafColor) should be function or string');return this}else{K=m.functor(arguments[0]);return this}}};l.nodeSize=function(_){if(!arguments.length)return N;else{if(typeof arguments[0]!=='function'&&!isFinite(arguments[0])){console.error('The arguments in tree.nodeSize(nodeSize) should be function or number');return this}else{N=m.functor(arguments[0]);return this}}};l.nodeColor=function(_){if(!arguments.length)return M;else{if(typeof arguments[0]!=='function'&&typeof arguments[0]!=='string'){console.error('The arguments in tree.nodeColor(nodeColor) should be function or string');return this}else{M=m.functor(arguments[0]);return this}}};l.options=function(_){if(!arguments.length)return{'type':l.getType(),'width':q,'height':r,'widthAvail':s,'heightAvail':t,'tranX':w,'tranY':x,'format':E,'fontSize':y,'fontColor':z,'fontFamily':A,'color':F,'duration':D,'lineWidth':I,'lineColor':J,'leafSize':L,'leafColor':K,'nodeSize':N,'nodeColor':M};else if(typeof _!=='object'){console.error('The arguments in map.options(options) should be object');return this}else{q=isFinite(_.width)?_.width:q;r=isFinite(_.height)?_.height:r;s=isFinite(_.widthAvail)?_.widthAvail:s;t=isFinite(_.heightAvail)?_.heightAvail:t;w=isFinite(_.tranX)?_.tranX:w;x=isFinite(_.tranY)?_.tranY:x;_.format&&l.tickFormat(_.format);_.fontFamily&&l.fontFamily(_.fontFamily);_.fontColor&&l.fontColor(_.fontColor);isFinite(_.fontSize)&&l.fontSize(_.fontSize);isFinite(_.duration)&&l.duration(_.duration);_.lineWidth&&l.lineWidth(_.lineWidth);_.lineColor&&l.lineColor(_.lineColor);_.leafSize&&l.leafSize(_.leafSize);_.leafColor&&l.leafColor(_.leafColor);_.nodeSize&&l.nodeSize(_.nodeSize);_.nodeColor&&l.nodeColor(_.nodeColor);return this}};if(arguments.length===1)l.options(arguments[0]);return l};bw.model.treemap=function(){var f=bw.extend();var h=_.d3;var j='树状图';var l=900;var m=700;var n=l;var o=m;var q;var r=0;var s=0;var v=10;var w='#000000';var z='Arial';var A;var B;var C;var D=1000;var E=h.format(',');var F=f.color();var G;f.data=function(_){if(arguments.length){if(_.type==='xml'){_=_.root;_=XMLdata(_)}q=_;return this}else return q};f.getType=function(){return j};f.render=function(_){B=B||h.select(_).node();if(!B||B.tagName.toLowerCase()!=='div'){console.error('The argument(element) in treemap.rander(_) should be <div> element')}h.select(B).classed('chart',true);C=C||h.select(B).append('svg').classed('treemap',true).node();A=h.select(B).select('.floatTag').node()?h.select(B).select('.floatTag'):f.floatTag(B);A.style('visibility','hidden');var b=h.layout.treemap().round(false).size([n,o]).sticky(true).value(function(d){return d.value});var x=h.scale.linear().range([0,n]);var y=h.scale.linear().range([0,o]);var c=h.scale.sqrt().domain([0,1e6]).clamp(true).range([90,20]);b.nodes(q).filter(function(d){return!d.children});G=q;var g=h.select(C).attr({'width':l,'height':m}).selectAll('g').data([1]).enter().append('svg:g').attr('transform','translate('+r+','+s+')');g.call(function(a){a.append('svg:g').classed('nodes',true)});g=h.select(C).select('g');var e=g.select('.nodes').selectAll('.node').data(Array.isArray(q)?q:[q]);e.exit().transition().duration(D/2).style('opacity',0).remove();e.enter().append('svg:g').classed('node',true).on('click',function(d){return zoom(d,x,y,g,c)}).on('mouseover',function(d){drawLegend(d,true)}).on('mouseout',function(d){drawLegend(d,false)}).attr('transform',function(d){return'translate('+d.x+','+d.y+')'}).each(function(d){h.select(this).append('svg:rect').style('opacity',0).transition().duration(D).attr({'width':d.dx,'height':d.dy}).style({'opacity':1,'fill':fill(d,c)});h.select(this).append('svg:text').attr({'x':d.dx/2,'y':d.dy/2}).text(d.name).style('opacity',function(){return d.dx>this.getComputedTextLength()?1:0}).transition().duration(D).style({'dy':'.35em','text-anchor':'middle','font-family':z,'fill':w,'font-size':v})});h.select('body').on('click',function(){zoom(G,x,y,g,c)})};function fill(d,a){var p=d;while(p.depth>1)p=p.parent;var c=h.lab(F(p.name));c.l=a(d.value);return c}function drawLegend(d,a){if(a){A.style({'visibility':'visible','textAlign':'center','margin':'auto','color':'#ffffff'}).html('<p style="color:#3f7ed8; font - weight:bold; font - size:13px">name: '+d.name+'</p>value: '+E(d.value.toFixed(5)))}else{A.style('visibility','hidden')}}function zoom(d,x,y,g,a){G=d.parent||q;var b=n/d.dx;var c=o/d.dy;x.domain([d.x,d.x+d.dx]);y.domain([d.y,d.y+d.dy]);var t=g.select('.nodes').selectAll('.node').data(d.children?d.children:[d]);t.exit().transition().duration(D/2).style('opacity',0).remove();t.each(function(p){h.select(this).transition().duration(D).attr('transform','translate('+x(p.x)+','+y(p.y)+')');h.select(this).select('rect').attr({'fill':fill(p,a)}).transition().duration(D).attr({'width':b*p.dx-1<0?0:b*p.dx-1,'height':c*p.dy-1<0?0:c*p.dy-1});h.select(this).select('text').attr({'dy':'.35em','text-anchor':'middle','font-family':z,'font-size':v}).text(p.name).style('opacity',function(){return b*p.dx>this.getComputedTextLength()?1:0}).transition().duration(D).attr({'x':b*p.dx/2,'y':c*p.dy/2})});t.enter().append('svg:g').classed('node',true).attr('transform',function(p){return'translate('+x(p.x)+','+y(p.y)+')'}).on('click',function(p){return zoom(p,x,y,g,a)}).on('mouseover',function(p){drawLegend(p,true)}).on('mouseout',function(p){drawLegend(p,false)}).each(function(p){h.select(this).append('svg:rect').attr({'fill':fill(p,a),'width':0,'height':0}).transition().duration(D).attr({'width':b*p.dx-1<0?0:b*p.dx-1,'height':c*p.dy-1<0?0:c*p.dy-1});h.select(this).append('svg:text').attr({'dy':'.35em','text-anchor':'middle','font-family':z,'font-size':v}).text(p.name).style('opacity',function(){return b*p.dx>this.getComputedTextLength()?1:0}).transition().duration(D).attr({'x':b*p.dx/2,'y':c*p.dy/2})});h.event.stopPropagation()}function XMLdata(d){if(typeof d==='object'&&d.constructor===Array){var a=0;var b;var c;var u;d.forEach(function(p,i){if(p.name!==undefined){b=i;a++}if(p.value!==undefined){c=i;a++}});if(a===1){var k=d.filter(function(p,i){return i!==b});for(var i=0;i<k.length;i++){k[i].children.children=XMLdata(k[i].children.children)}u={name:d[b].name,children:d.filter(function(p,i){return i!==b}).map(function(p){return p.children.children})}}if(a===2){u={name:d[b].name,value:+d[c].value}}}return u}f.size=function(_){if(!arguments.length)return[l,m];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in treemap.size(width, height) should be number and number of svg');return this}else{l=arguments[0];m=arguments[1];return this}};f.sizeAvail=function(_){if(!arguments.length)return[n,o];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in treemap.sizeAvail(widthAvail, heightAvail) should be number and number of svg');return this}else{n=arguments[0];o=arguments[1];return this}};f.tran=function(_){if(!arguments.length)return[r,s];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in treemap.tran(tranX, tranY) should be number and number of svg');return this}else{r=arguments[0];s=arguments[1];return this}};f.fontSize=function(_){if(!arguments.length)return v;else{if(!isFinite(arguments[0])){console.error('The arguments in treemap.fontSize(fontSize) should be number of text');return this}else{v=arguments[0];return this}}};f.fontFamily=function(_){if(!arguments.length)return z;else{if(typeof arguments[0]!=='string'){console.error('The arguments in treemap.fontFamily(fontFamily) should be string of text');return this}else{v=arguments[0];return this}}};f.fontColor=function(_){if(!arguments.length)return w;else{if(typeof arguments[0]!=='string'){console.error('The arguments in treemap.fontColor(fontColor) should be string of text');return this}else{w=arguments[0];return this}}};f.duration=function(_){if(!arguments.length)return D;else{if(!isFinite(arguments[0])){console.error('The arguments in treemap.duration(duration) should be number of transition');return this}else{D=Math.round(arguments[0]);return this}}};f.color=function(_){if(!arguments.length)return F;else{if(typeof arguments[0]!=='function'){console.error('The arguments in treemap.color(color) should be function of pvisual.color');return this}else{F=arguments[0];return this}}};f.tickFormat=function(_){if(!arguments.length)return E;else{if(typeof arguments[0]!=='string'){console.error('The arguments in treemap.tickFormat(format) should be string of d3.format');return this}else{E=h.format(arguments[0]);return this}}};f.options=function(_){if(!arguments.length)return{'type':f.getType(),'width':l,'height':m,'widthAvail':n,'heightAvail':o,'tranX':r,'tranY':s,'format':E,'fontSize':v,'fontColor':w,'fontFamily':z,'color':F,'duration':D};else if(typeof _!=='object'){console.error('The arguments in map.options(options) should be object');return this}else{l=isFinite(_.width)?_.width:l;m=isFinite(_.height)?_.height:m;n=isFinite(_.widthAvail)?_.widthAvail:n;o=isFinite(_.heightAvail)?_.heightAvail:o;r=isFinite(_.tranX)?_.tranX:r;s=isFinite(_.tranY)?_.tranY:s;_.format&&f.tickFormat(_.format);_.fontFamily&&f.fontFamily(_.fontFamily);_.fontColor&&f.fontColor(_.fontColor);isFinite(_.fontSize)&&f.fontSize(_.fontSize);isFinite(_.duration)&&f.duration(_.duration);return this}};if(arguments.length===1)f.options(arguments[0]);return f};bw.model.wordcloud=function(){var c=bw.extend();var e=_.d3;var f='Word Cloud';var h=700;var j=500;var l=h;var m=j;var n;var o=0;var q=0;var r;var t;var u=1000;var v=e.format('s');var w=c.color();var x=function(d,i){return d.value*3};var y=function(d,i){return w(i)};var z=function(d,i){return'Impact'};var A=1;var B=false;c.data=function(_){if(arguments.length){if(_.type==='xml'){_=_.root;_=_.map(function(d){var a={};d.row.row.forEach(function(p){var k=bw.keys(p)[0];a[k]=p[k]});return a})}else if(_.type==='xlsx'||_.type==='xls'){var s=[];for(var i=0;i<_.length;i++){var k=bw.keys(_[i])[0];s=s.concat(_[i][k])}_=s}n=_;return this}else return n};c.getType=function(){return f};c.render=function(_){r=r||e.select(_).node();if(!r||r.tagName.toLowerCase()!=='div'){console.error('The argument(element) in wordcloud.rander(_) should be <div> element')}e.select(r).classed('chart',true);t=t||e.select(r).append('svg').classed('wordcloud',true).node();var g=e.select(t).attr({'width':h,'height':j}).selectAll('g').data([1]).enter().append('svg:g').attr('transform','translate('+o+','+q+')');g.call(function(a){a.append('svg:g').classed('texts',true).attr('transform','translate('+h/2+','+j/2+')')});e.layout.cloud().size([l,m]).words(n.map(function(d){return{text:d.text,size:x(d),url:d.url||''}})).padding(A).rotate(function(){return B?(Math.random()*2)*90:~~(Math.random()*2)*90}).font(z).fontSize(function(d){return d.size}).on('end',textDraw).start()};function textDraw(a){var b=e.select(t).select('.texts').selectAll('.text').data(a);b.exit().transition().duration(u).style('opacity',0).remove();b.attr('xlink:href',function(d){return d.url}).select('text').transition().duration(u).style('fill',function(d,i){return w(i)}).attr('transform',function(d){return'translate('+[d.x,d.y]+')rotate('+d.rotate+')'}).text(function(d){return d.text});b.enter().append('svg:a').classed('text',true).attr('xlink:href',function(d){return d.url}).style('text-decoration','none').append('svg:text').style('fill',function(d,i){return w(i)}).transition().duration(u).style('font-size',function(d){return d.size+'px'}).style('font-family',z).attr('text-anchor','middle').attr('transform',function(d){return'translate('+[d.x,d.y]+')rotate('+d.rotate+')'}).text(function(d){return d.text})}c.size=function(_){if(!arguments.length)return[h,j];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in wordcloud.size(width, height) should be number and number of svg');return this}else{h=arguments[0];j=arguments[1];return this}};c.sizeAvail=function(_){if(!arguments.length)return[l,m];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in wordcloud.sizeAvail(widthAvail, heightAvail) should be number and number of svg');return this}else{l=arguments[0];m=arguments[1];return this}};c.tran=function(_){if(!arguments.length)return[o,q];else if(arguments.length!==2||!isFinite(arguments[0])||!isFinite(arguments[1])){console.error('The argument(element) in wordcloud.tran(tranX, tranY) should be number and number of svg');return this}else{o=arguments[0];q=arguments[1];return this}};c.fontSize=function(_){if(!arguments.length)return x;else{if(typeof arguments[0]!=='function'&&!isFinite(arguments[0])){console.error('The arguments in wordcloud.fontSize(fontSize) should be function or number');return this}else{x=e.functor(arguments[0]);return this}}};c.fontFamily=function(_){if(!arguments.length)return z;else{if(typeof arguments[0]!=='function'&&typeof arguments[0]!=='string'){console.error('The arguments in wordcloud.fontFamily(fontFamily) should be function or string');return this}else{z=e.functor(arguments[0]);return this}}};c.fontColor=function(_){if(!arguments.length)return y;else{if(typeof arguments[0]!=='function'&&typeof arguments[0]!=='string'){console.error('The arguments in wordcloud.fontColor(fontColor) should be function or string');return this}else{y=e.functor(arguments[0]);return this}}};c.duration=function(_){if(!arguments.length)return u;else{if(!isFinite(arguments[0])){console.error('The arguments in wordcloud.duration(duration) should be number of transition');return this}else{u=Math.round(arguments[0]);return this}}};c.color=function(_){if(!arguments.length)return w;else{if(typeof arguments[0]!=='function'){console.error('The arguments in wordcloud.color(color) should be function of pvisual.color');return this}else{w=arguments[0];return this}}};c.tickFormat=function(_){if(!arguments.length)return v;else{if(typeof arguments[0]!=='string'){console.error('The arguments in wordcloud.tickFormat(format) should be string of d3.format');return this}else{v=e.format(arguments[0]);return this}}};c.padding=function(_){if(!arguments.length)return A;else{if(!isFinite(arguments[0])){console.error('The arguments in wordcloud.padding(padding) should be number');return this}else{A=arguments[0];return this}}};c.isRandom=function(_){if(!arguments.length)return B;else{if(typeof arguments[0]!==true&&typeof arguments[0]!==false){console.error('The arguments in wordcloud.isRandom(random) should be bool');return this}else{B=arguments[0];return this}}};c.options=function(_){if(!arguments.length)return{'type':c.getType(),'width':h,'height':j,'widthAvail':l,'heightAvail':m,'tranX':o,'tranY':q,'format':v,'fontSize':x,'fontColor':y,'fontFamily':z,'color':w,'duration':u,'padding':A,'isRandom':B};else if(typeof _!=='object'){console.error('The arguments in map.options(options) should be object');return this}else{h=isFinite(_.width)?_.width:h;j=isFinite(_.height)?_.height:j;l=isFinite(_.widthAvail)?_.widthAvail:l;m=isFinite(_.heightAvail)?_.heightAvail:m;o=isFinite(_.tranX)?_.tranX:o;q=isFinite(_.tranY)?_.tranY:q;_.format&&c.tickFormat(_.format);_.fontFamily&&c.fontFamily(_.fontFamily);_.fontSize&&c.fontSize(_.fontSize);_.fontColor&&c.fontColor(_.fontColor);isFinite(_.duration)&&c.duration(_.duration);isFinite(_.padding)&&c.padding(_.padding);_.random&&c.random(_.random);return this}};if(arguments.length===1)c.options(arguments[0]);return c};function validData(a){if(a===null)return false;if(a==='')return false;return true}function getAttributes(a){var b=this;var c;var f;if(typeof(a[0])==='number'){c='numeric'}else if(typeof(a[0])==='string'){f=[];a.forEach(function(e){f.push(e)});f.sort();for(var i=1;i<f.length;i++)if(f[i-1]===f[i]){f.splice(i-1,1);i--}c=f}else if(a[0].constructor===Array){c='array'}else{c={};var g=bw.keys(a[0]);g.forEach(function(d){f=new Array;a.forEach(function(e){f.push(e[d])});c[d]=getAttributes.call(b,f)})}return c}function dataConvert(a,b,c){var d=this;var e;if(a.constructor===Array){var f=getAttributes.call(d,a);e={meta:{name:b,numInstances:a.length,isNested:false,numAttributes:bw.keys(a[0]).length,numMiss:c,attributes:f},data:a}}else{e={meta:{name:b,isNested:true},data:a}}return e}function compareStructure(a,b,c){var d=this;d.flag=true;if(!validData(a)){d.flag=false;console.error('Wrong input in data 1. Automatically delete data 1.');d.numMiss++;d.data.splice(0,1);return true}else if(!validData(b)){d.flag=false;console.error('Wrong input in data '+(c+1)+'. Automatically delete data '+(c+1)+'.');d.numMiss++;d.data.constructor===Array&&d.data.splice(c,1);return true}if(typeof(a)!==typeof(b))return false;else if(typeof(a)==='string'||typeof(a)==='number')return true;else if(typeof(a)==='object'){var e,dimension2;if(a.constructor===Array)e=dimension2=Object.keys(a);else{e=bw.keys(a);dimension2=bw.keys(b);if(e.length!==dimension2.length)return false}for(var j=0;j<e.length;j++){var f=a[e[j]];var g=b[dimension2[j]];if(!d.flag)break;if(!compareStructure.call(d,f,g,c)){return false}}return true}}function compareObject(a){var b=this;if(typeof a==='number'||typeof a==='string')return true;var c=bw.keys(a);for(var j=0;j<c.length;j++){if(typeof a[c[j]]==='object')if(a.constructor===Array&&a.length>1){for(var i=1,item;i<a.length;i++){if(!b.flag)i--;item=a[i];if(i<a.length){if(!compareStructure.call(b,a[0],item,i))console.error(((i===0)||(i===1))?'Wrong data structure: 0 or 1':'Wrong data structure: '+(i+1))}else break}}else{if(!compareObject.call(b,a[c[j]]))return false}}return true}function xmlToArray(a,b,c){var d=a.children;c[b]=d;b++;if(d.length===0){var e=a.textContent;b--;if(e==='0')return 0;else return+e||e}else{var f={};var g=c[b-1].length;if(g===1){f[c[b-1][0].tagName]=xmlToArray(c[b-1][0],b,c)}else{var o=[];for(var j=0;j<g;j++){var h={};h[c[b-1][j].tagName]=xmlToArray(c[b-1][j],b,c);o.push(h)}f[a.tagName]=o}b--;return f}}_.pvisual=bw}(window));